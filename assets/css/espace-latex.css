/* === ESPACEMENT FIABLE AUTOUR DES FORMULES MATHJAX INLINE === */
/* Couvre SVG & CHTML, et les variantes display="false"/"inline" */
.statement mjx-container:not([display="true"]),
.steps     mjx-container:not([display="true"]) {
  display: inline-block !important;   /* pour que margin-left/right s'appliquent bien */
  margin: 0 .3ch !important;          /* ajuste entre .25ch et .4ch selon ton goût */
  vertical-align: baseline;
}

/* Pas d’espace ajouté en bord de ligne */
.statement mjx-container:not([display="true"]):first-child { margin-left: 0 !important; }
.statement mjx-container:not([display="true"]):last-child  { margin-right: 0 !important; }
.steps     mjx-container:not([display="true"]):first-child { margin-left: 0 !important; }
.steps     mjx-container:not([display="true"]):last-child  { margin-right: 0 !important; }

/* Affichages bloc (équations centrées) */
.statement mjx-container[display="true"],
.steps     mjx-container[display="true"] {
  margin: .6em 0 .5em !important;
}

/* Filet de sécurité: insère une fine espace si un reset CSS neutralise les marges */
.statement mjx-container:not([display="true"])::before,
.statement mjx-container:not([display="true"])::after,
.steps     mjx-container:not([display="true"])::before,
.steps     mjx-container:not([display="true"])::after {
  content: "\2009"; /* thin space */
}
.statement mjx-container:not([display="true"]):first-child::before,
.statement mjx-container:not([display="true"]):last-child::after,
.steps     mjx-container:not([display="true"]):first-child::before,
.steps     mjx-container:not([display="true"]):last-child::after {
  content: "";
}

  /* Espacement autour des formules inline dans les énoncés */
  .statement mjx-container{padding:.05rem .35rem;border-radius:6px;margin:0 .35rem;display:inline-block;white-space:nowrap}
  .statement mjx-container:first-child, .equ:first-child{ margin-left:0 }
  .statement mjx-container:last-child,  .equ:last-child{  margin-right:0 }
  
  /* Espacement autour des formules inline dans les étapes */
.step mjx-container:not([display="block"]){
  display:inline-block;
  padding:.05rem .35rem;
  margin:0 .35rem;
  border-radius:6px;
  white-space:nowrap;
}
.step mjx-container:not([display="block"]):first-child{ margin-left:0 }
.step mjx-container:not([display="block"]):last-child{  margin-right:0 }


  /* Espacement autour des formules inline dans les énoncés */
  .qa mjx-container{padding:.05rem .35rem;border-radius:6px;margin:0 .35rem;display:inline-block;white-space:nowrap}
  .qa mjx-container:first-child, .equ:first-child{ margin-left:0 }
  .qa mjx-container:last-child,  .equ:last-child{  margin-right:0 }
  
    .wrap mjx-container{padding:.05rem .15rem;border-radius:6px;margin:0 .15rem;display:inline-block;white-space:nowrap}
  .wrap mjx-container:first-child, .equ:first-child{ margin-left:0 }
  .wrap mjx-container:last-child,  .equ:last-child{  margin-right:0 }
  
/* ——— PATCH primes MathJax ——— */
.statement mjx-container:not([display="true"]),
.steps     mjx-container:not([display="true"]),
.step      mjx-container:not([display="block"]),
.wrap      mjx-container,
.qa        mjx-container{
  /* on garde la marge, mais on enlève tout ce qui altère la boîte interne */
  margin: 0 .3ch !important;
  padding: 0 !important;                 /* retire le rembourrage qui casse le serrage */
  vertical-align: initial !important;    /* rend la main à MathJax pour l’alignement */
  white-space: normal !important;        /* pas de contrainte de non-retour */
}

/* supprime les espaces injectés autour des formules (peuvent décaler le prime) */
.statement mjx-container:not([display="true"])::before,
.statement mjx-container:not([display="true"])::after,
.steps     mjx-container:not([display="true"])::before,
.steps     mjx-container:not([display="true"])::after{
  content: "" !important;
}
/* ====== Corrigé (.steps) : abaisse le prime MathJax ====== */

/* 0) On évite toute fantaisie de boîte inline autour des formules,
      ça garde des métriques stables pour le calcul du script. */
.steps mjx-container:not([display="true"]) {
  display: inline !important;         /* pas inline-block */
  padding: 0 !important;
  white-space: normal !important;
  margin: 0 .3ch !important;          /* tu gardes ta marge externe */
  vertical-align: baseline !important;
  line-height: normal !important;
}

/* 1) MATHJAX **SVG** : le prime est un <use class="mjx-c2032"> dans un msup.
      On lui ajoute une translation *vers le bas* de ~0.08em. */
.steps mjx-container[jax="SVG"] g[data-mml-node="msup"]
       > g[data-mml-node="mo"] use.mjx-c2032,
.steps mjx-container[jax="SVG"] g[data-mml-node="msup"]
       > g[data-mml-node="mo"] use.mjx-c2033,
.steps mjx-container[jax="SVG"] g[data-mml-node="msup"]
       > g[data-mml-node="mo"] use.mjx-c2034 {
  transform: translateY(0.08em) !important;
}

/* 2) MATHJAX **CHTML** (au cas où tu repasses en CHTML un jour) :
      même idée, mais on cible l’élément du script dans mjx-msup. */
.steps mjx-msup > mjx-script > mjx-mo .mjx-c2032,
.steps mjx-msup > mjx-script > mjx-mo .mjx-c2033,
.steps mjx-msup > mjx-script > mjx-mo .mjx-c2034 {
  position: relative !important;
  top: .08em !important;   /* abaissement identique à l’offset SVG */
}
/* ——— Boîte grisée neutre pour la solution (n'altère pas MathJax) ——— */
.solbox{
  background:#f6f6f6;
  border:1px dashed #e3e3e3;
  border-radius:8px;
  padding:.6rem .7rem;
  margin:.45rem 0 0 .15rem;
}
.solbox p{ margin:.25rem 0; }
