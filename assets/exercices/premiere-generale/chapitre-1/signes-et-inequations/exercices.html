<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Premi√®re ‚Äì In√©quations du second degr√© (Œî carr√© parfait) ‚Äî Tableau de signe</title>

<link rel="stylesheet" href="../../../../css/math-kbd.css">
<link rel="stylesheet" href="../../../../css/espace-gras.css">

<style>
   *{box-sizing:border-box}
  :root{--ink:#111;--bg:#fafafa;--card:#fff;--line:#e6e6e6;--ok:#11823b;--ko:#b00020}
  html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.55 system-ui,Segoe UI,Roboto,Arial}
  .header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;padding:14px 18px;z-index:5}
  .wrap{max-width:1200px;margin:0 auto;padding:18px;display:flex;flex-direction:column;gap:12px}
  .card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
  .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  select,input[type="text"]{padding:8px 10px;border:1px solid #ddd;border-radius:8px;font-size:15px}
  .btn{padding:8px 12px;border:1px solid #ddd;background:#fff;border-radius:8px;cursor:pointer}
  .btn:hover{background:#f6f6f6}
  .score{margin-left:auto}

  .equ{font-variant-numeric:tabular-nums}
  .steps{margin:.6rem 0 0 .15rem;padding:.6rem .7rem;background:#f7f8fb;border:1px dashed #c7d2fe;border-radius:10px}
  .table{width:100%;border-collapse:collapse;margin:.35rem 0}
  .table th,.table td{border:1px solid #e5e5e5;padding:6px 8px;vertical-align:top}
  .table th{background:#f3f3f6;text-align:left}

  .frac{display:inline-flex;flex-direction:column;align-items:center;justify-content:center;vertical-align:middle;line-height:1}
  .frac .bar{display:block;border-top:1px solid #000;width:100%;margin:.08em 0}
  .frac .num,.frac .den{padding:0 .15em}
  .frac-sign{display:inline-block;margin-right:.08em;vertical-align:middle}

.sign-table{
  width:100%;
  border:2px solid #000;
  border-collapse:separate;
  border-spacing:0;
  table-layout:fixed;
  --zeroW: 110px;
}
.sign-table col.col-lbl{ width: 96px; }
.sign-table col.col-zero{ width: var(--zeroW); }
.sign-table col.col-int{ width:auto; }

.sign-table th, .sign-table td{
  padding:8px 6px; text-align:center; vertical-align:middle;
  border-top:1px solid #000;
  border-bottom:1px solid #000;
  border-right:none; border-left:none;
}

.sign-table .lbl{
  font-weight:600;
  border-right:2px solid #000;
  white-space:nowrap;
}

.sign-table td.int{ border-left:0 !important; border-right:0 !important; }
.sign-table td.zero{ border-left:0 !important; border-right:0 !important; }
.sign-table .cap-left{ text-align:left; padding-left:8px; }
.sign-table .cap-right{ text-align:right; padding-right:8px; }

.sign-table .sel, .sign-table .root{
    width: var(--zeroW);
    height: 34px;
    line-height: 1.2;
    font-size: 16px;
    padding: 6px 8px;
    border:1px solid #cbd5e1; border-radius:8px;
    text-align:center; box-sizing:border-box;
    margin:0 auto; display:block; background:#fff;
  }
.sign-table .sel{
  -webkit-appearance:none; -moz-appearance:none; appearance:none;
  text-align-last:center;
}

.sign-table{ font-size:1.15rem; }
.sign-table th, .sign-table td{
  padding:10px 14px;
}
.sign-table .cell{ width:84px; height:44px; font-size:1.12rem; }
.sign-table .sel{ height:40px; min-width:84px; text-align-last:center; }
.sign-table .root{ min-width:110px; height:40px; font-size:1.12rem; }

  @media print{ .controls{display:none !important;} }

.sign-table .cell-inline{ display:inline-flex; align-items:center; justify-content:center; gap:6px; }
.tick{ min-width:1.1em; font-weight:700; font-size:16px; line-height:1; vertical-align:middle; }
.tick.ok{ color:#16a34a; }
.tick.ko{ color:#dc2626; }
.tick.nu{ color:transparent; }

.pdf-large.sign-table{
  font-size: 1.35rem;
  --zeroW: 140px;
}
.pdf-large.sign-table th,
.pdf-large.sign-table td{
  padding: 14px 16px;
}
.pdf-large.sign-table td,
.pdf-large.sign-table th{
  text-align: center !important;
  vertical-align: middle !important;
}
.pdf-large.sign-table .lbl{ text-align: center !important; }
</style>
</head>
<body>
  <div class="header">
    <h1 style="margin:0;font-size:1.1rem"><strong>Premi√®re ‚Äì In√©quations du second degr√©</strong></h1>
  </div>

  <div class="wrap">
    <div class="controls card">
      <label for="exo-select"><strong>Type d‚Äôexercice :</strong></label>
      <select id="exo-select"></select>
      <button id="btn-new" class="btn">üîÑ Nouvel √©nonc√©</button>
      <button id="btn-check" class="btn">‚úÖ V√©rifier</button>
      <button id="btn-solution" class="btn">üí° Solution</button>
      <button id="btn-reset" class="btn">üßπ R√©initialiser</button>
      <span class="score">Score : <span id="score">0 / 0</span></span>
    </div>

    <div class="card" id="host"></div>

    <div class="card small">
      <hr><strong>Saisie &amp; r√©ponses accept√©es :</strong>
<ul style="margin:.5rem 0 0 18px">
  <li><b>Entr√©e ‚èé</b> d√©clenche <b>V√©rifier</b>. Les ‚úì/‚úó n‚Äôapparaissent que lors de la v√©rification.</li>
  <li><b>Colonnes extr√™mes :</b> <code>‚àí‚àû</code> (gauche) et <code>+‚àû</code> (droite) sont fixes.</li>
  <li><b>Ligne x :</b>
    <ul>
      <li><b>r‚ÇÅ</b> et <b>r‚ÇÇ</b> acceptent : entier (<code>-1</code>), fraction <code>p/q</code> (<code>7/2</code>‚Ä¶), ou d√©cimal (<code>3.5</code> / <code>3,5</code>). Les fractions seront rendues <span style="font-style:normal;">en pile</span> dans la correction et dans le tableau.</li>
      <li><b>Œ± doit rester vide</b> (pour cet exercice).</li>
    </ul>
  </li>
  <li><b>Ligne f(x) :</b>
    <ul>
      <li>Sous <b>r‚ÇÅ</b> et <b>r‚ÇÇ</b> : choisir <code>0</code>.</li>
      <li>Dans les intervalles : choisir <code>+</code> ou <code>‚àí</code> (signe de a √† l‚Äôext√©rieur, signe oppos√© √† l‚Äôint√©rieur).</li>
    </ul>
  </li>
  <li><b>Score :</b> une case laiss√©e vide n‚Äôest <b>pas</b> comptabilis√©e. Œ± laiss√©e vide est correcte.</li>
  <li><b>√âcriture de S :</b>
    <ul>
      <li>Union : <code>‚à™</code> ou <code>U</code>.</li>
      <li>Bornes : <code>]</code>‚Ä¶<code>[</code> pour ouvert ; <code>[</code>‚Ä¶<code>]</code> pour ferm√©.</li>
      <li>Infini : accepter <code>-‚àû</code>/<code>-oo</code> et <code>+‚àû</code>/<code>+oo</code>.</li>
      <li>Exemples : <code>] ‚àí‚àû ; r‚ÇÅ [ ‚à™ ] r‚ÇÇ ; +‚àû [</code> ; <code>[ r‚ÇÅ ; r‚ÇÇ ]</code>.</li>
    </ul>
  </li>
</ul>
    </div>

    <div class="card"><div data-math-kbd style="display:flex;justify-content:center"></div></div>
  </div>

  <script src='../../../../js/dev-rules-clean.dedup.js' defer></script>
  <script src='../../../../js/exo-pdf-kit.multiplicatif.js' defer></script>
  <script src='../../../../js/math-kbd.js' defer></script>
  <script src='../../../../js/algebra-eval-patch.multiplicatif.js' defer></script>

  <script>
'use strict';
function $(s,r){ return (r||document).querySelector(s); }
function $all(s,r){ return Array.prototype.slice.call((r||document).querySelectorAll(s)); }
var scoreOK=0, scoreTot=0;
function updateScore(){ var el=$("#score"); if(el) el.textContent = scoreOK+" / "+scoreTot; }
function rnd(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
function choice(a){ return a[Math.floor(Math.random()*a.length)]; }
function setCmpRandom(host, st){
  var opts=['<','>','<=','>='];
  var pick = (st && st.cmp) ? st.cmp : opts[Math.floor(Math.random()*opts.length)];
  st.cmp = pick;
  var el = (host && host.querySelector) ? host.querySelector('#cmp') : null;
  if(el){ el.value = pick; }
}

var UMINUS = (window.DevRules && DevRules.consts && DevRules.consts.UMINUS) || '‚àí';

function gcd(a,b){ a=Math.abs(a); b=Math.abs(b); while(b){ var t=a%b; a=b; b=t; } return a||1; }
function isSquare(n){ if(n<0) return false; var r=Math.floor(Math.sqrt(n)); return r*r===n; }
function simplify(p,q){
  if(q<0){ p=-p; q=-q; }
  var g=gcd(Math.abs(p),Math.abs(q)); return [p/g, q/g];
}
function fracHTML(p,q){
  var neg = (p<0)!==(q<0); p=Math.abs(p); q=Math.abs(q);
  var g=gcd(p,q); p/=g; q/=g;
  if(q===1) return (neg? '<span class="frac-sign">'+UMINUS+'</span>':'') + p;
  return (neg? '<span class="frac-sign">'+UMINUS+'</span>':'')+
         '<span class="frac"><span class="num">'+p+'</span><span class="bar"></span><span class="den">'+q+'</span></span>';
}
function fracRaw(p,q){
  function s(n){ return String(n).replace(/-/g,'‚àí'); }
  return '<span class="frac"><span class="num">'+s(p)+'</span><span class="bar"></span><span class="den">'+s(q)+'</span></span>';
}
function numToFracHTML(x){
  if (Math.floor(x)===x) return String(x).replace(/-/g,'‚àí');
  var qMax=16;
  for(var q=2;q<=qMax;q++){
    var p=Math.round(x*q);
    if (Math.abs(x - p/q) < 1e-10) return fracHTML(p,q);
  }
  return String(x).replace(/-/g,'‚àí');
}

function polyHTML(a,b,c){
  function kx2(k){ if(k===1) return 'x<sup>2</sup>'; if(k===-1) return UMINUS+'x<sup>2</sup>'; if(k<0) return UMINUS+' '+Math.abs(k)+'x<sup>2</sup>'; return k+'x<sup>2</sup>'; }
  function kx(k){ if(k===0) return ''; var s=(k>0?' + ':' '+UMINUS+' '); var v=Math.abs(k); return (v===1)? s+'x' : s+v+'x'; }
  function kc(k){ if(k===0) return ''; var s=(k>0?' + ':' '+UMINUS+' '); return s+Math.abs(k); }
  var s='';
  if(a!==0) s = kx2(a);
  s += kx(b);
  s += kc(c);
  s = s.replace(/^ \+ /,'');
  return s||'0';
}

function genInEq(){
  for(var tries=0;tries<999;tries++){
    var a = choice([-3,-2,-1,1,2,3]);
    var b = rnd(-9,9);
    var c = rnd(-9,9);
    if(a===0) continue;
    var D = b*b - 4*a*c;
    if(D>0 && isSquare(D)){
      var r = Math.sqrt(D);
      var x1 = (-b - r)/(2*a);
      var x2 = (-b + r)/(2*a);
      if (Math.abs(x1-x2)>1e-12){
        var rmin = Math.min(x1,x2);
        var rmax = Math.max(x1,x2);
        return {a:a,b:b,c:c,delta:D,r:rmin,s:rmax};
      }
    }
  }
  var a2=-2,b2=5,c2=7,D2=81; return {a:a2,b:b2,c:c2,delta:D2,r:-1,s:7/2};
}

function signTableHTML(st){
  return [
  '<div class="signwrap">',
    '<table id="signTable" class="sign-table" aria-label="Tableau de signe">',
      '<colgroup>',
        '<col class="col-lbl">',
        '<col class="col-int">',
        '<col class="col-zero">',
        '<col class="col-int">',
        '<col class="col-zero">',
        '<col class="col-int">',
      '</colgroup>',
      '<tbody>',
        '<tr>',
          '<th class="lbl">x</th>',
          '<td class="int cap-left">‚àí‚àû</td>',
          '<td class="zero">',
            '<div class="cell-inline">',
              '<input id="r1" class="root" placeholder="r‚ÇÅ">',
              '<span id="ok_r1" class="tick nu"></span>',
            '</div>',
          '</td>',
          '<td class="int">',
            '<div class="cell-inline">',
              '<input id="alpha" class="root" placeholder="Œ±">',
              '<span id="ok_alpha" class="tick nu"></span>',
            '</div>',
          '</td>',
          '<td class="zero">',
            '<div class="cell-inline">',
              '<input id="r2" class="root" placeholder="r‚ÇÇ">',
              '<span id="ok_r2" class="tick nu"></span>',
            '</div>',
          '</td>',
          '<td class="int cap-right">+‚àû</td>',
        '</tr>',
        '<tr>',
          '<th class="lbl">f(x)</th>',
          '<td class="int">',
            '<div class="cell-inline">',
              '<select id="s1" class="sel">',
                '<option value=""></option><option>+</option><option>‚àí</option>',
              '</select>',
              '<span id="ok_s1" class="tick nu"></span>',
            '</div>',
          '</td>',
          '<td class="zero">',
            '<div class="cell-inline">',
              '<select id="z1" class="sel">',
                '<option value=""></option><option>0</option>',
              '</select>',
              '<span id="ok_z1" class="tick nu"></span>',
            '</div>',
          '</td>',
          '<td class="int">',
            '<div class="cell-inline">',
              '<select id="s2" class="sel">',
                '<option value=""></option><option>+</option><option>‚àí</option><option>0</option>',
              '</select>',
              '<span id="ok_s2" class="tick nu"></span>',
            '</div>',
          '</td>',
          '<td class="zero">',
            '<div class="cell-inline">',
              '<select id="z2" class="sel">',
                '<option value=""></option><option>0</option>',
              '</select>',
              '<span id="ok_z2" class="tick nu"></span>',
            '</div>',
          '</td>',
          '<td class="int">',
            '<div class="cell-inline">',
              '<select id="s3" class="sel">',
                '<option value=""></option><option>+</option><option>‚àí</option>',
              '</select>',
              '<span id="ok_s3" class="tick nu"></span>',
            '</div>',
          '</td>',
        '</tr>',
      '</tbody>',
    '</table>',
  '</div>'
  ].join('');
}
function buildHost(st){
  var P = polyHTML(st.a,st.b,st.c);
  return [
    '<div class="equ"><strong>R√©soudre l‚Äôin√©quation dans ‚Ñù suivante :</strong> ', P,
    ' <select id="cmp" style="margin:0 6px;"><option value="<">&lt; 0</option><option value=">">&gt; 0</option><option value="<=">&le; 0</option><option value=">=">&ge; 0</option></select></div>',
    signTableHTML(st),
    '<div style="margin-top:.6rem">',
      '<div><label><strong>S=</strong>&nbsp;</label> <input id="ansSet" class="inp" placeholder="ex. ]‚àí‚àû ; r‚ÇÅ[ ‚à™ ]r‚ÇÇ ; +‚àû[" style="min-width:340px"> <span id="ok_S" class="tick nu"></span></div>',
      '<div style="margin-top:.25rem"><em>Astuce&nbsp;:</em> compl√©ter le tableau, puis √©crire S.</div>',
    '</div>',
    '<div id="res" style="margin-top:.6rem"></div>'
  ].join('');
}

function parseNumber(s){
  if(!s) return NaN;
  s = (''+s).trim().replace(/‚àí/g,'-');
  var m = s.match(/^([+-]?\d+)\s*\/\s*([+-]?\d+)$/);
  if(m){
    var p=parseInt(m[1],10), q=parseInt(m[2],10);
    if(q===0) return NaN;
    return p/q;
  }
  var v = Number(s.replace(',','.'));
  return isFinite(v)? v : NaN;
}

function getCmpFrom(host){
  var elLocal = host && host.querySelector ? host.querySelector('#cmp') : null;
  if(elLocal && typeof elLocal.value !== 'undefined') return elLocal.value;
  try{
    var st = host && host.dataset && host.dataset.state ? JSON.parse(host.dataset.state) : null;
    if(st && st.cmp){ return st.cmp; }
  }catch(e){}
  var elGlobal = document.getElementById('cmp');
  if(elGlobal && typeof elGlobal.value !== 'undefined') return elGlobal.value;
  return '<';
}

function check(host, st){
  var ok=0, tot=0;
  var r1 = parseNumber(($("#r1",host)||{}).value||'');
  var r2 = parseNumber(($("#r2",host)||{}).value||'');
  if(!isNaN(r1)){ tot++; if(Math.abs(r1-st.r)<1e-6) ok++; }
  if(!isNaN(r2)){ tot++; if(Math.abs(r2-st.s)<1e-6) ok++; }

  var a = st.a;
  var outSign = (a>0? '+':'‚àí');
  var inSign  = (a>0? '‚àí':'+');

  var s1=($("#s1",host)||{}).value||'', s2=($("#s2",host)||{}).value||'', s3=($("#s3",host)||{}).value||'';
  var z1=($("#z1",host)||{}).value||'', z2=($("#z2",host)||{}).value||'';
  function scoreOne(val, exp){ if(val){ tot++; if(val===exp) ok++; } }
  scoreOne(s1,outSign); scoreOne(s2,inSign); scoreOne(s3,outSign);
  scoreOne(z1,'0'); scoreOne(z2,'0');

  var ansSet = (($("#ansSet",host)||{}).value||'').trim();
  if(ansSet){
    tot++;
    function parseIntervals(txt){
      var t = txt.replace(/\s/g,'').replace(/‚àí/g,'-');
      var parts = t.split(/‚à™|U|u/).filter(function(x){return x;});
      var ints = [];
      for(var i=0;i<parts.length;i++){
        var p = parts[i];
        var left = p.charAt(0), right = p.charAt(p.length-1);
        var inner = p.slice(1,-1);
        var semi = inner.indexOf(';');
        if(semi<0) continue;
        var Araw = inner.slice(0,semi);
        var Braw = inner.slice(semi+1);
        var A = (Araw==='-‚àû'||Araw==='-oo') ? -Infinity : parseNumber(Araw);
        var B = (Braw==='+‚àû'||Braw==='+oo') ?  Infinity : parseNumber(Braw);
        ints.push({A:A,B:B,left:left,right:right});
      }
      return ints;
    }
    function inU(x,U){
      for(var i=0;i<U.length;i++){
        var I = U[i];
        var okL = (I.left===']'? x>I.A : x>=I.A);
        var okR = (I.right==='['? x<I.B : x<=I.B);
        if(okL && okR) return true;
      }
      return false;
    }
    var U = parseIntervals(ansSet);
    var cmp = getCmpFrom(host);
    var EPS=1e-9;
    function inside(x){
      var y = st.a*x*x + st.b*x + st.c;
      if(cmp==='<') return y < -EPS;
      if(cmp==='>') return y >  EPS;
      if(cmp==='<=')return y <= EPS;
      if(cmp=== '>=')return y >=-EPS;
      return y < -EPS;
    }
    var tests = [st.r-1, st.r, (st.r+st.s)/2, st.s, st.s+1];
    var okSet = true;
    for(var ti=0;ti<tests.length;ti++){
      var x = tests[ti];
      if( inU(x,U) !== inside(x) ){ okSet=false; break; }
    }
    if(okSet) ok++;
  }

  scoreTot+=tot; scoreOK+=ok; updateScore();
}

function cmpSymbol(cmp){
  if(cmp==='<=') return '‚â§';
  if(cmp=== '>=') return '‚â•';
  if(cmp=== '<') return '<';
  if(cmp=== '>') return '>';
  return '<';
}

function solutionHTML(st, cmp){
  var a=st.a,b=st.b,c=st.c,D=st.delta;
  var r = Math.sqrt(D);
  var x1n = -b - r, x2n = -b + r, den = 2*a;
  var s1 = simplify(x1n,den);
  var s2 = simplify(x2n,den);
  var x1html = fracHTML(s1[0],s1[1]);
  var x2html = fracHTML(s2[0],s2[1]);
  var r1 = st.r, r2 = st.s;
  var P = polyHTML(a,b,c);
  function solSetFor(a,r1,r2,cmpVal){
    var Lopen=']', Ropen='[', Lclosed='[', Rclosed=']';
    var r1H=numToFracHTML(r1), r2H=numToFracHTML(r2);
    if(a>0){
      if(cmpVal==='<' ) return Lopen+' '+r1H+' ; '+r2H+' '+Ropen;
      if(cmpVal==='<=') return Lclosed+' '+r1H+' ; '+r2H+' '+Rclosed;
      if(cmpVal==='>' ) return '] ‚àí‚àû ; '+r1H+' [ ‚à™ ] '+r2H+' ; +‚àû [';
      if(cmpVal==='>=') return '] ‚àí‚àû ; '+r1H+' ] ‚à™ [ '+r2H+' ; +‚àû [';
    } else {
      if(cmpVal==='<' ) return '] ‚àí‚àû ; '+r1H+' [ ‚à™ ] '+r2H+' ; +‚àû [';
      if(cmpVal==='<=') return '] ‚àí‚àû ; '+r1H+' ] ‚à™ [ '+r2H+' ; +‚àû [';
      if(cmpVal==='>' ) return Lopen+' '+r1H+' ; '+r2H+' '+Ropen;
      if(cmpVal==='>=') return Lclosed+' '+r1H+' ; '+r2H+' '+Rclosed;
    }
    return Lopen+' '+r1H+' ; '+r2H+' '+Ropen;
  }

  var t1 = (b*b);
  var t2 = 4*a*c;
  var aS = (a<0? '('+UMINUS+Math.abs(a)+')' : String(a));
  var cS = (c<0? '('+UMINUS+Math.abs(c)+')' : String(c));
  var mid = t1 + (t2>=0? ' ‚àí ' + t2 : ' + ' + Math.abs(t2));
  var Dline = t1 + ' ‚àí 4 √ó ' + aS + ' √ó ' + cS + ' = ' + mid + ' = ' + D + ' > 0';

  function asHTML(x){ return numToFracHTML(x); }

  var outSign = (a>0? '+':'‚àí');
  var inSign  = (a>0? '‚àí':'+');

  var tableSolved = [
  '<div class="signwrap">',
    '<table class="sign-table">',
      '<colgroup>',
        '<col class="col-lbl"><col class="col-int"><col class="col-zero"><col class="col-int"><col class="col-zero"><col class="col-int">',
      '</colgroup>',
      '<tbody>',
        '<tr>',
          '<th class="lbl">x</th>',
          '<td class="int cap-left">‚àí‚àû</td>',
          '<td class="zero"><b>', asHTML(r1), '</b></td>',
          '<td class="int"><b><!-- Œ± vide --></b></td>',
          '<td class="zero"><b>', asHTML(r2), '</b></td>',
          '<td class="int cap-right">+‚àû</td>',
        '</tr>',
        '<tr>',
          '<th class="lbl">f(x)</th>',
          '<td class="int">', outSign, '</td>',
          '<td class="zero"><div class="cell"><b>0</b></div></td>',
          '<td class="int">', inSign, '</td>',
          '<td class="zero"><div class="cell"><b>0</b></div></td>',
          '<td class="int">', outSign, '</td>',
        '</tr>',
      '</tbody>',
    '</table>',
  '</div>'
  ].join('');

  var solSet = solSetFor(a, r1, r2, cmp||'<');
  var cmpNice = cmpSymbol(cmp||'<');

  return [
  '<div class="steps">',
    '<div>On note f(x) = ', P, '</div>',
    '<div><b>1<sup>√®re</sup> √©tape :</b> On cherche les racines de f(x) en r√©solvant l‚Äô√©quation f(x) = 0.</div>',
    '<div>a = ', a, ' ; b = ', b, ' et c = ', c, '</div>',
    '<div><b>Œî = b¬≤ ‚àí 4ac</b> = ', Dline, '</div>',
    '<div>Et ‚àöŒî = ', Math.sqrt(D), '</div>',
    '<div>Ainsi l‚Äô√©quation admet deux solutions r√©elles :</div>',
    '<table class="table"><thead><tr><th style="width:50%">x‚ÇÅ</th><th>x‚ÇÇ</th></tr></thead>',
      '<tbody><tr>',
        '<td>',
          '<div><b>x‚ÇÅ</b> = <span class="frac"><span class="num">‚àíb ‚àí ‚àöŒî</span><span class="bar"></span><span class="den">2a</span></span></div>',
          '<div><b>x‚ÇÅ</b> = <span class="frac"><span class="num">', -b, ' ‚àí ', Math.sqrt(D), '</span><span class="bar"></span><span class="den">', 2*a, '</span></span></div>',
          '<div><b>x‚ÇÅ</b> = ', fracRaw(x1n, den), '</div>',
          '<div><b>x‚ÇÅ</b> = ', x1html, '</div>',
        '</td>',
        '<td>',
          '<div><b>x‚ÇÇ</b> = <span class="frac"><span class="num">‚àíb + ‚àöŒî</span><span class="bar"></span><span class="den">2a</span></span></div>',
          '<div><b>x‚ÇÇ</b> = <span class="frac"><span class="num">', -b, ' + ', Math.sqrt(D), '</span><span class="bar"></span><span class="den">', 2*a, '</span></span></div>',
          '<div><b>x‚ÇÇ</b> = ', fracRaw(x2n, den), '</div>',
          '<div><b>x‚ÇÇ</b> = ', x2html, '</div>',
        '</td>',
      '</tr></tbody>',
    '</table>',
    '<div><b>2<sup>√®me</sup> √©tape :</b> On fait le tableau de signes en utilisant le signe de a (√† l‚Äôext√©rieur des racines). ', (a<0?'a < 0':'a > 0'), ' ainsi la parabole est tourn√©e vers ', (a<0?'le bas.':'le haut.'), '</div>',
    tableSolved,
    '<div><b>3<sup>√®me</sup> √©tape :</b> On r√©sout l‚Äôin√©quation demand√©e :</div>',
    '<div>', P, ' ', cmpNice, ' 0 pour x ‚àà ', solSet, '</div>',
    '<div style="font-weight:700;margin-top:.25rem">S = ', solSet, '</div>',
  '</div>'
  ].join('');
}

var exIneq = { id:'ineq', title:'In√©quation ‚Äì Œî > 0 (carr√© parfait)', gen:function(host, st){ st = st && st.a!==undefined ? st : genInEq(); host.innerHTML=buildHost(st); setCmpRandom(host, st); host.dataset.state = JSON.stringify(st); },
  correct:function(host, st){ check(host, st); },
  solution:function(host, st){ var cmp = getCmpFrom(host); try{ st = st || JSON.parse(host.dataset.state||'{}'); }catch(e){} st = st || {}; st.cmp = cmp; host.dataset.state = JSON.stringify(st); $('#res',host).innerHTML = solutionHTML(st, cmp); },
  reset:function(host){
    var resEl = $('#res',host); if(resEl) resEl.textContent='';
    var msg = document.getElementById('msg'); if(msg) msg.textContent='';
    $all('input.root',host).forEach(function(el){ el.value=''; });
    $all('select.sel',host).forEach(function(el){ el.value=''; });
    var ans = document.getElementById('ansSet'); if(ans) ans.value='';
    ['ok_r1','ok_r2','ok_alpha','ok_s1','ok_s2','ok_s3','ok_z1','ok_z2','ok_S'].forEach(function(id){
      var el=document.getElementById(id); if(el){ el.className='tick nu'; el.textContent='‚Ä¢'; el.style.opacity=0; }
    });
  }
};

var REG = [exIneq];
window.REG=REG; window.REGISTRY=REG;

function mount(){
  var sel=$("#exo-select"); if(!sel) return;
  sel.innerHTML=REG.map(function(e,i){return '<option value="'+e.id+'">'+(i+1)+'. '+e.title+'</option>';}).join('');
  function get(){ var id=sel.value||REG[0].id; for(var i=0;i<REG.length;i++){ if(REG[i].id===id) return REG[i]; } return REG[0]; }
  function newOne(){ var ex=get(); var host=$("#host"); ex.gen(host); }
  function _check(){ var ex=get(); var host=$("#host"); ex.correct(host, JSON.parse(host.dataset.state||'{}')); }
  function sol(){ var ex=get(); var host=$("#host"); ex.solution(host, JSON.parse(host.dataset.state||'{}')); }
  function reset(){ var ex=get(); ex.reset($("#host")); }

  sel.onchange=newOne;
  $("#btn-new").onclick=newOne;
  $("#btn-check").onclick = function(){
    var host = $("#host");
    var st = JSON.parse(host.dataset.state||'{}');
    _check();
    updateTicks(host, st);
  };
  $("#btn-solution").onclick=sol;
  $("#btn-reset").onclick=reset;

  document.addEventListener('keydown', function(e){
    if(e.key==='Enter'){
      var host = $("#host");
      var st = JSON.parse(host.dataset.state||'{}');
      _check();
      updateTicks(host, st);
    }
  });
  sel.value=REG[0].id; newOne();
}
document.addEventListener('DOMContentLoaded', mount);
  
function parseNumberLite(s){
  if(!s) return NaN;
  var t = (''+s).trim().replace(/‚àí/g,'-').replace(/,/g,'.');
  if(!t) return NaN;
  if(t.indexOf('/')!==-1){
    var parts = t.split('/');
    if(parts.length!==2) return NaN;
    var p = Number(parts[0]), q = Number(parts[1]);
    if(!isFinite(p)||!isFinite(q)||q===0) return NaN;
    return p/q;
  }
  var v = Number(t); return isFinite(v)? v : NaN;
}
function setTick(id, state){
  var el = document.getElementById(id);
  if(!el) return;
  el.className = 'tick ' + (state||'nu');
  el.textContent = state==='ok' ? '‚úì' : (state==='ko' ? '‚úó' : '‚Ä¢');
  el.style.opacity = (state==='nu') ? 0 : 1;
}
function updateTicks(host, st){
  var a = st.a;
  var outSign = (a>0? '+':'‚àí');
  var inSign  = (a>0? '‚àí':'+');

  var r1t = (host.querySelector('#r1')||{}).value||'';
  var r2t = (host.querySelector('#r2')||{}).value||'';
  var at  = (host.querySelector('#alpha')||{}).value||'';
  var r1 = parseNumberLite(r1t), r2 = parseNumberLite(r2t);

  setTick('ok_r1', r1t==='' ? 'nu' : (!isNaN(r1)&&Math.abs(r1-st.r)<1e-6 ? 'ok':'ko'));
  setTick('ok_r2', r2t==='' ? 'nu' : (!isNaN(r2)&&Math.abs(r2-st.s)<1e-6 ? 'ok':'ko'));
  setTick('ok_alpha', at==='' ? 'ok' : 'ko');

  var s1=(host.querySelector('#s1')||{}).value||'';
  var s2=(host.querySelector('#s2')||{}).value||'';
  var s3=(host.querySelector('#s3')||{}).value||'';
  var z1=(host.querySelector('#z1')||{}).value||'';
  var z2=(host.querySelector('#z2')||{}).value||'';

  function tick(val, exp, id){ setTick(id, val===''? 'nu' : (val===exp? 'ok':'ko')); }
  tick(s1,outSign,'ok_s1');
  tick(s2,inSign,'ok_s2');
  tick(s3,outSign,'ok_s3');
  tick(z1,'0','ok_z1');
  tick(z2,'0','ok_z2');

  var ans = (document.getElementById('ansSet')||{}).value||'';
  if(ans===''){ setTick('ok_S','nu'); }
  else{
    function parseIntervals(txt){
      var t = txt.replace(/\s/g,'').replace(/‚àí/g,'-');
      var parts = t.split(/‚à™|U|u/).filter(function(x){return x;});
      var ints = [];
      for(var i=0;i<parts.length;i++){
        var p = parts[i];
        var L=p.charAt(0), R=p.charAt(p.length-1);
        var inner=p.slice(1,-1);
        var semi=inner.indexOf(';'); if(semi<0) continue;
        var Araw=inner.slice(0,semi), Braw=inner.slice(semi+1);
        var A=(Araw==='-‚àû'||Araw==='-oo')? -Infinity : parseNumberLite(Araw);
        var B=(Braw==='+‚àû'||Braw==='+oo')?  Infinity : parseNumberLite(Braw);
        ints.push({A:A,B:B,L:L,R:R});
      }
      return ints;
    }
    function inU(x,U){
      for(var i=0;i<U.length;i++){
        var I = U[i];
        var okL = (I.L===']'? x>I.A : x>=I.A);
        var okR = (I.R==='['? x<I.B : x<=I.B);
        if(okL && okR) return true;
      }
      return false;
    }
    var U = parseIntervals(ans);
    var cmp = getCmpFrom(host);
    var EPS=1e-9;
    function inside(x){
      var y = st.a*x*x + st.b*x + st.c;
      if(cmp==='<') return y < -EPS;
      if(cmp==='>') return y >  EPS;
      if(cmp==='<=')return y <= EPS;
      if(cmp=== '>=')return y >=-EPS;
      return y < -EPS;
    }
    var tests = [st.r-1, st.r, (st.r+st.s)/2, st.s, st.s+1];
    var ok = true;
    for(var j=0;j<tests.length;j++){
      var xx = tests[j];
      if( inU(xx,U) !== inside(xx) ){ ok=false; break; }
    }
    setTick('ok_S', ok? 'ok':'ko');
  }
}
function bindLiveValidation(host, st){ /* volontairement inactif */ }
</script>

<script>
function genDeltaNeg(){
  for(var t=0;t<999;t++){
    var a = choice([-3,-2,-1,1,2,3]);
    var b = rnd(-9,9);
    var c = rnd(-9,9);
    if(a===0) continue;
    var D = b*b - 4*a*c;
    if(D<0){
      return {a:a,b:b,c:c,delta:D};
    }
  }
  return {a:1,b:0,c:1,delta:-4};
}

function genDeltaZero(){
  var a = choice([-3,-2,-1,1,2,3]);
  var alpha = rnd(-8,8);
  var b = -2*a*alpha;
  var c = a*alpha*alpha;
  return {a:a,b:b,c:c,delta:0,alpha:alpha};
}

function solutionHTML_Dneg(st, cmp){
  var a=st.a,b=st.b,c=st.c,D=st.delta;
  var P = polyHTML(a,b,c);
  var outSign = (a>0? '+':'‚àí');
  function solSetFor(a,cmpVal){
    if(a>0){
      if(cmpVal==='<'||cmpVal==='<=') return '‚àÖ';
      return '‚Ñù';
    }else{
      if(cmpVal==='<'||cmpVal==='<=') return '‚Ñù';
      return '‚àÖ';
    }
  }
  var tableSolved = [
  '<div class="signwrap">',
    '<table class="sign-table">',
      '<colgroup>',
        '<col class="col-lbl"><col class="col-int"><col class="col-zero"><col class="col-int"><col class="col-zero"><col class="col-int">',
      '</colgroup>',
      '<tbody>',
        '<tr>',
          '<th class="lbl">x</th>',
          '<td class="int cap-left">‚àí‚àû</td>',
          '<td class="zero"></td>',
          '<td class="int"><b><!-- signe uniquement sous Œ± --></b></td>',
          '<td class="zero"></td>',
          '<td class="int cap-right">+‚àû</td>',
        '</tr>',
        '<tr>',
          '<th class="lbl">f(x)</th>',
          '<td class="int"></td>',
          '<td class="zero"></td>',
          '<td class="int">', outSign, '</td>',
          '<td class="zero"></td>',
          '<td class="int"></td>',
        '</tr>',
      '</tbody>',
    '</table>',
  '</div>'
  ].join('');

  var cmpNice = cmpSymbol(cmp||'<');
  var solSet = solSetFor(a,(cmp||'<'));

  return [
  '<div class="steps">',
    '<div>On note f(x) = ', P, '</div>',
    '<div><b>1<sup>√®re</sup> √©tape :</b> On cherche les racines de f(x) en r√©solvant l‚Äô√©quation f(x) = 0.</div>',
    '<div>a = ', a, ' ; b = ', b, ' et c = ', c, '</div>',
    '<div><b>Œî = b¬≤ ‚àí 4ac</b> = ', (b*b) ,' ‚àí 4 √ó ', (a<0? '('+UMINUS+Math.abs(a)+')': a) ,' √ó ', (c<0? '('+UMINUS+Math.abs(c)+')': c) ,' = ', (b*b) , ((4*a*c)>=0? ' ‚àí '+(4*a*c) : ' + '+Math.abs(4*a*c)) ,' = ', D ,' &lt; 0</div>',
    '<div>Ainsi l‚Äô√©quation n‚Äôadmet pas de solution r√©elle.</div>',
    '<div><b>2<sup>√®me</sup> √©tape :</b> On fait le tableau de variations en utilisant le signe de <i>a</i>.</div>',
    '<div>a ', (a>0? '&gt;':'&lt;'), ' 0 ainsi la parabole est tourn√©e vers le ', (a>0?'haut':'bas'), '.</div>',
    tableSolved,
    '<div><b>3<sup>√®me</sup> √©tape :</b> On r√©sout l‚Äôin√©quation demand√©e :</div>',
    '<div>', P, ' ', cmpNice, ' 0 pour x ‚àà ', solSet, '</div>',
    '<div style="text-align:center;margin:.3rem 0"><b>S = ', solSet, '</b></div>',
  '</div>'
  ].join('');
}

function solutionHTML_Dzero(st, cmp){
  var a=st.a,b=st.b,c=st.c;
  var P = polyHTML(a,b,c);
  var alpha = -b/(2*a);
  var outSign = (a>0? '+':'‚àí');
  function solSetFor(a,alpha,cmpVal){
    var aH=numToFracHTML(alpha);
    if(cmpVal==='<') return (a>0? '‚àÖ' : '‚Ñù\\{'+aH+'}');
    if(cmpVal==='<=') return (a>0? '{'+aH+'}' : '‚Ñù');
    if(cmpVal==='>') return (a>0? '‚Ñù\\{'+aH+'}' : '‚àÖ');
    if(cmpVal==='>=') return (a>0? '‚Ñù' : '{'+aH+'}');
    return '';
  }
  var tableSolved = [
  '<div class="signwrap">',
    '<table class="sign-table">',
      '<colgroup>',
        '<col class="col-lbl"><col class="col-int"><col class="col-zero"><col class="col-int"><col class="col-zero"><col class="col-int">',
      '</colgroup>',
      '<tbody>',
        '<tr>',
          '<th class="lbl">x</th>',
          '<td class="int cap-left">‚àí‚àû</td>',
          '<td class="zero"></td>',
          '<td class="int"><b>', numToFracHTML(alpha), '</b></td>',
          '<td class="zero"></td>',
          '<td class="int cap-right">+‚àû</td>',
        '</tr>',
        '<tr>',
          '<th class="lbl">f(x)</th>',
          '<td class="int">', outSign, '</td>',
          '<td class="zero"></td>',
          '<td class="int"><b>0</b></td>',
          '<td class="zero"></td>',
          '<td class="int">', outSign, '</td>',
        '</tr>',
      '</tbody>',
    '</table>',
  '</div>'
  ].join('');

  var cmpNice = cmpSymbol(cmp||'<');
  var solSet = solSetFor(a,alpha,(cmp||'<'));

  return [
  '<div class="steps">',
    '<div>On note f(x) = ', P, '</div>',
    '<div><b>1<sup>√®re</sup> √©tape :</b> On cherche les racines de f(x) en r√©solvant l‚Äô√©quation f(x) = 0.</div>',
    '<div>a = ', a, ' ; b = ', b, ' et c = ', c, '</div>',
    '<div><b>Œî = b¬≤ ‚àí 4ac</b> = ', (b*b), ' ‚àí 4 √ó ', (a<0? '('+UMINUS+Math.abs(a)+')': a) ,' √ó ', (c<0? '('+UMINUS+Math.abs(c)+')': c) ,' = ', (b*b) , ((4*a*c)>=0? ' ‚àí '+(4*a*c) : ' + '+Math.abs(4*a*c)) ,' = 0</div>',
    '<div>Ainsi l‚Äô√©quation admet une seule solution :</div>',
    '<div><b>Œ± = ‚àí</b><span class="frac"><span class="num">b</span><span class="bar"></span><span class="den">2a</span></span> = ', fracRaw(-b, 2*a), ' = <b>', numToFracHTML(alpha), '</b></div>',
    '<div><b>2<sup>√®me</sup> √©tape :</b> On fait le tableau de variations en utilisant le signe de <i>a</i>.</div>',
    tableSolved,
    '<div><b>3<sup>√®me</sup> √©tape :</b> On r√©sout l‚Äôin√©quation demand√©e :</div>',
    '<div>', P, ' ', cmpNice, ' 0 pour x ‚àà ', solSet, '</div>',
    '<div style="text-align:center;margin:.3rem 0"><b>S = ', solSet, '</b></div>',
  '</div>'
  ].join('');
}

function check_Dneg(host, st){
  var ok=0, tot=0;
  var a=st.a;
  var outSign = (a>0? '+':'‚àí');
  var s2=($("#s2",host)||{}).value||'';
  function sc(val,exp){ if(val){ tot++; if(val===exp) ok++; } }
  sc(s2,outSign);
  var ans = (document.getElementById('ansSet')||{}).value||'';
  ans = ans.replace(/\s/g,'');
  var cmp = getCmpFrom(host);
  var target = (a>0? ((cmp==='<'||cmp==='<=')?'‚àÖ':'‚Ñù') : ((cmp==='<'||cmp==='<=')?'‚Ñù':'‚àÖ'));
  if(ans){ tot++; if(ans===target || ans==='R' || ans==='\\mathbb{R}') ok++; }
  scoreOK+=ok; scoreTot+=tot; updateScore();
}

function check_Dzero(host, st){
  var ok=0, tot=0;
  var a=st.a, alpha = -st.b/(2*st.a);
  var outSign = (a>0? '+':'‚àí');

  var s1=($("#s1",host)||{}).value||'', s2=($("#s2",host)||{}).value||'', s3=($("#s3",host)||{}).value||'';
  function sc(val,exp){ if(val){ tot++; if(val===exp) ok++; } }
  sc(s1,outSign); sc(s2,'0'); sc(s3,outSign);

  var z1=($("#z1",host)||{}).value||'', z2=($("#z2",host)||{}).value||'';
  tot++; ok += (z1==='')?1:0;
  tot++; ok += (z2==='')?1:0;

  var alphaIn = parseNumber(($("#alpha",host)||{}).value||'');
  if(!isNaN(alphaIn)){ tot++; if(Math.abs(alphaIn-alpha)<1e-6) ok++; }

  scoreOK+=ok; scoreTot+=tot; updateScore();
}

function buildHost_Generic(st){
  return buildHost(st);
}

var exDneg = { id:'dneg', title:'In√©quation ‚Äì Œî < 0', gen:function(host, st){ st = st && st.a!==undefined ? st : genDeltaNeg(); host.innerHTML=buildHost_Generic(st); setCmpRandom(host, st); host.dataset.state = JSON.stringify(st); },
  correct:function(host, st){ check_Dneg(host, st); },
  solution:function(host, st){ var cmp = getCmpFrom(host); $('#res',host).innerHTML = solutionHTML_Dneg(st, cmp); },
  reset:function(host){ exIneq.reset(host); }
};

var exDzero = { id:'dzero', title:'In√©quation ‚Äì Œî = 0', gen:function(host, st){ st = st && st.a!==undefined ? st : genDeltaZero(); host.innerHTML=buildHost_Generic(st); setCmpRandom(host, st); host.dataset.state = JSON.stringify(st); },
  correct:function(host, st){ check_Dzero(host, st); },
  solution:function(host, st){ var cmp = getCmpFrom(host); $('#res',host).innerHTML = solutionHTML_Dzero(st, cmp); },
  reset:function(host){ exIneq.reset(host); }
};

// ===== FIX: exMix respects provided state; route by delta =====
var exMix = { id:'mix', title:'M√©lange (60% Œî>0 PF, 25% Œî=0, 15% Œî<0)',
  gen:function(host, st){
    // If a state is provided (PDF flow), render exactly this state (no random)
    if (st && st.a!==undefined) {
      host.innerHTML = buildHost_Generic(st);
      setCmpRandom(host, st);
      host.dataset.state = JSON.stringify(st);
      if (typeof st.delta === 'number') {
        host.dataset.mode = (st.delta<0 ? 'dneg' : (st.delta===0 ? 'dzero' : 'dpos'));
      }
      return;
    }
    // Otherwise: random draw with weights
    var r=Math.random();
    if(r<0.60){
      var st1=genInEq(); host.innerHTML=buildHost(st1); setCmpRandom(host, st1);
      host.dataset.state = JSON.stringify(st1); host.dataset.mode='dpos';
    }else if(r<0.85){
      var st2=genDeltaZero(); host.innerHTML=buildHost_Generic(st2); setCmpRandom(host, st2);
      host.dataset.state = JSON.stringify(st2); host.dataset.mode='dzero';
    }else{
      var st3=genDeltaNeg(); host.innerHTML=buildHost_Generic(st3); setCmpRandom(host, st3);
      host.dataset.state = JSON.stringify(st3); host.dataset.mode='dneg';
    }
  },
  correct:function(host, st){
    st = st || JSON.parse(host.dataset.state||'{}');
    if (st && typeof st.delta === 'number') {
      if (st.delta<0) return check_Dneg(host, st);
      if (st.delta===0) return check_Dzero(host, st);
      return exIneq.correct(host, st);
    }
    // Fallback on mode if ever needed
    var mode = host.dataset.mode;
    if(mode==='dzero') return check_Dzero(host, st);
    if(mode==='dneg')  return check_Dneg(host, st);
    return exIneq.correct(host, st);
  },
  solution:function(host, st){
    st = st || JSON.parse(host.dataset.state||'{}');
    var cmp = getCmpFrom(host);
    if (st && typeof st.delta === 'number') {
      if (st.delta<0) return $('#res',host).innerHTML = solutionHTML_Dneg(st, cmp);
      if (st.delta===0) return $('#res',host).innerHTML = solutionHTML_Dzero(st, cmp);
      return $('#res',host).innerHTML = solutionHTML(st, cmp);
    }
    // Fallback on mode
    var mode = host.dataset.mode;
    if(mode==='dzero') return $('#res',host).innerHTML = solutionHTML_Dzero(st, cmp);
    if(mode==='dneg')  return $('#res',host).innerHTML = solutionHTML_Dneg(st, cmp);
    return $('#res',host).innerHTML = solutionHTML(st, cmp);
  },
  reset:function(host){ exIneq.reset(host); }
};

REG.push(exDneg, exDzero, exMix);
window.REG=REG; window.REGISTRY=REG;

(function(){
  var rules = document.querySelector('.card.small ul');
  if(!rules) return;
  rules.insertAdjacentHTML('beforeend',
    '<li><b>Ex. 2 ‚Äì Œî &lt; 0 :</b> laisser <b>r‚ÇÅ</b>, <b>Œ±</b>, <b>r‚ÇÇ</b> vides ; ne choisir que le <b>signe central</b> (sous Œ±) qui est le signe de <i>a</i>.</li>'+
    '<li><b>Ex. 3 ‚Äì Œî = 0 :</b> laisser <b>r‚ÇÅ</b> et <b>r‚ÇÇ</b> vides ; remplir <b>Œ±</b>, mettre <b>0</b> en dessous ; signes ext√©rieurs = signe de <i>a</i>.</li>'+
    '<li><b>Ex. 4 ‚Äì M√©lange :</b> tirage pond√©r√© : 60% Œî&gt;0 (carr√© parfait), 25% Œî=0, 15% Œî&lt;0.</li>'
  );
})();
</script>

<script>
window.updateTicks_orig = window.updateTicks;
window.updateTicks = function(host, st){
  if(st && st.delta<0){
    var a=st.a;
    var outSign=(a>0? '+':'‚àí');
    var s2=(host.querySelector('#s2')||{}).value||'';
    setTick('ok_r1','ok'); setTick('ok_r2','ok'); setTick('ok_alpha','ok');
    setTick('ok_s1','ok'); setTick('ok_s3','ok'); setTick('ok_z1','ok'); setTick('ok_z2','ok');
    setTick('ok_s2', s2===''? 'nu' : (s2===outSign? 'ok':'ko'));
    var ans = (document.getElementById('ansSet')||{}).value||'';
    if(ans===''){ setTick('ok_S','nu'); }
    else{
      var clean = ans.replace(/\s/g,'');
      var cmp = getCmpFrom(host);
      var target = (a>0? ((cmp==='<'||cmp==='<=')?'‚àÖ':'‚Ñù') : ((cmp==='<'||cmp==='<=')?'‚Ñù':'‚àÖ'));
      setTick('ok_S', (clean===target || clean==='R' || clean==='\\mathbb{R}')? 'ok':'ko');
    }
    return;
  }
  if(st && st.delta===0){
    var a2=st.a, alpha = -st.b/(2*st.a);
    var outSign2=(a2>0? '+':'‚àí');
    var r1t=(host.querySelector('#r1')||{}).value||'';
    var r2t=(host.querySelector('#r2')||{}).value||'';
    var at=(host.querySelector('#alpha')||{}).value||'';
    var av = parseNumberLite(at);
    setTick('ok_r1', r1t===''?'ok':'ko');
    setTick('ok_r2', r2t===''?'ok':'ko');
    setTick('ok_alpha', (at!=='' && !isNaN(av) && Math.abs(av-alpha)<1e-6)? 'ok' : (at===''? 'nu':'ko'));
    var s1=(host.querySelector('#s1')||{}).value||'';
    var s2=(host.querySelector('#s2')||{}).value||'';
    var s3=(host.querySelector('#s3')||{}).value||'';
    var z1=(host.querySelector('#z1')||{}).value||'';
    var z2=(host.querySelector('#z2')||{}).value||'';
    setTick('ok_s1', s1===''?'nu':(s1===outSign2?'ok':'ko'));
    setTick('ok_s2', s2===''?'nu':(s2==='0'?'ok':'ko'));
    setTick('ok_s3', s3===''?'nu':(s3===outSign2?'ok':'ko'));
    setTick('ok_z1', z1===''?'ok':'ko');
    setTick('ok_z2', z2===''?'ok':'ko');
    var ans2 = (document.getElementById('ansSet')||{}).value||'';
    if(ans2===''){ setTick('ok_S','nu'); }
    else{
      function parseIntervals(txt){
        var t = txt.replace(/\s/g,'').replace(/‚àí/g,'-');
        if(t==='‚Ñù'||t==='R'||t==='\\mathbb{R}') return [{A:-Infinity,B:Infinity,L:'[',R:']'}];
        var parts = t.split(/‚à™|U|u/).filter(function(x){return x;});
        var ints = [];
        for(var i=0;i<parts.length;i++){
          var p = parts[i];
          var L=p.charAt(0), R=p.charAt(p.length-1);
          var inner=p.slice(1,-1);
          var semi=inner.indexOf(';'); if(semi<0) continue;
          var Araw=inner.slice(0,semi), Braw=inner.slice(semi+1);
          var A=(Araw==='-‚àû'||Araw==='-oo')? -Infinity : parseNumberLite(Araw);
          var B=(Braw==='+‚àû'||Braw==='+oo')?  Infinity : parseNumberLite(Braw);
          ints.push({A:A,B:B,L:L,R:R});
        }
        return ints;
      }
      function inU(x,U){
        for(var i=0;i<U.length;i++){
          var I = U[i];
          var okL = (I.L===']'? x>I.A : x>=I.A);
          var okR = (I.R==='['? x<I.B : x<=I.B);
          if(okL && okR) return true;
        }
        return false;
      }
      var U = parseIntervals(ans2);
      var cmp2 = getCmpFrom(host);
      var EPS=1e-9;
      function inside(x){
        var y = st.a*x*x + st.b*x + st.c;
        if(cmp2==='<') return y < -EPS;
        if(cmp2==='>') return y >  EPS;
        if(cmp2==='<=')return y <= EPS;
        if(cmp2=== '>=')return y >=-EPS;
        return y < -EPS;
      }
      var tests = [alpha-1, alpha, alpha+1];
      var ok = true;
      for(var j=0;j<tests.length;j++){
        var x = tests[j];
        if( inU(x,U) !== inside(x) ){ ok=false; break; }
      }
      setTick('ok_S', ok? 'ok':'ko');
    }
    return;
  }
  return window.updateTicks_orig(host, st);
};
</script>

<script>
(function(){
  document.addEventListener('DOMContentLoaded', function () {
    if (!(window.ExoPDF && typeof ExoPDF.init === 'function')) return;

    function validState(st){
      return st && isFinite(st.a) && isFinite(st.b) && isFinite(st.c);
    }

    ExoPDF.init({
      title: document.title,
      beforeGen(def, _st, ctx){
        const host = document.createElement('div');
        if (def && typeof def.gen === 'function') def.gen(host);
        let st = {};
        try{ st = JSON.parse(host.dataset.state||'{}'); }catch(_){}
        return st; // √©tat gel√© pour √©nonc√© + correction
      },

      beforeRender: function(def, _st, withSolutions){
        try{
          var host = document.createElement('div');
          host.id = 'pdf-host';
          host.style.position='fixed';
          host.style.left='-200vw';
          document.body.appendChild(host);

          var REG = (window.REGISTRY || window.REG || []);
          var theDef = def || REG[0];
          if(!theDef){ document.body.removeChild(host); return null; }

          // G√©n√©rer en utilisant EXACTEMENT l'√©tat fourni
          try{ theDef.gen(host, _st); }catch(_){ theDef.gen(host); }

          var st = _st;
          try{
            if(!st && host.dataset.state) st = JSON.parse(host.dataset.state);
          }catch(e){ st = null; }

          if(!validState(st)){
            theDef.gen(host);
            try{ if(host.dataset.state) st = JSON.parse(host.dataset.state); }catch(e){ st=null; }
          }
          if(!validState(st)){
            st = {a:1,b:0,c:-1,delta:4,r:-1,s:1,alpha:0};
            host.dataset.state = JSON.stringify(st);
          }

          if(st && st.cmp){ var cmpSel = host.querySelector('#cmp'); if(cmpSel){ cmpSel.value = st.cmp; } }
          if(withSolutions && typeof theDef.solution === 'function'){
            theDef.solution(host, st);
          }

          // Remplacement des champs par du texte avant export
          var fields = host.querySelectorAll('input, textarea, select, [contenteditable="true"]');
          for(var i=0;i<fields.length;i++){
            var el = fields[i];
            var tVal=' '; if(el.tagName==='SELECT'){var opt=el.options&&el.selectedIndex>=0&&el.options[el.selectedIndex]; tVal = opt ? (opt.textContent||opt.innerText||el.value||' ') : (el.value||' ');} else { tVal = el.value||' '; } var t=document.createTextNode(tVal);
            el.parentNode.replaceChild(t, el);
          }

          function upscaleSignTables(root){
            var list = root.querySelectorAll('.sign-table');
            for(var i=0;i<list.length;i++){
              var t = list[i];
              t.classList.add('pdf-large');
              t.style.setProperty('--zeroW','140px');
              var cells = t.querySelectorAll('th,td');
              for(var k=0;k<cells.length;k++){
                var c = cells[k];
                c.style.textAlign    = 'center';
                c.style.verticalAlign= 'middle';
                c.style.padding      = '14px 16px';
                if(c.classList.contains('lbl')) c.style.borderRight = '2px solid #000';
              }
            }
          }
          upscaleSignTables(host);

          var tables = host.querySelectorAll('table');
          for(var k=0;k<tables.length;k++){
            var table = tables[k];
            var csT = window.getComputedStyle(table);
            table.style.borderCollapse = csT.borderCollapse;
            table.style.borderSpacing  = csT.borderSpacing;
            var hasOuter = (csT.borderTopWidth!=='0px'||csT.borderRightWidth!=='0px'||csT.borderBottomWidth!=='0px'||csT.borderLeftWidth!=='0px');
            table.style.border = hasOuter ? (csT.borderTopWidth+' '+csT.borderTopStyle+' '+csT.borderTopColor) : 'none';
            var tds = table.querySelectorAll('th,td');
            for(var m=0;m<tds.length;m++){
              var td=tds[m], cs=window.getComputedStyle(td);
              td.style.borderTop    = cs.borderTopWidth+' '+cs.borderTopStyle+' '+cs.borderTopColor;
              td.style.borderRight  = cs.borderRightWidth+' '+cs.borderRightStyle+' '+cs.borderRightColor;
              td.style.borderBottom = cs.borderBottomWidth+' '+cs.borderBottomStyle+' '+cs.borderBottomColor;
              td.style.borderLeft   = cs.borderLeftWidth+' '+cs.borderLeftStyle+' '+cs.borderLeftColor;
              td.style.verticalAlign = 'top';
            }
          }

          var outHTML = withSolutions
            ? ( (function(){ var el = host.querySelector('#res'); return el? el.outerHTML : host.innerHTML; })() )
            : host.innerHTML;

          document.body.removeChild(host);
          return outHTML;
        }catch(e){
          console.error('PDF beforeRender error:', e);
          return null;
        }
      }
    });
  });
})();
</script>

<script>
(function(){
  function isHost(x){ return x && x.nodeType===1; }
  function scaffold(host){
    if(!host) return;
    ['enonce','res','solution','statement'].forEach(function(id){
      if(!host.querySelector('#'+id)){
        var d=document.createElement('div'); d.id=id; host.appendChild(d);
      }
    });
  }
  function wrapDef(def){
    if(!def || typeof def!=='object') return def;
    var origGen = def.gen;
    def.gen = function(host, st){
      host = isHost(host)? host : document.createElement('div');
      scaffold(host);
      if (typeof origGen === 'function') origGen(host, st);
      return host;
    };
    return def;
  }
  if(Array.isArray(window.REGISTRY||window.REG)){
    var R = window.REGISTRY || window.REG;
    for (var i=0;i<R.length;i++) R[i] = wrapDef(R[i]) || R[i];
    window.REGISTRY = R; window.REG = R;
  }
})();

document.addEventListener('change', function(ev){
  try{
    if(ev && ev.target && ev.target.id === 'cmp'){
      var host = document.getElementById('host');
      if(host){
        var st = {};
        try{ st = host.dataset && host.dataset.state ? JSON.parse(host.dataset.state) : {}; }catch(e){}
        st.cmp = ev.target.value;
        host.dataset.state = JSON.stringify(st);
      }
    }
  }catch(e){}
});
</script>

</body>
</html>
