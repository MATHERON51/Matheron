<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>1√®re ‚Äì Cosinus & sinus d‚Äôun angle (LaTeX)</title>

<link rel="stylesheet" href="../../../../css/math-kbd.css">
<link rel="stylesheet" href="../../../../css/espace-gras.css">
<link rel="stylesheet" href="../../../../css/espace-latex.css">
<link rel="stylesheet" href="../../../../css/mobile.css">

<style>
*{box-sizing:border-box}
body{font-family:system-ui, Segoe UI, Roboto, Arial; margin:0; background:#fafafa; color:#111; line-height:1.55}
.header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;padding:14px 18px;z-index:5}
.wrap{max-width:1280px;margin:0 auto;padding:18px;display:flex;flex-direction:column;gap:12px}
.card{background:#fff;border:1px solid #e6e6e6;border-radius:12px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
.controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
select,button{font:inherit}
select{padding:6px 8px;border:1px solid #ddd;border-radius:10px;background:#fff}
.btn{padding:8px 10px;border:1px solid #ddd;border-radius:10px;background:#fff;cursor:pointer}
.btn:active{transform:translateY(1px)}
.score{margin-left:auto;font-weight:600}

/* Deux colonnes : 1) cercle  2) √©nonc√© */
.grid-two{display:grid;grid-template-columns:auto 1fr;column-gap:140px;align-items:start}
.svgbox{background:#fff;border:1px solid #e5e5e5;border-radius:12px;padding:8px;display:flex;justify-content:center;align-items:center;overflow:visible}
.statement{padding-left:0}

/* Blocs */
.row{display:grid;grid-template-columns:minmax(0,1fr);gap:8px;margin:10px 0}
.q{background:#f9fafb;border:1px dashed #e5e7eb;border-radius:10px;padding:10px}
.input-line{display:flex;gap:8px;align-items:center}
.input-line input[type=text]{flex:1}
.mark{margin-left:8px;font-weight:700}
.mark.ok{color:#16a34a}.mark.ko{color:#dc2626}
.solution-box{background:#f3f4f6;border:1px solid #e5e7eb;border-radius:10px;padding:12px;margin-top:10px}

/* Tableau (bordures visibles) */
.radtab{border-collapse:collapse;width:100%}
.radtab th,.radtab td{border:2px solid #111;padding:8px 10px;text-align:center;vertical-align:middle}
.radtab .lab{text-align:left}

/* Cercle & labels */
.svgbox svg{display:block;max-width:none}
.ptlbl{font-weight:800; paint-order:stroke; stroke:#fff; stroke-width:4px;}
.ptlbl .prime { font-size:1.45em; font-weight:900; }

/* Inputs */
input[type=text]{padding:6px 8px;border:1px solid #dcdcdc;border-radius:10px;text-align:center}

/* Petit encart d‚Äôaide global */
.help-list{margin:0;padding-left:18px}
.help-list li{margin:.2em 0}

/* LaTeX un peu plus grand dans la zone solution (confort) */
.solution-box .mjx-container{font-size:115%}
</style>

<!-- ==== MathJax (comme dans ‚Äúexercices - Latex.html‚Äù) ==== -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['\\(','\\)'], ['$', '$']],
      displayMath: [['\\[','\\]'], ['$$','$$']],
      processEscapes: true,
      macros: { frac: ['\\dfrac{#1}{#2}', 2] }
    },
    options: {
      // on n‚Äôignore pas <code>/<pre> pour permettre \\( ... \\) partout
      skipHtmlTags: ['script','noscript','style','textarea']
    },
    chtml: { matchFontHeight: false },
    startup: { typeset: true }
  };
</script>
<script defer src="../../../../es5/tex-chtml.js"></script>
</head>
<body>

<div class="header">
  <h1 style="margin:0;font-size:1.1rem">1√®re ‚Äì <strong>Cosinus & sinus d‚Äôun angle</strong></h1>
  <div class="wrap" style="padding:0 18px">
    <div class="controls">
      <label for="exo-select">Type d‚Äôexercice :</label>
      <select id="exo-select"></select>
      <button id="btn-new" class="btn">üîÄ Nouvel √©nonc√©</button>
      <button id="btn-check" class="btn">‚úÖ V√©rifier</button>
      <button id="btn-solution" class="btn">üí° Solution</button>
      <button id="btn-reset" class="btn">‚ôªÔ∏è R√©initialiser</button>
      <div class="score" id="score">Score : 0 / 0</div>
    </div>
  </div>
</div>

<div class="wrap">
  <!-- EXERCICES AU-DESSUS -->
  <div class="card" id="mount-here"></div>

  <!--  Bo√Æte d‚Äôaide globale (juste au-dessus du PDF) -->
  <div class="card" id="input-notes">
    <div><strong>Saisie & r√©ponses accept√©es :</strong></div>
    <ul class="help-list">
      <li>Fractions : saisir <em>a/b</em>.</li>
      <li>Racines : <code>‚àön</code>, <code>sqrt(n)</code> ou <code>rac(n)</code>.</li>
      <li>Signes : <code>-</code> ou le signe moins unicode (les deux reconnus).</li>
      <li>D√©cimaux : point ou virgule.</li>
      <li>Valeurs exactes admises : \(0\), \(1\), \(-1\), \(\frac{\sqrt{2}}{2}\), \(-\frac{\sqrt{3}}{2}\), etc.</li>
      <li>Appuie sur <kbd>Entr√©e</kbd> ou ‚ÄúV√©rifier‚Äù pour corriger.</li>
    </ul>
  </div>
  <!-- Clavier math, centr√© -->
  <div class="card">
    <div data-math-kbd style="display:flex; justify-content:center"></div>
  </div>
</div>

<script src="../../../../js/math-kbd.js" defer></script>
<script>
/* ========= Utilitaires ========= */
const $=(s,r=document)=>r.querySelector(s);
const $$=(s,r=document)=>[...r.querySelectorAll(s)];
const PI=Math.PI, TAU=2*Math.PI;
const UMIN='‚àí';

/* ===== MathJax helper (m√™me principe que ‚Äúexercices - Latex.html‚Äù) ===== */
function typesetAll(root){
  const run = () => (window.MathJax && MathJax.typesetPromise) ? MathJax.typesetPromise(root ? [root] : undefined).catch(()=>{}) : null;
  if (window.MathJax && MathJax.startup && MathJax.startup.promise){
    MathJax.startup.promise.then(run);
  } else {
    const t = setInterval(()=>{
      if (window.MathJax && MathJax.typesetPromise){ clearInterval(t); run(); }
    }, 60);
  }
}

/* === Aide : wrapper LaTeX inline === */
const L = (tex) => `\\(${tex}\\)`;

/* ====== Conversions vers TeX ====== */
function fracTex(N, D){
  const d = String(D);
  if (d==='1' || d===1) return String(N);
  return `\\frac{${N}}{${D}}`;
}
function fmtPiTex(r){
  if (Math.abs(r) < 1e-10) return '0';
  const k = r/PI;
  const sgn = k < 0 ? '-' : '';
  const an = Math.abs(k);
  // approx sur 12 (angles remarquables)
  const P=Math.round(an*12), Q=12;
  const g=(a,b)=>b?g(b,a%b):a, gg=g(P,Q), p=P/gg, q=Q/gg;
  if (p===q) return sgn+'\\pi';
  if (q===1) return sgn + (p===1 ? '\\pi' : (p+'\\pi'));
  if (p===1) return sgn + `\\frac{\\pi}{${q}}`;
  return sgn + `\\frac{${p}\\pi}{${q}}`;
}
function intervalLabelTex(I){ return `\\left[ ${fmtPiTex(I[0])} \\; ; \\; ${fmtPiTex(I[1])} \\right]`; }

function valToNiceTex(x){
  const ax=Math.abs(x);
  const s = x<0 ? '-' : '';
  const near=t=>Math.abs(ax-t)<1e-9;
  if(near(0))   return '0';
  if(near(1))   return s+'1';
  if(near(0.5)) return s+`\\frac{1}{2}`;
  const r2=Math.SQRT2/2, r3=Math.sqrt(3)/2;
  if(near(r2))  return s+`\\frac{\\sqrt{2}}{2}`;
  if(near(r3))  return s+`\\frac{\\sqrt{3}}{2}`;
  // d√©cimaux FR accept√©s : on laisse le point (MathJax ne g√®re pas la virgule comme s√©parateur d√©cimal)
  return (x<0?'-':'')+(Math.round(ax*1000)/1000);
}
function cosSinExact(angle){
  let t=((angle%TAU)+TAU)%TAU;
  const c = Math.cos(t), s = Math.sin(t);
  return { cosTex: valToNiceTex(c), sinTex: valToNiceTex(s), cos:c, sin:s };
}
function sqrtNumTex(n){
  const r = Math.sqrt(n);
  return Number.isInteger(r) ? String(r) : `\\sqrt{${n}}`;
}

/* Parsing d‚Äôune saisie num√©rique (‚àö, fractions, d√©cimal) */
function evalExprSafe(str){
  if (typeof str !== 'string') return NaN;

  // 1) Normalisations (espaces/invisibles, signes, s√©parateurs)
  let s = str
    .replace(/[\u0009-\u000D\u00A0\u1680\u180E\u2000-\u200D\u2028\u2029\u202F\u205F\u2060-\u2063\uFE0E\uFE0F\uFEFF]/g,'')
    .replace(/\s+/g,'')
    .replace(/,/g,'.')
    .replace(/[‚àí‚Äì‚Äî]/g,'-')
    .replace(/[√ó¬∑‚ãÖ]/g,'*')
    .replace(/[√∑‚àï‚ÅÑ]/g,'/');

  // 2) Canonicaliser toute forme de racine vers ‚àö
  s = s
    .replace(/\u221A[\uFE0E\uFE0F]?/g, '‚àö')
    .replace(/\b(?:rac|sqrt)\b/gi, '‚àö');

  // 3) D√©velopper ‚àö en Math.sqrt(...)
  s = s
    .replace(/‚àö\s*\(\s*/g, 'Math.sqrt(')
    .replace(/‚àö\s*([0-9]+(?:\.[0-9]+)?(?:\/[0-9]+(?:\.[0-9]+)?)?)/g, 'Math.sqrt($1)')
    .replace(/‚àö/g, 'Math.sqrt');
  s = s.replace(/\^/g,'**');

  // 4) Garde-fou
  const t = s.replace(/Math\.sqrt\s*\(/g,'S(').replace(/Math\.sqrt\b/g,'S');
  if (!/^[0-9.+\-*/()S]*$/.test(t)) return NaN;

  try { return +Function('"use strict";return('+s+')')(); }
  catch { return NaN; }
}
function sameNum(a,b,tol=1e-3){ return isFinite(a)&&isFinite(b)&&Math.abs(a-b)<=tol; }

/* ========= Cercle remarquable (SVG) ========= */
const SVGNS='http://www.w3.org/2000/svg';
function setSVGTextWithBigPrimes(textEl, raw){
  const s = String(raw).replace(/‚Äô|‚Ä≤/g,"'");
  const parts = s.split("'");
  parts.forEach((chunk,i)=>{
    if(chunk){ const t=document.createElementNS(SVGNS,'tspan'); t.textContent=chunk; textEl.appendChild(t); }
    if(i<parts.length-1){
      const p=document.createElementNS(SVGNS,'tspan'); p.setAttribute('class','prime'); p.setAttribute('dy','-0.15em'); p.textContent='‚Ä≤'; textEl.appendChild(p);
      const r=document.createElementNS(SVGNS,'tspan'); r.setAttribute('dy','0.15em'); r.textContent=''; textEl.appendChild(r);
    }
  });
}
function circleWithPointsSVG({R=110}={}){
  const pad=22, W=2*R+2*pad, H=2*R+2*pad, cx=pad+R, cy=pad+R;
  const svg=document.createElementNS(SVGNS,'svg');
  svg.setAttribute('viewBox',`0 0 ${W} ${H}`); svg.setAttribute('width',W); svg.setAttribute('height',H);
  const g=(n,a={})=>{const e=document.createElementNS(SVGNS,n); for(const k in a) e.setAttribute(k,a[k]); svg.appendChild(e); return e;};

  // Quadrillage (¬±R/2)
  ['-0.5','0.5'].forEach(k=>{
    const dx=R*parseFloat(k), dy=R*parseFloat(k);
    g('line',{x1:cx+dx,y1:cy-R,x2:cx+dx,y2:cy+R,stroke:'#bbb','stroke-width':1,'stroke-dasharray':'4,4'});
    g('line',{x1:cx-R,y1:cy+dy,x2:cx+R,y2:cy+dy,stroke:'#bbb','stroke-width':1,'stroke-dasharray':'4,4'});
  });

  g('circle',{cx,cy,r:R,fill:'#fff',stroke:'#111','stroke-width':2});
  g('line',{x1:cx-R,y1:cy,x2:cx+R,y2:cy,stroke:'#111','stroke-width':1.4});
  g('line',{x1:cx,y1:cy+R,x2:cx,y2:cy-R,stroke:'#111','stroke-width':1.4});

  // Ticks 30¬∞
  for(let d=0; d<360; d+=30){
    const a=d*PI/180, x1=cx+(R-6)*Math.cos(a), y1=cy-(R-6)*Math.sin(a), x2=cx+R*Math.cos(a), y2=cy-R*Math.sin(a);
    g('line',{x1,y1,x2,y2,stroke:'#333','stroke-width':1});
  }

  const PTS=[['I',0],['A',PI/6],['B',PI/4],['C',PI/3],['J',PI/2],['D',2*PI/3],['E',3*PI/4],['F',5*PI/6],
  ['K',PI],["F'",7*PI/6],["E'",5*PI/4],["D'",4*PI/3],['L',3*PI/2],["C'",5*PI/3],["B'",7*PI/4],["A'",11*PI/6]];
  const coords={}; const labelR=R+12;
  for(const [name,a] of PTS){
    const xp=cx+R*Math.cos(a), yp=cy-R*Math.sin(a);
    const xl=cx+labelR*Math.cos(a), yl=cy-labelR*Math.sin(a);
    coords[name]={x:xp,y:yp};
    g('circle',{cx:xp,cy:yp,r:3,fill:'#111'});
    const anchor = Math.abs(Math.cos(a))<0.2 ? 'middle' : (Math.cos(a)>0?'start':'end');
    const dy = (Math.abs(Math.sin(a))<0.2) ? 4 : 1;
    const t=g('text',{x:xl,y:yl+dy,'font-size':13,'text-anchor':anchor,'dominant-baseline':'middle',class:'ptlbl'});
    setSVGTextWithBigPrimes(t,name);
  }
  // Liaisons pointill√©es
  const LINKS=[ ['C',"C'"], ['D',"D'"], ['F','A'], ["F'","A'"], ["E'","B"], ['E',"B'"] ];
  for(const [L,R2] of LINKS){
    const p=coords[L], q=coords[R2];
    if(p&&q) g('line',{x1:p.x,y1:p.y,x2:q.x,y2:q.y,stroke:'#999','stroke-width':1.4,'stroke-dasharray':'4,4'});
  }
  const tO=document.createElementNS(SVGNS,'text'); tO.setAttribute('x',cx-10); tO.setAttribute('y',cy+16); tO.setAttribute('class','ptlbl'); tO.textContent='O'; svg.appendChild(tO);

  return {svg,cx,cy,R};
}
const POINTS_MAP = {
  'I':0,'A':PI/6,'B':PI/4,'C':PI/3,'J':PI/2,'D':2*PI/3,'E':3*PI/4,'F':5*PI/6,'K':PI,
  "F'":7*PI/6,"E'":5*PI/4,"D'":4*PI/3,'L':3*PI/2,"C'":5*PI/3,"B'":7*PI/4,"A'":11*PI/6
};
const ALL_LABELS = Object.keys(POINTS_MAP);

/* ========= EXO 1 ‚Äî Coordonn√©es des points remarquables ========= */
function EXO_point_coords(){
  const host=$('#mount-here'); host.innerHTML='';
  const grid=document.createElement('div'); grid.className='grid-two'; host.appendChild(grid);

  const svgbox=document.createElement('div'); svgbox.className='svgbox'; grid.appendChild(svgbox);
  const {svg}=circleWithPointsSVG({R:110}); svgbox.appendChild(svg);

  const st=document.createElement('div'); st.className='statement'; grid.appendChild(st);

  const pool=[...ALL_LABELS]; const pick=()=>pool.splice((Math.random()*pool.length)|0,1)[0];
  const PTS=[...Array(6)].map(()=>pick());
  st.innerHTML = `
    <div class="q">
      <div><strong>Exercice 1 ‚Äî Coordonn√©es des points remarquables</strong></div>
      <div style="margin:6px 0">Compl√©ter le tableau avec les valeurs exactes de \\(\\cos a\\) et \\(\\sin a\\), o√π \\(a\\) est tel que son image sur le cercle est le point indiqu√©.</div>
      <table class="radtab" style="margin-top:6px">
        <thead><tr><th class="lab">Point</th><th>\\(\\cos a\\)</th><th>\\(\\sin a\\)</th></tr></thead>
        <tbody>
          ${PTS.map((Lbl,i)=>`
            <tr>
              <th class="lab">${Lbl.replace(/'/g,"<span class='prime'>‚Ä≤</span>")}</th>
              <td><div class="input-line"><input type="text" data-i="${i}" data-kind="c"><span class="mark" data-i="${i}" data-kind="c"></span></div></td>
              <td><div class="input-line"><input type="text" data-i="${i}" data-kind="s"><span class="mark" data-i="${i}" data-kind="s"></span></div></td>
            </tr>`).join('')}
        </tbody>
      </table>
      <div class="solution-box" id="solEx1" style="display:none"></div>
    </div>
  `;

  const EXPECT = PTS.map(L=>cosSinExact(POINTS_MAP[L]));

  function check(){
    let allFilled=true, allCorrect=true;
    $$('#mount-here input[type="text"]').forEach(inp=>{
      const i=+inp.dataset.i, kind=inp.dataset.kind;
      const mark = inp.parentElement.querySelector('.mark');
      if(!inp.value.trim()){
        inp.style.borderColor='#dcdcdc';
        mark.textContent=''; mark.className='mark';
        allFilled=false; return;
      }
      const val=evalExprSafe(inp.value);
      const good = kind==='c' ? EXPECT[i].cos : EXPECT[i].sin;
      const pass = sameNum(val, good);
      inp.style.borderColor = pass? '#16a34a' : '#dc2626';
      mark.textContent = pass ? '‚úì' : '‚úó';
      mark.className = 'mark ' + (pass ? 'ok' : 'ko');
      if(!pass) allCorrect=false;
    });
    const solved = allFilled && allCorrect;
    return {solved};
  }
  function solution(){
    const box=$('#solEx1'); box.style.display='';
 const rows = PTS.map((Lbl,i)=>`<tr><th class="lab">${Lbl.replace(/'/g,"<span class='prime'>‚Ä≤</span>")}</th><td>${L(EXPECT[i].cosTex)}</td><td>${L(EXPECT[i].sinTex)}</td></tr>`).join('');
    box.innerHTML = `<div><strong>Correction.</strong></div><table class="radtab" style="margin-top:6px"><thead><tr><th class="lab">Point</th><th>\\(\\cos a\\)</th><th>\\(\\sin a\\)</th></tr></thead><tbody>${rows}</tbody></table>`;
    typesetAll(box);
  }
  function reset(){
    $$('#mount-here input[type="text"]').forEach(inp=>{ inp.value=''; inp.style.borderColor='#dcdcdc'; });
    $$('#mount-here .mark').forEach(m=>{ m.textContent=''; m.className='mark'; });
    $('#solEx1').style.display='none'; $('#solEx1').innerHTML='';
  }

  // typeset initial (en-t√™tes)
  typesetAll(st);

  return {check, solution, reset,
    pdf:{
      gen(){ return {PTS}; },
      render(st,isSol){
        const {svg}=circleWithPointsSVG({R:110});
        const svgHTML = svg.outerHTML.replace('<svg','<svg style="width:70mm;height:70mm"');
        const rows = st.PTS.map(Lbl=>{
          const ex = cosSinExact(POINTS_MAP[Lbl]);
          return `<tr><th class="lab">${Lbl.replace(/'/g,"<span class='prime'>‚Ä≤</span>")}</th><td>${isSol?L(ex.cosTex):''}</td><td>${isSol?L(ex.sinTex):''}</td></tr>`;
       }).join('');
       const css = `
          .radtab{border-collapse:collapse;width:100%}
          .radtab th,.radtab td{border:1.2pt solid #000;padding:6pt 8pt;text-align:center;vertical-align:middle}
          .radtab .lab{text-align:left}
        `;
		 const title = `<b>Exercice 1 ‚Äî Coordonn√©es des points remarquables</b>`;
 const enonce = `<div style="margin:4mm 0 3mm 0">
   Compl√©ter le tableau avec les valeurs exactes de \\(\\cos(a)\\) et \\(\\sin(a)\\),
   o√π \\(a\\) est tel que son image sur le cercle est le point indiqu√©.
 </div>`;
        return `<style>${css}</style>
   <div style="width:180mm;font-size:12pt;line-height:1.45">
     ${title}
     ${enonce}
     <div style="display:grid;grid-template-columns:70mm 1fr;column-gap:10mm;align-items:start">
       <div style="display:flex;justify-content:center;align-items:center">${svgHTML}</div>
       <div>
         <table class="radtab">
          <thead><tr><th class="lab">Point</th><th>\\(\\cos(a)\\)</th><th>\\(\\sin(a)\\)</th></tr></thead>
           <tbody>${rows}</tbody>
         </table>
       </div>
     </div>
   </div>`;
      }
    }
  };
}

/* ========= EXO 2 ‚Äî Valeurs remarquables (cercle + tableau) ========= */
function EXO_remarkable_values(){
  const host=$('#mount-here'); host.innerHTML='';
  const grid=document.createElement('div'); grid.className='grid-two'; host.appendChild(grid);

  const svgbox=document.createElement('div'); svgbox.className='svgbox'; grid.appendChild(svgbox);
  const {svg}=circleWithPointsSVG({R:110}); svgbox.appendChild(svg);

  const statement=document.createElement('div'); statement.className='statement'; grid.appendChild(statement);

  const ANG_SET=[0,PI/6,PI/4,PI/3,PI/2,2*PI/3,3*PI/4,5*PI/6,PI,-PI/6,-PI/4,-PI/3,-PI/2,-3*PI/4,-5*PI/6,TAU];
  const pick=(arr)=>arr.splice((Math.random()*arr.length)|0,1)[0];
  const pool=[...ANG_SET]; const TASKS=[];
  for(let i=0;i<6 && pool.length;i++){
    const a = pick(pool);
    const askCos = Math.random()<0.5;
    TASKS.push({a, askCos});
  }
  statement.innerHTML = `
    <div class="q">
      <div><strong>Exercice 2 ‚Äî Cosinus et sinus d‚Äôun angle</strong></div>
      <div style="margin:6px 0">En utilisant le cercle trigonom√©trique et le tableau des valeurs remarquables, d√©terminer la valeur exacte de :</div>
      <table class="radtab" style="margin-top:6px">
        <tbody>
          ${TASKS.map((t,i)=>`
            <tr>
              <th class="lab">${String.fromCharCode(97+i)}.&nbsp;${L(`${t.askCos?'\\cos':'\\sin'}\\big( ${fmtPiTex(t.a)} \\big)`)}</th>
              <td>
                <div class="input-line">
                  <input type="text" data-i="${i}">
                  <span class="mark" data-i="${i}"></span>
                </div>
              </td>
            </tr>
          `).join('')}
        </tbody>
      </table>
      <div class="solution-box" id="solEx2" style="display:none"></div>
    </div>
  `;
  typesetAll(statement);

  const expect = TASKS.map(t=> (t.askCos ? cosSinExact(t.a).cos : cosSinExact(t.a).sin));

  function check(){
    let allFilled=true, allCorrect=true;
    $$('#mount-here input[type=text]').forEach((inp)=>{
      const i=+inp.dataset.i, val = evalExprSafe(inp.value);
      const mark = inp.parentElement.querySelector('.mark');
      if(!inp.value.trim()){
        inp.style.borderColor='#dcdcdc';
        mark.textContent=''; mark.className='mark';
        allFilled=false; return;
      }
      const pass = sameNum(val, expect[i]);
      inp.style.borderColor = pass? '#16a34a' : '#dc2626';
      mark.textContent = pass ? '‚úì' : '‚úó';
      mark.className = 'mark ' + (pass ? 'ok' : 'ko');
      if(!pass) allCorrect=false;
    });
    const solved = allFilled && allCorrect;
    return {solved};
  }
  function solution(){
    const box=$('#solEx2'); box.style.display='';
    const rows = TASKS.map((t,i)=>{
      const exact = t.askCos ? cosSinExact(t.a).cosTex : cosSinExact(t.a).sinTex;
      return `<tr><th class="lab">${String.fromCharCode(97+i)}.&nbsp;${L(`${t.askCos?'\\cos':'\\sin'}\\big( ${fmtPiTex(t.a)} \\big)`)}</th><td>${L(exact)}</td></tr>`;
    }).join('');
    box.innerHTML = `<div><strong>Correction.</strong></div><table class="radtab" style="margin-top:6px"><tbody>${rows}</tbody></table>`;
    typesetAll(box);
  }
  function reset(){
    $$('#mount-here input[type=text]').forEach(inp=>{ inp.value=''; inp.style.borderColor='#dcdcdc'; });
    $$('#mount-here .mark').forEach(m=>{ m.textContent=''; m.className='mark'; });
    $('#solEx2').style.display='none'; $('#solEx2').innerHTML='';
  }

  return {check, solution, reset,
    pdf:{
      gen(){ return {TASKS}; },
      render(st,isSol){
        const {svg}=circleWithPointsSVG({R:110});
  const left = svg.outerHTML.replace('<svg','<svg style="width:70mm;height:70mm"');
  const rows = st.TASKS.map((t,i)=>{
    const lab = `${t.askCos?'\\\\cos':'\\\\sin'}\\big( ${fmtPiTex(t.a)} \\big)`;
    const exact = t.askCos ? cosSinExact(t.a).cosTex : cosSinExact(t.a).sinTex;
    return `<tr><th class="lab">${String.fromCharCode(97+i)}.&nbsp;\\(${lab}\\)</th><td>${isSol? L(exact) : ''}</td></tr>`;
  }).join('');
  const css = `
    .radtab{border-collapse:collapse;width:100%}
    .radtab th,.radtab td{border:1.2pt solid #000;padding:6pt 8pt;text-align:center;vertical-align:middle}
    .radtab .lab{text-align:left}
  `;
const right = `
         <table class="radtab" style="table-layout:fixed;width:100%">
            <colgroup>
              <col style="width:40mm">
              <col style="width:auto">
            </colgroup>
            <tbody>${rows}</tbody>
          </table>`;
 const title = `<b>Exercice 2 ‚Äî Cosinus et sinus d‚Äôun angle</b>`;
 const enonce = `<div style="margin:4mm 0 3mm 0">
   En utilisant le cercle trigonom√©trique et le tableau des valeurs remarquables,
  d√©terminer la valeur exacte demand√©e.
 </div>`;

 return `<style>${css}</style>
          <div style="width:180mm;display:grid;grid-template-columns:70mm 1fr;column-gap:10mm;align-items:start;font-size:12pt">
     ${title}
     ${enonce}
            <div style="display:flex;justify-content:center;align-items:center">${left}</div>
            <div>${right}</div>
     </div>
  </div>`;
}
    }
  };
}

/* ========= EXO 3 ‚Äî Sin‚ÜîCos (1 question, correction d√©taill√©e) ========= */
function EXO_sin_cos_from_other(){
  const host=$('#mount-here'); host.innerHTML='';
  const box=document.createElement('div'); box.className='row'; host.appendChild(box);

  const intervals = [
    {I:[0,PI/2],   w:45, lab:'[ 0 ; œÄ/2 ]'},
    {I:[PI/2,PI],  w:15, lab:'[ œÄ/2 ; œÄ ]'},
    {I:[PI,3*PI/2],w:15, lab:'[ œÄ ; 3œÄ/2 ]'},
    {I:[3*PI/2,TAU],w:15,lab:'[ 3œÄ/2 ; 2œÄ ]'}
  ];
  const W = intervals.reduce((a,b)=>a+b.w,0);
  function pickInterval(){ let r=Math.random()*W, acc=0; for(const it of intervals){ acc+=it.w; if(r<=acc) return it; } return intervals[0]; }
  function randPQ(){
    let q = 5 + (Math.random()*8|0); // 5..12
    let p = 1 + (Math.random()*(q-1)|0);
    const g=(a,b)=>b?g(b,a%b):a; const d=g(p,q); p/=d; q/=d;
    if(p>q) [p,q]=[q,p];
    return [p,q];
  }

  const askSin = Math.random()<0.5; // une seule question
  const it = pickInterval();
  const [p,q]=randPQ();
  const knownAbs = p/q;
  const a = (it.I[0] + Math.random()*(it.I[1]-it.I[0]));
  const sCos = (a>=0 && a<PI/2) || (a>=3*PI/2 && a<TAU) ? 1 : ((a>=PI/2 && a<3*PI/2) ? -1 : 1);
  const sSin = (a>=0 && a<PI) ? 1 : -1;
  const cosv = sCos * (askSin ? knownAbs : Math.sqrt(1-knownAbs*knownAbs));
  const sinv = sSin * (askSin ? Math.sqrt(1-knownAbs*knownAbs) : knownAbs);

  const carTex = '\\text{car}';

  function derivationTeX(){
    const q2 = q*q, p2 = p*p;
    if(askSin){
      const L1 = `\\cos^2(a) + \\sin^2(a) = 1`;
      const L2 = `\\left(${fracTex(p,q)}\\right)^2 + \\sin^2(a) = 1`;
      const L3 = `${fracTex(p2,q2)} + \\sin^2(a) = 1`;
      const L4 = `\\sin^2(a) = 1 - ${fracTex(p2,q2)}`;
      const L5 = `\\sin^2(a) = ${fracTex(q2,q2)} - ${fracTex(p2,q2)} = ${fracTex(q2-p2,q2)}`;
      const rad = q2 - p2;
      const num = sqrtNumTex(rad);
      const L6 = `\\sin(a) = ${sSin<0?'-':''}\\, ${fracTex(num, q)} \\; ${carTex}\\; a \\in ${intervalLabelTex(it.I)}.`;
      return [L1,L2,L3,L4,L5,L6];
    }else{
      const L1 = `\\sin^2(a) + \\cos^2(a) = 1`;
      const L2 = `\\left(${fracTex(p,q)}\\right)^2 + \\cos^2(a) = 1`;
      const L3 = `${fracTex(p2,q2)} + \\cos^2(a) = 1`;
      const L4 = `\\cos^2(a) = 1 - ${fracTex(p2,q2)}`;
      const L5 = `\\cos^2(a) = ${fracTex(q2,q2)} - ${fracTex(p2,q2)} = ${fracTex(q2-p2,q2)}`;
      const rad = q2 - p2;
      const num = sqrtNumTex(rad);
      const L6 = `\\cos(a) = ${sCos<0?'-':''}\\, ${fracTex(num, q)} \\; ${carTex}\\; a \\in ${intervalLabelTex(it.I)}.`;
      return [L1,L2,L3,L4,L5,L6];
    }
  }
  const steps = derivationTeX();

  const questionHTML = askSin
    ? `Soit \\(a \\in ${intervalLabelTex(it.I)}\\) et \\(\\cos(a) = ${fracTex(p,q)}\\).<br>Calculer <strong>\\(\\sin(a)\\)</strong>.`
    : `Soit \\(a \\in ${intervalLabelTex(it.I)}\\) et \\(\\sin(a) = ${fracTex(p,q)}\\).<br>Calculer <strong>\\(\\cos(a)\\)</strong>.`;

  box.innerHTML = `
    <div class="q">
      <div style="font-weight:700;margin-bottom:6px">Exercice 3 ‚Äî Sinus et cosinus d‚Äôun nombre r√©el</div>
      <div class="row">
        <div>${questionHTML}</div>
        <div class="input-line" style="margin-top:6px">
          <label>${askSin? L('\\\\sin\\, a =') : L('\\\\cos\\, a =')}</label>
          <input id="ex3" type="text">
          <span id="m3" class="mark"></span>
        </div>
        <div class="solution-box" id="sol3" style="display:none"></div>
      </div>
    </div>
  `;
  typesetAll(box);

  function check(){
    let solved=false;
    const el=$('#ex3'), mark=$('#m3');
    if(!el.value.trim()){
      el.style.borderColor='#dcdcdc';
      mark.textContent=''; mark.className='mark';
      solved=false;
    }else{
      const v = evalExprSafe(el.value);
      const target = askSin ? sinv : cosv;
      const pass = sameNum(v, target);
      el.style.borderColor = pass? '#16a34a' : '#dc2626';
      mark.textContent = pass ? '‚úì' : '‚úó';
      mark.className = 'mark ' + (pass ? 'ok' : 'ko');
      solved = pass;
    }
    return {solved};
  }
  function solution(){
    const box=$('#sol3'); box.style.display='';
    box.innerHTML = `<div><strong>Correction.</strong></div>` + steps.map(s=>`<div>${L(s)}</div>`).join('');
    typesetAll(box);
  }
  function reset(){
    const el=$('#ex3'); el.value=''; el.style.borderColor='#dcdcdc';
    $('#m3').textContent=''; $('#m3').className='mark';
    $('#sol3').style.display='none'; $('#sol3').innerHTML='';
  }

  return {check, solution, reset,
    pdf:{
      gen(){ return {askSin, it, p, q, steps}; },
      render(st,isSol){
        const qtxt = st.askSin
          ? `Soit \\(a \\in ${intervalLabelTex(st.it.I)}\\) et \\(\\cos(a) = ${fracTex(st.p,st.q)}\\). Calculer \\(\\sin(a)\\).`
          : `Soit \\(a \\in ${intervalLabelTex(st.it.I)}\\) et \\(\\sin(a) = ${fracTex(st.p,st.q)}\\). Calculer \\(\\cos(a)\\).`;
        const solHTML = `<div class="solution-box"><b>Correction.</b>${st.steps.map(s=>`<div>\\(${s}\\)</div>`).join('')}</div>`;
        return `<div><b>Exercice 3 ‚Äî Sinus et cosinus d‚Äôun nombre r√©el.</b><br>${qtxt}${isSol?solHTML:''}</div>`;
      }
    }
  };
}

/* ========= REGISTRY & UI ========= */
const REGISTRY = [
  { id:'point-coords',       title:'(1) Coordonn√©es des points remarquables', gen: EXO_point_coords },
  { id:'remarkable-values',  title:'(2) Valeurs remarquables (cercle + tableau)', gen: EXO_remarkable_values },
  { id:'sin-cos-from-other', title:'(3) Sinus ‚Üî Cosinus (1 question, correction d√©taill√©e)', gen: EXO_sin_cos_from_other }
];
window.REGISTRY = REGISTRY;

let API=null, scoreOK=0, scoreTOT=0;
function populateSelect(){ const sel=$('#exo-select'); sel.innerHTML=''; for(const e of REGISTRY){ const o=document.createElement('option'); o.value=e.id; o.textContent=e.title; sel.appendChild(o); } }
function renderActive(){ const sel=$('#exo-select'); const exo=REGISTRY.find(e=>e.id===sel.value); API=exo.gen(); }
function buildOne(){ if($('#mount-here')) $('#mount-here').innerHTML=''; renderActive(); }
function updateScore(){ $('#score').textContent = `Score : ${scoreOK} / ${scoreTOT}`; }
function check(){ if(!API) return; const r=API.check(); if(r && r.solved){ scoreOK += 1; scoreTOT += 1; updateScore(); } }
function solution(){ if(!API) return; API.solution(); }
function resetAll(){ scoreOK=0; scoreTOT=0; updateScore(); if(API) API.reset(); }

document.addEventListener('DOMContentLoaded',()=>{
  populateSelect(); $('#exo-select').selectedIndex=0; renderActive();
  $('#exo-select').addEventListener('change', buildOne);
  $('#btn-new').addEventListener('click', buildOne);
  $('#btn-check').addEventListener('click', check);
  $('#btn-solution').addEventListener('click', solution);
  $('#btn-reset').addEventListener('click', resetAll);
  updateScore();
  document.addEventListener('keydown',(ev)=>{
    const a=document.activeElement;
    if(a && a.tagName==='INPUT' && ev.key==='Enter'){ ev.preventDefault(); check(); }
  });
});
</script>

<!-- ======= G√©n√©rateur PDF ======= -->
<script src='../../../../js/exo-pdf-kit.multiplicatif-latex.js' defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  if (!window.ExoPDF) return;
  ExoPDF.init({
    title: document.title || 'Fiche ‚Äî Cosinus & sinus',
    mountAfterSelector: '#input-notes',
    max: 50,
    beforeGen(def, st, meta){
      const sel=$('#exo-select'); const ex=REGISTRY.find(e=>e.id===sel.value);
      if(!ex) return {};
      return ex.gen().pdf.gen();
    },
    beforeRender(def, st, isSolution){
      const sel=$('#exo-select'); const ex=REGISTRY.find(e=>e.id===sel.value);
      if(!ex) return '';
      return ex.gen().pdf.render(st, isSolution);
    }
  });
});
</script>
</body>
</html>
