<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>1Ã¨re â€“ Produit scalaire - Normes et angle</title>

<link rel="stylesheet" href="../../../../css/math-kbd.css">
<link rel="stylesheet" href="../../../../css/espace-latex.css">
<link rel="stylesheet" href="../../../../css/espace-gras.css">
<link rel="stylesheet" href="../../../../css/mobile.css">

<style>
  *{box-sizing:border-box}
  :root{--ink:#111;--bg:#fafafa;--card:#fff;--line:#e6e6e6;--ok:#11823b;--ko:#b00020}
  html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.55 system-ui,Segoe UI,Roboto,Arial}
  .header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;padding:14px 18px;z-index:5}
  .wrap{max-width:1200px;margin:0 auto;padding:18px;display:flex;flex-direction:column;gap:12px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
  .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  select,input[type="text"]{padding:8px 10px;border:1px solid #ddd;border-radius:8px;font-size:15px}
  .btn{padding:8px 12px;border:1px solid #ddd;background:#fff;border-radius:8px;cursor:pointer}
  .btn:hover{background:#f6f6f6}
  .score{margin-left:auto}
  .steps{margin:.35rem 0 0 .15rem;padding:.35rem .5rem;background:#f2f2f2;border:1px dashed #bbb;border-radius:8px}
  .step{margin:.2rem 0}
  .tick{ display:inline-block; min-width:1.15em; text-align:center; margin-left:.35rem; font-weight:700 }
  .tick.nu::after{ content:''; }
  .tick.ok::after{ content:'âœ“'; color:#11823b; }
  .tick.ko::after{ content:'âœ—'; color:#b00020; }

  table.pdf-tbl{
    border-collapse: separate; border-spacing: 0; border: none; margin:.4rem 0;
  }
  table.pdf-tbl th, table.pdf-tbl td{
    border: none; padding: 4px 6px; text-align: center; vertical-align: middle;
  }
  table.pdf-tbl th{ background:#f3f3f6 }
  table.pdf-tbl tr:first-child > * { border-top:    1.5px solid #000; }
  table.pdf-tbl tr:last-child  > * { border-bottom: 1.5px solid #000; }
  table.pdf-tbl tr > *:first-child { border-left:   1.5px solid #000; }
  table.pdf-tbl tr > *:last-child  { border-right:  1.5px solid #000; }
  table.pdf-tbl thead tr > *:first-child,
  table.pdf-tbl tbody tr > *:first-child{ border-right: 1.5px solid #000; }

  table.pdf-tbl td.sbar,
  table.pdf-tbl td.zbar,
  table.pdf-tbl td.dbar { position: relative; }

  table.pdf-tbl td.sbar::before,
  table.pdf-tbl td.zbar::before{
    content:'';
    position:absolute;
    top:-1.5px;
    bottom:-1.5px;
    left:50%;
    transform:translateX(-50%);
    border-left:2px solid #000;
  }
  table.pdf-tbl td.zbar{
    font-size: 1.35em;
    font-weight: 400;
    line-height: 1;
  }

  .var-wrap{display:flex;justify-content:center}
  table.var{width:max-content;border-collapse:separate;border-spacing:0;margin:.35rem auto}
  table.var th, table.var td{padding:4px 6px;border:1.5px solid #000}
  table.var th{background:#f3f3f6}
  table.var input[type="text"]{text-align:center}
  table.var .thin td{ border-top:none; border-left:none; border-right:none; padding-top:2px; }
  table.var .gaprow td{ border:none !important; height:8px; padding:0; }

  .ext-cell{
    display:flex;
    flex-direction:column;
    gap:2px;
    align-items:center;
  }
  .ext-cell input[type="text"]{
    width:70px;
    max-width:100%;
    font-size:.9rem;
    padding:2px 4px;
  }

  @media screen { .screen-only{display:block!important} .print-only{display:none!important} }
  @media print  { .screen-only{display:none!important} .print-only{display:block!important} }

  .table-qcm-screen{
    width:100%;
    border-collapse:separate;
    border-spacing:12px 8px;
  }
  .table-qcm-screen td{ width:50%; vertical-align:top }
  .table-qcm-screen .cell{
    border:1px solid var(--line);
    border-radius:10px;
    padding:10px 12px;
    background:#fff;
  }
  .table-qcm-screen .num{ font-weight:700; margin-right:6px }
  .table-qcm-screen select{ margin-left:8px }

  table.pdf-tbl td.dbar::before,
  table.pdf-tbl td.dbar::after{
    content:'';
    position:absolute;
    top:-1.5px;
    bottom:-1.5px;
    border-left:2px solid #000;
  }
  table.pdf-tbl td.dbar::before{ left: calc(50% - 2px); }
  table.pdf-tbl td.dbar::after { left: calc(50% + 2px); }

  .uvtab{
    border-collapse:collapse;
    margin:.6rem 0 .8rem 0;
    font-size:0.95rem;
  }
  .uvtab td{
    border:none;
    padding:4px 32px 4px 0;
    white-space:nowrap;
    vertical-align:top;
    line-height:1.6;
  }
  @media print{
    .uvtab td{ padding:4px 40px 4px 0; }
  }

  .angle-mode-box{
    margin-bottom:.5rem;
    padding:.35rem .6rem;
    border-radius:8px;
    background:#f7f7f9;
    display:inline-flex;
    align-items:center;
    gap:.4rem;
  }
  
  /* Chapeau HTML pour l'angle dans le PDF */
.html-angle{
  display:inline-block;
  position:relative;
  padding-top:0.25em;
}
.html-angle-base{
  display:inline-block;
}
.html-angle-cap{
  position:absolute;
  left:50%;
  top:0;
  transform:translate(-50%,-65%);
  font-size:0.7em;
  line-height:1;
}
  
  
</style>

<!-- MathJax -->
<script>
  window.MathJax={tex:{inlineMath:[['\\(','\\)'],['$','$']],displayMath:[['\\[','\\]'],['$$','$$']],processEscapes:true},chtml:{matchFontHeight:false},startup:{typeset:true}};
</script>
<script defer src="../../../../es5/tex-chtml.js"></script>
<script src='../../../../js/math-kbd.js' defer></script>
<script src='../../../../js/exo-pdf-kit.multiplicatif-latex.js' defer></script>

</head>
<body>
  <div class="header">
    <h1 style="margin:0;font-size:1.1rem">1Ã¨re â€“ Produit scalaire - Normes et angle</h1>
  </div>

  <div class="wrap">
    <div class="controls card">
      <label for="exo-select"><strong>Type dâ€™exercice :</strong></label>
      <select id="exo-select"></select>

      <button id="btn-new" class="btn">ðŸ”„ Nouvel Ã©noncÃ©</button>
      <button id="btn-check" class="btn">âœ… VÃ©rifier</button>
      <button id="btn-solution" class="btn">ðŸ’¡ Solution</button>
      <button id="btn-reset" class="btn">ðŸ§¹ RÃ©initialiser</button>
      <span class="score">Score : <span id="score">0 / 0</span></span>
    </div>

    <div class="card" id="host"></div>

    <div class="card small">
      <strong>Consignes de saisie</strong>
      <ul style="margin:.5rem 0 0 18px">
        <li>Pour les produits scalaires et les longueurs : rÃ©pondre avec un nombre rÃ©el (entier, dÃ©cimal avec virgule ou fraction du type <code>a/b</code>).</li>
        <li>Pour les angles :
          <ul>
            <li>si lâ€™unitÃ© choisie est <strong>Radian</strong> : rÃ©pondre en radians, par exemple <code>pi/3</code> ou <code>Ï€/3</code> ; pour lâ€™exercice&nbsp;3, donner une valeur approchÃ©e au centiÃ¨me prÃ¨s ;</li>
            <li>si lâ€™unitÃ© choisie est <strong>DegrÃ©</strong> : rÃ©pondre en degrÃ©s (par exemple <code>60</code>) ; pour lâ€™exercice&nbsp;3, donner une valeur approchÃ©e au <strong>degrÃ© prÃ¨s</strong>.</li>
          </ul>
        </li>
        <li>Le signe Â« âˆ’ Â» peut Ãªtre saisi avec le tiret du clavier ; les espaces sont ignorÃ©s.</li>
      </ul>
    </div>

    <div class="card"><div data-math-kbd style="display:flex;justify-content:center"></div></div>
  </div>

<script>
(function(){
'use strict';

/* â€”â€”â€”â€”â€” Utils â€”â€”â€”â€”â€” */
const $ = (s,r)=> (r||document).querySelector(s);
let scoreOK=0, scoreTot=0;
const UMIN='âˆ’';

function cleanSigns(s){
  if(!s) return s;
  let out = String(s);
  out = out.replace(/\u2212/g, '-');
  out = out.replace(/\s+/g,' ').trim();
  out = out.replace(/\+\s*-\s*/g, ' - ');
  out = out.replace(/-\s*-\s*/g, ' + ');
  out = out.replace(/\+\s*\+\s*/g, ' + ');
  out = out.replace(/-\s*\+\s*/g, ' - ');
  out = out.replace(/^\+\s*/,'');
  out = out.replace(/\s+/g,' ').trim();
  return out.replace(/-/g, UMIN);
}

function updateScore(){ $("#score").textContent=scoreOK+" / "+scoreTot; }
function L(s){return '\\( '+s+' \\)';}

function ensureTickAfter(el){
  if(!el) return null;
  let s = el.nextElementSibling;
  if (s && s.classList && s.classList.contains('tick')) return s;
  s = document.createElement('span');
  s.className = 'tick nu';
  el.insertAdjacentElement('afterend', s);
  return s;
}
function setTick(el, state){
  if(!el) return;
  ensureTickAfter(el).className='tick '+state;
}

function typesetAll(root){
  const run=()=>MathJax.typesetPromise(root?[root]:undefined).catch(()=>{});
  if(MathJax?.startup?.promise){
    MathJax.startup.promise.then(run);
  } else {
    const t=setInterval(()=>{
      if(MathJax?.typesetPromise){
        clearInterval(t); run();
      }
    },60);
  }
}

const choice=a=>a[Math.floor(Math.random()*a.length)];
const rint=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;

function mapHTML(arr, render, sep=''){
  let out = '';
  for (let i = 0; i < arr.length; i++){
    out += render(arr[i], i);
    if (sep && i < arr.length - 1) out += sep;
  }
  return out;
}

// UnitÃ© d'angle globale pour toute la page (et pour le PDF)
let ANGLE_MODE = 'rad';

function getAngleMode(){
  return ANGLE_MODE;
}
function setAngleMode(mode){
  ANGLE_MODE = mode || 'rad';
}


/* parseurs & format */
function parseNumber(str){
  if(str==null) return NaN;
  let s = String(str).trim();
  if(!s) return NaN;

  // normalisation signe et virgule
  s = s.replace(/\u2212/g,'-').replace(/,/g,'.');

  // rac() â†’ Math.sqrt()
  s = s.replace(/rac\s*\(/gi, 'Math.sqrt(');

  // --- Multiplication implicite ---
  s = s
    .replace(/(\d)\s*(?=(Math\.sqrt|Math\.PI|\())/g, '$1*')
    .replace(/\)\s*(?=(\d|Math\.sqrt|Math\.PI|\())/g, ')*')
    .replace(/Math\.PI\s*(?=(\d|Math\.sqrt|\())/g, 'Math.PI*');

  // fraction simple a/b
  if(/^[+-]?\d+\s*\/\s*[+-]?\d+$/.test(s)){
    const parts = s.split('/');
    const p = Number(parts[0]);
    const q = Number(parts[1]);
    if(!q) return NaN;
    return p/q;
  }

  try{
    return Function('"use strict";return('+s+')')();
  }catch(e){
    return NaN;
  }
}


function approxEqual(a,b,eps=1e-6){
  if(!isFinite(a) || !isFinite(b)) return false;
  return Math.abs(a-b)<=eps;
}

function formatNumber(x){
  if(!isFinite(x)) return String(x);
  const r = Math.round(x);
  if(Math.abs(x-r)<1e-9) return String(r);
  return String(x).replace('.',',');
}

function parseAngle(str){
  if(str==null) return NaN;
  let s = String(str).trim();
  if(!s) return NaN;

  // normalisation signe et virgule
  s = s.replace(/\u2212/g,'-').replace(/,/g,'.');

  // rac() â†’ Math.sqrt()
  s = s.replace(/rac\s*\(/gi, 'Math.sqrt(');

  // pi ou Ï€ â†’ Math.PI
  s = s.replace(/Ï€|pi/gi,'Math.PI');

  // --- Multiplication implicite ---
  s = s
    .replace(/(\d)\s*(?=(Math\.sqrt|Math\.PI|\())/g, '$1*')
    .replace(/\)\s*(?=(\d|Math\.sqrt|Math\.PI|\())/g, ')*')
    .replace(/Math\.PI\s*(?=(\d|Math\.sqrt|\())/g, 'Math.PI*');

  try{
    return Function('"use strict";return('+s+')')();
  }catch(e){
    return NaN;
  }
}


/* parenthÃ¨ses aprÃ¨s une multiplication si le facteur est nÃ©gatif */
function texFactorAfterTimes(tex, numericValue){
  if(numericValue < 0){
    return '\\left('+tex+'\\right)';
  }
  return tex;
}

/* gcd pour fractions (exo 3 et PS symbolique) */
function gcd(a,b){
  a = Math.abs(Math.round(a));
  b = Math.abs(Math.round(b));
  while(b){ const t=a%b; a=b; b=t; }
  return a || 1;
}

/* conversion rad â†” degrÃ©s */
function radToDeg(val){
  return Math.round(val*180/Math.PI);
}
function radToDegTex(val){
  const d = radToDeg(val);
  return d+'^{\\circ}';
}

/* â€”â€”â€”â€”â€” Angles remarquables (et opposÃ©s) â€”â€”â€”â€”â€”
   cos(theta) = (num/den)*sqrt(rad)   (rad = 0,2,3) */
const ANGLES = [
  { tex:'0',                  label:'0',     val:0,                num:1,  den:1, rad:0, cosTex:'1' },
  { tex:'\\dfrac{\\pi}{6}',   label:'Ï€/6',   val:Math.PI/6,        num:1,  den:2, rad:3, cosTex:'\\dfrac{\\sqrt{3}}{2}' },
  { tex:'\\dfrac{\\pi}{4}',   label:'Ï€/4',   val:Math.PI/4,        num:1,  den:2, rad:2, cosTex:'\\dfrac{\\sqrt{2}}{2}' },
  { tex:'\\dfrac{\\pi}{3}',   label:'Ï€/3',   val:Math.PI/3,        num:1,  den:2, rad:0, cosTex:'\\dfrac{1}{2}' },
  { tex:'\\dfrac{\\pi}{2}',   label:'Ï€/2',   val:Math.PI/2,        num:0,  den:1, rad:0, cosTex:'0' },
  { tex:'\\dfrac{2\\pi}{3}',  label:'2Ï€/3',  val:2*Math.PI/3,      num:-1, den:2, rad:0, cosTex:'-\\dfrac{1}{2}' },
  { tex:'\\dfrac{3\\pi}{4}',  label:'3Ï€/4',  val:3*Math.PI/4,      num:-1, den:2, rad:2, cosTex:'-\\dfrac{\\sqrt{2}}{2}' },
  { tex:'\\dfrac{5\\pi}{6}',  label:'5Ï€/6',  val:5*Math.PI/6,      num:-1, den:2, rad:3, cosTex:'-\\dfrac{\\sqrt{3}}{2}' },
  { tex:'\\pi',               label:'Ï€',     val:Math.PI,          num:-1, den:1, rad:0, cosTex:'-1' },
  { tex:'-\\dfrac{\\pi}{6}',  label:'-Ï€/6',  val:-Math.PI/6,       num:1,  den:2, rad:3, cosTex:'\\dfrac{\\sqrt{3}}{2}' },
  { tex:'-\\dfrac{\\pi}{4}',  label:'-Ï€/4',  val:-Math.PI/4,       num:1,  den:2, rad:2, cosTex:'\\dfrac{\\sqrt{2}}{2}' },
  { tex:'-\\dfrac{\\pi}{3}',  label:'-Ï€/3',  val:-Math.PI/3,       num:1,  den:2, rad:0, cosTex:'\\dfrac{1}{2}' },
  { tex:'-\\dfrac{\\pi}{2}',  label:'-Ï€/2',  val:-Math.PI/2,       num:0,  den:1, rad:0, cosTex:'0' },
  { tex:'-\\dfrac{2\\pi}{3}', label:'-2Ï€/3', val:-2*Math.PI/3,     num:-1, den:2, rad:0, cosTex:'-\\dfrac{1}{2}' },
  { tex:'-\\dfrac{3\\pi}{4}', label:'-3Ï€/4', val:-3*Math.PI/4,     num:-1, den:2, rad:2, cosTex:'-\\dfrac{\\sqrt{2}}{2}' },
  { tex:'-\\dfrac{5\\pi}{6}', label:'-5Ï€/6', val:-5*Math.PI/6,     num:-1, den:2, rad:3, cosTex:'-\\dfrac{\\sqrt{3}}{2}' },
  { tex:'-\\pi',              label:'-Ï€',    val:-Math.PI,         num:-1, den:1, rad:0, cosTex:'-1' }
];

// on ajoute la valeur numÃ©rique du cosinus
ANGLES.forEach(a=>{
  const base = (a.rad===0 ? 1 : Math.sqrt(a.rad));
  a.cosVal = (a.num/a.den)*base;
});

/* construit le PS sous forme symbolique : k * cos(theta)
   renvoie : texTimes (k Ã— cos(...) avec parenthÃ¨ses si cos<0),
             texFinal (forme simplifiÃ©e : fraction Ã©ventuellement Ã— racine),
             val (valeur numÃ©rique) */
function buildPsSymbolic(k, ang){
  const cos = ang;

  // cas cos = 0
  if(cos.num === 0){
    const factorTex = texFactorAfterTimes('0', 0);
    return {
      texTimes: k+'\\times '+factorTex,
      texFinal: '0',
      val: 0
    };
  }

  const factorTex = texFactorAfterTimes(cos.cosTex, cos.cosVal);
  const timesTex = k+'\\times '+factorTex;

  let num = k * cos.num;
  let den = cos.den;
  const rad = cos.rad;

  const g = gcd(num,den);
  num /= g; den /= g;

  let coefTex;
  if(den === 1){
    coefTex = String(num);
  }else{
    coefTex = '\\dfrac{'+num+'}{'+den+'}';
  }

  let finalTex;
  if(rad === 0){
    finalTex = coefTex;
  }else{
    finalTex = coefTex+'\\sqrt{'+rad+'}';
  }

  const val = k * cos.cosVal;

  return {
    texTimes: timesTex,
    texFinal: finalTex,
    val
  };
}

/* â€”â€”â€”â€”â€” Exercice 1 : AB, AC, angle â†’ produit scalaire â€”â€”â€”â€”â€” */
const ex1 = {
  id: 'ps_ab_ac_angle',
  title: `Calculer un produit scalaire connaisant norme et angle`,

  gen(){
    const ang = choice(ANGLES); // toutes les valeurs et opposÃ©s
    const AB  = rint(2,10);
    const AC  = rint(2,10);
    const k   = AB*AC;
    const psSym = buildPsSymbolic(k, ang);

    const angleDeg = radToDeg(ang.val);
    const angleTexDeg = angleDeg+'^{\\circ}';

    return {
      AB, AC,
      angleTex: ang.tex,      // en radians
      angleTexDeg,            // en degrÃ©s
      angleLabel: ang.label,
      angleVal: ang.val,
      cos: ang.cosVal,
      cosTex: ang.cosTex,
      psVal: psSym.val,
      psTimesTex: psSym.texTimes,
      psFinalTex: psSym.texFinal
    };
  },

  render(host, st){
  const mode = getAngleMode();
  const angleTex = (mode==='deg') ? st.angleTexDeg : st.angleTex;

  host.innerHTML = `
    <div class="angle-mode-box">
      <span><strong>UnitÃ© de lâ€™angle :</strong></span>
      <select class="angle-mode-select">
        <option value="rad">Radian</option>
        <option value="deg">DegrÃ©</option>
      </select>
    </div>
    <p><strong>Exercice 1 : </strong></p>
    <p>On considÃ¨re un triangle $ABC$.</p>
    <p>On sait que $AB = ${st.AB}$, $AC = ${st.AC}$ et $\\widehat{BAC} = ${angleTex}$.</p>
    <p>Calculer le produit scalaire $\\overrightarrow{AB}\\cdot\\overrightarrow{AC}$.</p>
    <p class="pdf-hide">
      $\\overrightarrow{AB}\\cdot\\overrightarrow{AC} =$ 
      <input type="text" class="ans-ps" size="8" autocomplete="off">
      <span class="tick nu"></span>
    </p>
    <div id="steps" class="steps"></div>
  `;

  const sel = host.querySelector('.angle-mode-select');
  if(sel){
    sel.value = mode;
sel.addEventListener('change', ()=>{
  setAngleMode(sel.value);
  this.render(host, st);
});

  }

  typesetAll(host);
},


  correct(host, st){
    let ok = 0, total = 1;
    const inp = host.querySelector('.ans-ps');
    const v   = parseNumber(inp.value);
    if(!isNaN(v) && approxEqual(v, st.psVal)){
      setTick(inp,'ok'); ok++;
    }else{
      setTick(inp,'ko');
    }
    return {ok, total};
  },

 solution(host, st){
  const mode = getAngleMode();
  const angleTex = (mode==='deg') ? st.angleTexDeg : st.angleTex;

  const W   = $('#steps',host);
  const lines = [];
  lines.push(`<div class="step">${L('\\overrightarrow{AB}\\cdot\\overrightarrow{AC} = AB\\times AC\\times \\cos\\left(\\widehat{BAC}\\right)')}</div>`);
  lines.push(`<div class="step">${L(`\\overrightarrow{AB}\\cdot\\overrightarrow{AC} = ${st.AB}\\times ${st.AC}\\times \\cos\\left(${angleTex}\\right)` )}</div>`);
  lines.push(`<div class="step">${L(`\\overrightarrow{AB}\\cdot\\overrightarrow{AC} = ${st.psTimesTex}`)}</div>`);
  lines.push(`<div class="step">${L(`\\overrightarrow{AB}\\cdot\\overrightarrow{AC} = ${st.psFinalTex}`)}</div>`);

  W.innerHTML = lines.join('');
  typesetAll(W);
},


  reset(host){
    const inp = host.querySelector('.ans-ps');
    if(inp){ inp.value=''; setTick(inp,'nu'); }
    const W = $('#steps',host);
    if(W) W.innerHTML='';
  },







};
/* â€”â€”â€”â€”â€” Exercice 2 : PS, norme, angle â†’ norme manquante â€”â€”â€”â€”â€” */
const ex2 = {
  id: 'ps_norme_inconnue',
  title: `Retrouver AB ou AC Ã  partir du produit scalaire et de l'angle`,

  gen(){
    const ang = choice(ANGLES.filter(a=>a.cosVal!==0)); // on Ã©vite cos = 0
    let AB  = rint(2,10);
    let AC  = rint(2,10);
    const unknown = Math.random()<0.5 ? 'AB' : 'AC';
    const k = AB*AC;
    const psSym = buildPsSymbolic(k, ang); // valeur exacte (pas de dÃ©cimal)

    const angleDeg = radToDeg(ang.val);
    const angleTexDeg = angleDeg+'^{\\circ}';

    return {
      AB, AC,
      unknown,          // 'AB' ou 'AC'
      angleTex: ang.tex,
      angleTexDeg,
      angleLabel: ang.label,
      angleVal: ang.val,
      cos: ang.cosVal,
      cosTex: ang.cosTex,
      psVal: psSym.val,
      psTex: psSym.texFinal
    };
  },

 render(host, st){
  const mode = getAngleMode();
  const angleTex = (mode==='deg') ? st.angleTexDeg : st.angleTex;

  const unknownText = st.unknown === 'AB' ? 'AB' : 'AC';
  const knownText   = st.unknown === 'AB'
    ? `AC = ${st.AC}`
    : `AB = ${st.AB}`;

  host.innerHTML = `
    <div class="angle-mode-box">
      <span><strong>UnitÃ© de lâ€™angle :</strong></span>
      <select class="angle-mode-select">
        <option value="rad">Radian</option>
        <option value="deg">DegrÃ©</option>
      </select>
    </div>
    <p><strong>Exercice 2 : </strong></p>
    <p>On considÃ¨re un triangle $ABC$.</p>
    <p>On sait que $\\overrightarrow{AB}\\cdot\\overrightarrow{AC} = ${st.psTex}$, \\(${knownText}\\)
       et $\\widehat{BAC} = ${angleTex}$.</p>
    <p>Calculer \\(${unknownText}\\).</p>
    <p class="pdf-hide">
      \\(${unknownText} =\\)
      <input type="text" class="ans-norme" size="8" autocomplete="off">
      <span class="tick nu"></span>
    </p>
    <div id="steps" class="steps"></div>
  `;

  const sel = host.querySelector('.angle-mode-select');
  if(sel){
    sel.value = mode;
sel.addEventListener('change', ()=>{
  setAngleMode(sel.value);
  this.render(host, st);
});

  }

  typesetAll(host);
},


  correct(host, st){
    let ok = 0, total = 1;
    const inp = host.querySelector('.ans-norme');
    const v   = parseNumber(inp.value);
    const expected = (st.unknown === 'AB') ? st.AB : st.AC;

    if(!isNaN(v) && approxEqual(v, expected)){
      setTick(inp,'ok'); ok++;
    }else{
      setTick(inp,'ko');
    }
    return {ok, total};
  },

 solution(host, st){
  const mode = getAngleMode();
  const angleTex = (mode==='deg') ? st.angleTexDeg : st.angleTex;

  const W   = $('#steps',host);

  const unknown = st.unknown;              // 'AB' ou 'AC'
  const known   = (unknown === 'AB') ? 'AC' : 'AB';
  const knownVal= (unknown === 'AB') ? st.AC : st.AB;

  const cosFactor = texFactorAfterTimes(st.cosTex, st.cos);

  const lines = [];
  lines.push(`<div class="step">${L(`\\overrightarrow{AB}\\cdot\\overrightarrow{AC} = AB\\times AC\\times \\cos\\left(\\widehat{BAC}\\right) \\iff ${unknown} = \\dfrac{\\overrightarrow{AB}\\cdot\\overrightarrow{AC}}{${known}\\times \\cos\\left(\\widehat{BAC}\\right)}`)}</div>`);
  lines.push(`<div class="step"> <br></div>`);
  lines.push(`<div class="step">${L(`${unknown} = \\dfrac{\\overrightarrow{AB}\\cdot\\overrightarrow{AC}}{${known}\\times \\cos\\left(\\widehat{BAC}\\right)}`)}</div>`);
  lines.push(`<div class="step">${L(`${unknown} = \\dfrac{${st.psTex}}{${knownVal}\\times \\cos\\left(${angleTex}\\right)}`)}</div>`);
  lines.push(`<div class="step">${L(`${unknown} = \\dfrac{${st.psTex}}{${knownVal}\\times ${cosFactor}}`)}</div>`);

  const expected = (unknown==='AB') ? st.AB : st.AC;
  lines.push(`<div class="step">${L(`${unknown} = ${expected}`)}</div>`);

  W.innerHTML = lines.join('');
  typesetAll(W);
},


  reset(host){
    const inp = host.querySelector('.ans-norme');
    if(inp){ inp.value=''; setTick(inp,'nu'); }
    const W = $('#steps',host);
    if(W) W.innerHTML='';
  }
};

/* â€”â€”â€”â€”â€” Exercice 3 : AB, AC, PS â†’ angle â€”â€”â€”â€”â€” */
const ex3 = {
  id: 'ps_angle',
  title: `Calculer lâ€™angle connaissant norme et produit scalaire`,

  gen(){
    const COS_REMARK = [1, -1, 0.5, -0.5];
    const wantRemarkable = Math.random() < 0.5;

    let AB, AC, ps, cosVal;

    if(wantRemarkable){
      // 50 % des cas : cos(theta) remarquable
      while(true){
        AB = rint(2,10);
        AC = rint(2,10);
        const prod = AB*AC;

        const c = choice(COS_REMARK);
        // Pour cos = Â±1/2, il faut prod pair pour que PS soit entier
        if (Math.abs(c) === 0.5 && prod % 2 !== 0) continue;

        cosVal = c;
        ps = prod * cosVal; // entier
        break;
      }
    } else {
      // 50 % des cas : cos(theta) NON remarquable
      while(true){
        AB = rint(2,10);
        AC = rint(2,10);
        const prod = AB*AC;
        const maxPS = prod;

        ps = rint(-maxPS, maxPS);
        if(ps === 0) continue; // on Ã©vite cos = 0

        cosVal = ps / prod;

        // On Ã©vite les cos remarquables
        let isRemark = false;
        for(const c of COS_REMARK){
          if(Math.abs(cosVal - c) < 1e-9){
            isRemark = true;
            break;
          }
        }
        if(isRemark) continue;

        break;
      }
    }

    const c = Math.max(-1, Math.min(1, cosVal));
    const angleVal = Math.acos(c); // entre 0 et Ï€

    return {
      AB,
      AC,
      ps,
      cos: c,
      angleVal
    };
  },

  render(host, st){
  const mode = getAngleMode();
  const questionText = (mode==='rad')
    ? 'Donner la mesure de lâ€™angle $\\widehat{BAC}$ (mesure principale ou au centiÃ¨me de radian prÃ¨s).'
    : 'Donner la mesure de lâ€™angle $\\widehat{BAC}$ (en degrÃ©s, au degrÃ© prÃ¨s).';
  const unitLatex = (mode==='rad') ? '\\text{rad.}' : '^{\\circ}';

  host.innerHTML = `
    <div class="angle-mode-box">
      <span><strong>UnitÃ© de lâ€™angle :</strong></span>
      <select class="angle-mode-select">
        <option value="rad">Radian</option>
        <option value="deg">DegrÃ©</option>
      </select>
    </div>
    <p><strong>Exercice 3 : </strong></p>
    <p>On considÃ¨re un triangle $ABC$.</p>
    <p>On sait que $AB = ${st.AB}$, $AC = ${st.AC}$ et
       $\\overrightarrow{AB}\\cdot\\overrightarrow{AC} = ${st.ps}$.</p>
    <p>${questionText}</p>
    <p class="pdf-hide">
      $\\widehat{BAC} =$
      <input type="text" class="ans-angle" size="10" autocomplete="off">
      <span class="tick nu"></span>
      $  ${unitLatex}$
    </p>
    <div id="steps" class="steps"></div>
  `;

  const sel = host.querySelector('.angle-mode-select');
  if(sel){
    sel.value = mode;
sel.addEventListener('change', ()=>{
  setAngleMode(sel.value);
  this.render(host, st);
});

  }

  typesetAll(host);
},


  correct(host, st){
  let ok = 0, total = 1;
  const inp = host.querySelector('.ans-angle');
  const mode = getAngleMode();

  let v, expected, good = false;

  if(mode==='rad'){
    v = parseAngle(inp.value);
    expected = st.angleVal;
    if(!isNaN(v) && Math.abs(v-expected) <= 0.01+1e-6){
      good = true;
    }
  }else{
    v = parseNumber(inp.value);
    expected = st.angleVal * 180/Math.PI;
    if(!isNaN(v) && Math.abs(v-expected) <= 0.5+1e-6){
      good = true;
    }
  }

  if(good){
    setTick(inp,'ok'); ok++;
  }else{
    setTick(inp,'ko');
  }
  return {ok, total};
},


  solution(host, st){
  const mode = getAngleMode();
  const W   = $('#steps',host);

  const AB = st.AB, AC = st.AC, ps = st.ps;
  const denom = AB*AC;
  const g = gcd(ps,denom);
  const numS = ps/g;
  const denS = denom/g;

  let isRemarkable = false;
  let angRem = null;

  const c = st.cos;
  for(const a of ANGLES){
    if(Math.abs(c - a.cosVal) < 1e-9){
      isRemarkable = true;
      angRem = a;
      break;
    }
  }

  let approxLine = '';
  if(mode==='rad'){
    const approx = isRemarkable ? angRem.val : st.angleVal;
    const approxTxt = String(Math.round(approx*100)/100).replace('.',',');
    approxLine = `\\text{A la calculatrice on trouve : } \\widehat{BAC} \\approx ${approxTxt}  \\text{rad.}`;
  }else{
    const base = isRemarkable ? angRem.val : st.angleVal;
    const approxDeg = base*180/Math.PI;
    const rounded = Math.round(approxDeg);
    const approxTxt = String(rounded).replace('.',',');
    approxLine = `\\text{A la calculatrice on trouve : } \\widehat{BAC} \\approx ${approxTxt}^{\\circ}`;
  }

  const lines = [];
  lines.push(`<div class="step">${L('\\overrightarrow{AB}\\cdot\\overrightarrow{AC} = AB\\times AC\\times \\cos\\left(\\widehat{BAC}\\right) \\iff \\cos\\left(\\widehat{BAC}\\right) = \\dfrac{\\overrightarrow{AB}\\cdot\\overrightarrow{AC}}{AB\\times AC}')}</div>`);
  lines.push(`<div class="step"> <br></div>`);
  lines.push(`<div class="step">${L(`\\cos\\left(\\widehat{BAC}\\right) = \\dfrac{\\overrightarrow{AB}\\cdot\\overrightarrow{AC}}{AB\\times AC}`)}</div>`);
  lines.push(`<div class="step">${L(`\\cos\\left(\\widehat{BAC}\\right) = \\dfrac{${ps}}{${AB}\\times ${AC}}`)}</div>`);
  lines.push(`<div class="step">${L(`\\cos\\left(\\widehat{BAC}\\right)  = \\dfrac{${numS}}{${denS}}`)}</div>`);

  if(isRemarkable){
    const angleTex = (mode==='rad')
      ? angRem.tex
      : radToDegTex(angRem.val);
    lines.push(`<div class="step">${L(`\\text{Ainsi } \\widehat{BAC} = ${angleTex}`)}</div>`);
  }

  lines.push(`<div class="step">${L(approxLine)}</div>`);

  W.innerHTML = lines.join('');
  typesetAll(W);
},


  reset(host){
    const inp = host.querySelector('.ans-angle');
    if(inp){ inp.value=''; setTick(inp,'nu'); }
    const W = $('#steps',host);
    if(W) W.innerHTML='';
  }
};

/* â€”â€”â€”â€”â€” Exercice 4 : Travail dâ€™une force â€”â€”â€”â€”â€” */

/* cos dâ€™angles en degrÃ©s pour la solution */
const DEG_ANGLES = {
  0:   { cosVal:  1,                 cosTex:'1' },
  30:  { cosVal:  Math.sqrt(3)/2,    cosTex:'\\dfrac{\\sqrt{3}}{2}' },
  45:  { cosVal:  Math.sqrt(2)/2,    cosTex:'\\dfrac{\\sqrt{2}}{2}' },
  60:  { cosVal:  0.5,               cosTex:'\\dfrac{1}{2}' },
  90:  { cosVal:  0,                 cosTex:'0' },
  120: { cosVal: -0.5,               cosTex:'-\\dfrac{1}{2}' },
  135: { cosVal: -Math.sqrt(2)/2,    cosTex:'-\\dfrac{\\sqrt{2}}{2}' },
  150: { cosVal: -Math.sqrt(3)/2,    cosTex:'-\\dfrac{\\sqrt{3}}{2}' },
  180: { cosVal: -1,                 cosTex:'-1' }
};

/* petite fonction pour des tirages par pas */
function randStep(min, max, step){
  const nMax = Math.floor((max - min)/step);
  const k = rint(0, nMax);
  return min + k*step;
}

/* 20 Ã©noncÃ©s possibles, avec F et d tirÃ©s dans des intervalles rÃ©alistes */
const WORK_CONTEXTS = [
  {
    id:'teleski',
    Fmin:300, Fmax:500, Fstep:20,
    dmin:80,  dmax:150, dstep:10,
    angles:[30],
    text:`Sur un tÃ©lÃ©ski, la perche exerce sur un skieur une force constante $\\vec{F}$ dâ€™intensitÃ© [[F]]  N lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
  {
    id:'valise',
    Fmin:80, Fmax:160, Fstep:10,
    dmin:20, dmax:80,  dstep:10,
    angles:[30,45],
    text:`Une personne tire une valise Ã  roulettes en exerÃ§ant une force constante $\\vec{F}$ dâ€™intensitÃ© [[F]]  N lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
  {
    id:'caisse_sol',
    Fmin:200, Fmax:400, Fstep:20,
    dmin:10,  dmax:40,  dstep:5,
    angles:[0],
    text:`Un ouvrier pousse une caisse sur un sol horizontal en exerÃ§ant une force $\\vec{F}$ dâ€™intensitÃ© [[F]]  N parallÃ¨le au dÃ©placement $\\overrightarrow{AB}$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
  {
    id:'remorque_tracteur',
    Fmin:600, Fmax:900, Fstep:20,
    dmin:80,  dmax:200, dstep:20,
    angles:[30,60],
    text:`Un tracteur tire une remorque en exerÃ§ant une force $\\vec{F}$ dâ€™intensitÃ© [[F]]  N lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
  {
    id:'luge_neige',
    Fmin:100, Fmax:200, Fstep:10,
    dmin:20,  dmax:60,  dstep:10,
    angles:[30,45],
    text:`Un enfant tire une luge sur la neige avec une corde en exerÃ§ant une force constante $\\vec{F}$ dâ€™intensitÃ© [[F]]  N lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
  {
    id:'traineau_chien',
    Fmin:400, Fmax:700, Fstep:20,
    dmin:60,  dmax:120, dstep:10,
    angles:[30],
    text:`Des chiens de traÃ®neau exercent sur un traÃ®neau une force rÃ©sultante $\\vec{F}$ dâ€™intensitÃ© [[F]]  N lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
  {
    id:'bateau_remorque',
    Fmin:200, Fmax:400, Fstep:20,
    dmin:40,  dmax:100, dstep:10,
    angles:[30,60],
    text:`Un bateau remorque une bouÃ©e en exerÃ§ant une force $\\vec{F}$ dâ€™intensitÃ© [[F]]  N lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
  {
    id:'diable_caisse',
    Fmin:150, Fmax:250, Fstep:10,
    dmin:15,  dmax:50,  dstep:5,
    angles:[30,45],
    text:`Un livreur transporte une caisse Ã  lâ€™aide dâ€™un diable. Il exerce une force $\\vec{F}$ dâ€™intensitÃ© [[F]]  N lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
  {
    id:'skate',
    Fmin:50, Fmax:120, Fstep:10,
    dmin:10, dmax:40,  dstep:5,
    angles:[0],
    text:`Un skateur est tirÃ© par une corde horizontale. La tension de la corde modÃ©lise une force $\\vec{F}$ dâ€™intensitÃ© [[F]]  N appliquÃ©e sur le skateur lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
  {
    id:'traineau_cote',
    Fmin:250, Fmax:450, Fstep:20,
    dmin:40,  dmax:80,  dstep:10,
    angles:[30],
    text:`Sur une piste enneigÃ©e, un adulte tire un traÃ®neau avec une corde en exerÃ§ant une force $\\vec{F}$ dâ€™intensitÃ© [[F]]  N lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
  {
    id:'palete_entrepot',
    Fmin:300, Fmax:500, Fstep:20,
    dmin:20,  dmax:60,  dstep:10,
    angles:[0],
    text:`Dans un entrepÃ´t, un transpalette permet de dÃ©placer une palette de cartons. <br>La traction exercÃ©e modÃ©lise une force $\\vec{F}$ dâ€™intensitÃ© [[F]]  N lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m,
colinÃ©aire Ã  $\\overrightarrow{AB}$ (mesure d'angle de [[angle]]Â°).`
  },
  {
    id:'grimpe_pente',
    Fmin:200, Fmax:350, Fstep:10,
    dmin:40,  dmax:90,  dstep:10,
    angles:[30],
    text:`Un randonneur tire un chariot de matÃ©riel en montÃ©e en exerÃ§ant une force $\\vec{F}$ dâ€™intensitÃ© [[F]]  N lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
  {
    id:'bateau_resistance',
    Fmin:200, Fmax:400, Fstep:20,
    dmin:60,  dmax:120, dstep:10,
    angles:[120,150],
    text:`Un bateau avance alors quâ€™une force de rÃ©sistance de lâ€™eau $\\vec{F}$ dâ€™intensitÃ© [[F]]  N sâ€™exerce en sens opposÃ© lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
  {
    id:'voiture_traction',
    Fmin:500, Fmax:900, Fstep:20,
    dmin:50,  dmax:150, dstep:10,
    angles:[0],
    text:`Une voiture tracte une autre voiture en panne Ã  lâ€™aide dâ€™une barre rigide. <br>La force de traction $\\vec{F}$ dâ€™intensitÃ© [[F]]  N est appliquÃ©e lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m,
colinÃ©aire Ã  $\\overrightarrow{AB}$ (angle de [[angle]]Â°).`
  },
  {
    id:'remonte_pente',
    Fmin:300, Fmax:500, Fstep:20,
    dmin:60,  dmax:120, dstep:10,
    angles:[30],
    text:`Un tÃ©lÃ©siÃ¨ge exerce sur un skieur une force $\\vec{F}$ dâ€™intensitÃ© [[F]]  N lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m le long de la pente.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
  {
    id:'charriot_usine',
    Fmin:180, Fmax:280, Fstep:10,
    dmin:20,  dmax:70,  dstep:10,
    angles:[30,45],
    text:`Dans une usine, un chariot est tirÃ© par une corde modÃ©lisant une force $\\vec{F}$ dâ€™intensitÃ© [[F]]  N lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
  {
    id:'boxeur_sac',
    Fmin:150, Fmax:250, Fstep:10,
    dmin:1,   dmax:3,   dstep:0.5,
    angles:[90],
    text:`Un boxeur pousse un sac de frappe mais son mouvement est essentiellement perpendiculaire au dÃ©placement du sac. La force exercÃ©e $\\vec{F}$ a une intensitÃ© [[F]]  N lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
{
  id:'grue',
  Fmin:800, Fmax:1200, Fstep:50,
  dmin:10,  dmax:30,   dstep:5,
  angles:[90],
  text:`Une grue transporte une charge Ã  hauteur constante. 
La tension du cÃ¢ble modÃ©lise une force verticale $\\vec{F}$ dâ€™intensitÃ© [[F]]  N appliquÃ©e Ã  la charge, 
tandis que le crochet se dÃ©place horizontalement du point $A$ au point $B$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
},

  {
    id:'brouette',
    Fmin:120, Fmax:220, Fstep:10,
    dmin:15,  dmax:40,  dstep:5,
    angles:[30,45],
    text:`Un jardinier pousse une brouette en exerÃ§ant une force $\\vec{F}$ dâ€™intensitÃ© [[F]]  N lors dâ€™un dÃ©placement du point $A$ au point $B$ de longueur [[d]]  m.
<br>Une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
  {
    id:'caisse_descente',
    Fmin:250, Fmax:400, Fstep:10,
    dmin:15,  dmax:40,  dstep:5,
    angles:[120,150],
    text:`Un Ã©lÃ¨ve tente de retenir une caisse qui descend sur un plan inclinÃ© en exerÃ§ant une force $\\vec{F}$ dâ€™intensitÃ© [[F]]  N, presque opposÃ©e au mouvement de la caisse.
<br>Le dÃ©placement du point $A$ au point $B$ a une longueur [[d]]  m et une mesure de lâ€™angle $\\left(\\vec{F},\\overrightarrow{AB}\\right)$ est [[angle]]Â°.`
  },
];

/* formatteur de texte de contexte avec placeholders sÃ»rs */
function formatWorkContext(ctx, F, d, angleDeg){
  return ctx.text
    .replace(/\[\[F\]\]/g, String(F))
    .replace(/\[\[d\]\]/g, String(d))
    .replace(/\[\[angle\]\]/g, String(angleDeg));
}

const ex4 = {
  id: 'travail_force',
  title: 'Travail dâ€™une force',

  gen(){
    const ctx = choice(WORK_CONTEXTS);

    const stepF = ctx.Fstep || 10;
    const stepD = ctx.dstep || 10;

    const F = randStep(ctx.Fmin, ctx.Fmax, stepF);
    const d = randStep(ctx.dmin, ctx.dmax, stepD);
    const angleDeg = choice(ctx.angles);

    const angData = DEG_ANGLES[angleDeg] || DEG_ANGLES[0];
    const cosVal  = angData.cosVal;
    const cosTex  = angData.cosTex;

    const Wval = F * d * cosVal;

    return {
      ctxId: ctx.id,
      F,
      d,
      angleDeg,
      cosVal,
      cosTex,
      Wval,
      contextText: formatWorkContext(ctx, F, d, angleDeg)
    };
  },

  render(host, st){
    host.innerHTML = `
      <p><strong>Exercice 4 : </strong></p>
	  <p>En physique, le travail dâ€™une force $\\vec{F}$ lors dâ€™un dÃ©placement $\\overrightarrow{AB}$ est le produit scalaire des vecteurs $\\vec{F}$ et $\\overrightarrow{AB}$.</p>
      <p>${st.contextText}</p>
      <p>Quel est le travail de la force $\\vec{F}$ durant le dÃ©placement $\\overrightarrow{AB}$ ? <br>Donner le rÃ©sultat au Joule prÃ¨s.</p>

    <p class="pdf-hide">
        $W_{\\vec{F}}(\\overrightarrow{AB}) =$
        <input type="text" class="ans-work" size="10" autocomplete="off">
        <span class="tick nu"></span>
        $  \\text{J}$
      </p>
      <div id="steps" class="steps"></div>
    `;
    typesetAll(host);
  },

  correct(host, st){
    let ok = 0, total = 1;
    const inp = host.querySelector('.ans-work');
    const v   = parseNumber(inp.value);

    // valeur attendue arrondie au joule prÃ¨s
    const expected = Math.round(st.Wval);

    if(!isNaN(v) && Math.abs(v - expected) <= 0.5){
      setTick(inp, 'ok'); ok++;
    } else {
      setTick(inp, 'ko');
    }
    return {ok, total};
  },

  solution(host, st){
    const W = $('#steps',host);

    const F = st.F;
    const d = st.d;
    const a = st.angleDeg;

    const approx = Math.round(st.Wval*100)/100;
    const approxTxt = String(approx).replace('.',',');

    const cosFactorTex = texFactorAfterTimes(st.cosTex, st.cosVal);

    const lines = [];
    lines.push(`<div class="step">${L(`W_{\\vec{F}}(\\overrightarrow{AB}) = \\vec{F}\\cdot\\overrightarrow{AB} `)}</div>`);
    lines.push(`<div class="step">${L(`W_{\\vec{F}}(\\overrightarrow{AB}) = F\\times AB\\times \\cos\\left(\\widehat{(\\vec{F},\\overrightarrow{AB})}\\right)`)}</div>`);
    lines.push(`<div class="step">${L(`W_{\\vec{F}}(\\overrightarrow{AB}) = ${F}\\times ${d}\\times \\cos\\left(${a}^{\\circ}\\right)`)} </div>`);
    lines.push(`<div class="step">${L(`W_{\\vec{F}}(\\overrightarrow{AB}) = ${F}\\times ${d}\\times ${cosFactorTex}`)} </div>`);
    lines.push(`<div class="step">${L(`W_{\\vec{F}}(\\overrightarrow{AB}) \\approx ${approxTxt}  \\text{J}`)}</div>`);

    W.innerHTML = lines.join('');
    typesetAll(W);
  },

  reset(host){
    const inp = host.querySelector('.ans-work');
    if(inp){ inp.value=''; setTick(inp,'nu'); }
    const W = $('#steps',host);
    if(W) W.innerHTML = '';
  }
};

/* â€”â€”â€”â€”â€” Registre & UI â€”â€”â€”â€”â€” */
const REGISTRY=[ex1, ex2, ex3, ex4];
window.REGISTRY = REGISTRY;

(function waitExoPDF(){
  if (window.ExoPDF && typeof ExoPDF.init === 'function') {
    ExoPDF.init({
      title: `1Ã¨re â€“ Produit scalaire - Normes et angle`,
      mountAfterSelector: '.card.small',
    });
  } else {
    setTimeout(waitExoPDF, 50);
  }
})();

function getDefById(id){
  return REGISTRY.find(d=>d.id===id)||REGISTRY[0];
}

function buildOne(){
  const def  = getDefById($("#exo-select").value);
  const host = $("#host");
  const st   = def.gen();
  host.dataset.active = def.id;
  st.angleMode = getAngleMode();
host.dataset.state = JSON.stringify(st);
  def.render(host, st);

  try{
    if (window.MathKbd?.attachAllInputs){
      MathKbd.attachAllInputs(host);
    }
  }catch(_){}
}

function checkAll(){
  const def  = getDefById($("#exo-select").value);
  const host = $("#host");
  const st   = JSON.parse(host.dataset.state||'{}');
  const r    = def.correct(host,st)||{ok:0,total:0};
  scoreOK=r.ok; scoreTot=r.total; updateScore();
}
function showSolution(){
  const def  = getDefById($("#exo-select").value);
  const host = $("#host");
  const st   = JSON.parse(host.dataset.state||'{}');
  def.solution(host,st);
}
function resetAll(){
  const def  = getDefById($("#exo-select").value);
  const host = $("#host");
  def.reset(host); scoreOK=0; scoreTot=0; updateScore();
}

document.addEventListener('keydown',e=>{
  if(e.key==='Enter'){
    e.preventDefault();
    checkAll();
  }
});

(function init(){
  const sel=$("#exo-select");
  sel.innerHTML = mapHTML(REGISTRY, (ex,idx)=>`<option value="${ex.id}">${idx+1} â€” ${ex.title}</option>`);
  sel.onchange = buildOne;
  $("#btn-new").onclick=buildOne;
  $("#btn-check").onclick=checkAll;
  $("#btn-solution").onclick=showSolution;
  $("#btn-reset").onclick=resetAll;
  sel.value = REGISTRY[0].id;
  buildOne();
})();

})();
</script>

</body>
</html>
