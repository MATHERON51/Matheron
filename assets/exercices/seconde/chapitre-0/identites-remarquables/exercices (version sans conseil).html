<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Seconde â€“ Chapitre 0 â€“ Calculs â€“ IdentitÃ©s remarquables</title>
<style>
*{box-sizing:border-box}
body{font-family:system-ui, Segoe UI, Roboto, Arial; margin:0; background:#fafafa; color:#111; line-height:1.5}
.header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;padding:14px 18px;z-index:5}
.wrap{max-width:1200px;margin:0 auto;padding:18px;display:flex;flex-direction:column;gap:12px}
.card{background:#fff;border:1px solid #e6e6e6;border-radius:12px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
.controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
select,input[type=text]{padding:8px 10px;border:1px solid #ddd;border-radius:8px;font-size:15px}
.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 10px;border:1px solid #dadada;background:#f7f7f7;border-radius:10px;cursor:pointer;white-space:nowrap}
.btn:hover{background:#efefef}
.score{font-weight:700;white-space:nowrap}
.row{display:grid;grid-template-columns:1fr auto minmax(560px,1fr);gap:8px;align-items:center}
.row > div:last-child{overflow-x:auto}
.res-ok{color:#11823b;font-weight:700}
.res-ko{color:#b00020;font-weight:700}
.equ{font-weight:700}

/* Ã‰tapes */
.steps{margin:.5rem 0 0 .15rem;padding:.6rem .7rem;background:#fafafa;border:1px dashed #e3e3e3;border-radius:10px}
.eqline{display:block;margin:.25rem 0;line-height:1.35;white-space:normal}

/* Tableau des carrÃ©s (ex. calcul-num) */
.sqtbl-wrap{margin-top:10px}
.sqtbl-wrap .smallcap{font-size:.92rem;color:#444;margin-bottom:4px}
.sqtbl{width:100%;border-collapse:collapse;font-size:.95rem}
.sqtbl td{border:1px solid #eee;padding:4px 6px;text-align:center;white-space:nowrap}

/* Clavier */
.kbd-host{display:flex;justify-content:center}
.small{font-size:.92rem;color:#555}
</style>
</head>
<body>
  <div class="header">
    <h1 style="margin:0;font-size:1.1rem">Seconde â€“ Chapitre 0 â€“ Calculs â€“ <strong>IdentitÃ©s remarquables</strong></h1>
  </div>

  <div class="wrap">
    <div class="controls card">
      <label for="exo-select"><strong>Type dâ€™exercice :</strong></label>
      <select id="exo-select"></select>
      <button id="btn-new" class="btn">ðŸ”„ Nouvel Ã©noncÃ©</button>
      <button id="btn-check" class="btn">âœ… VÃ©rifier</button>
      <button id="btn-solution" class="btn">ðŸ’¡ Solution</button>
      <button id="btn-reset" class="btn">ðŸ§¹ RÃ©initialiser</button>
      <span class="score">Score : <span id="score">0 / 0</span></span>
    </div>

    <div class="card" id="host"></div>

    <!-- Clavier math -->
    <div class="card kbd-host"><div data-math-kbd></div></div>
    <div class="small" style="text-align:center">
      Astuce : tu peux Ã©crire les puissances avec <code>^</code> (ex. <code>x^2</code>) ou utiliser <code>xÂ²</code>.
    </div>
  </div>

<script>
(function(){'use strict';
const $=(s,r=document)=>r.querySelector(s);
const rnd=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const choice=a=>a[Math.floor(Math.random()*a.length)];
const UMINUS='âˆ’', TIMES='Ã—';

/* ===== affichage & signes ===== */
function uminus(n){ return n<0 ? UMINUS+String(Math.abs(n)) : String(n); }
function normalizeSigns(s){
  return s
    .replace(/\u2212/g,UMINUS)
    .replace(/\+\s*[âˆ’-]/g,' âˆ’ ')
    .replace(/[âˆ’-]\s*\+/g,' âˆ’ ')
    .replace(/[âˆ’-]\s*[âˆ’-]/g,' + ')
    .replace(/\+\s*\+/g,' + ')
    .replace(/\s{2,}/g,' ')
    .trim();
}
function canonSup2(s){
  return s.replace(/([x0-9)])Â²/g, '$1<sup>2</sup>').replace(/\(<sup>2<\/sup>/g,'(');
}

/* ===== parse d'une rÃ©ponse poly (trÃ¨s simple) ===== */
function parsePoly(txt){
  if(!txt) return null;
  let s=String(txt).toLowerCase().replace(/\s+/g,'').replace(/\u2212/g,'-').replace(/Ã—|Â·/g,'*');
  s=s.replace(/x\^2/g,'x2');
  const m2=s.match(/([+\-]?\d*)x2/), m1=s.match(/([+\-]?\d*)x(?!\d)/), m0=s.match(/([+\-]?\d+)(?!x)/g);
  let a2=0,a1=0,a0=0;
  if(m2){ a2 = m2[1]===''||m2[1]==='+'?1:(m2[1]==='-'?-1:parseInt(m2[1],10)); }
  if(m1){ a1 = m1[1]===''||m1[1]==='+'?1:(m1[1]==='-'?-1:parseInt(m1[1],10)); }
  if(m0){ a0 = m0.map(Number).reduce((p,c)=>p+c,0); }
  return {a2,a1,a0};
}

/* ===== polynÃ´mes (â‰¤2) ===== */
function polyToHTML({a2=0,a1=0,a0=0}){
  const parts=[];
  if(a2){ parts.push(a2===1?'x<sup>2</sup>':a2===-1?`${UMINUS}x<sup>2</sup>`:uminus(a2)+'x<sup>2</sup>'); }
  if(a1){
    const k=Math.abs(a1), s=(a1>0 && parts.length)?' + ':' âˆ’ ';
    if(parts.length) parts.push(a1>0? s+(k===1?'x':k+'x') : s+(k===1?'x':k+'x'));
    else parts.push(a1<0? UMINUS+(k===1?'x':k+'x') : (k===1?'x':k+'x'));
  }
  if(a0){
    const k=Math.abs(a0), s=(a0>0 && parts.length)?' + ':' âˆ’ ';
    if(parts.length) parts.push(a0>0? s+k : s+k);
    else parts.push(a0<0? UMINUS+k : ''+k);
  }
  return parts.length? normalizeSigns(parts.join('')) : '0';
}

/* ===== bloc de solution ===== */
function linesBlockHTML(lines){
  return `<div class="steps">${lines.map(t=>`<div class="eqline">${canonSup2(normalizeSigns(t))}</div>`).join('')}</div>`;
}

/* ===== solutions en 5 lignes (avec Ã©tape dÃ©veloppement) ===== */
function sol5_square(a,b,sign){
  const A=`${uminus(a)}x`, B=`${Math.abs(b)}`;
  const pm = (sign==='+') ? '+' : 'âˆ’';
  const form = (sign==='+') ? '(A + B)Â²' : '(A âˆ’ B)Â²';
  const or   = (sign==='+') ? 'AÂ² + 2AB + BÂ²' : 'AÂ² âˆ’ 2AB + BÂ²';
  const a2=a*a, mid=(sign==='+')? 2*a*b : -2*a*b, b2=b*b;
  const final = polyToHTML({a2:a2,a1:mid,a0:b2});
  return [
    `Formule : ${form} avec A=${A}, B=${B}`,
    `Or ${form}= ${or}`,
    `F= (${A} ${pm} ${B})Â²`,
    `F= (${A})Â² ${pm==='+'?'+':UMINUS} 2${TIMES}(${A})${TIMES}(${B}) + (${B})Â²`,
    `F= ${final}`
  ];
}
function sol5_conj(a,b){
  const A=`${uminus(a)}x`, B=`${Math.abs(b)}`;
  return [
    `Formule : (A + B)(A ${UMINUS} B) avec A=${A}, B=${B}`,
    `Or (A + B)(A ${UMINUS} B)= AÂ² ${UMINUS} BÂ²`,
    `F= (${A} + ${B})(${A} ${UMINUS} ${B})`,
    `F= (${A})Â² ${UMINUS} (${B})Â²`,
    `F= ${polyToHTML({a2:a*a,a1:0,a0:-(b*b)})}`
  ];
}
function sol5_k_square(k,a,b,sign){
  const A=`${uminus(a)}x`, B=`${Math.abs(b)}`;
  const pm = (sign==='+') ? '+' : 'âˆ’';
  const form = (sign==='+') ? '(A + B)Â²' : '(A âˆ’ B)Â²';
  const or   = (sign==='+') ? 'AÂ² + 2AB + BÂ²' : 'AÂ² âˆ’ 2AB + BÂ²';
  const a2=k*a*a, mid=k*((sign==='+')? 2*a*b : -2*a*b), b2=k*b*b;
  const final = polyToHTML({a2:a2,a1:mid,a0:b2});
  return [
    `Formule : ${form} avec A=${A}, B=${B}`,
    `Or ${form}= ${or}`,
    `F= ${uminus(k)} Â· (${A} ${pm} ${B})Â²`,
    `F= ${uminus(k)} ${TIMES} ( (${A})Â² ${pm==='+'?'+':UMINUS} 2${TIMES}(${A})${TIMES}(${B}) + (${B})Â² )`,
    `F= ${final}`
  ];
}

/* ===== rendu commun ===== */
function renderOne(host, htmlEq, placeholder="ex.  x^2 + 4x + 4", label='RÃ©ponse (forme rÃ©duite)'){
  host.innerHTML="";
  const row0=document.createElement("div"); row0.className="row";
  const lab0=document.createElement("div"); lab0.className="equ"; lab0.innerHTML=htmlEq; row0.appendChild(lab0);
  const spacer=document.createElement("div"); spacer.textContent=""; row0.appendChild(spacer);
  const res0=document.createElement("div"); res0.id="res"; row0.appendChild(res0);
  host.appendChild(row0);

  const row1=document.createElement("div"); row1.className="row";
  const lab1=document.createElement("div"); lab1.innerHTML=label;
  const inp=document.createElement("input"); inp.type="text"; inp.id="reponse"; inp.placeholder=placeholder;
  const res1=document.createElement("div"); res1.textContent="";
  row1.appendChild(lab1); row1.appendChild(inp); row1.appendChild(res1);
  host.appendChild(row1);
}

/* ===== EXO 1 â€“ (ax Â± b)Â² ===== */
const ex1 = {
  id:"carre-binom",
  title:"DÃ©velopper : (ax Â± b)Â²",
  gen(){
    const a = rnd(-9,9)||1;
    const b0 = rnd(-12,12)||2;
    const b  = Math.abs(b0);
    const sign = choice(['+','âˆ’']);
    const A2 = a*a, A1 = (sign==='+') ? 2*a*b : -2*a*b, A0 = b*b;
    return {a,b,sign,exp:{a2:A2,a1:A1,a0:A0}};
  },
  text(st){
    // Ã‰noncÃ© sans guillemets aprÃ¨s F=
    return `DÃ©velopper et rÃ©duire : <span class="equ">F= (${uminus(st.a)}x ${st.sign} ${st.b})Â²</span>`;
  },
  render(host, st){ renderOne(host, this.text(st)); },
  correct(host, st){
    const ans = parsePoly($("#reponse",host).value);
    if(!ans){ $("#res",host).innerHTML="âœ˜ RÃ©ponse invalide (ex.  x^2 + 4x + 4)"; $("#res",host).className="res-ko"; return {ok:false,total:1}; }
    const ok = ans && ans.a2===st.exp.a2 && ans.a1===st.exp.a1 && ans.a0===st.exp.a0;
    $("#res",host).innerHTML = ok ? "âœ”" : `âœ˜ (attendu : ${polyToHTML(st.exp)})`;
    $("#res",host).className = ok ? "res-ok" : "res-ko";
    return {ok,total:1};
  },
  solution(host, st){
    const lines = sol5_square(st.a, st.b, st.sign);
    $("#res",host).innerHTML = linesBlockHTML(lines);
    const a2=st.a*st.a, mid=(st.sign==='+'?2*st.a*st.b:-2*st.a*st.b), b2=st.b*st.b;
    $("#reponse",host).value = polyToHTML({a2:a2,a1:mid,a0:b2}).replace(/<[^>]*>/g,'');
  },
  printSolutionHTML(st){
    return linesBlockHTML(sol5_square(st.a, st.b, st.sign));
  },
  reset(host){ $("#reponse",host).value=""; $("#res",host).textContent=""; }
};

/* ===== EXO 2 â€“ (ax + b)(ax âˆ’ b) ===== */
const ex2 = {
  id:"produit-conj",
  title:"DÃ©velopper : (ax + b)(ax âˆ’ b)",
  gen(){
    const a=rnd(-9,9)||1, b=rnd(-12,12)||2;
    const A2=a*a, A1=0, A0=-(b*b);
    return {a,b,exp:{a2:A2,a1:A1,a0:A0}};
  },
  text(st){
    return `DÃ©velopper et rÃ©duire : <span class="equ">F= (${uminus(st.a)}x + ${Math.abs(st.b)})(${uminus(st.a)}x ${UMINUS} ${Math.abs(st.b)})</span>`;
  },
  render(host, st){ renderOne(host, this.text(st)); },
  correct: ex1.correct,
  solution(host, st){
    $("#res",host).innerHTML = linesBlockHTML( sol5_conj(st.a, st.b) );
    $("#reponse",host).value = polyToHTML(st.exp).replace(/<[^>]*>/g,'');
  },
  printSolutionHTML(st){ return linesBlockHTML( sol5_conj(st.a, st.b) ); },
  reset: ex1.reset
};

/* ===== EXO 3 â€“ k Â· (ax Â± b)Â² ===== */
const ex3 = {
  id:"k-carrÃ©",
  title:"DÃ©velopper : k Â· (ax Â± b)Â²",
  gen(){
    const k = rnd(-9,9)||1;
    const a = rnd(-9,9)||1;
    const b0 = rnd(-12,12)||2;
    const b  = Math.abs(b0);
    const sign = choice(['+','âˆ’']);
    const A2 = k*(a*a), A1 = k*((sign==='+')? 2*a*b : -2*a*b), A0 = k*(b*b);
    return {k,a,b,sign,exp:{a2:A2,a1:A1,a0:A0}};
  },
  text(st){
    return `DÃ©velopper et rÃ©duire : <span class="equ">F= ${uminus(st.k)} Â· (${uminus(st.a)}x ${st.sign} ${st.b})Â²</span>`;
  },
  render(host, st){ renderOne(host, this.text(st)); },
  correct: ex1.correct,
  solution(host, st){
    $("#res",host).innerHTML = linesBlockHTML( sol5_k_square(st.k, st.a, st.b, st.sign) );
    $("#reponse",host).value = polyToHTML(st.exp).replace(/<[^>]*>/g,'');
  },
  printSolutionHTML(st){ return linesBlockHTML( sol5_k_square(st.k, st.a, st.b, st.sign) ); },
  reset: ex1.reset
};

/* ===== EXO 4 â€“ Vrai/Faux (inchangÃ©) ===== */
const ex4 = {
  id:"vf-idr",
  title:"VÃ©rifier une identitÃ© (Vrai/Faux)",
  gen(){
    const type = choice(['carre+','carre-','conj']);
    const a=rnd(-6,6)||1, b=rnd(-9,9)||2;
    let exp, prop, answer;
    if(type==='carre+'){
      exp = {a2:a*a, a1:2*a*Math.abs(b), a0:b*b};
      const correct = Math.random()<0.6;
      if (correct) { prop = {...exp}; answer = 'Vrai'; }
      else { prop = {...exp}; if (Math.random()<0.5) prop.a1 = -prop.a1; else prop.a0 += choice([-1,1])*rnd(1,3); answer = 'Faux'; }
    } else if(type==='carre-'){
      exp = {a2:a*a, a1:-2*a*Math.abs(b), a0:b*b};
      const correct = Math.random()<0.6;
      if (correct) { prop = {...exp}; answer = 'Vrai'; }
      else { prop = {...exp}; if (Math.random()<0.5) prop.a1 = -prop.a1; else prop.a0 += choice([-1,1])*rnd(1,3); answer = 'Faux'; }
    } else {
      exp = {a2:a*a, a1:0, a0: -(b*b)};
      const correct = Math.random()<0.6;
      if (correct) { prop = {...exp}; answer = 'Vrai'; }
      else { prop = {...exp}; if (Math.random()<0.5) prop.a0 = -prop.a0; else prop.a1 = choice([-1,1])*rnd(1,5); answer = 'Faux'; }
    }
    return {type,a,b,exp,prop,answer};
  },
  text(st){
    if(st.type==='conj'){
      return `Dire si lâ€™Ã©galitÃ© est vraie : <span class="equ">( ${uminus(st.a)}x + ${Math.abs(st.b)} )( ${uminus(st.a)}x ${UMINUS} ${Math.abs(st.b)} ) = ${polyToHTML(st.prop)}</span>`;
    }else if(st.type==='carre+'){
      return `Dire si lâ€™Ã©galitÃ© est vraie : <span class="equ">( ${uminus(st.a)}x + ${Math.abs(st.b)} )<sup>2</sup> = ${polyToHTML(st.prop)}</span>`;
    }else{
      return `Dire si lâ€™Ã©galitÃ© est vraie : <span class="equ">( ${uminus(st.a)}x ${UMINUS} ${Math.abs(st.b)} )<sup>2</sup> = ${polyToHTML(st.prop)}</span>`;
    }
  },
  render(host, st){
    host.innerHTML="";
    const row0=document.createElement("div"); row0.className="row";
    const lab0=document.createElement("div"); lab0.className="equ"; lab0.innerHTML=this.text(st); row0.appendChild(lab0);
    const spacer=document.createElement("div"); spacer.textContent=""; row0.appendChild(spacer);
    const res0=document.createElement("div"); res0.id="res"; row0.appendChild(res0);
    host.appendChild(row0);

    const row1=document.createElement("div"); row1.className="row";
    const lab1=document.createElement("div"); lab1.textContent="Votre jugement";
    const sel=document.createElement("select"); sel.id="reponse-vf";
    ["","Vrai","Faux"].forEach(v=>sel.appendChild(new Option(v,v)));
    const res1=document.createElement("div"); res1.textContent="";
    row1.appendChild(lab1); row1.appendChild(sel); row1.appendChild(res1);
    host.appendChild(row1);
  },
  correct(host, st){
    const val = ($("#reponse-vf",host)||{}).value || "";
    const ok = (val===st.answer);
    $("#res",host).innerHTML = ok? "âœ”" : `âœ˜ (attendu : ${st.answer})`;
    $("#res",host).className = ok? "res-ok" : "res-ko";
    return {ok,total:1};
  },
  solution(host, st){
    const {type,a,b}=st;
    const A = `${uminus(a)}x`, B = `${Math.abs(b)}`;
    const lines=[];
    if(type==='conj'){
      lines.push(`Formule : (A + B)(A ${UMINUS} B) avec A=${A}, B=${B}`);
      lines.push(`Or (A + B)(A ${UMINUS} B)= AÂ² ${UMINUS} BÂ²`);
      lines.push(`F= (${A} + ${B})(${A} ${UMINUS} ${B})`);
      lines.push(`F= (${A})Â² ${UMINUS} (${B})Â²`);
      lines.push(`F= ${polyToHTML({a2:a*a,a1:0,a0:-(b*b)})}`);
    }else if(type==='carre+'){
      lines.push(`Formule : (A + B)Â² avec A=${A}, B=${B}`);
      lines.push(`Or (A + B)Â²= AÂ² + 2AB + BÂ²`);
      lines.push(`F= (${A} + ${B})Â²`);
      lines.push(`F= (${A})Â² + 2${TIMES}(${A})${TIMES}(${B}) + (${B})Â²`);
      lines.push(`F= ${polyToHTML({a2:a*a,a1:2*a*Math.abs(b),a0:b*b})}`);
    }else{
      lines.push(`Formule : (A ${UMINUS} B)Â² avec A=${A}, B=${B}`);
      lines.push(`Or (A ${UMINUS} B)Â²= AÂ² ${UMINUS} 2AB + BÂ²`);
      lines.push(`F= (${A} ${UMINUS} ${B})Â²`);
      lines.push(`F= (${A})Â² ${UMINUS} 2${TIMES}(${A})${TIMES}(${B}) + (${B})Â²`);
      lines.push(`F= ${polyToHTML({a2:a*a,a1:-2*a*Math.abs(b),a0:b*b})}`);
    }
    $("#res",host).innerHTML = linesBlockHTML(lines);
  },
  printSolutionHTML(st){
    const host = document.createElement('div'); this.solution({querySelector:()=>null, innerHTML:''}, st); return $("#res",host)?.innerHTML || '';
  },
  reset(host){ const sel=$("#reponse-vf",host); if(sel) sel.value=""; $("#res",host).textContent=""; }
};

/* ===== EXO 5 â€“ Calcul rapide (inchangÃ©) ===== */
const ex5 = {
  id:"calcul-num",
  title:"Calculer rapidement (identitÃ© remarquable)",
  gen(){
    const kind = choice(['square','prod']);
    const pool = [-20,-15,-12,-10,-8,-5,-4,-3,-2,-1,1,2,3,4,5,6,8,10,12,15,20,-100,100];
    if(kind==='square'){
      const a = choice(pool.filter(v=>v>0));
      const d = choice([1,2,3,4,5,6,8,10]);
      const sign = choice(['+','âˆ’']);
      const val = (sign==='+'? (a+d)*(a+d) : (a-d)*(a-d));
      return {kind,sign,a,b:d,expected:val};
    }else{
      const a = choice(pool);
      const k = choice([1,2,3,4,5,6,8,10]);
      const val = a*a - k*k;
      return {kind,a,k,expected:val};
    }
  },
  text(st){
    return (st.kind==='square')
      ? `Calculer (sans calculatrice) : <span class="equ">( ${st.a} ${st.sign} ${st.b} )<sup>2</sup></span>`
      : `Calculer (sans calculatrice) : <span class="equ">( ${st.a} ${UMINUS} ${st.k} )( ${st.a} + ${st.k} )</span>`;
  },
  render(host, st){
    renderOne(host, this.text(st), "ex.  2401", "RÃ©ponse (nombre entier)");
    const wrap = document.createElement('div');
    wrap.className = 'sqtbl-wrap';
    wrap.innerHTML = `<div class="smallcap"><strong>Table des carrÃ©s (0 Ã  20)</strong></div>${squaresTableHTML()}`;
    host.appendChild(wrap);
  },
  correct(host, st){
    const txt = ($("#reponse",host).value||"").trim().replace(/\s+/g,'');
    if(!/^-?\d+$/.test(txt)){
      $("#res",host).innerHTML = "âœ˜ Entrez un entier (ex.  9801)";
      $("#res",host).className = "res-ko";
      return {ok:false,total:1};
    }
    const ok = (parseInt(txt,10)===st.expected);
    $("#res",host).innerHTML = ok ? "âœ”" : `âœ˜ (attendu : ${st.expected})`;
    $("#res",host).className = ok ? "res-ok" : "res-ko";
    return {ok,total:1};
  },
  solution(host, st){
    const lines=[];
    if(st.kind==='square'){
      const A = st.a, B = st.b, sum = st.sign==='+' ? (A+B) : (A-B);
      lines.push(`( ${A} ${st.sign} ${B} )Â²`);
      lines.push(`${sum}Â²`);
      lines.push(String(sum*sum));
    }else{
      const A = st.a, B = st.k;
      lines.push(`( ${A} + ${B} )( ${A} ${UMINUS} ${B} )`);
      lines.push(`${A}Â² ${UMINUS} ${B}Â²`);
      lines.push(`${A*A} ${UMINUS} ${B*B}`);
      lines.push(String(st.expected));
    }
    $("#res",host).innerHTML = linesBlockHTML(lines);
    $("#reponse",host).value = String(st.expected);
  },
  printSolutionHTML(st){
    const host = document.createElement('div'); this.solution({querySelector:()=>null, innerHTML:''}, st); return $("#res",host)?.innerHTML || '';
  },
  reset(host){ $("#reponse",host).value=""; $("#res",host).textContent=""; }
};

/* Tableau des carrÃ©s 0..20 */
function squaresTableHTML(){
  const nPerRow = 7;
  const t = [];
  t.push('<table class="sqtbl"><tbody>');
  for(let i=0;i<=21;i+=nPerRow){
    const start=i, end=Math.min(20, i+nPerRow-1);
    if(start>20) break;
    t.push('<tr>');
    for(let n=start; n<=end; n++){
      t.push(`<td>${n}<sup>2</sup> = ${n*n}</td>`);
    }
    t.push('</tr>');
  }
  t.push('</tbody></table>');
  return t.join('');
}

/* ===== Registre & moteur ===== */
const REGISTRY = [ex1, ex2, ex3, ex4, ex5];
window.REGISTRY = REGISTRY;

let scoreOK=0, scoreTot=0;
function updateScore(){ $("#score").textContent = scoreOK+" / "+scoreTot; }
function buildOne(){
  const sel=$("#exo-select"), host=$("#host");
  const def=REGISTRY.find(e=>e.id===sel.value); if(!def) return;
  const st=def.gen();
  host.dataset.active = def.id;
  host.dataset.state  = JSON.stringify(st);
  def.render(host, st);
  const inp = $("#reponse",host) || $("#reponse-vf",host); if(inp) inp.focus();
}
function check(){
  const host=$("#host");
  const def=REGISTRY.find(e=>e.id===host.dataset.active); if(!def) return;
  const st=JSON.parse(host.dataset.state||"{}");
  const r=def.correct(host, st);
  if(r){ scoreOK += (r.ok?1:0); scoreTot += (r.total||1); updateScore(); }
}
function solution(){
  const host=$("#host");
  const def=REGISTRY.find(e=>e.id===host.dataset.active); if(!def) return;
  const st=JSON.parse(host.dataset.state||"{}");
  def.solution(host, st);
}
function resetAll(){
  scoreOK=0; scoreTot=0; updateScore();
  const host=$("#host");
  const def=REGISTRY.find(e=>e.id===host.dataset.active);
  if(def){ def.reset(host); }
}

document.addEventListener("DOMContentLoaded", function(){
  const sel=$("#exo-select");
  REGISTRY.forEach(e=>{ const o=document.createElement("option"); o.value=e.id; o.textContent=e.title; sel.appendChild(o); });
  sel.addEventListener("change", buildOne);
  $("#btn-new").addEventListener("click", buildOne);
  $("#btn-check").addEventListener("click", check);
  $("#btn-solution").addEventListener("click", solution);
  $("#btn-reset").addEventListener("click", resetAll);

  sel.value = REGISTRY[0].id;
  buildOne(); updateScore();
});
})();
</script>

<!-- GÃ©nÃ©rateur de fiches PDF -->
<script src="../../../../js/exo-pdf-kit.js" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  ExoPDF.init({
    title: 'Seconde â€“ Chapitre 0 â€“ Calculs â€“ IdentitÃ©s remarquables',
    max: 50,
    lead: 'DÃ©velopper ou calculer en utilisant une identitÃ© remarquable :',
    leadByDefId: {
      "carre-binom": 'DÃ©velopper et rÃ©duire :',
      "produit-conj": 'DÃ©velopper et rÃ©duire :',
      "k-carrÃ©": 'DÃ©velopper et rÃ©duire :',
      "vf-idr": 'Dire si lâ€™Ã©galitÃ© suivante est vraie :',
      "calcul-num": 'Calculer (sans calculatrice) :'
    }
  });
});
</script>

<!-- Clavier math -->
<link rel="stylesheet" href="../../../../css/math-kbd.css">
<script src="../../../../js/math-kbd.js" defer></script>
<script src="../../../../js/algebra-eval-patch.js" defer></script>
</body>
</html>
