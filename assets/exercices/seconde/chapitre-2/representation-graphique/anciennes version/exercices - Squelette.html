<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Seconde ‚Äî Squelette d‚Äôexercices (minimal)</title>

<link rel="stylesheet" href="../../../../css/math-kbd.css">

<style>
  :root{ --card-bg:#fff; --card-bd:#e6e6e6; --muted:#6b7280; }
  *{box-sizing:border-box} html,body{margin:0;padding:0}
  body{font-family:system-ui, Segoe UI, Roboto, Arial, sans-serif; background:#fafafa; color:#111; line-height:1.55}

  .header{position:sticky; top:0; background:#fff; border-bottom:1px solid #eee}
  .header .wrap{padding:12px 16px}

  .wrap{max-width:1100px; margin:0 auto; padding:16px; display:flex; flex-direction:column; gap:12px}
  .card{background:var(--card-bg); border:1px solid var(--card-bd); border-radius:12px; padding:14px}

  .controls{display:flex; flex-wrap:wrap; gap:8px; align-items:center}
  #exo-select{min-width:320px}
  select,button,input[type=text]{font-size:15px}
  .btn{padding:8px 12px; border:1px solid #dadada; border-radius:10px; background:#f7f7f7; cursor:pointer}
  .btn:hover{background:#efefef}

  .row{display:grid; grid-template-columns:1fr; gap:12px; align-items:start}
  .statement .consigne{opacity:.85; margin-bottom:6px}
  .ans-row{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  .ans-row input[type=text]{flex:1; min-width:240px}
  .steps{background:#f6f7f8; border:1px dashed #cfd3d7; border-radius:10px; padding:.7rem .8rem; min-height:52px}
  .steps .line{white-space:pre-wrap; color:var(--muted)}

  .accept .title{font-weight:600}
  .kbd-wrap{display:flex; justify-content:center}
</style>
</head>
<body>
  <!-- En-t√™te -->
  <div class="header">
    <div class="wrap">
      <div class="controls">
        <label for="exo-select"><strong>Type d‚Äôexercice :</strong></label>
        <select id="exo-select"></select>

        <button id="btn-new" class="btn">üîÑ Nouvel √©nonc√©</button>
        <button id="btn-check" class="btn">‚úÖ V√©rifier</button>
        <button id="btn-solution" class="btn">üí° Solution</button>
        <button id="btn-reset" class="btn">üßπ R√©initialiser</button>
      </div>
    </div>
  </div>

  <!-- Corps -->
  <div class="wrap">
    <!-- √ânonc√© + saisie + corrig√© -->
    <div class="card" id="host"></div>

    <!-- Saisie & r√©ponses accept√©es (volontairement vide) -->
    <div class="card accept" id="accept">
      <div class="title">Saisie & r√©ponses accept√©es :</div>
    </div>

    <!-- L‚ÄôUI PDF se montera ici (apr√®s #accept) -->

    <!-- Clavier math (auto-mount par la lib) -->
    <div class="card kbd-wrap">
      <div data-math-kbd></div>
    </div>
  </div>

  <!-- JS (versions *.multiplicatif uniquement) -->
  <script src="../../../../js/ch0-mul-clean.multiplicatif.js" defer></script>
  <script src="../../../../js/dev-rules-clean.dedup.js" defer></script>
  <script src="../../../../js/algebra-eval-patch.multiplicatif.js" defer></script>
  <script src="../../../../js/exo-pdf-kit.multiplicatif.js" defer></script>
  <script src="../../../../js/math-kbd.multiplicatif.js" defer></script>

  <!-- Orchestration minimale (sans exercices) -->
  <script>
  (function(){
    'use strict';
    const $ = (s,r=document)=>r.querySelector(s);

    /* Cadre g√©n√©rique √ânonc√©/Saisie/Corrig√© */
    function mkFrame(host, {consigneHTML='', enonceHTML='', placeholder='‚Ä¶'}={}){
      host.innerHTML = `
        <div class="row">
          <div class="statement">
            ${consigneHTML ? `<div class="consigne">${consigneHTML}</div>` : ''}
            ${enonceHTML ? `<div class="equ">${enonceHTML}</div>` : ''}
            <div class="ans-row" style="margin-top:.5rem">
              <label for="reponse"><strong>R√©ponse :</strong></label>
              <input type="text" id="reponse" placeholder="${placeholder}">
            </div>
            <div id="res" class="small" aria-live="polite"></div>
          </div>
          <div id="sol" class="steps"><div class="line">Le corrig√© s‚Äôaffichera ici.</div></div>
        </div>`;
      const ip=$("#reponse",host);
      ip && ip.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); check(); } });
    }

    /* Catalogue vide (√† remplir plus tard) */
    const REGISTRY = (window.REGISTRY = []);

    /* Actions boutons */
    function buildOne(){
      const sel=$("#exo-select"), host=$("#host");
      const def = REGISTRY.find(e=>e.id===sel.value);
      if(!def){
        mkFrame(host,{consigneHTML:'S√©lectionnez un type d‚Äôexercice.', placeholder:'‚Ä¶'});
        $("#res",host).textContent = 'Aucun exercice charg√© (squelette).';
        return;
      }
      const st = def.gen ? def.gen() : {};
      host.dataset.active = def.id;
      host.dataset.state = JSON.stringify(st);
      (def.render || mkFrame)(host, st);
    }
    function check(){
      const host=$("#host");
      const def = REGISTRY.find(e=>e.id===host.dataset.active);
      if(def && typeof def.correct==='function'){
        const st = JSON.parse(host.dataset.state||'{}');
        def.correct(host, st);
      }
    }
    function solution(){
      const host=$("#host");
      const def = REGISTRY.find(e=>e.id===host.dataset.active);
      if(def && typeof def.solution==='function'){
        const st = JSON.parse(host.dataset.state||'{}');
        def.solution(host, st);
      }
    }
    function resetAll(){
      const host=$("#host");
      const ip=$("#reponse",host); if(ip) ip.value='';
      $("#res",host).textContent='';
      $("#sol",host).innerHTML='<div class="line">Le corrig√© s‚Äôaffichera ici.</div>';
    }

    /* Init */
    document.addEventListener('DOMContentLoaded', function(){
      // s√©lecteur (reste vide si REGISTRY vide)
      $("#exo-select").innerHTML = REGISTRY.map(e=>`<option value="${e.id}">${e.title}</option>`).join('');
      $("#exo-select").addEventListener('change', buildOne);

      $("#btn-new").addEventListener('click', buildOne);
      $("#btn-check").addEventListener('click', check);
      $("#btn-solution").addEventListener('click', solution);
      $("#btn-reset").addEventListener('click', resetAll);

      // Pas d'appel √† MathKbd.autoMount() -> √©vite le double clavier

      // PDF (UI apr√®s #accept)
      if (window.ExoPDF?.init){
        ExoPDF.init({
          title: 'Seconde ‚Äî Squelette d‚Äôexercices',
          mountAfterSelector: '#accept',
          max: 50,
          lead: ''
        });
      }

      buildOne(); // cadre ‚Äúpr√™t‚Äù
    });
  })();
  </script>
</body>
</html>
