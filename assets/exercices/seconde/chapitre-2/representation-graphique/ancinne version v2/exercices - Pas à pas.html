<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Représentation graphique — pas à pas</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    header { margin-bottom: 20px; }
    .controls { margin: 10px 0; }
    select, button, input[type=checkbox] { margin: 5px; }
    canvas { border: 1px solid #ccc; margin: 10px 0; }
    .solution { display: none; background: #f0f0f0; padding: 10px; }
  </style>
</head>
<body>

<header>
  <h1>Représentation graphique (pas à pas)</h1>
  <div>
    <label><input type="checkbox" id="chk-amplitude"> PDF : amplitude aléatoire</label>
    <label><input type="checkbox" id="chk-images"> PDF : # images/antécédents aléatoire</label>
    <label><input type="checkbox" id="chk-theme"> PDF : thème aléatoire (exo 3)</label>
  </div>
</header>

<div class="controls">
  <label for="exo-select">Choisir un exercice :</label>
  <select id="exo-select"></select>
  <button id="btn-new">Nouvel énoncé</button>
  <button id="btn-check">Vérifier</button>
  <button id="btn-solution">Solution</button>
  <button id="btn-reset">Réinitialiser</button>
</div>

<div id="exo-container"></div>

<!-- ==================== MATH KEYBOARD ==================== -->
<script src="../../../../js/math-kbd.js"></script>

<!-- ==================== HELPERS JS ==================== -->
<script>
/* --- Helpers graphiques repris de ton fichier original --- */
function genCurveIntegerGrid(amplitude, npoints) {
  const pts = [];
  for (let i = -amplitude; i <= amplitude; i++) {
    pts.push([i, Math.floor(Math.random() * (2 * amplitude + 1)) - amplitude]);
  }
  return pts;
}

function pathFromGrid(ctx, pts) {
  if (pts.length < 2) return;
  ctx.beginPath();
  ctx.moveTo(pts[0][0], pts[0][1]);
  for (let i = 1; i < pts.length; i++) {
    ctx.lineTo(pts[i][0], pts[i][1]);
  }
  ctx.stroke();
}

function interpAtGrid(pts, x) {
  for (let i = 0; i < pts.length - 1; i++) {
    if (x >= pts[i][0] && x <= pts[i+1][0]) {
      const [x1, y1] = pts[i];
      const [x2, y2] = pts[i+1];
      return y1 + (y2 - y1) * (x - x1) / (x2 - x1);
    }
  }
  return null;
}

function antecedentsOfGrid(pts, y) {
  const sols = [];
  for (let i = 0; i < pts.length - 1; i++) {
    const [x1, y1] = pts[i];
    const [x2, y2] = pts[i+1];
    if ((y1 - y) * (y2 - y) <= 0) {
      const x = x1 + (x2 - x1) * (y - y1) / (y2 - y1);
      sols.push(x);
    }
  }
  return sols;
}

function catmullRomPath(ctx, pts) {
  if (pts.length < 2) return;
  ctx.beginPath();
  ctx.moveTo(pts[0][0], pts[0][1]);
  for (let i = 0; i < pts.length - 1; i++) {
    const [x1, y1] = pts[i];
    const [x2, y2] = pts[i+1];
    ctx.lineTo(x2, y2);
  }
  ctx.stroke();
}

function addPath(ctx, pts) { pathFromGrid(ctx, pts); }
function addLine(ctx, x1, y1, x2, y2) {
  ctx.beginPath();
  ctx.moveTo(x1, y1);
  ctx.lineTo(x2, y2);
  ctx.stroke();
}

/* --- REGISTRY des exercices (vide pour l’instant) --- */
const REGISTRY = {};
</script>

<!-- ==================== MOTEUR INIT ==================== -->
<script>
function populateMenu() {
  const select = document.getElementById("exo-select");
  select.innerHTML = "";
  for (const id in REGISTRY) {
    const opt = document.createElement("option");
    opt.value = id;
    opt.textContent = REGISTRY[id].title;
    select.appendChild(opt);
  }
}

function buildOne(id) {
  const container = document.getElementById("exo-container");
  container.innerHTML = "";
  if (!REGISTRY[id]) return;
  const exo = REGISTRY[id];
  const node = exo.render();
  container.appendChild(node);
}

window.onload = function() {
  populateMenu();
  const first = Object.keys(REGISTRY)[0];
  if (first) buildOne(first);

  document.getElementById("exo-select").onchange = e => buildOne(e.target.value);
  document.getElementById("btn-new").onclick = () => {
    const id = document.getElementById("exo-select").value;
    if (REGISTRY[id]) buildOne(id);
  };
  document.getElementById("btn-check").onclick = () => {
    const id = document.getElementById("exo-select").value;
    if (REGISTRY[id] && REGISTRY[id].correct) REGISTRY[id].correct();
  };
  document.getElementById("btn-solution").onclick = () => {
    const id = document.getElementById("exo-select").value;
    if (REGISTRY[id] && REGISTRY[id].solution) REGISTRY[id].solution();
  };
  document.getElementById("btn-reset").onclick = () => {
    const id = document.getElementById("exo-select").value;
    if (REGISTRY[id] && REGISTRY[id].reset) REGISTRY[id].reset();
  };
};
</script>

</body>
</html>
