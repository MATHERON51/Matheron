
<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Seconde — Représentation graphique (pas à pas) — Partie 1</title>

<!-- mêmes dépendances que v17.hotfix3 -->
<link rel="stylesheet" href="../../../../css/math-kbd.css">

<style>
  *{box-sizing:border-box}
  html,body{margin:0;padding:0}
  body{font-family:system-ui,Segoe UI,Roboto,Arial;background:#fafafa;color:#111;line-height:1.5}

  .header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;padding:12px 16px;z-index:5}
  .wrap{max-width:1200px;margin:0 auto;padding:16px;display:flex;flex-direction:column;gap:12px}
  .card{background:#fff;border:1px solid #e6e6e6;border-radius:12px;padding:12px;box-shadow:0 1px 2px rgba(0,0,0,.04)}

  .controls{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .btn{padding:6px 10px;border:1px solid #ddd;background:#fff;border-radius:8px;cursor:pointer}
  .btn:hover{background:#f6f6f6}
  .score{margin-left:auto}

  .row{display:grid;grid-template-columns:560px 1fr;gap:12px;align-items:start}
  .row.single{grid-template-columns:1fr}
  @media (max-width:980px){ .row{grid-template-columns:1fr} }

  .statement{font-size:18px}
  .consigne{opacity:.9;margin-bottom:6px}

  /* SVGs */
  svg.repere{display:block;margin:.25rem auto;width:min(560px,100%);height:auto;aspect-ratio:560/360}
  body.solution-active svg.repere{width:min(520px,100%)}

  .qa{display:grid;grid-template-columns:26px 1fr;gap:8px;align-items:start}
  .qmark{min-width:1.2em;text-align:center;font-weight:700}

  .steps{margin:.35rem 0 0 .15rem;padding:.35rem .5rem;background:#fafafa;border:1px dashed #e3e3e3;border-radius:8px}
  .step{margin:.2rem 0}

  .tbl{border-collapse:collapse;margin:.3rem 0;max-width:100%}
  .tbl th,.tbl td{border:1px solid #000;padding:3px 4px;text-align:center}
  .tbl input{width:6ch}

  @media print{ 
    .header,.controls{display:none !important}
    .wrap{max-width:100%}
    .card{border:none;box-shadow:none;padding:0}
    .row{grid-template-columns:1fr}
    svg.repere{height:auto}
  }
</style>
</head>
<body>
  <div class="header">
    <h1 style="margin:0;font-size:1.05rem">Seconde — <strong>Représentation graphique</strong> <em>(pas à pas • Partie 1)</em></h1>
  </div>

  <div class="wrap">
    <!-- barre de contrôles -->
    <div class="controls card" id="ctrlbar">
      <label for="exo-select"><strong>Type d’exercice :</strong></label>
      <select id="exo-select"></select>
      <button id="btn-new" class="btn">🔄 Nouvel énoncé</button>
      <button id="btn-check" class="btn">✅ Vérifier</button>
      <button id="btn-solution" class="btn">💡 Solution</button>
      <button id="btn-reset" class="btn">🧹 Réinitialiser</button>
      <span class="score">Score : <span id="score">0 / 0</span></span>
    </div>

    <!-- amplitude et paramètres -->
    <div class="controls card" id="ampbar">
      <strong>Amplitude (max ±12)&nbsp;:</strong>
      x ∈ [&nbsp;<input id="xmin" type="number" value="-6" min="-12" max="12" step="1">&nbsp;;&nbsp;
      <input id="xmax" type="number" value="6"  min="-12" max="12" step="1">&nbsp;],
      y ∈ [&nbsp;<input id="ymin" type="number" value="-6" min="-12" max="12" step="1">&nbsp;;&nbsp;
      <input id="ymax" type="number" value="6"  min="-12" max="12" step="1">&nbsp;]
      <button id="amp-apply" class="btn">↴ Appliquer</button>

      <span style="margin-left:12px"></span>
      <label><small># images</small> <input id="cfg-img" type="number" min="1" max="10" value="2" style="width:64px"></label>
      <label><small># antécédents</small> <input id="cfg-ant" type="number" min="1" max="10" value="2" style="width:64px"></label>
      <label class="small" style="margin-left:12px"><input id="pdfRandAmp" type="checkbox"> PDF : amplitude aléatoire</label>
      <label class="small" style="margin-left:10px"><input id="pdfRandNA" type="checkbox"> PDF : # images/antécédents aléatoire</label>
      <label class="small" style="margin-left:10px"><input id="pdfRandTheme" type="checkbox"> PDF : thème aléatoire (exo&nbsp;3)</label>
    </div>

    <!-- conteneur exercice -->
    <div class="card" id="host"><em>Partie 1</em> — Aucun exercice chargé (REGISTRY vide).</div>

    <!-- emplacement pour bouton PDF (Partie 5) -->
    <div class="card small" id="pdf-slot"><em>PDF</em> — sera branché en Partie 5 (unique ExoPDF.init).</div>

    <!-- Clavier maths -->
    <div class="card" data-math-kbd></div>
  </div>

<script>
  // même mode que v17.hotfix3 : le nettoyeur n’agit QUE sur inputs/textarea
  window.DEVRULES_MODE = 'inputs-only';
</script>

<!-- mêmes librairies que v17.hotfix3 -->
<script src="../../../../js/dev-rules-clean.dedup.vB.inputs-only.js" defer></script>
<script src="../../../../js/math-kbd.multiplicatif.js" defer></script>
<script src="../../../../js/exo-pdf-kit.multiplicatif.js" defer></script>
<script src="../../../../js/algebra-eval-patch.multiplicatif.js" defer></script>

<!-- ===== Partie 1 : Helpers globaux & graphiques (sans exercices) ===== -->
<script>
'use strict';

/* ===== Helpers DOM & random ===== */
const $=(s,r=document)=>r.querySelector(s);
const rnd=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const clamp=(x,a,b)=>Math.max(a,Math.min(b,x));

/* ===== Format FR (exact comme nos autres pages) ===== */
const FRfmt = new Intl.NumberFormat('fr-FR',{maximumFractionDigits:2, useGrouping:false});
const fmtFR = n => FRfmt.format(n).replace('-', '−');
const fmtNum = n => `<span class="num">${fmtFR(n)}</span>`;

/* ===== Amplitude globale (UI) ===== */
let AMP={ xmin:-6,xmax:6,ymin:-6,ymax:6 };
function applyAMP(){
  let xi=+$('#xmin').value, xa=+$('#xmax').value, yi=+$('#ymin').value, ya=+$('#ymax').value;
  if(!(xi<=xa)) [xi,xa]=[xa,xi];
  if(!(yi<=ya)) [yi,ya]=[ya,yi];
  xi=clamp(xi,-12,12); xa=clamp(xa,-12,12);
  yi=clamp(yi,-12,12); ya=clamp(ya,yi+1,12); // au moins 1 de hauteur
  if(xi===xa) xa=xi+1; if(yi===ya) ya=yi+1;
  AMP={ xmin:xi,xmax:xa,ymin:yi,ymax:ya };
  document.body.classList.remove('solution-active');
  buildOne(); // reconstruit l'exo courant quand il y en aura
}

/* ===== Helpers graphiques (repris et unifiés) ===== */
function catmullRomPath(points){
  if(points.length < 2) return '';
  const P=i=>points[Math.max(0,Math.min(points.length-1,i))];
  let d=`M ${points[0].x} ${points[0].y}`;
  for(let i=0;i<points.length-1;i++){
    const p0=P(i-1), p1=P(i), p2=P(i+1), p3=P(i+2);
    const c1x=p1.x+(p2.x-p0.x)/6, c1y=p1.y+(p2.y-p0.y)/6;
    const c2x=p2.x-(p3.x-p1.x)/6, c2y=p2.y-(p3.y-p1.y)/6;
    d+=` C ${c1x} ${c1y}, ${c2x} ${c2y}, ${p2.x} ${p2.y}`;
  }
  return d;
}
function addPath(g,d,st){
  const p=document.createElementNS('http://www.w3.org/2000/svg','path');
  p.setAttribute('d',d);
  p.setAttribute('fill','none');
  p.setAttribute('stroke',st?.stroke||'#000');
  p.setAttribute('stroke-width',st?.['stroke-width']||2.2);
  if(st?.['stroke-dasharray']) p.setAttribute('stroke-dasharray',st['stroke-dasharray']);
  g.appendChild(p);
  return p;
}
function addLine(g,x1,y1,x2,y2,st){
  const l=document.createElementNS('http://www.w3.org/2000/svg','line');
  l.setAttribute('x1',x1); l.setAttribute('y1',y1);
  l.setAttribute('x2',x2); l.setAttribute('y2',y2);
  l.setAttribute('stroke',st?.stroke||'#000');
  l.setAttribute('stroke-width',st?.['stroke-width']||2);
  if(st?.['stroke-dasharray']) l.setAttribute('stroke-dasharray',st['stroke-dasharray']);
  g.appendChild(l);
  return l;
}
function genCurveIntegerGrid(R){
  const xs=[], ys=[];
  for(let x=R.xmin; x<=R.xmax; x++){
    ys.push(rnd(R.ymin+1,R.ymax-1));
    xs.push(x);
  }
  return {Xs:xs, Ys:ys};
}
function pathFromGrid(rep, grid){
  const pts=grid.Xs.map((x,i)=>({x:rep.X(x), y:rep.Y(grid.Ys[i])}));
  return catmullRomPath(pts);
}
function interpAtGrid(grid, x){
  const {Xs,Ys}=grid;
  if(x<Xs[0] || x> Xs[Xs.length-1]) return null;
  const i=Math.floor(x - Xs[0]);
  if(Math.abs(x - Math.round(x))<1e-9) return Ys[i];
  const k=Math.floor(x), idx=k - Xs[0];
  const y1=Ys[idx], y2=Ys[idx+1];
  return y1 + 0.5*(y2-y1);
}
function antecedentsOfGrid(grid, y){
  const out=[];
  for(let i=0;i<grid.Xs.length-1;i++){
    const x1=grid.Xs[i], x2=grid.Xs[i+1], y1=grid.Ys[i], y2=grid.Ys[i+1];
    if(y===y1) out.push(x1);
    if(y===y2) out.push(x2);
    if((y1<y && y<y2) || (y2<y && y<y1)){
      const t=(y-y1)/((y2-y1)||1e-9);
      const x=x1+t*(x2-x1);
      out.push(x);
    }
  }
  return Array.from(new Set(out.map(v=>Math.round(v*100)/100)));
}

/* === Repère stylisé complet (quadrillage noir, axes gras, flèches) === */
function buildRepereSVG(opts) {
  const { xmin, xmax, ymin, ymax, grid=true, arrows=true } = opts;
  const W = 560, H = 360;
  const svgNS = "http://www.w3.org/2000/svg";

  const svg = document.createElementNS(svgNS, "svg");
  svg.setAttribute("width", W);
  svg.setAttribute("height", H);
  svg.classList.add("repere");

  const gGrid = document.createElementNS(svgNS, "g"); gGrid.classList.add("grid");
  const gAxes = document.createElementNS(svgNS, "g"); gAxes.classList.add("axes");
  const gPlot = document.createElementNS(svgNS, "g"); gPlot.classList.add("plot");
  const gText = document.createElementNS(svgNS, "g"); gText.classList.add("labels");
  svg.appendChild(gGrid); svg.appendChild(gAxes); svg.appendChild(gPlot); svg.appendChild(gText);

  const X = x => (x - xmin) * W / (xmax - xmin);
  const Y = y => H - (y - ymin) * H / (ymax - ymin);

  if (grid) {
    for (let x = Math.ceil(xmin); x <= xmax; x++) {
      const l = document.createElementNS(svgNS,"line");
      l.setAttribute("x1", X(x)); l.setAttribute("y1", Y(ymin));
      l.setAttribute("x2", X(x)); l.setAttribute("y2", Y(ymax));
      l.setAttribute("stroke", "#000"); l.setAttribute("stroke-width", 0.5);
      gGrid.appendChild(l);
    }
    for (let y = Math.ceil(ymin); y <= ymax; y++) {
      const l = document.createElementNS(svgNS,"line");
      l.setAttribute("x1", X(xmin)); l.setAttribute("y1", Y(y));
      l.setAttribute("x2", X(xmax)); l.setAttribute("y2", Y(y));
      l.setAttribute("stroke", "#000"); l.setAttribute("stroke-width", 0.5);
      gGrid.appendChild(l);
    }
  }

  const axeX = document.createElementNS(svgNS,"line");
  axeX.setAttribute("x1", X(xmin)); axeX.setAttribute("y1", Y(0));
  axeX.setAttribute("x2", X(xmax)); axeX.setAttribute("y2", Y(0));
  axeX.setAttribute("stroke", "#000"); axeX.setAttribute("stroke-width", 2);
  gAxes.appendChild(axeX);

  const axeY = document.createElementNS(svgNS,"line");
  axeY.setAttribute("x1", X(0)); axeY.setAttribute("y1", Y(ymin));
  axeY.setAttribute("x2", X(0)); axeY.setAttribute("y2", Y(ymax));
  axeY.setAttribute("stroke", "#000"); axeY.setAttribute("stroke-width", 2);
  gAxes.appendChild(axeY);

  if (arrows) {
    const mkArrow = (x,y,dx,dy) => {
      const p = document.createElementNS(svgNS,"path");
      p.setAttribute("d",`M${x} ${y} l${-dy*8} ${dx*8} l${dy*8} ${-dx*8} Z`);
      p.setAttribute("fill","#000");
      return p;
    };
    gAxes.appendChild(mkArrow(X(xmax), Y(0), 1, 0));
    gAxes.appendChild(mkArrow(X(0), Y(ymax), 0, -1));
  }

  // graduations collées aux axes (sans 0)
  for (let x = Math.ceil(xmin); x <= xmax; x++) {
    if (x !== 0) {
      const t = document.createElementNS(svgNS,"text");
      t.setAttribute("x", X(x));
      t.setAttribute("y", Y(0)+15);
      t.setAttribute("text-anchor","middle");
      t.setAttribute("font-size","12");
      t.textContent = x;
      gText.appendChild(t);
    }
  }
  for (let y = Math.ceil(ymin); y <= ymax; y++) {
    if (y !== 0) {
      const t = document.createElementNS(svgNS,"text");
      t.setAttribute("x", X(0)-10);
      t.setAttribute("y", Y(y)+4);
      t.setAttribute("text-anchor","end");
      t.setAttribute("font-size","12");
      t.textContent = y;
      gText.appendChild(t);
    }
  }

  return {svg, plot:gPlot, X, Y};
}
</script>
<script>
// === PATCH HELPERS requis par Exo 1 (rg1) ===
function mkRow(host, consigne){
  host.innerHTML='';
  const row=document.createElement('div'); row.className='row';
  const left=document.createElement('div'); left.className='st';
  const right=document.createElement('div'); right.className='form';
  if(consigne){
    const c=document.createElement('div'); c.className='consigne'; c.textContent=consigne;
    left.appendChild(c);
  }
  row.appendChild(left); row.appendChild(right);
  host.appendChild(row);
  return { st:left, form:right };
}

function uniq(arr){ return Array.from(new Set(arr)); }
function shuffle(arr){
  const a=arr.slice();
  for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
  return a;
}

// parse : "1 ; -2,5 ; 3"  -> [1, -2.5, 3]
function parseListFR(s){
  if(!s) return [];
  const norm = s
    .replace(/\u2212/g,'-') // moins Unicode → ASCII
    .replace(/;/g, ',')
    .replace(/\s+/g, ' ')
    .trim();
  return norm.split(',').map(t=>t.trim()).filter(Boolean).map(t=>{
    // laisser la virgule comme séparateur décimal FR si besoin
    const t2 = t.replace(',', '.');
    const n = Number(t2);
    return Number.isFinite(n) ? n : null;
  }).filter(n => n!==null);
}

function clearMarks(host){
  host.querySelectorAll('.qmark').forEach(m=>{ m.textContent=''; m.style.color=''; });
}

function showSteps(host, steps){
  const el = document.createElement('div');
  el.className = 'steps';
  el.innerHTML = steps.map(x=>`<div class="step">${x}</div>`).join('');
  host.appendChild(el);
}

// placeholder — sera implémenté en Partie 5 (PDF)
function buildPDFStatementFromRender(exo, st){ return ''; }
</script>

<!-- ===== Partie 1 : REGISTRY vide + moteur UI ===== -->
<script>
'use strict';

window.REGISTRY = {};   // sera rempli en Partie 2/3/4

function populateMenu(){
  const sel = $('#exo-select');
  if(!sel) return;
  sel.innerHTML = '';
  Object.values(REGISTRY).forEach(exo=>{
    const opt=document.createElement('option');
    opt.value = exo.id;
    opt.textContent = exo.title || exo.id;
    sel.appendChild(opt);
  });
}

function buildOne(id){
  const sel = $('#exo-select');
  const targetId = id || sel?.value || Object.keys(REGISTRY)[0];
  const host = $('#host');
  if(!targetId || !REGISTRY[targetId]){
    if(host) host.innerHTML = '<em>REGISTRY vide</em> — ajoutez les exercices (Partie 2, 3, 4).';
    return;
  }
  sel.value = targetId;
  const exo = REGISTRY[targetId];
  const st = exo.gen();
  exo.render(host, st);
  document.body.classList.remove('solution-active');
  host.dataset.state = JSON.stringify(st);
  host.dataset.active = exo.id;
}

function currentExo(){
  const id = $('#host')?.dataset?.active;
  return REGISTRY[id];
}

/* ========= Boutons & évènements UI ========= */
document.addEventListener('DOMContentLoaded', ()=>{
  // coches PDF décochées par défaut
  const c1=$('#pdfRandAmp'), c2=$('#pdfRandNA'), c3=$('#pdfRandTheme');
  if(c1) c1.checked=false; if(c2) c2.checked=false; if(c3) c3.checked=false;

  $('#amp-apply')?.addEventListener('click', applyAMP);
  $('#btn-new')?.addEventListener('click', ()=>buildOne());
  $('#btn-reset')?.addEventListener('click', ()=>{
    const exo=currentExo(); if(exo) exo.reset($('#host'));
  });
  $('#btn-solution')?.addEventListener('click', ()=>{
    const host=$('#host'); const exo=currentExo(); if(!exo) return;
    const st=JSON.parse(host.dataset.state);
    document.body.classList.add('solution-active');
    exo.solution(host, st);
  });
  $('#btn-check')?.addEventListener('click', ()=>{
    const host=$('#host'); const exo=currentExo(); if(!exo) return;
    const st=JSON.parse(host.dataset.state);
    exo.correct(host, st);
  });
  $('#exo-select')?.addEventListener('change', ()=>buildOne());

  populateMenu();
  buildOne(); // affiche le premier si présent (sinon message REGISTRY vide)
});
</script>
<script>
REGISTRY["exo1"] = {
  id: "exo1",
  title: "Exercice 1 — Ensemble de définition",
  gen: function(container) {
    container.innerHTML = `
      <div class="enonce">
        <p>Donner l'ensemble de définition de la fonction :</p>
        <p style="text-align:center; font-size: 20px;">
          f(x) = √(x - 3)
        </p>
        <p>
          Domaine : 
          <input type="text" id="reponse-exo1" placeholder="Votre réponse">
        </p>
      </div>
      <div class="controls">
        <button onclick="REGISTRY['exo1'].correct()">Vérifier</button>
        <button onclick="REGISTRY['exo1'].solution()">Solution</button>
        <button onclick="REGISTRY['exo1'].reset()">Réinitialiser</button>
      </div>
      <div id="feedback-exo1" class="feedback"></div>
      <div id="solution-exo1" class="solution" style="display:none;">
        <p>Solution : l'ensemble de définition est [3 ; +∞[</p>
      </div>
    `;
  },
  correct: function() {
    const val = document.getElementById("reponse-exo1").value.trim();
    const fb = document.getElementById("feedback-exo1");
    if (val === "[3;+∞[" || val === "[3 ; +∞[") {
      fb.innerHTML = "<span style='color:green;'>✔️ Correct !</span>";
    } else {
      fb.innerHTML = "<span style='color:red;'>❌ Incorrect.</span>";
    }
  },
  solution: function() {
    document.getElementById("solution-exo1").style.display = "block";
  },
  reset: function() {
    document.getElementById("reponse-exo1").value = "";
    document.getElementById("feedback-exo1").innerHTML = "";
    document.getElementById("solution-exo1").style.display = "none";
  }
};
</script>
</body>
</html>
