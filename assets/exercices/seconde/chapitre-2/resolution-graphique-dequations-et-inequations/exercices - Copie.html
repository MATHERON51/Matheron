<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Seconde â€” Ã‰quations et inÃ©quations (lecture graphique)</title>

<!-- mÃªmes dÃ©pendances que ton exemple -->
<link rel="stylesheet" href="../../../../css/math-kbd.css">
<link rel="stylesheet" href="courbes-print-fix.css">
<link rel="stylesheet" href="../../../../css/espace-latex.css">
<link rel="stylesheet" href="../../../../css/mobile.css">

<style>
  *{box-sizing:border-box}
  body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:0;background:#fafafa;color:#111;line-height:1.5}
  .header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;padding:12px 16px;z-index:5}
  .wrap{max-width:1200px;margin:0 auto;padding:16px;display:flex;flex-direction:column;gap:12px}
  .card{background:#fff;border:1px solid #e6e6e6;border-radius:12px;padding:12px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
  .controls{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .btn{padding:6px 10px;border:1px solid #ddd;background:#fff;border-radius:8px;cursor:pointer}
  .btn:hover{background:#f6f6f6}
  .score{margin-left:auto}
  .row{display:grid;grid-template-columns:560px 1fr;gap:12px;align-items:start}
  @media (max-width:980px){ .row{grid-template-columns:1fr} }
  .statement{font-size:18px}
  .consigne{opacity:.9;margin-bottom:6px}
  svg.repere{display:block;margin:.25rem auto;width:min(560px,100%);height:auto;aspect-ratio:560/360}
  body.solution-active svg.repere{width:min(520px,100%)}
  .qa{display:grid;grid-template-columns:26px 1fr;gap:8px;align-items:start}
  .qmark{min-width:1.2em;text-align:center;font-weight:700}
  .steps{margin:.35rem 0 0 .15rem;padding:.35rem .5rem;background:#fafafa;border:1px dashed #e3e3e3;border-radius:8px}
  .step{margin:.2rem 0}
  .tbl{border-collapse:collapse;margin:.3rem 0;max-width:100%}
  .tbl th,.tbl td{border:1px solid #000;padding:3px 4px;text-align:center}
  .mini-note{font-size:.9rem;opacity:.8;margin:.25rem 0}
  @media print{ .header,.controls{display:none !important} .wrap{max-width:100%} .card{border:none;box-shadow:none;padding:0} .row{grid-template-columns:1fr} svg.repere{height:auto} }
  .plot path{stroke-linecap:round;stroke-linejoin:round}
  .helper-line{vector-effect:non-scaling-stroke;stroke-linecap:butt}
</style>

<script>
  window.MathJax = {
    tex: { inlineMath: [['\\(','\\)'], ['$', '$']], displayMath: [['\\[','\\]'], ['$$','$$']], processEscapes: true },
    chtml: { matchFontHeight:false },
    startup: { typeset: true }
  };
</script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>
<body>
  <div class="header">
    <h1 style="margin:0;font-size:1.05rem">Seconde â€” <strong>Ã‰quations et inÃ©quations (lecture graphique)</strong></h1>
  </div>

  <div class="wrap">
    <div class="controls card">
      <label><strong>Exercice :</strong> Ã‰quations et inÃ©quations</label>
      <button id="btn-new" class="btn">ðŸ”„ Nouvel Ã©noncÃ©</button>
      <button id="btn-check" class="btn">âœ… VÃ©rifier</button>
      <button id="btn-solution" class="btn">ðŸ’¡ Solution</button>
      <button id="btn-reset" class="btn">ðŸ§¹ RÃ©initialiser</button>
      <span class="score">Score : <span id="score">0 / 0</span></span>
    </div>

    <div class="controls card" id="ampbar">
      <strong>Amplitude (max Â±12)&nbsp;:</strong>
      x âˆˆ [&nbsp;<input id="xmin" type="number" value="-5" min="-12" max="12" step="1">&nbsp;;&nbsp;
      <input id="xmax" type="number" value="6"  min="-12" max="12" step="1">&nbsp;],
      y âˆˆ [&nbsp;<input id="ymin" type="number" value="-6" min="-12" max="12" step="1">&nbsp;;&nbsp;
      <input id="ymax" type="number" value="6"  min="-12" max="12" step="1">&nbsp;]
      <button id="amp-apply" class="btn">â†´ Appliquer</button>
    </div>

    <div class="card" id="host"></div>

    <div class="card small">
      <strong>Saisie & format attendus :</strong>
      <ul style="margin:8px 0 0 18px">
        <li><b>Ensemble de dÃ©finition</b> : <span class="code">[a ; b]</span> â€” ex. <span class="code">[âˆ’6 ; 6]</span>.</li>
        <li><b>Images</b> et <b>antÃ©cÃ©dents</b> : nombres (virgule <span class="code">2,5</span> ou point <span class="code">2.5</span> acceptÃ©s). Pour plusieurs antÃ©cÃ©dents : sÃ©parer par des points-virgules.</li>
        <li>Les questions 3aâ†’3j (Ã©quations/ inÃ©quations) sont corrigÃ©es dans la <b>Solution</b> (la vÃ©rification automatique ne les note pas).</li>
      </ul>
    </div>

    <div class="card">
      <div data-math-kbd style="display:flex; justify-content:center"></div>
    </div>
  </div>

<script>
(function(){
'use strict';
/* ===== util ===== */
const $=(s,r=document)=>r.querySelector(s);
const clamp=(x,a,b)=>Math.max(a,Math.min(b,x));
const FR=new Intl.NumberFormat('fr-FR',{maximumFractionDigits:2,useGrouping:false});
const fmt=n=>FR.format(n).replace('-', 'âˆ’');
function MJ(el){ try{ if(window.MathJax){ (MathJax.typesetPromise?MathJax.typesetPromise([el||document.body]):MathJax.typeset([el||document.body])); } }catch(_){} }

/* ===== amplitude contrÃ´lÃ©e ===== */
let AMP={ xmin:-5,xmax:6,ymin:-6,ymax:6 };
$('#amp-apply').addEventListener('click',()=>{
  const xi=+$('#xmin').value, xa=+$('#xmax').value, yi=+$('#ymin').value, ya=+$('#ymax').value;
  AMP={ xmin:Math.min(xi,xa), xmax:Math.max(xi,xa), ymin:Math.min(yi,ya), ymax:Math.max(yi,ya) };
  build();
});

/* ===== repÃ¨re + grille ===== */
let __cid=0;
function buildRepere({xmin,xmax,ymin,ymax}){
  const W0=560,H0=360,mL=28,mT=6,mR=6,mB=24, W=W0+mL+mR,H=H0+mT+mB;
  const svg=NS('svg'); svg.setAttribute('viewBox',`0 0 ${W} ${H}`); svg.classList.add('repere');
  const defs=NS('defs'); const clip=NS('clipPath'); const cid='clip'+(++__cid); clip.id=cid; const rc=NS('rect'); rc.setAttribute('x',mL);rc.setAttribute('y',mT);rc.setAttribute('width',W0);rc.setAttribute('height',H0); clip.appendChild(rc); defs.appendChild(clip);
  const mk=NS('marker'); mk.id='arr'; mk.setAttribute('markerWidth','8'); mk.setAttribute('markerHeight','8'); mk.setAttribute('refX','6'); mk.setAttribute('refY','3'); mk.setAttribute('orient','auto');
  mk.appendChild(path('M0,0 L6,3 L0,6 Z','#111',null,true)); defs.appendChild(mk); svg.appendChild(defs);
  const axes=NS('g'), plot=NS('g'); plot.classList.add('plot'); plot.setAttribute('clip-path','url(#'+cid+')'); svg.appendChild(axes); svg.appendChild(plot);
  const X=x=>mL + (x-xmin)*W0/(xmax-xmin); const Y=y=>mT + H0 - (y-ymin)*H0/(ymax-ymin);

  // cadre
  const frame=NS('rect'); frame.setAttribute('x',mL);frame.setAttribute('y',mT);frame.setAttribute('width',W0);frame.setAttribute('height',H0);
  frame.setAttribute('fill','none');frame.setAttribute('stroke','#111');frame.classList.add('frame'); axes.appendChild(frame);

  // grille + labels collÃ©s aux axes
  const g=NS('g'); g.setAttribute('stroke','#000'); g.setAttribute('stroke-width','0.7'); g.setAttribute('class','thin-grid');
  const tX=NS('g'),tY=NS('g'); const sx=1,sy=1;
  const yAxisY = clamp(Y(0), mT+10, mT+H0-10);
  const xAxisX = clamp(X(0), mL+10, mL+W0-10);

  for(let xv=Math.ceil(xmin/sx)*sx; xv<=xmax+1e-9; xv+=sx){
    g.appendChild(line(X(xv),0,X(xv),H));
    const t=NS('text'); t.textContent=fmt(xv); t.setAttribute('x', clamp(X(xv), mL+14, mL+W0-14)); t.setAttribute('y', clamp(yAxisY+14, mT+14, mT+H0+12)); t.setAttribute('font-size','12'); t.setAttribute('text-anchor','middle'); tX.appendChild(t);
  }
  for(let yv=Math.ceil(ymin/sy)*sy; yv<=ymax+1e-9; yv+=sy){
    g.appendChild(line(0,Y(yv),W,Y(yv)));
    const t=NS('text'); t.textContent=fmt(yv); t.setAttribute('x', clamp(xAxisX-6, mL+6, mL+W0-8)); t.setAttribute('y', clamp(Y(yv)+4, mT+10, mT+H0-6)); t.setAttribute('font-size','12'); t.setAttribute('text-anchor','end'); tY.appendChild(t);
  }
  axes.appendChild(g); axes.appendChild(tX); axes.appendChild(tY);

  // axes flÃ©chÃ©s
  const axX=line(mL,yAxisY,mL+W0-8,yAxisY,'#111',3); axX.setAttribute('marker-end','url(#arr)'); axes.appendChild(axX);
  const axY=line(xAxisX,mT+H0,xAxisX,mT+8,'#111',3); axY.setAttribute('marker-end','url(#arr)'); axes.appendChild(axY);

  return {svg,plot,X,Y,xmin,xmax,ymin,ymax};
}
function NS(n){return document.createElementNS('http://www.w3.org/2000/svg',n)}
function path(d,stroke,w,fill){const p=NS('path');p.setAttribute('d',d); if(!fill){p.setAttribute('fill','none');} else {p.setAttribute('fill',stroke||'#000');} if(stroke&&!fill)p.setAttribute('stroke',stroke); if(w)p.setAttribute('stroke-width',w); return p;}
function line(x1,y1,x2,y2,st='#000',w=1.6){const l=NS('line'); l.setAttribute('x1',x1);l.setAttribute('y1',y1);l.setAttribute('x2',x2);l.setAttribute('y2',y2); l.setAttribute('stroke',st); l.setAttribute('stroke-width',w); return l;}

/* ===== courbes (grille entiÃ¨re + Hermite monotone) ===== */
function buildGrid(R){
  const X=[], Y=[];
  for(let x=R.xmin; x<=R.xmax; x++){ X.push(x); Y.push(rand(R.ymin+1,R.ymax-1)); }
  // un peu de relief
  const mid=Math.floor(X.length/2);
  Y[mid]+=rand(-2,2); if(X.includes(0)) Y[X.indexOf(0)] += rand(-1,1);
  return {Xs:X, Ys:Y};
}
function rand(a,b){ return a + Math.floor(Math.random()*(b-a+1)); }
function hermitePath(rep, Xs, Ys){
  const X=rep.X, Y=rep.Y, n=Xs.length;
  const s = Array.from({length:n-1},(_,i)=>Ys[i+1]-Ys[i]);
  const d = Array(n); d[0]=s[0]; d[n-1]=s[n-2];
  for(let i=1;i<n-1;i++){
    const s0=s[i-1], s1=s[i];
    d[i] = (s0*s1<=0)?0:( (Math.sign(s0)+Math.sign(s1)) * Math.min(Math.abs(s0),Math.abs(s1),0.5*(Math.abs(s0)+Math.abs(s1))) );
  }
  let D=`M ${X(Xs[0])} ${Y(Ys[0])}`;
  for(let i=0;i<n-1;i++){
    const x0=Xs[i],x1=Xs[i+1],y0=Ys[i],y1=Ys[i+1],h=x1-x0;
    const c1x=X(x0+h/3), c1y=Y(y0 + d[i]*h/3);
    const c2x=X(x1-h/3), c2y=Y(y1 - d[i+1]*h/3);
    D+=` C ${c1x} ${c1y} ${c2x} ${c2y} ${X(x1)} ${Y(y1)}`;
  }
  return D;
}
function clampY(R,y){ return Math.max(R.ymin+1, Math.min(R.ymax-1, y)); }

/* === intersection util (linÃ©aire par segment) === */
function rootsEq(Xs, Y1, Y2){ // solutions de f=g
  const out=[];
  for(let i=0;i<Xs.length-1;i++){
    const a=Y1[i]-Y2[i], b=Y1[i+1]-Y2[i+1];
    if(a===0) out.push(Xs[i]);
    if((a<0&&b>0)||(a>0&&b<0)){
      const t = a/(a-b); // position entre i et i+1
      out.push( Xs[i] + t*(Xs[i+1]-Xs[i]) );
    }
  }
  // fusion des doublons
  return Array.from(new Set(out.map(v=>Math.round(v*100)/100)));
}
function rootsLevel(Xs, Ys, y){ // f(x)=y
  const out=[];
  for(let i=0;i<Xs.length-1;i++){
    const a=Ys[i]-y, b=Ys[i+1]-y;
    if(a===0) out.push(Xs[i]);
    if((a<0&&b>0)||(a>0&&b<0)){
      const t = a/(a-b);
      out.push( Xs[i] + t*(Xs[i+1]-Xs[i]) );
    }
  }
  return Array.from(new Set(out.map(v=>Math.round(v*100)/100)));
}

/* ===== gÃ©nÃ©ration de deux courbes qui se croisent en EXACTEMENT 2 points ===== */
function makeState(){
  const R={...AMP};
  let F=null,G=null,Xs=null;
  // on fabrique g en Â« dÃ©calage Â» de f avec un vallon central â‡’ 2 croisements
  for(let tries=0;tries<50;tries++){
    const grid=buildGrid(R);
    Xs=grid.Xs; const Yf=grid.Ys.slice();
    // delta : +k partout, et nÃ©gatif dans une fenÃªtre centrale lissÃ© linÃ©airement
    const k=2, n=Xs.length, L=Math.floor(n*0.30), Rw=Math.floor(n*0.70);
    const Ym=[];
    for(let i=0;i<n;i++){
      let d = k;
      if(i>=L && i<=Rw){
        const t = (i-L)/(Rw-L);           // 0 â†’ 1 dans la fenÃªtre
        d = -k*(1 - 4*(t-0.5)*(t-0.5));   // bosse nÃ©gative (min au centre)
      }
      Ym.push( clampY(R, Yf[i] + d) );
    }
    const roots = rootsEq(Xs, Yf, Ym);
    if(roots.length===2){ F=Yf; G=Ym; break; }
  }
  return { R, Xs, Yf:F, Yg:G };
}

/* ===== rendu ===== */
function render(st){
  const host=$("#host"); host.innerHTML='';
  const row=document.createElement('div'); row.className='row'; host.appendChild(row);

  const s=document.createElement('div'); s.className='statement';
  s.innerHTML = `
    <div class="consigne"><strong>Exercice&nbsp;16 â€” Ã‰quations et inÃ©quations.</strong><br>
    On donne ci-dessous les courbes des fonctions \\(f\\) (pleine) et \\(g\\) (pointillÃ©e).</div>`;
  row.appendChild(s);

  const rep=buildRepere(st.R);
  // f (plein)
  rep.plot.appendChild( path(hermitePath(rep, st.Xs, st.Yf), '#111', 3 ) );
  // g (pointillÃ©)
  const pg = path(hermitePath(rep, st.Xs, st.Yg), '#111', 2.4); pg.setAttribute('stroke-dasharray','6 6'); rep.plot.appendChild(pg);
  s.appendChild(rep.svg);

  const form=document.createElement('div'); form.className='input-wrap'; row.appendChild(form);

  form.innerHTML = `
    <div class="qa"><div class="q">1.</div>
      <div class="a">Donner lâ€™ensemble de dÃ©finition de \\(f\\) et de \\(g\\)&nbsp;:
        \\(D_f=\\)<input id="dF" type="text" style="width:10ch">,&nbsp;
        \\(D_g=\\)<input id="dG" type="text" style="width:10ch">
        <span id="mD" class="qmark"></span>
      </div>
    </div>

    <div class="qa"><div class="q">2.</div>
      <div class="a">
        a) Image de \\(âˆ’2\\) par \\(f\\) : <input id="iFa" type="text" style="width:8ch"> <span id="mFa" class="qmark"></span><br>
        b) Image de \\(4\\) par \\(g\\) : <input id="iGb" type="text" style="width:8ch"> <span id="mGb" class="qmark"></span><br>
        c) AntÃ©cÃ©dent(s) de \\(3\\) par \\(f\\)&nbsp;: <input id="aFc" type="text" style="width:20ch"> <span id="mFc" class="qmark"></span><br>
        d) AntÃ©cÃ©dent(s) de \\(3\\) par \\(g\\)&nbsp;: <input id="aGd" type="text" style="width:20ch"> <span id="mGd" class="qmark"></span>
      </div>
    </div>

    <div class="qa"><div class="q">3.</div>
      <div class="a">
        <div class="mini-note">RÃ©soudre graphiquement (rÃ©ponse en texte libre ; corrigÃ© dans Â« Solution Â»)&nbsp;:</div>
        <div class="tbl-wrap">
          <table class="tbl">
            <tbody>
              <tr><td>a) \\(f(x)=0\\)</td><td><input id="q_a" type="text" style="width:22ch"></td></tr>
              <tr><td>b) \\(f(x)=-4\\)</td><td><input id="q_b" type="text" style="width:22ch"></td></tr>
              <tr><td>c) \\(g(x)=2\\)</td><td><input id="q_c" type="text" style="width:22ch"></td></tr>
              <tr><td>d) \\(f(x)=g(x)\\)</td><td><input id="q_d" type="text" style="width:22ch"></td></tr>
              <tr><td>e) \\(f(x)>2\\)</td><td><input id="q_e" type="text" style="width:22ch"></td></tr>
              <tr><td>f) \\(f(x)\\le 2\\)</td><td><input id="q_f" type="text" style="width:22ch"></td></tr>
              <tr><td>g) \\(g(x)\\le -2\\)</td><td><input id="q_g" type="text" style="width:22ch"></td></tr>
              <tr><td>h) \\(g(x)\\ge -4\\)</td><td><input id="q_h" type="text" style="width:22ch"></td></tr>
              <tr><td>i) \\(f(x)\\ge g(x)\\)</td><td><input id="q_i" type="text" style="width:22ch"></td></tr>
              <tr><td>j) \\(f(x)< g(x)\\)</td><td><input id="q_j" type="text" style="width:22ch"></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="res"></div>
  `;

  // Ã©tat pour solution/vÃ©rif
  host.dataset.state = JSON.stringify(st);
  MJ(host);
}

/* ===== solution ===== */
function showSolution(){
  const host=$("#host"); let st=null; try{ st=JSON.parse(host.dataset.state||'{}'); }catch(_){}
  if(!st) return;
  const steps=[];
  steps.push(`Ensemble de dÃ©finition : \\(D_f=D_g=[${fmt(st.R.xmin)}\\; ;\\; ${fmt(st.R.xmax)}]\\).`);

  const fAt = xInterp(st, 'Yf', x=>x);
  const gAt = xInterp(st, 'Yg', x=>x);
  steps.push(`\\(f(âˆ’2)=${fmt(fAt(-2))}\\) ; \\(g(4)=${fmt(gAt(4))}\\).`);

  const Af3 = rootsLevel(st.Xs, st.Yf, 3);
  const Ag3 = rootsLevel(st.Xs, st.Yg, 3);
  steps.push(`AntÃ©cÃ©dent(s) de \\(3\\) par \\(f\\) : ${Af3.length? Af3.map(x=>'\\('+fmt(x)+'\\)').join(' ; ') : 'aucun'}.`);
  steps.push(`AntÃ©cÃ©dent(s) de \\(3\\) par \\(g\\) : ${Ag3.length? Ag3.map(x=>'\\('+fmt(x)+'\\)').join(' ; ') : 'aucun'}.`);

  // Q3 â€” Ã©quations/ineq (on Ã©chantillonne aux pas entiers)
  const roots0 = rootsLevel(st.Xs, st.Yf, 0);
  const rootsFm4 = rootsLevel(st.Xs, st.Yf, -4);
  const rootsG2 = rootsLevel(st.Xs, st.Yg, 2);
  const cross = rootsEq(st.Xs, st.Yf, st.Yg); // exactement 2 par construction

  function intervalsWhere(Y, cmp, k){
    // renvoie unions dâ€™intervalles oÃ¹ cmp(Y, k) est vrai (test par segments)
    const X=st.Xs, res=[];
    let cur=null;
    const val=i=>(cmp(Y[i],k));
    for(let i=0;i<X.length-1;i++){
      const a = Y[i]-k, b = Y[i+1]-k;
      const A = val(i);
      const B = val(i+1);
      if(A && !cur) cur = X[i];
      if((a<0&&b>0)||(a>0&&b<0)){ // croisement
        const t=a/(a-b); const x0 = X[i] + t*(X[i+1]-X[i]);
        if(A && !B){ res.push([cur, x0]); cur=null; }
        if(!A && B){ cur = x0; }
      }
      if(B===false && i===X.length-2 && cur!=null){ res.push([cur, X[i+1]]); cur=null; }
    }
    if(cur!=null) res.push([cur, X[X.length-1]]);
    return res;
  }
  const Iv_f_gt2 = intervalsWhere(st.Yf, (y,k)=>y>k, 2);
  const Iv_f_le2 = intervalsWhere(st.Yf, (y,k)=>y<=k, 2);
  const Iv_g_le_2 = intervalsWhere(st.Yg, (y,k)=>y<=k, -2);
  const Iv_g_ge_4 = intervalsWhere(st.Yg, (y,k)=>y>=k, -4);

  const Iv_f_ge_g = (()=>{ // comparer signe de (f-g)
    const D = st.Yf.map((y,i)=>y - st.Yg[i]);
    return intervalsWhere(D, (y)=>y>=0, 0);
  })();
  const Iv_f_lt_g = (()=>{ const D=st.Yf.map((y,i)=>y - st.Yg[i]); return intervalsWhere(D,(y)=>y<0,0); })();

  const toI = S => S.length ? S.map(([a,b])=>`\\([${fmt(a)}\\;;\\;${fmt(b)}]\\)`).join(' âˆª ') : 'âˆ…';

  steps.push(`<u>RÃ©solutions</u> :`);
  steps.push(`a) \\(f(x)=0\\) : ${roots0.length? roots0.map(x=>'\\('+fmt(x)+'\\)').join(' ; ') : 'aucune solution'}.`);
  steps.push(`b) \\(f(x)=-4\\) : ${rootsFm4.length? rootsFm4.map(x=>'\\('+fmt(x)+'\\)').join(' ; ') : 'aucune solution'}.`);
  steps.push(`c) \\(g(x)=2\\) : ${rootsG2.length? rootsG2.map(x=>'\\('+fmt(x)+'\\)').join(' ; ') : 'aucune solution'}.`);
  steps.push(`d) \\(f(x)=g(x)\\) : ${cross.map(x=>'\\('+fmt(x)+'\\)').join(' ; ')}.`);
  steps.push(`e) \\(f(x)>2\\) : ${toI(Iv_f_gt2)}.`);
  steps.push(`f) \\(f(x)\\le2\\) : ${toI(Iv_f_le2)}.`);
  steps.push(`g) \\(g(x)\\le-2\\) : ${toI(Iv_g_le_2)}.`);
  steps.push(`h) \\(g(x)\\ge-4\\) : ${toI(Iv_g_ge_4)}.`);
  steps.push(`i) \\(f(x)\\ge g(x)\\) : ${toI(Iv_f_ge_g)}.`);
  steps.push(`j) \\(f(x)< g(x)\\) : ${toI(Iv_f_lt_g)}.`);

  const box = document.createElement('div'); box.className='steps';
  box.innerHTML = steps.map(s=>`<div class="step">${s}</div>`).join('');
  $('#res',host).innerHTML = ''; $('#res',host).appendChild(box); MJ(box);
  document.body.classList.add('solution-active');

  // helpers visuels : traits vers (âˆ’2,f(âˆ’2)) et (4,g(4))
  drawHelpers(-2, fAt(-2), '#2563eb', true);
  drawHelpers(4,  gAt(4),  '#dc2626', false);

  function drawHelpers(x,y,col,isF){
    const rep = host.querySelector('svg.repere');
    const frame = rep.querySelector('rect.frame');
    const mL=+frame.getAttribute('x'), mT=+frame.getAttribute('y');
    const W0=+frame.getAttribute('width'), H0=+frame.getAttribute('height');
    const X = v => mL + (v - st.R.xmin) * W0 / (st.R.xmax - st.R.xmin);
    const Y = v => mT + H0 - (v - st.R.ymin) * H0 / (st.R.ymax - st.R.ymin);
    const plot = rep.querySelector('.plot');
    const l1=line(X(x),Y(y),X(x),Y(0),col,2.4); l1.setAttribute('stroke-dasharray','6 5'); plot.appendChild(l1);
    const l2=line(X(0),Y(y),X(x),Y(y),col,2.4); l2.setAttribute('stroke-dasharray','6 5'); plot.appendChild(l2);
  }
}
function xInterp(st, key){ // linÃ©aire sur le maillage entier
  const X=st.Xs, Y=st[key];
  return x=>{
    if(x<=X[0]) return Y[0];
    if(x>=X[X.length-1]) return Y[Y.length-1];
    let i=0; while(i<X.length-1 && X[i+1]<x) i++;
    const t = (x - X[i])/(X[i+1]-X[i]);
    return Math.round( (Y[i] + t*(Y[i+1]-Y[i])) * 100 )/100;
  };
}

/* ===== vÃ©rification (rapide) : domaine + 4 sous-questions du 2. ===== */
function checkQuick(){
  const host=$("#host"); let st=null; try{ st=JSON.parse(host.dataset.state||'{}'); }catch(_){}
  if(!st) return;
  let score=0, total=0;

  // domaine
  const want = `[${st.R.xmin} ; ${st.R.xmax}]`;
  function normD(s){ return String(s||'').replace(/\u2212/g,'-').replace(/\s+/g,' ').replace(/[()]/g,'').trim(); }
  const okD = (normD($('#dF').value)===want && normD($('#dG').value)===want) || (!$('#dF').value && !$('#dG').value);
  if($('#dF').value || $('#dG').value){ total++; if(okD) score++; }
  $('#mD').textContent = ($('#dF').value||$('#dG').value) ? (okD?'âœ”':'âœ˜') : '';

  // 2a / 2b / 2c / 2d
  const fAt = xInterp(st,'Yf'), gAt=xInterp(st,'Yg');
  function numFR(s){ return Number(String(s||'').replace(/\u2212/g,'-').replace(',','.')); }
  function mark(id, ok){ const m=$(id); m.textContent = (ok?'âœ”':'âœ˜'); m.style.color = ok?'#14532d':'#991b1b'; }
  // a)
  if($('#iFa').value){ total++; const ok=Math.abs(numFR($('#iFa').value)-fAt(-2))<=0.25; if(ok) score++; mark('#mFa', ok); }
  // b)
  if($('#iGb').value){ total++; const ok=Math.abs(numFR($('#iGb').value)-gAt(4))<=0.25; if(ok) score++; mark('#mGb', ok); }
  // c)
  if($('#aFc').value){
    total++;
    const L = String($('#aFc').value).replace(/[()[\]{}]/g,'').split(/[;:,]/).map(t=>numFR(t)).filter(n=>isFinite(n));
    const A = rootsLevel(st.Xs, st.Yf, 3);
    const ok = L.length===A.length && L.every(u=>A.some(v=>Math.abs(u-v)<=0.3));
    if(ok) score++; mark('#mFc', ok);
  }
  // d)
  if($('#aGd').value){
    total++;
    const L = String($('#aGd').value).replace(/[()[\]{}]/g,'').split(/[;:,]/).map(t=>numFR(t)).filter(n=>isFinite(n));
    const A = rootsLevel(st.Xs, st.Yg, 3);
    const ok = L.length===A.length && L.every(u=>A.some(v=>Math.abs(u-v)<=0.3));
    if(ok) score++; mark('#mGd', ok);
  }

  $('#score').textContent = `${score} / ${total}`;
  document.body.classList.remove('solution-active');
}

/* ===== wireup ===== */
function build(){ const st=makeState(); render(st); $('#score').textContent='0 / 0'; }
document.addEventListener('DOMContentLoaded',()=>{
  $('#btn-new').addEventListener('click', build);
  $('#btn-solution').addEventListener('click', showSolution);
  $('#btn-check').addEventListener('click', checkQuick);
  $('#btn-reset').addEventListener('click', build);
  build();
});
})();
</script>

<!-- (optionnel) ton clavier math habituel -->
<script src="../../../../js/math-kbd.js" defer></script>
</body>
</html>
