<!doctype html>
<html lang='fr'>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Seconde ‚Äì Augmentations & diminutions</title>

<link rel="stylesheet" href="../../../../css/math-kbd.css">
<link rel="stylesheet" href="../../../../css/espace-gras.css">

<style>
*{box-sizing:border-box}
body{font-family:system-ui, Segoe UI, Roboto, Arial; margin:0; background:#fafafa; color:#111; line-height:1.5}
.header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;padding:14px 18px;z-index:5}
.wrap{max-width:1100px;margin:0 auto;padding:18px;display:flex;flex-direction:column;gap:12px}
.card{background:#fff;border:1px solid #e6e6e6;border-radius:12px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
.controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
.controls label{font-weight:600}
select,input[type=text]{padding:8px 10px;border:1px solid #ddd;border-radius:8px;font-size:15px}
.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 10px;border:1px solid #ddd;background:#f7f7f7;border-radius:10px;cursor:pointer;white-space:nowrap}
.btn:hover{background:#efefef}
.score{font-weight:700;white-space:nowrap;margin-left:auto}
.small{font-size:.92rem;color:#666}
.res{grid-area:res; padding:12px; border-radius:10px; background:#f7f7f7}
.res-ok{background:#ecfdf5;border:1px solid #a7f3d0}
.res-ko{background:#fef2f2;border:1px solid #fecaca}
.consigne .c-label{font-weight:600; margin-right:.35em}

.row{ display:grid; grid-template-columns:1fr; grid-template-areas:'lab' 'inp' 'res'; gap:10px; align-items:start; }
.row .col-label{grid-area:lab}
.row .input-line{grid-area:inp}
.row .input-line input[type=text]{width:100%}

.frac{display:inline-flex;flex-direction:column;align-items:center;vertical-align:middle;line-height:1}
.frac .num,.frac .den{padding:0 .2em;white-space:nowrap}
.frac .bar{border-top:1.6px solid currentColor;align-self:stretch;margin:.06em 0}

.eq .frac .num,
.eq .frac .den{ padding:0 .24em; }

.eq .frac .bar{
  border-top:1.6px solid currentColor;
  align-self:stretch;
  transform:translateY(-0.06em); /* micro-ajustement optique de la barre */
}


.tick{display:inline-block;min-width:1.2em;margin-left:8px;font-weight:700}
.tick.ok{color:#059669}
.tick.ko{color:#dc2626}
</style>
</head>

<body>
<div class="header">
  <h1 style="margin:0;font-size:1.1rem">Seconde ‚Äì <strong>Augmentations & diminutions</strong></h1>
  <div class="wrap" style="padding:0 18px">
    <div class="controls">
      <label for="exo-select">Type d‚Äôexercice :</label>
      <select id="exo-select"></select>
      <button id="btn-new" class="btn">üîÄ Nouvel √©nonc√©</button>
      <button id="btn-check" class="btn">‚úÖ V√©rifier</button>
      <button id="btn-solution" class="btn">üí° Solution</button>
      <button id="btn-reset" class="btn">‚ôªÔ∏è R√©initialiser</button>
      <div class="score" id="score">Score : 0 / 0</div>
    </div>
  </div>
</div>

<div class="wrap">
  <div class="card"><div id="host"></div></div>

  <div class="card small">
    <div><strong>Consignes de saisie :</strong></div>
    <ul class="tips">
      <li>Entrez <strong>uniquement un nombre</strong> (sans unit√©) dans la zone de r√©ponse.</li>
      <li>D√©cimaux : virgule <em>ou</em> point (ex. <code>1,25</code> ‚Üî <code>1.25</code>).</li>
      <li>Arrondir la valeur demand√©e au <strong>centi√®me</strong> pr√®s.</li>
    </ul>
  </div>
</div>

<script>
/* ======= Outils ======= */
const $=(s,r=document)=>r.querySelector(s);
const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
const rnd=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const choice=L=>L[rnd(0,L.length-1)];
const fmtDecFR=(x,d=2)=>String(Math.round(x*10**d)/10**d).replace('.',',');
function tidyDecFR(v,d=2){ let s=fmtDecFR(v,d); if(s.includes(',')) s=s.replace(/0+$/,'').replace(/[,]$/,''); return s; }
const same02=(a,b)=>Math.round(a*100)===Math.round(b*100);
const stripU=s=>String(s||'').replace(/‚àí/g,'-');
function parseNumberFR(s){ s=stripU(String(s||'').trim()); return parseFloat(s.replace(',', '.')); }
function fracHTML(n,d){ return '<span class="frac"><span class="num">'+n+'</span><span class="bar"></span><span class="den">'+d+'</span></span>'; }
function addTicks(host){
  $$('#host input[type=text]').forEach(inp=>{
    if(!inp.nextElementSibling || !inp.nextElementSibling.classList || !inp.nextElementSibling.classList.contains('tick')){
      inp.insertAdjacentHTML('afterend','<span class="tick"></span>');
    }
  });
}
function setTick(inp, ok){
  const t = inp.nextElementSibling && inp.nextElementSibling.classList.contains('tick') ? inp.nextElementSibling : null;
  if(!t) return; t.textContent = ok===null?'':(ok?'‚úî':'‚úò'); t.className='tick '+(ok?'ok':'ko');
}
function gcd(a,b){ a=Math.abs(a); b=Math.abs(b); while(b){ [a,b]=[b,a%b]; } return a; }
function roundToMultiple(n, m){ return Math.round(n/m)*m; }

/* ======= Banque de contextes (25) ======= */
function bank25(){
  const B=[
    {unit:'adh√©rents',dec:0,int:true,  genVal:()=>rnd(120,800),  viToVf:(v,d,p)=>`L'an dernier, un club de sport comptait ${v} adh√©rents. Le nombre de membres a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Combien d'adh√©rents cette ann√©e ?`, vfToVi:(v,d,p)=>`Cette ann√©e, un club de sport compte ${v} adh√©rents apr√®s une ${d==='A'?'augmentation':'diminution'} de ${p}%. Combien en comptait-il l'an dernier ?`},
    {unit:'‚Ç¨',dec:2,int:false, genVal:()=>rnd(8,45)+rnd(0,99)/100, viToVf:(v,d,p)=>`Le prix d'un livre est de ${tidyDecFR(v,2)} ‚Ç¨. Il a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quel est le nouveau prix ?`, vfToVi:(v,d,p)=>`Apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%, le prix d'un livre est ${tidyDecFR(v,2)} ‚Ç¨. Quel √©tait l'ancien prix ?`},
    {unit:'habitants',dec:0,int:true, genVal:()=>rnd(15000,120000), viToVf:(v,d,p)=>`La population d'une ville est de ${v} habitants. Elle a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Combien d'habitants maintenant ?`, vfToVi:(v,d,p)=>`La population d'une ville est de ${v} habitants apr√®s une ${d==='A'?'augmentation':'diminution'} de ${p}%. Quelle √©tait la population avant ?`},
    {unit:'pi√®ces',dec:0,int:true, genVal:()=>rnd(500,5000), viToVf:(v,d,p)=>`Une usine produit ${v} pi√®ces par jour. La production a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Combien de pi√®ces produit-elle d√©sormais ?`, vfToVi:(v,d,p)=>`Une usine produit ${v} pi√®ces par jour apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%. Combien produisait-elle auparavant ?`},
    {unit:'‚Ç¨',dec:2,int:false, genVal:()=>rnd(1200,3200)+rnd(0,99)/100, viToVf:(v,d,p)=>`Un salaire mensuel est de ${tidyDecFR(v,2)} ‚Ç¨. Il a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quel est le nouveau salaire ?`, vfToVi:(v,d,p)=>`Un salaire mensuel est ${tidyDecFR(v,2)} ‚Ç¨ apr√®s une ${d==='A'?'augmentation':'diminution'} de ${p}%. Quel √©tait le salaire avant ?`},
    {unit:'g',dec:0,int:true, genVal:()=>rnd(250,750), viToVf:(v,d,p)=>`La masse d'un paquet de c√©r√©ales est ${v} g. Pendant une promotion, elle a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quelle est la masse apr√®s ?`, vfToVi:(v,d,p)=>`Apr√®s une ${d==='A'?'augmentation':'diminution'} de ${p}%, la masse d'un paquet de c√©r√©ales est ${v} g. Quelle √©tait la masse avant ?`},
    {unit:'L',dec:1,int:false, genVal:()=>rnd(50,300)/10, viToVf:(v,d,p)=>`Le volume d'un r√©servoir est ${tidyDecFR(v,1)} L. Il a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quel est le nouveau volume ?`, vfToVi:(v,d,p)=>`Le volume d'un r√©servoir est ${tidyDecFR(v,1)} L apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%. Quel √©tait le volume initial ?`},
    {unit:'km/h',dec:1,int:false, genVal:()=>rnd(30,120)/1, viToVf:(v,d,p)=>`La vitesse moyenne d'un trajet est ${v} km/h. Elle a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quelle est la nouvelle vitesse ?`, vfToVi:(v,d,p)=>`Apr√®s une ${d==='A'?'augmentation':'diminution'} de ${p}%, la vitesse moyenne d'un trajet est ${v} km/h. Quelle √©tait-elle avant ?`},
    {unit:'min',dec:0,int:true, genVal:()=>rnd(20,120), viToVf:(v,d,p)=>`La dur√©e d'un trajet est ${v} minutes. Elle a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quelle est la nouvelle dur√©e ?`, vfToVi:(v,d,p)=>`La dur√©e d'un trajet est ${v} minutes apr√®s une ${d==='A'?'augmentation':'diminution'} de ${p}%. Quelle √©tait la dur√©e initiale ?`},
    {unit:'m¬≤',dec:0,int:true, genVal:()=>rnd(40,150), viToVf:(v,d,p)=>`La surface d'un appartement est ${v} m¬≤. Elle a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quelle est la nouvelle surface ?`, vfToVi:(v,d,p)=>`La surface d'un appartement est ${v} m¬≤ apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%. Quelle √©tait la surface avant ?`},
    {unit:'‚Ç¨',dec:2,int:false, genVal:()=>rnd(300,1200)+rnd(0,99)/100, viToVf:(v,d,p)=>`La facture d'√©lectricit√© d'un foyer est ${tidyDecFR(v,2)} ‚Ç¨. Elle a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quel est le nouveau montant ?`, vfToVi:(v,d,p)=>`La facture d'√©lectricit√© d'un foyer est ${tidyDecFR(v,2)} ‚Ç¨ apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%. Quel √©tait le montant avant ?`},
    {unit:'k‚Ç¨',dec:0,int:true, genVal:()=>rnd(100,900), viToVf:(v,d,p)=>`Le chiffre d'affaires d'une librairie est ${v} k‚Ç¨. Il a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quel est le nouveau CA ?`, vfToVi:(v,d,p)=>`Le chiffre d'affaires d'une librairie est ${v} k‚Ç¨ apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%. Quel √©tait le CA pr√©c√©dent ?`},
    {unit:'$',dec:0,int:false, genVal:()=>rnd(200,1200), viToVf:(v,d,p)=>`Le prix d'un ordinateur est ${v} $. Il a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quel est le nouveau prix ?`, vfToVi:(v,d,p)=>`Apr√®s une ${d==='A'?'augmentation':'diminution'} de ${p}%, le prix d'un ordinateur est ${v} $. Quel √©tait l'ancien prix ?`},
    {unit:'arbres',dec:0,int:true, genVal:()=>rnd(100,1200), viToVf:(v,d,p)=>`Une association a plant√© ${v} arbres l'an dernier. Le nombre a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Combien cette ann√©e ?`, vfToVi:(v,d,p)=>`Cette ann√©e, une association a plant√© ${v} arbres apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%. Combien l'an dernier ?`},
    {unit:'spectateurs',dec:0,int:true, genVal:()=>rnd(500,5000), viToVf:(v,d,p)=>`Un concert a r√©uni ${v} spectateurs. Le nombre a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Combien au concert suivant ?`, vfToVi:(v,d,p)=>`Un concert a r√©uni ${v} spectateurs apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%. Combien au pr√©c√©dent ?`},
    {unit:'pi√®ces',dec:0,int:true, genVal:()=>rnd(200,2000), viToVf:(v,d,p)=>`Le stock d'un magasin est de ${v} pi√®ces. Il a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quel est le stock maintenant ?`, vfToVi:(v,d,p)=>`Le stock d'un magasin est de ${v} pi√®ces apr√®s une ${d==='A'?'augmentation':'diminution'} de ${p}%. Quel √©tait le stock avant ?`},
    {unit:'tonnes',dec:1,int:false, genVal:()=>rnd(50,500)/10, viToVf:(v,d,p)=>`La production mensuelle d'une carri√®re est ${tidyDecFR(v,1)} tonnes. Elle a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quelle est la nouvelle production ?`, vfToVi:(v,d,p)=>`La production mensuelle d'une carri√®re est ${tidyDecFR(v,1)} tonnes apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%. Quelle √©tait-elle auparavant ?`},
    {unit:'√©l√®ves',dec:0,int:true, genVal:()=>rnd(200,1500), viToVf:(v,d,p)=>`Un lyc√©e compte ${v} √©l√®ves. L'effectif a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Combien d'√©l√®ves maintenant ?`, vfToVi:(v,d,p)=>`Un lyc√©e compte ${v} √©l√®ves apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%. Combien auparavant ?`},
    {unit:'‚Ç¨',dec:2,int:false, genVal:()=>rnd(20,160)+rnd(0,99)/100, viToVf:(v,d,p)=>`Le prix d'un billet de train est ${tidyDecFR(v,2)} ‚Ç¨. Il a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quel est le nouveau prix ?`, vfToVi:(v,d,p)=>`Apr√®s une ${d==='A'?'augmentation':'diminution'} de ${p}%, le prix d'un billet de train est ${tidyDecFR(v,2)} ‚Ç¨. Quel √©tait l'ancien prix ?`},
    {unit:'km',dec:1,int:false, genVal:()=>rnd(2,25)/1, viToVf:(v,d,p)=>`La distance d'un parcours est ${v} km. Elle a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quelle est la nouvelle distance ?`, vfToVi:(v,d,p)=>`La distance d'un parcours est ${v} km apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%. Quelle √©tait la distance initiale ?`},
    {unit:'bo√Ætes',dec:0,int:true, genVal:()=>rnd(20,300), viToVf:(v,d,p)=>`Un commer√ßant vend ${v} bo√Ætes par jour. Les ventes ont ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Combien vend-il d√©sormais ?`, vfToVi:(v,d,p)=>`Un commer√ßant vend ${v} bo√Ætes par jour apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%. Combien vendait-il avant ?`},
    {unit:'‚Ç¨',dec:2,int:false, genVal:()=>rnd(400,1500)+rnd(0,99)/100, viToVf:(v,d,p)=>`Le loyer d'un appartement est ${tidyDecFR(v,2)} ‚Ç¨. Il a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quel est le nouveau loyer ?`, vfToVi:(v,d,p)=>`Le loyer d'un appartement est ${tidyDecFR(v,2)} ‚Ç¨ apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%. Quel √©tait le loyer pr√©c√©dent ?`},
    {unit:'kWh',dec:0,int:true, genVal:()=>rnd(1800,6000), viToVf:(v,d,p)=>`La consommation annuelle d'un foyer est ${v} kWh. Elle a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quelle est la nouvelle consommation ?`, vfToVi:(v,d,p)=>`La consommation annuelle d'un foyer est ${v} kWh apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%. Quelle √©tait la consommation initiale ?`},
    {unit:'‚Ç¨',dec:2,int:false, genVal:()=>rnd(2,8)+rnd(0,99)/100, viToVf:(v,d,p)=>`Le prix d'un sandwich est ${tidyDecFR(v,2)} ‚Ç¨. Il a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quel est le nouveau prix ?`, vfToVi:(v,d,p)=>`Apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%, le prix d'un sandwich est ${tidyDecFR(v,2)} ‚Ç¨. Quel √©tait le prix avant ?`},
    {unit:'kg',dec:1,int:false, genVal:()=>rnd(50,120)/10, viToVf:(v,d,p)=>`La masse d'un colis est ${tidyDecFR(v,1)} kg. Elle a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quelle est la nouvelle masse ?`, vfToVi:(v,d,p)=>`La masse d'un colis est ${tidyDecFR(v,1)} kg apr√®s une ${d==='A'?'augmentation':'diminution'} de ${p}%. Quelle √©tait la masse au d√©part ?`},
    {unit:'m',dec:2,int:false, genVal:()=>Math.round((rnd(50,500)/10 + Math.random())*100)/100, viToVf:(v,d,p)=>`La longueur d'un c√¢ble est ${v} m. Elle a ${d==='A'?'augment√©':'diminu√©'} de ${p}%. Quelle est la nouvelle longueur ?`, vfToVi:(v,d,p)=>`La longueur d'un c√¢ble est ${v} m apr√®s une ${d==='A'?'hausse':'baisse'} de ${p}%. Quelle √©tait la longueur avant ?`}
  ];
  return B;
}

/* ======= G√©n√©rateur de contexte commun ======= */
function makeContext(mode){ // mode: 'vi2vf' ou 'vf2vi'
  const bank = bank25();
  const tpl  = choice(bank);
  // Pour entiers : on force des pourcentages compatibles
  const P = [5,10,20,25,50]; // pour % ‚Äúpropres‚Äù
  const dir  = Math.random()<0.5 ? 'A' : 'D';     // A=augmentation, D=diminution
  const pAll = rnd(5,60); // fallback pour non-entier
  const pSel = tpl.int ? choice(P) : pAll;
  const p    = pSel;
  const t    = (dir==='A'? +1 : -1) * (p/100);

  if(mode==='vi2vf'){
    // Vi donn√© ‚Üí choisir Vi ; si entiers, Vi multiple de 20 (garantit Vf entier pour P)
    let Vi0 = tpl.genVal();
    if(tpl.int){
      Vi0 = Math.max( roundToMultiple(Vi0, 20), 20);
    }
    const Vi = Vi0;
    const Vf = Vi * (1 + t);
    const text = tpl.viToVf(tpl.int?Math.round(Vi):Vi, dir, p);
    return {Vi:tpl.int?Math.round(Vi):Vi, Vf:tpl.int?Math.round(Vf*1)/1:Math.round(Vf*100)/100, t, dir, p, unit:tpl.unit, dec:tpl.dec, text, int:tpl.int};
  }else{
    // vf2vi ‚Äî Vf donn√©, choisir Vf pour que Vi soit entier si besoin
    const d = (dir==='A') ? (100+p) : (100-p);   // 100 ¬± p
    const g = gcd(100, d);
    const mult = d / g;                          // condition: Vf multiple de mult
    let base = tpl.genVal();
    if(tpl.int){
      // forcer Vf multiple de mult
      base = Math.max(mult, Math.round(base / mult) * mult);
    }else{
      base = Math.round(base*100)/100;
    }
    const Vf = tpl.int ? base : base;
    const Vi = (Vf * 100) / d;
    const text = tpl.vfToVi(tpl.int?Math.round(Vf):Vf, dir, p);
    return {Vi:tpl.int?Math.round(Vi):Math.round(Vi*100)/100, Vf:tpl.int?Math.round(Vf):Vf, t, dir, p, unit:tpl.unit, dec:tpl.dec, text, int:tpl.int};
  }
}
// === Arrondi + signe "=" / "‚âà" selon si l'affichage est exact ou arrondi
function rto(v, d=2){ return Math.round(v * 10**d) / 10**d; }
function eqSign(exact, shown){ return (Math.abs(exact - shown) < 1e-12) ? '=' : '‚âà'; }

/* ======= Exercice 1 : Vi + %  ‚Üí chercher Vf ======= */
const ex1={
  id:'augdim_vi_vf',
  title:'Exercice 1 ‚Äî Vi et % donn√©s ‚Üí trouver la valeur finale',
  gen(){ return makeContext('vi2vf'); },
  render(host, st){
    const inner = (host.innerHTML='<div class="inner"></div>', host.querySelector('.inner'));
    inner.innerHTML = `
      <div class="consigne">
        <div class="c-label">√ânonc√©</div>
        <div style="font-size:1.05rem">${st.text}</div>
      </div>
      <div class="row">
        <div class="col-label"><strong>R√©ponse (nombre uniquement) :</strong></div>
        <div class="input-line"><input id="ans" type="text" placeholder="ex. 200"></div>
      </div>
      <div id="res" class="res"></div>
    `;
    addTicks(inner);
  },
  correct(host, st){
    const inner = host.querySelector('.inner');
    const v = parseNumberFR($('#ans',inner).value);
    const exp = st.Vf;
    const ok = isFinite(v) && same02(v, exp);
    setTick($('#ans',inner), ok);
    const res=$('#res',inner); res.textContent = ok?'Correct.':'Incorrect.'; res.className='res '+(ok?'res-ok':'res-ko');
    return {ok,total:1};
  },
  solution(host, st){
  const inner = host.querySelector('.inner');
  const sign = st.t >= 0 ? '+' : '‚àí';
  const frac = fracHTML(Math.abs(st.p), '100');

  const cExact = 1 + st.t;           // valeur exacte
  const c02    = rto(cExact, 2);      // valeur affich√©e (2 d√©cimales)

  const viShow = st.int ? Math.round(st.Vi) : rto(st.Vi, 2);
  const vfExact= st.Vi * cExact;
  const vfShow = st.int ? Math.round(vfExact) : rto(vfExact, 2);

  $('#res', inner).innerHTML = `
    <div><em>V</em><sub>i</sub> = ${tidyDecFR(viShow, st.int?0:2)}</div>
    <p>${st.t>=0?'Augmenter':'Diminuer'} de ${st.p}% revient √† multiplier par
       <em>c</em> = 1 ${sign} ${frac} ${eqSign(cExact, c02)} ${tidyDecFR(c02,2)}</p>
    <div><em>V</em><sub>f</sub> = <em>V</em><sub>i</sub> √ó <em>c</em>
       = ${tidyDecFR(viShow, st.int?0:2)} √ó ${tidyDecFR(c02,2)}
       ${eqSign(vfExact, vfShow)} <strong>${tidyDecFR(vfShow, st.int?0:2)}${st.int?' '+st.unit:''}</strong>.</div>
  `;
  $('#res', inner).className = 'res';   // pour un rendu propre des fractions
},
  reset(host){ host.querySelector('.inner').innerHTML=''; }
};

/* ======= Exercice 2 : Vf + % ‚Üí chercher Vi ======= */
const ex2={
  id:'augdim_vf_vi',
  title:'Exercice 2 ‚Äî Vf et % donn√©s ‚Üí retrouver la valeur initiale',
  gen(){ return makeContext('vf2vi'); },
  render(host, st){
    const inner = (host.innerHTML='<div class="inner"></div>', host.querySelector('.inner'));
    inner.innerHTML = `
      <div class="consigne">
        <div class="c-label">√ânonc√©</div>
        <div style="font-size:1.05rem">${st.text}</div>
      </div>
      <div class="row">
        <div class="col-label"><strong>R√©ponse (nombre uniquement) :</strong></div>
        <div class="input-line"><input id="ans2" type="text" placeholder="ex. 350"></div>
      </div>
      <div id="res" class="res"></div>
    `;
    addTicks(inner);
  },
  correct(host, st){
    const inner = host.querySelector('.inner');
    const v = parseNumberFR($('#ans2',inner).value);
    const exp = st.Vi;
    const ok = isFinite(v) && same02(v, exp);
    setTick($('#ans2',inner), ok);
    const res=$('#res',inner); res.textContent = ok?'Correct.' :'Incorrect.'; res.className='res '+(ok?'res-ok':'res-ko');
    return {ok,total:1};
  },
  solution(host, st){
  const inner = host.querySelector('.inner');
  const sign = st.t >= 0 ? '+' : '‚àí';
  const frac = fracHTML(Math.abs(st.p), '100');

  const cExact = 1 + st.t;
  const c02    = rto(cExact, 2);

  const vfShow = st.int ? Math.round(st.Vf) : rto(st.Vf, 2);
  const viExact= st.Vf / cExact;
  const viShow = st.int ? Math.round(viExact) : rto(viExact, 2);

  $('#res', inner).innerHTML = `
    <div><em>V</em><sub>f</sub> = ${tidyDecFR(vfShow, st.int?0:2)}</div>
    <p>${st.t>=0?'Augmenter':'Diminuer'} de ${st.p}% revient √† multiplier par
       <em>c</em> = 1 ${sign} ${frac} ${eqSign(cExact, c02)} ${tidyDecFR(c02,2)}</p>
    <div><em>V</em><sub>i</sub> = ${fracHTML('V<sub>f</sub>','c')}
       = ${fracHTML(tidyDecFR(vfShow, st.int?0:2), tidyDecFR(c02,2))}
       ${eqSign(viExact, viShow)} <strong>${tidyDecFR(viShow, st.int?0:2)}${st.int?' '+st.unit:''}</strong>.</div>
  `;
  $('#res', inner).className = 'res';
},
  reset(host){ host.querySelector('.inner').innerHTML=''; }
};

/* ======= Moteur ======= */
const REGISTRY=[ex1,ex2];
let scoreOK=0, scoreTot=0;
function updateScore(){ $('#score').textContent=`Score : ${scoreOK} / ${scoreTot}`; }
function buildOne(){ const host=$('#host'); const sel=$('#exo-select'); const def=REGISTRY.find(e=>e.id===sel.value); if(!def) return; const st=def.gen(); host.dataset.active=def.id; host.dataset.state=JSON.stringify(st); def.render(host, st); $('#res',host).textContent=''; $('#res',host).className='res'; }
function check(){ const host=$('#host'); const def=REGISTRY.find(e=>e.id===host.dataset.active); if(!def) return; const st=JSON.parse(host.dataset.state||'{}'); const r=def.correct(host, st); if(r){ scoreOK+=(r.ok?1:0); scoreTot+=(r.total||1); updateScore(); } }
function solution(){ const host=$('#host'); const def=REGISTRY.find(e=>e.id===host.dataset.active); if(!def||!def.solution) return; const st=JSON.parse(host.dataset.state||'{}'); def.solution(host, st); }
function resetAll(){ scoreOK=0; scoreTot=0; updateScore(); const host=$('#host'); const def=REGISTRY.find(e=>e.id===host.dataset.active); if(def) def.reset(host); }

document.addEventListener('DOMContentLoaded',()=>{
  const sel=$('#exo-select'); REGISTRY.forEach(e=>{ const o=document.createElement('option'); o.value=e.id; o.textContent=e.title; sel.appendChild(o); });
  sel.addEventListener('change', buildOne);
  $('#btn-new').addEventListener('click', buildOne);
  $('#btn-check').addEventListener('click', check);
  $('#btn-solution').addEventListener('click', solution);
  $('#btn-reset').addEventListener('click', resetAll);
  sel.value=REGISTRY[0].id; buildOne(); updateScore();

  document.addEventListener('keydown', (ev)=>{
    const a=document.activeElement;
    if(a && a.closest('#host') && a.tagName==='INPUT' && ev.key==='Enter'){ ev.preventDefault(); check(); }
  });
});
</script>

</body>
</html>