<!doctype html>
<html lang='fr'>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Seconde ‚Äì √âvolution r√©ciproque</title>

<link rel="stylesheet" href="../../../../css/math-kbd.css">
<link rel="stylesheet" href="../../../../css/espace-gras.css">
<link rel="stylesheet" href="../../../../css/mobile.css">


<style>
*{box-sizing:border-box}
body{font-family:system-ui, Segoe UI, Roboto, Arial; margin:0; background:#fafafa; color:#111; line-height:1.5}
.header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;padding:14px 18px;z-index:5}
.wrap{max-width:1100px;margin:0 auto;padding:18px;display:flex;flex-direction:column;gap:12px}
.card{background:#fff;border:1px solid #e6e6e6;border-radius:12px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
.controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
.controls label{font-weight:600}
select,input[type=text]{padding:8px 10px;border:1px solid #ddd;border-radius:8px;font-size:15px}
.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 10px;border:1px solid #ddd;background:#f7f7f7;border-radius:10px;cursor:pointer;white-space:nowrap}
.btn:hover{background:#efefef}
.score{font-weight:700;white-space:nowrap;margin-left:auto}
.small{font-size:.92rem;color:#666}

.row{ display:grid; grid-template-columns:1fr; grid-template-areas:'lab' 'inp' 'res'; gap:10px; align-items:start; }
.row .col-label{grid-area:lab}
.row .input-line{grid-area:inp}
.row .input-line input[type=text]{width:100%}
.res{grid-area:res; padding:12px;border-radius:10px;background:#f7f7f7}
.res-ok{background:#ecfdf5;border:1px solid #a7f3d0}
.res-ko{background:#fef2f2;border:1px solid #fecaca}

.eq .frac{display:inline-flex;flex-direction:column;align-items:center;vertical-align:middle;line-height:1}
.eq .frac .num,.frac .den{padding:0 .2em;white-space:nowrap}
.eq .frac .bar{border-top:1.6px solid currentColor;align-self:stretch;margin:.06em 0}
/* petit tick apr√®s les champs */
.tick{display:inline-block;min-width:1.2em;margin-left:8px;font-weight:700}
.tick.ok{color:#059669}
.tick.ko{color:#dc2626}

</style>
</head>

<body>
<div class="header">
  <h1 style="margin:0;font-size:1.1rem">Seconde ‚Äì <strong>√âvolution r√©ciproque</strong></h1>
  <div class="wrap" style="padding:0 18px">
    <div class="controls">
      <label for="exo-select">Type d‚Äôexercice :</label>
      <select id="exo-select"></select>
      <button id="btn-new" class="btn">üîÄ Nouvel √©nonc√©</button>
      <button id="btn-check" class="btn">‚úÖ V√©rifier</button>
      <button id="btn-solution" class="btn">üí° Solution</button>
      <button id="btn-reset" class="btn">‚ôªÔ∏è R√©initialiser</button>
      <div class="score" id="score">Score : 0 / 0</div>
    </div>
  </div>
</div>

<div class="wrap">
  <div class="card"><div id="host"></div></div>

  <div class="card small">
    <div><strong>Saisie & r√©ponses accept√©es :</strong></div>
    <ul class="tips">
      <li>D√©cimaux : virgule <em>ou</em> point (ex. <code>0,17</code> ‚Üî <code>0.17</code>).</li>
      <li>Pourcentages : autoris√© avec <code>%</code> (ex. <code>17%</code>).</li>
      <li>Arrondis : taux au <strong>% pr√®s</strong> (√©quivalent √† 0,01 en d√©cimal).</li>
    </ul>
  </div>
    <div class="card"><div data-math-kbd style="display:flex; justify-content:center"></div></div>

</div>
<script src='../../../../js/math-kbd.js' defer></script>

<script>
/* ======= Outils ======= */
const $=(s,r=document)=>r.querySelector(s);
const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
const rnd=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const choice=L=>L[rnd(0,L.length-1)];

const fmtDecFR=(x,d=2)=>String(Math.round(x*10**d)/10**d).replace('.',',');
function tidyDecFR(v,d=2){ let s=fmtDecFR(v,d); if(s.includes(',')) s=s.replace(/0+$/,'').replace(/[,]$/,''); return s; }

const same02=(a,b)=>Math.round(a*100)===Math.round(b*100);   // ~ 1% sur un taux en d√©cimal
const stripU=s=>String(s||'').replace(/‚àí/g,'-');
function parseNumberFR(s){
  s=stripU(String(s||'').trim());
  const m=s.match(/^([-+]?[0-9]+(?:[.,][0-9]+)?)\s*%$/);
  if(m) return parseFloat(m[1].replace(',', '.'))/100;
  return parseFloat(s.replace(',', '.'));
}
function fracHTML(n,d){ return '<span class="frac"><span class="num">'+n+'</span><span class="bar"></span><span class="den">'+d+'</span></span>'; }
function addTicks(host){ $$('#host input[type=text]').forEach(inp=>{ if(!inp.nextElementSibling || !inp.nextElementSibling.classList?.contains('tick')) inp.insertAdjacentHTML('afterend','<span class="tick"></span>'); }); }
function setTick(inp, ok){ const t=inp.nextElementSibling?.classList?.contains('tick')?inp.nextElementSibling:null; if(!t) return; t.textContent=ok===null?'':(ok?'‚úî':'‚úò'); t.className='tick '+(ok?'ok':'ko'); }
// signe "=" ou "‚âà" selon arrondi
function eqSign(exact, shown){ return (Math.abs(exact - shown) < 1e-12) ? '=' : '‚âà'; }
const noun = s => s==='+' ? 'hausse' : 'baisse';
const needed = s => s==='+' ? 'r√©duction' : 'hausse'; // pour revenir √† l'initial
function rto(v,d=2){ return Math.round(v*10**d)/10**d; }

/* ======= Ex. 1 ‚Äî Taux r√©ciproque d‚Äôun pourcentage donn√© ======= */
const ex1={
  id:'taux_recip_simple',
  title:'Exercice 1 ‚Äî D√©terminer un taux d‚Äô√©volution r√©ciproque',
  gen(){
    const s = Math.random()<0.5 ? '+' : '‚àí';   // hausse/baisse
    const p = rnd(5,60);                       // au % pr√®s
    const c  = s==='+' ? 1+p/100 : 1-p/100;
    const cr = 1/c;
    const tr = cr - 1;                         // d√©cimal (signe oppos√©)
    return {s, p, c, cr, tr};
  },
  render(host, st){
    host.innerHTML = `<div class="inner">
      <div class="consigne">
        <div style="font-weight:700">√ânonc√©</div>
        D√©terminer, sous forme de pourcentage, le taux d‚Äô√©volution <em>r√©ciproque</em> d‚Äôune <strong>${noun(st.s)}</strong> de <strong>${st.p}%</strong>.
      </div>
      <div class="row">
        <div class="col-label"><strong>R√©ponse attendue :</strong> le taux r√©ciproque (au % pr√®s)</div>
        <div class="input-line"><input id="t1" type="text" placeholder="ex. 17% ou 0,17"></div>
      </div>
      <div id="res" class="res"></div>
    </div>`;
  },
  correct(host, st){
    const inner=$('.inner',host); addTicks(inner);
    const t = parseNumberFR($('#t1',inner).value);   // d√©cimal accept√©
    const ok = isFinite(t) && same02(t, st.tr);
    setTick($('#t1',inner), ok);
    const res=$('#res',inner); res.textContent = ok ? 'Correct.' : 'Incorrect.'; res.className='res '+(ok?'res-ok':'res-ko');
    return {ok,total:1};
  },
  solution(host, st){
  const inner = $('.inner', host);

  const c1Exact = st.c;                          // 1 ¬± p/100
  const c1Show  = tidyDecFR(c1Exact, 2);

  const c2Exact = 1 / c1Exact;
  const c2Show  = tidyDecFR(rto(c2Exact, 2), 2);

  const tExact  = c2Exact - 1;                   // d√©cimal
  const tDec    = tidyDecFR(rto(tExact, 2), 2);  // ex: ‚àí0,13
  const tPctI   = Math.round(tExact * 100);      // au % pr√®s (entier sign√©)
  const signWord = (st.s === '+') ? 'baisse' : 'hausse';

  $('#res', inner).innerHTML = `
    <div class="eq">
      <div>c<sub>1</sub> = 1 ${st.s==='+'?'+':'‚àí'} ${fracHTML(st.p,'100')} = ${c1Show}</div>
      <div>c<sub>2</sub> = ${fracHTML('1','c<sub>1</sub>')} = ${fracHTML('1', c1Show)} ${eqSign(c2Exact, rto(c2Exact,2))} ${c2Show}</div>
      <div>t<sub>2</sub> = c<sub>2</sub> ‚àí 1 ${eqSign(tExact, rto(tExact,2))} ${tDec} ‚âà ${tPctI}%</div>
      <p>Il faut une <strong>${signWord}</strong> d‚Äôenviron <strong>${Math.abs(tPctI)}%</strong>.</p>
    </div>`;
  $('#res', inner).className = 'res eq';
},

  reset(host){ host.innerHTML=''; }
};

/* ======= Banque 25 contextes (√©nonc√©s r√©alistes) ======= */
function bank25(){
  const B = [
    p => `Le prix de vente d‚Äôun article a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}% lors d‚Äôune op√©ration. Quelle ${needed(p.s)} faut-il appliquer pour revenir au prix initial ?`,
    p => `Le loyer a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}% cette ann√©e. Quelle ${needed(p.s)} est n√©cessaire pour retrouver le loyer de l‚Äôan dernier ?`,
    p => `Le salaire d‚Äôun employ√© a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}% en janvier. Quelle ${needed(p.s)} faudrait-il pour revenir au salaire pr√©c√©dent ?`,
    p => `Le prix d‚Äôun billet de cin√©ma a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} rendre pour retrouver l‚Äôancien tarif ?`,
    p => `Le prix d‚Äôun ordinateur a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} faut-il pour revenir au prix d‚Äôavant ?`,
    p => `Le prix d‚Äôun livre scolaire a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} appliquer pour retrouver le prix initial ?`,
    p => `Le tarif d‚Äôun abonnement a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} permet de revenir au tarif initial ?`,
    p => `Le prix d‚Äôun smartphone a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}% pendant les soldes. Quelle ${needed(p.s)} pour retrouver le prix d‚Äôavant ?`,
    p => `Le co√ªt d‚Äôun trajet en train a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} est n√©cessaire pour revenir √† l‚Äôancien co√ªt ?`,
    p => `Le prix d‚Äôun panier de courses a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} faut-il pour retrouver le prix initial ?`,
    p => `Le tarif horaire d‚Äôun artisan a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} pour revenir √† l‚Äôancien tarif ?`,
    p => `Le prix d‚Äôune place de spectacle a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} faut-il pour revenir au prix de d√©part ?`,
    p => `Le prix d‚Äôun caf√© au comptoir a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} pour retrouver l‚Äôancien prix ?`,
    p => `Le prix d‚Äôun menu au restaurant a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} appliquer pour revenir au prix initial ?`,
    p => `Le prix du ticket de bus a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} faut-il pour retrouver l‚Äôancien prix ?`,
    p => `Le prix d‚Äôune paire de chaussures a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} appliquer pour revenir au prix avant promo ?`,
    p => `Le prix d‚Äôune bicyclette a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} pour retrouver le prix initial ?`,
    p => `Le prix d‚Äôun sac √† dos a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} pour revenir au prix d‚Äôorigine ?`,
    p => `Le prix d‚Äôune console de jeux a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} faut-il pour revenir au prix initial ?`,
    p => `Le prix d‚Äôune imprimante a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} appliquer pour retrouver l‚Äôancien prix ?`,
    p => `Le prix d‚Äôune chaise de bureau a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} faut-il pour revenir au prix d‚Äôorigine ?`,
    p => `Le prix d‚Äôune lampe de chevet a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} pour retrouver le prix initial ?`,
    p => `Le prix d‚Äôune trottinette a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} appliquer pour revenir au prix initial ?`,
    p => `Le prix d‚Äôun casque audio a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} faut-il pour retrouver le prix de d√©part ?`,
    p => `Le prix d‚Äôun sac de sport a ${p.s==='+'?'augment√©':'diminu√©'} de ${p.p}%. Quelle ${needed(p.s)} permet de revenir au prix initial ?`,
  ];
  return B;
}

/* ======= Ex. 2 ‚Äî Taux r√©ciproque dans un contexte ======= */
const ex2={
  id:'taux_recip_contexte',
  title:'Exercice 2 ‚Äî √âvolution r√©ciproque en contexte (banque de 25)',
  gen(){
    const s = Math.random()<0.5 ? '+' : '‚àí';   // hausse/baisse
    const p = rnd(5,60);                       // au % pr√®s
    const c  = s==='+' ? 1+p/100 : 1-p/100;
    const cr = 1/c;
    const tr = cr - 1;                         // d√©cimal
    const ctx = choice(bank25());
    return {s,p,c,cr,tr, ctxText: ctx({s,p})};
  },
  render(host, st){
    host.innerHTML = `<div class="inner">
      <div class="consigne">
        <div style="font-weight:700">√ânonc√©</div>
        ${st.ctxText}
      </div>
      <div class="row">
        <div class="col-label"><strong>R√©ponse attendue :</strong> le taux r√©ciproque (au % pr√®s)</div>
        <div class="input-line"><input id="t2" type="text" placeholder="ex. 17% ou 0,17"></div>
      </div>
      <div id="res" class="res"></div>
    </div>`;
  },
  correct(host, st){
    const inner=$('.inner',host); addTicks(inner);
    const t = parseNumberFR($('#t2',inner).value);
    const ok = isFinite(t) && same02(t, st.tr);
    setTick($('#t2',inner), ok);
    const res=$('#res',inner); res.textContent = ok ? 'Correct.' : 'Incorrect.'; res.className='res '+(ok?'res-ok':'res-ko');
    return {ok,total:1};
  },
  solution(host, st){
  const inner = $('.inner', host);

  const c1Exact = st.c;                          // 1 ¬± p/100
  const c1Show  = tidyDecFR(c1Exact, 2);

  const c2Exact = 1 / c1Exact;
  const c2Show  = tidyDecFR(rto(c2Exact, 2), 2);

  const tExact  = c2Exact - 1;
  const tDec    = tidyDecFR(rto(tExact, 2), 2);
  const tPctI   = Math.round(tExact * 100);
  const signWord = (st.s === '+') ? 'baisse' : 'hausse';

  $('#res', inner).innerHTML = `
    <div class="eq">
      <div>c<sub>1</sub> = 1 ${st.s==='+'?'+':'‚àí'} ${fracHTML(st.p,'100')} = ${c1Show}</div>
      <div>c<sub>2</sub> = ${fracHTML('1','c<sub>1</sub>')} = ${fracHTML('1', c1Show)} ${eqSign(c2Exact, rto(c2Exact,2))} ${c2Show}</div>
      <div>t<sub>2</sub> = c<sub>2</sub> ‚àí 1 ${eqSign(tExact, rto(tExact,2))} ${tDec} ‚âà ${tPctI}%</div>
      <p>Il faut donc une <strong>${signWord}</strong> d‚Äôenviron <strong>${Math.abs(tPctI)}%</strong> pour revenir √† la valeur initiale.</p>
    </div>`;
  $('#res', inner).className = 'res eq';
},

  reset(host){ host.innerHTML=''; }
};

/* ======= Moteur ======= */
const REGISTRY=[ex1, ex2];
window.REGISTRY = REGISTRY; // requis par le g√©n√©rateur PDF
let scoreOK=0, scoreTot=0;
function updateScore(){ $('#score').textContent=`Score : ${scoreOK} / ${scoreTot}`; }
function buildOne(){
  const host=$('#host'); const sel=$('#exo-select');
  const def=REGISTRY.find(e=>e.id===sel.value); if(!def) return;
  const st=def.gen(); host.dataset.active=def.id; host.dataset.state=JSON.stringify(st);
  def.render(host, st); $('#res',host)?.classList?.remove('res-ok','res-ko');
}
function check(){
  const host=$('#host'); const def=REGISTRY.find(e=>e.id===host.dataset.active); if(!def) return;
  const st=JSON.parse(host.dataset.state||'{}'); const r=def.correct(host, st);
  if(r){ scoreOK+=(r.ok?1:0); scoreTot+=(r.total||1); updateScore(); }
}
function solution(){
  const host=$('#host'); const def=REGISTRY.find(e=>e.id===host.dataset.active); if(!def||!def.solution) return;
  const st=JSON.parse(host.dataset.state||'{}'); def.solution(host, st);
}
function resetAll(){ scoreOK=0; scoreTot=0; updateScore(); const host=$('#host'); const def=REGISTRY.find(e=>e.id===host.dataset.active); if(def) def.reset(host); }

document.addEventListener('DOMContentLoaded',()=>{
  const sel=$('#exo-select'); REGISTRY.forEach(e=>{ const o=document.createElement('option'); o.value=e.id; o.textContent=e.title; sel.appendChild(o); });
  sel.addEventListener('change', buildOne);
  $('#btn-new').addEventListener('click', buildOne);
  $('#btn-check').addEventListener('click', check);
  $('#btn-solution').addEventListener('click', solution);
  $('#btn-reset').addEventListener('click', resetAll);
  sel.value=REGISTRY[0].id; buildOne(); updateScore();

  // Enter = V√©rifier
  document.addEventListener('keydown', ev=>{
    const a=document.activeElement;
    if(a && a.closest('#host') && a.tagName==='INPUT' && ev.key==='Enter'){ ev.preventDefault(); check(); }
  });
});
</script>

<!-- G√©n√©rateur PDF -->
<script src='../../../../js/exo-pdf-kit.multiplicatif.js' defer></script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  if (window.ExoPDF) {
    ExoPDF.init({
      title: (document.title || 'Fiche d‚Äôexercices').replace(/\s+‚Äì.+$/, '').trim(),
      mountAfterSelector: '.wrap .card.small', // sous ¬´ Saisie & r√©ponses accept√©es ¬ª
      max: 50
      // On laisse le fallback du kit : rendu offscreen propre + extraction de #res pour la correction.
    });
  } else {
    console.warn('ExoPDF non charg√©');
  }
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const coarse = matchMedia('(pointer:coarse)').matches;

  // 1) Barre d‚Äôactions mobile (clones des boutons existants)
  if (window.innerWidth <= 760) {
    const actions = document.querySelector('.controls') || document.querySelector('.header .controls');
    if (actions) {
      const bar = document.createElement('div');
      bar.className = 'mb-actions';
      // Boutons bas = miroirs des originaux (on d√©clenche .click() sur eux)
[['#btn-check','V√©rifier'], ['#btn-solution','Solution']].forEach(([sel,label])=>{
  const src = document.querySelector(sel);
  if (src) {
    const clone = src.cloneNode(true);
    clone.classList.add('btn');
    clone.type = 'button';
    clone.removeAttribute('id');        // id doit rester unique
    clone.addEventListener('click', (e)=>{ e.preventDefault(); src.click(); });
    bar.appendChild(clone);
  } else {
    // fallback si jamais l‚Äôoriginal est absent (rare)
    const fallback = document.createElement('button');
    fallback.className = 'btn';
    fallback.type = 'button';
    fallback.textContent = label;
    fallback.addEventListener('click', (e)=>{ e.preventDefault(); document.querySelector(sel)?.click(); });
    bar.appendChild(fallback);
  }
});
      document.body.appendChild(bar);
    }
  }

  // 2) Clavier math repliable (si pr√©sent)
  const kbdHost = document.querySelector('[data-math-kbd]')?.closest('.kbd-host');
  if (kbdHost && window.innerWidth <= 760) {
    kbdHost.setAttribute('data-collapsible','');
    const tg = document.createElement('button');
    tg.className='kbd-toggle'; tg.type='button';
    tg.textContent='Clavier math';
    tg.addEventListener('click',()=>kbdHost.setAttribute('data-open', kbdHost.getAttribute('data-open')==='1'?'0':'1'));
    document.body.appendChild(tg);
  }

  // 3) Confort de saisie
  document.querySelectorAll('input[type="text"], textarea').forEach(el=>{
    el.setAttribute('autocomplete','off');
    el.setAttribute('autocapitalize','off');
    el.setAttribute('autocorrect','off');
    el.setAttribute('spellcheck','false');
    // Scroll au centre quand le clavier s‚Äôouvre
    el.addEventListener('focus', ()=>{ setTimeout(()=>el.scrollIntoView({block:'center', behavior:'smooth'}), 50); }, {passive:true});
  });

  // 4) Points √† d√©placer : rayon + touche
  if (coarse) {
    document.querySelectorAll('circle[data-draggable], .pt, .drag-point').forEach(c=>{
      const r = parseFloat(c.getAttribute('r')||'5');
      if (r < 10) c.setAttribute('r', String(12));
      c.style.touchAction='none';
    });
  }
}, {passive:true});
</script>
</body>
</html>