<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Python ‚Äî Fonctions ‚Äì Exemples</title>

<!-- m√™mes feuilles que ton mod√®le -->
<link rel="stylesheet" href="../../../../css/math-kbd.css">
<link rel="stylesheet" href="../../../../css/espace-gras.css">
<link rel="stylesheet" href="../../../../css/espace-latex.css">
<link rel="stylesheet" href="../../../../css/mobile.css">

<style>
*{box-sizing:border-box}
body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:0;background:#fafafa;color:#111;line-height:1.5}
.header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;padding:14px 18px;z-index:5}
.wrap{max-width:1200px;margin:0 auto;padding:18px;display:flex;flex-direction:column;gap:12px}
.card{background:#fff;border:1px solid #e6e6e6;border-radius:12px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
.controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
.controls .btn{border:1px solid #ccc;background:#fff;border-radius:8px;padding:.45rem .7rem;cursor:pointer}
.controls select{border:1px solid #ccc;border-radius:8px;padding:.45rem .55rem}
.controls .btn:active{transform:translateY(1px)}
.controls .score{margin-left:auto;font-weight:700}
.small{font-size:.92rem;color:#555}

.row{display:grid;grid-template-columns:1fr 1fr;gap:14px;align-items:start}
.row.norepere{grid-template-columns:1fr}
.hint{color:#444;font-style:italic;margin:.25rem 0}
.steps{margin:.45rem 0 0 .15rem;padding:.6rem .7rem;background:#f6f6f6;border:1px dashed #e3e3e3;border-radius:8px}
.step{margin:.25rem 0}

.kbd{padding:.06rem .35rem;border:1px solid #ccc;border-radius:6px;background:#fff}
.tick{display:none;margin-left:.35rem;font-weight:700}
.tick.ok{color:#11823b;display:inline}
.tick.ko{color:#b00020;display:inline}

.tbl{border-collapse:collapse}
.tbl td,.tbl th{border:1px solid #ddd;padding:6px 8px;text-align:center}

/* Lignes de r√©ponse imprimables */
.blank-wrap{ display:inline-block; vertical-align:baseline }
.blank-wrap .blank{ display:none; height:1.4em; border-bottom:2px solid #000; vertical-align:baseline; }
@media print{
  .controls,.header,.kbd-host,.hide-print{display:none!important}
  .card{box-shadow:none}
  .blank-wrap input{ display:none !important; }
  .blank-wrap .blank{ display:inline-block !important; }
}
</style>

<!-- MathJax identique -->
<script>
window.MathJax = {
  tex: { inlineMath: [['\\(','\\)'], ['$', '$']], displayMath: [['\\[','\\]'], ['$$','$$']], processEscapes: true },
  chtml: { matchFontHeight:false }, startup: { typeset: true }
};
</script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

<!-- libs partag√©es -->
<script src='../../../../js/algebra-eval-patch.multiplicatif.js' defer></script>
</head>
<body>
  <div class="header">
    <h1 style="margin:0;font-size:1.1rem">Python ‚Äî Fonctions ‚Äì Exemples</h1>
  </div>

  <div class="wrap">
    <!-- Barre de contr√¥le -->
    <div class="controls card">
      <label for="exo-select"><strong>Type d‚Äôexercice :</strong></label>
      <select id="exo-select"></select>
      <button id="btn-new" class="btn">üîÑ Nouvel √©nonc√©</button>
      <button id="btn-check" class="btn">‚úÖ V√©rifier</button>
      <button id="btn-sol" class="btn">üí° Solution</button>
      <button id="btn-reset" class="btn">üßπ R√©initialiser</button>
      <div class="score" id="score">Score : 0 / 0</div>
    </div>

    <!-- H√¥te -->
    <div id="host" class="card" data-active="" data-state=""></div>

    <!-- Saisie & r√©ponses accept√©es -->

  </div>

<script>
(function(){
"use strict";

/* ====== Utilitaires ====== */
function $(s,root){return (root||document).querySelector(s)}
function $all(s,root){return Array.from((root||document).querySelectorAll(s))}
function rint(a,b){return a+Math.floor(Math.random()*(b-a+1))}
function choice(A){return A[Math.floor(Math.random()*A.length)]}
function near(a,b,eps){return Math.abs(a-b)<= (eps||1e-9)}
function parseNumber(s){
  if(s==null) return NaN;
  s = (''+s).trim().replace(',', '.');
  if(/^[-+]?(\d+(\.\d+)?|\.\d+)$/.test(s)) return +s;
  return NaN;
}
function retypeMath(scope){ if(window.MathJax?.typesetPromise) MathJax.typesetPromise([scope||document]) }
function mkInput(id,w){ return `<span class="blank-wrap"><input id="${id}" style="width:${w||110}px;font-size:15px;padding:6px;border:1px solid #ddd;border-radius:8px"> <span class="blank" style="width:${(w||110)-14}px"></span></span>` }
function tickTri(el, state){
  if(!el) return;
  el.classList.remove('ok','ko');
  if(state===true){ el.classList.add('ok'); el.textContent='‚úì'; }
  else if(state===false){ el.classList.add('ko'); el.textContent='‚úó'; }
  else el.textContent='';
}
function scoreSet(a,b){ const s=$("#score"); if(s) s.textContent=`Score : ${a} / ${b}` }
let SCORE=[0,0];
function normPy(s){
  return (''+s).toLowerCase()
    .replace(/[ \t]/g,'')
    .replace(/[‚àí‚Äì‚Äî]/g,'-')
    .replace(/\u00A0/g,'')
    .replace(/;+$/,''); // ; facultatif
}
function normRelation(str){
  if(str==null) return '';
  let s=(''+str).toLowerCase().replace(/\s+/g,'');
  s=s.replace(/[‚àí‚Äì‚Äî]/g,'-');
  s=s.replace(/u\(([^)]+)\)/g,'u_{$1}').replace(/u_\(([^)]+)\)/,'u_{$1}').replace(/u_\{([^}]+)\)/g,'u_{$1}');
  s=s.replace(/u_\{([a-z])\}/g,'u_$1').replace(/\{(\d+)\}/g,'$1');
  return s;
}
function fmtPt(P){ return `\\((${P[0]}  ;  ${P[1]})\\)`; }  // (x ; y)
function hasBothTF(arr){ return arr.some(Boolean) && arr.some(x=>!x); }

// Normalise un texte "appel de fonction" (retire espaces, minuscule, virgules homog√®nes)
function normCall(s){
  return (''+s).trim()
    .toLowerCase()
    .replace(/\s+/g,'')       // supprime espaces
    .replace(/[,;]+/g,',');   // ; ‚Üí , par s√©curit√©
}
// Tick helper concis
function setTick(host, sel, state){
  const el=$(sel,host); if(!el) return;
  el.classList.remove('ok','ko');
  if(state===true){ el.classList.add('ok'); el.textContent='‚úì'; }
  else if(state===false){ el.classList.add('ko'); el.textContent='‚úó'; }
  else el.textContent='';
}
// Nombre tol√©rant
function chkNumById(id, target, tickSel, host, eps=1e-6){
  const raw=(document.getElementById(id)?.value||'').trim();
  const ok = raw==='' ? null : near(parseNumber(raw), target, eps);
  setTick(host, tickSel, ok);
  return ok;
}

/* ====== REGISTRY ====== */
function makeExos(){
  const L=[];

/* ============= C1 ‚Äî SOLDES ============= */
L.push({
  id:'C1_soldes',
  title:'C1 ‚Äî Soldes : fonction sans input',
// remplace gen() dans C1_soldes
gen(){
  // prix entiers multiples de 5 entre 20 et 80
  const P = a => 5*Math.floor(rint(a/5, 80/5));
  const q1_price = P(20);
  const q1_t = choice([10,15,20,25,30,40,50]);     // %
  const q2_price = P(30);
  const q2_t = choice([10,20,30,40,50,60,70]);     // %
  return {
    q1_price, q1_t, q2_price, q2_t,
    code:
`def solde(prix, t):
    p = prix * (1 - t/100)
    return p`
  };
},

  render(host,s){
    host.innerHTML = `
      <div class="row norepere">
        <div class="statement">
          <p><strong>Exercice C1 </strong>En pr√©vision des soldes, un commer√ßant s'appr√™te √† modifier ses √©tiquettes.</p>
          <ol>
            <li>Quel est le prix d‚Äôun article qui co√ªtait <b>${s.q1_price}‚Ç¨</b> sold√© √† <b>${s.q1_t}%</b> ?
              ${mkInput('c1a',120)} <span id="tc1a" class="tick"></span></li>
            <li>On d√©finit la fonction Python ci-dessous (sans saisie) :
<pre><code>${s.code}</code></pre>
              a) Que repr√©sente la variable <code>t</code> ? ${mkInput('c1b',260)} <span id="tc1b" class="tick"></span><br>
              b) Que doit saisir le commer√ßant dans la console de Python pour obtenir le prix d'un article qui co√ªte <b>${s.q2_price}‚Ç¨</b> et qui est sold√© √† <b>${s.q2_t}%</b> ? ${mkInput('c1c',200)} <span id="tc1c" class="tick"></span> <br>
			  c) Quel est le prix de l'article sold√© ?  ${mkInput('c1d',200)} <span id="tc1d" class="tick"></span>
            </li>
          </ol>
        </div>
        <div><div id="steps" class="steps"></div></div>
      </div>`;
    host.__state=s; retypeMath(host);
  },
check(host){
  const s = host.__state;

  // --- helpers locaux ---
  const strip = (txt)=> (txt||'')
    .toString()
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'') // retire accents
    .toLowerCase();

  const normCall = (txt)=> strip(txt)
    .replace(/\s+/g,'')     // supprime espaces
    .replace(/[,;]+/g,','); // ; -> ,

  const setTick = (sel, state)=>{
    const el = $(sel,host); if(!el) return;
    el.classList.remove('ok','ko');
    if(state===true){ el.classList.add('ok'); el.textContent='‚úì'; }
    else if(state===false){ el.classList.add('ko'); el.textContent='‚úó'; }
    else el.textContent='';
  };

  const chkNum = (id, target, tickSel, eps=1e-6)=>{
    const raw = (document.getElementById(id)?.value||'').trim();
    const ok = raw==='' ? null : near(parseNumber(raw), target, eps);
    setTick(tickSel, ok);
    return ok;
  };

  // Q1) Prix sold√© pour q1
  const expectedQ1 = s.q1_price * (1 - s.q1_t/100);
  const ok1 = chkNum('c1a', expectedQ1, '#tc1a');

  // 2a) "t" repr√©sente ?  (taux / √©volution / r√©duction)
  const a_raw = document.getElementById('c1b')?.value || '';
  const a_txt = strip(a_raw);
  const ok2a = a_txt.trim()==='' ? null
             : /(taux|evolution|reduction)s?/.test(a_txt);
  setTick('#tc1b', ok2a);

  // 2b) appel de fonction pour q2 : solde(q2_price, q2_t)
  const b_raw = document.getElementById('c1c')?.value || '';
  const b_call = normCall(b_raw);
  const expectedCall = `solde(${s.q2_price},${s.q2_t})`;
  const ok2b = b_call==='' ? null : (b_call === expectedCall);
  setTick('#tc1c', ok2b);

  // 2c) r√©sultat num√©rique pour q2
  const expectedQ2 = s.q2_price * (1 - s.q2_t/100);
  const ok2c = chkNum('c1d', expectedQ2, '#tc1d');

  const list = [ok1, ok2a, ok2b, ok2c];
  const filled = list.every(x=>x!==null);
  const allOk  = list.every(x=>x===true);
  if(filled){ SCORE[1]++; if(allOk) SCORE[0]++; scoreSet(...SCORE); }
  return filled && allOk;
},



solution(host){
  const s = host.__state, W = $('#steps', host);

  // 1) Le code de la fonction SEULE (sans input, sans tests)
  const code = s.code;

  // 2) Pr√©remplissage console : uniquement la fonction
  host.__solutionPython = code;
  host.dataset.hasSolution = '1';

  // 3) Exemples de tests affich√©s √† part (en dehors du bloc code)
  const tests =
`solde(${s.q1_price}, ${s.q1_t}) = ${s.q1_price*(1 - s.q1_t/100)}
solde(${s.q2_price}, ${s.q2_t}) = ${s.q2_price*(1 - s.q2_t/100)}`;

  // 4) Rendu
  W.innerHTML = `
    <pre><code>${code}</code></pre>
	<div class="step">b) La variable t repr√©sente le taux d'√©volution (ici une diminution).</div>
    <div class="step">a), c) et d) :</div>
    <pre><code>${tests}</code></pre>
  `;
}

});

/* ============= C2 ‚Äî PRIX PARC ============= */
L.push({
  id:'C2_parc',
  title:'C2 ‚Äî Prix d‚Äôun groupe (fonction)',
gen(){
  // Tarifs al√©atoires (adulte 30‚Äì45 ‚Ç¨, enfant 20‚Äì35 ‚Ç¨)
  const tarifA = rint(30, 45);
  const tarifE = rint(20, 35);

  // 4 cas al√©atoires (1‚Äì6 adultes, 0‚Äì6 enfants)
  const mk = ()=>({A:rint(1,6), E:rint(0,6)});
  const cases = [mk(), mk(), mk(), mk()];

  // fonction total
  const total = c => tarifA*c.A + tarifE*c.E;

  // texte du code Python avec les bons tarifs
  const code = 
`def prix_parc(adultes, enfants):
    return ${tarifA}*adultes + ${tarifE}*enfants`;

  return {tarifA, tarifE, cases, total: cases.map(total), code};
},

  render(host,s){
    const rows = s.cases.map((c,i)=>`
      <tr><td>${c.A}</td><td>${c.E}</td>
          <td>${mkInput('c2t'+i,100)} <span id="tc2t${i}" class="tick"></span></td></tr>`).join('');
    host.innerHTML=`
      <div class="row norepere">
        <div class="statement">
          <p><strong>Exercice C2 </strong>Le prix de l'entr√©e dans un parc aquatique est ${s.tarifA}‚Ç¨ pour un adulte et ${s.tarifE}‚Ç¨ pour un enfant.</p>
<p>1) Programmer une fonction prix_parc dont les arguments sont le nombre d'adultes et le nombres d'enfants d'un groupe et qui retourne le prix pay√© par le groupe.</p>
          <p>2) Tester la fonction avec :</p>
          <table class="tbl">
            <tr><th>Adultes</th><th>Enfants</th><th>Total</th></tr>${rows}
          </table>
        </div><div><div id="steps" class="steps"></div></div>
      </div>`;
    host.__state=s; retypeMath(host);
  },
check(host){
  const s=host.__state; let filled=true, allOk=true;
  s.total.forEach((T,i)=>{
    const v=(document.getElementById('c2t'+i)?.value||'').trim();
    const ok = v==='' ? null : near(parseNumber(v), T, 1e-9);
    setTick(host, '#tc2t'+i, ok);
    if(ok===null) filled=false; else if(!ok) allOk=false;
  });
  if(filled){ SCORE[1]++; if(allOk) SCORE[0]++; scoreSet(...SCORE); }
  return filled && allOk;
},

  solution(host){
    const s=host.__state, W=$('#steps',host);
    host.__solutionPython = s.code; host.dataset.hasSolution='1';
    const lines = s.cases.map((c,i)=>`prix_parc(${c.A}, ${c.E}) = ${s.total[i]}`).join('\n');
    W.innerHTML = `<pre><code>${s.code}

# Tests
${lines}</code></pre>`;
  }
});


/* ============= C3 ‚Äî VOLUME PYRAMIDE ============= */
L.push({
  id:'C3_pyramide',
  title:'C3 ‚Äî Volume d‚Äôune pyramide',
// remplace gen() dans C3_pyramide
gen(){
  // 3 tests al√©atoires ; au moins un volume non entier la plupart du temps
  const mk = ()=>({L:rint(2,12), l:rint(2,12), h:rint(2,10)});
  const tests=[mk(), mk(), mk()];
  const vol = t => (t.L*t.l*t.h)/3;
  return {
    tests,
    vols: tests.map(vol),
    code:
`def vol_pyr(base, h):
    return (base*h)/3

def vol_pyr_rect(L, l, h):
    base = L*l
    return vol_pyr(base, h)`
  };
},

  render(host,s){
    const rows=s.tests.map((t,i)=>`
      <tr><td>${t.L}</td><td>${t.l}</td><td>${t.h}</td>
          <td>${mkInput('c3v'+i,120)} <span id="tc3v${i}" class="tick"></span></td></tr>`).join('');
    host.innerHTML=`
      <div class="row norepere"><div class="statement">
        <p><strong>Exercice C3 </strong>On rappelle que le volume d‚Äôune pyramide est donn√© par la formule : \\(V=\\dfrac13\\,base\\times h\\).</p>
<p>1) Ecrire une fonction vol_pyr qui retourne le volume d'une pyramide dont on connait l'aire de la base et la hauteur.</p>
     <p>2) Ecrire, en faisant appel √† la fonction vol_pyr, le programme de  la fonction vol_pyr_rect qui calcule le volume d'une pyramide √† base rectangulaire √† partir de la largeur l et de la longueur L de sa base ainsi que sa hauteur.</p>
   
		
		<table class="tbl">
          <tr><th>Longueur L</th><th>Largeur l</th><th>Hauteur h</th><th>Volume</th></tr>
          ${rows}
        </table>
      </div><div><div id="steps" class="steps"></div></div></div>`;
    host.__state=s; retypeMath(host);
  },
check(host){
  const s=host.__state; let filled=true, allOk=true;
  s.vols.forEach((V,i)=>{
    const v=(document.getElementById('c3v'+i)?.value||'').trim();
    const ok = v==='' ? null : near(parseNumber(v), V, 1e-6);
    setTick(host, '#tc3v'+i, ok);
    if(ok===null) filled=false; else if(!ok) allOk=false;
  });
  if(filled){ SCORE[1]++; if(allOk) SCORE[0]++; scoreSet(...SCORE); }
  return filled && allOk;
},

  solution(host){
    const s=host.__state, W=$('#steps',host);
    host.__solutionPython = s.code; host.dataset.hasSolution='1';
    const lines = s.tests.map((t,i)=>`vol_pyr_rect(${t.L}, ${t.l}, ${t.h}) = ${s.vols[i]}`).join('\n');
    W.innerHTML = `<pre><code>${s.code}

# Tests
${lines}</code></pre>`;
  }
});


/* ============= C4 ‚Äî MILIEU & PARALL√âLOGRAMME ============= */
L.push({
  id:'C4_milieu_para',
  title:'C4 ‚Äî Milieu & parall√©logramme',
// remplace gen() dans C4_milieu_para
gen(){
  function vadd(P,Q){ return [P[0]+Q[0], P[1]+Q[1]]; }
  function milieu(A,B){ return [(A[0]+B[0])/2,(A[1]+B[1])/2]; }
  function mkPara(){
    const A=[rint(-5,5), rint(-5,5)];
    const u=[rint(-4,4)||2, rint(-4,4)||1];
    const v=[rint(-4,4)||-1, rint(-4,4)||2];
    const B=vadd(A,u), D=vadd(A,v), C=vadd(B,v);
    return {A,B,C,D};
  }
  function mkNonPara(){
    const T = mkPara();
    // on d√©cale un sommet pour casser l‚Äô√©galit√© des milieux
    T.D = vadd(T.D, [rint(1,3), rint(-3,-1)]);
    return T;
  }

  let cases, res;
  do{
    cases = [ Math.random()<.5?mkPara():mkNonPara(),
              Math.random()<.5?mkPara():mkNonPara(),
              Math.random()<.5?mkPara():mkNonPara() ];
    res = cases.map(t => JSON.stringify(milieu(t.A,t.C))===JSON.stringify(milieu(t.B,t.D)));
  }while(!hasBothTF(res));

  return {
    cases, res,
    code:
`def milieu(xA,yA,xB,yB):
    xM = (xA + xB)/2
    yM = (yA + yB)/2
    return (xM, yM)

def parallelogramme(xA,yA,xB,yB,xC,yC,xD,yD):
    return milieu(xA,yA,xC,yC)==milieu(xB,yB,xD,yD)`
  };
},

  render(host,s){
    const rows = s.cases.map((t,i)=>`
  <tr>
    <td>${fmtPt(t.A)}</td>
    <td>${fmtPt(t.B)}</td>
    <td>${fmtPt(t.C)}</td>
    <td>${fmtPt(t.D)}</td>
    <td>${mkInput('c4'+i,90)} <span id="tc4${i}" class="tick"></span></td>
  </tr>`).join('');

    host.innerHTML=`
      <div class="row norepere"><div class="statement">
        <p><strong>Exercice C4</strong></p>
		
<p>1) Ecrire la fonction milieu qui retourne les coordonn√©es du milieu \\(M\\) du segment \\([AB]\\).</p>
     <p>2) Ecrire, en faisant appel √† la fonction milieu, le programme de la fonction parallelogramme pour qu'elle indique si \\(ABCD\\) est un parall√©logramme.</p>
       <p>3) Tester ce programme :</p>   
		  <table class="tbl">
          <tr><th>A</th><th>B</th><th>C</th><th>D</th><th>Parall√©logramme ? (True/False)</th></tr>
          ${rows}
        </table>
      </div><div><div id="steps" class="steps"></div></div></div>`;
    host.__state=s;
  },
check(host){
  const s=host.__state; let filled=true, allOk=true;
  s.res.forEach((R,i)=>{
    const raw=(document.getElementById('c4'+i)?.value||'').trim().toLowerCase();
    const ok = raw==='' ? null
            : ( (R && (raw==='true'||raw==='vrai'||raw==='oui'))
             || (!R && (raw==='false'||raw==='faux'||raw==='non')) );
    setTick(host, '#tc4'+i, ok);
    if(ok===null) filled=false; else if(!ok) allOk=false;
  });
  if(filled){ SCORE[1]++; if(allOk) SCORE[0]++; scoreSet(...SCORE); }
  return filled && allOk;
},

  solution(host){
    const s=host.__state, W=$('#steps',host);
    host.__solutionPython = s.code; host.dataset.hasSolution='1';
const lines = s.cases.map((t,i) =>
  `parallelogramme(${t.A[0]}, ${t.A[1]}, ${t.B[0]}, ${t.B[1]}, ${t.C[0]}, ${t.C[1]}, ${t.D[0]}, ${t.D[1]}) = ${s.res[i]}`
).join('\n');
    W.innerHTML = `<pre><code>${s.code}

# Tests
${lines}</code></pre>`;
  }
});


/* ============= C5 ‚Äî DISTANCE & M√âDIATRICE ============= */
L.push({
  id:'C5_distance_mediatrice',
  title:'C5 ‚Äî Distance et m√©diatrice',
  // remplace gen() dans C5_distance_mediatrice
gen(){
  const dist=(A,B)=>Math.hypot(B[0]-A[0], B[1]-A[1]);

  function trueCase(){
    const A=[rint(-6,6), rint(-6,6)], B=[rint(-6,6), rint(-6,6)];
    const M=[(A[0]+B[0])/2, (A[1]+B[1])/2];
    return {M,A,B};
  }
  function falseCase(){
    const A=[rint(-6,6), rint(-6,6)], B=[rint(-6,6), rint(-6,6)];
    const M=[(A[0]+B[0])/2 + rint(1,3), (A[1]+B[1])/2 + rint(-3,-1)];
    return {M,A,B};
  }

  let cases, res;
  do{
    cases = [ Math.random()<.5?trueCase():falseCase(),
              Math.random()<.5?trueCase():falseCase(),
              Math.random()<.5?trueCase():falseCase() ];
    res = cases.map(t => Math.abs(dist(t.M,t.A)-dist(t.M,t.B))<1e-9);
  }while(!hasBothTF(res));

  return {
    cases, res,
    code:
`from math import sqrt

def distance(xA,yA,xB,yB):
    return sqrt((xB-xA)**2 + (yB-yA)**2)

def mediatrice(xM,yM,xA,yA,xB,yB):
    return distance(xM,yM,xA,yA)==distance(xM,yM,xB,yB)`
  };
},


  render(host,s){
    const rows = s.cases.map((t,i)=>`
  <tr>
    <td>${fmtPt(t.M)}</td>
    <td>${fmtPt(t.A)}</td>
    <td>${fmtPt(t.B)}</td>
    <td>${mkInput('c5'+i,90)} <span id="tc5${i}" class="tick"></span></td>
  </tr>`).join('');

    host.innerHTML=`
      <div class="row norepere"><div class="statement">
        <p><strong>Exercice C5</strong></p>
<p>1) Ecrire la fonction distance qui retourne la distance \\(AB\\).</p>
     <p>2) Ecrire, en faisant appel √† la fonction distance, le programme de la fonction mediatrice qui indique si M est sur la m√©diatrice du segment \\([AB]\\).</p>
       <p>3) Tester ce programme :</p>   
        <table class="tbl">
          <tr><th>M</th><th>A</th><th>B</th><th>M sur la m√©diatrice ? (True/False)</th></tr>
          ${rows}
        </table>
      </div><div><div id="steps" class="steps"></div></div></div>`;
    host.__state=s;
  },
check(host){
  const s=host.__state; let filled=true, allOk=true;
  s.res.forEach((R,i)=>{
    const raw=(document.getElementById('c5'+i)?.value||'').trim().toLowerCase();
    const ok = raw==='' ? null
            : ( (R && (raw==='true'||raw==='vrai'||raw==='oui'))
             || (!R && (raw==='false'||raw==='faux'||raw==='non')) );
    setTick(host, '#tc5'+i, ok);
    if(ok===null) filled=false; else if(!ok) allOk=false;
  });
  if(filled){ SCORE[1]++; if(allOk) SCORE[0]++; scoreSet(...SCORE); }
  return filled && allOk;
},

  solution(host){
    const s=host.__state, W=$('#steps',host);
    host.__solutionPython = s.code; host.dataset.hasSolution='1';
const lines = s.cases.map((t,i)=>
  `mediatrice(${t.M[0]}, ${t.M[1]}, ${t.A[0]}, ${t.A[1]}, ${t.B[0]}, ${t.B[1]}) = ${s.res[i]}`
).join('\n');    W.innerHTML = `<pre><code>${s.code}

# Tests
${lines}</code></pre>`;
  }
});


/* ============= C6 ‚Äî PENTE & PARALL√âLISME ============= */
L.push({
  id:'C6_pente_paralleles',
  title:'C6 ‚Äî Pente & parall√©lisme',
// remplace gen() dans C6_pente_paralleles
gen(){
  function slope(P,Q){ return (P[0]===Q[0]) ? Infinity : (Q[1]-P[1])/(Q[0]-P[0]); }
  function mkParallel(){
    const dx = choice([1,2,3,4]), dy = choice([-4,-3,-2,1,2,3,4]);
    const A=[rint(-4,4), rint(-4,4)], B=[A[0]+dx, A[1]+dy];
    const C=[rint(-5,5), rint(-5,5)], k=rint(2,4), D=[C[0]+k*dx, C[1]+k*dy];
    return {A,B,C,D};
  }
  function mkPerpOrRandomNotParallel(){
    const A=[rint(-5,5), rint(-5,5)], B=[A[0]+choice([1,2,3]), A[1]+choice([1,3,5])];
    const C=[rint(-5,5), rint(-5,5)], D=[C[0]+choice([2,4]), C[1]+choice([-3,-1,1,3])];
    return {A,B,C,D};
  }
  function mkVertVsHori(){ // s√ªr non parall√®le
    const xV = rint(-5,5), yH = rint(-5,5);
    const A=[xV, rint(-5,5)], B=[xV, rint(-5,5)];
    const C=[rint(-5,5), yH], D=[rint(-5,5), yH];
    return {A,B,C,D};
  }

  let cases, res;
  do{
    cases = [
      Math.random()<.5 ? mkParallel() : mkPerpOrRandomNotParallel(),
      Math.random()<.5 ? mkVertVsHori() : mkPerpOrRandomNotParallel(),
      Math.random()<.5 ? mkParallel() : mkPerpOrRandomNotParallel()
    ];
    res = cases.map(t=>{
      const m1=slope(t.A,t.B), m2=slope(t.C,t.D);
      if(m1===Infinity && m2===Infinity) return true;
      if(m1===Infinity || m2===Infinity) return false;
      return Math.abs(m1-m2)<1e-9;
    });
  }while(!hasBothTF(res));

  return {
    cases, res,
    code:
`def pente(xA,yA,xB,yB):
    if xA == xB:
        return("Droite verticale : pente non d√©finie.")
    return (yB-yA)/(xB-xA)

def paralleles(m1, p1, m2, p2):
    return m1 == m2

def paralleles_points(xA,yA,xB,yB,xC,yC,xD,yD):
    if xA==xB and xC==xD:
        return True
    if xA==xB or xC==xD:
        return False
    return pente(xA,yA,xB,yB) == pente(xC,yC,xD,yD)`
  };
},


  render(host,s){
   const rows = s.cases.map((t,i)=>`
  <tr>
    <td>${fmtPt(t.A)}</td>
    <td>${fmtPt(t.B)}</td>
    <td>${fmtPt(t.C)}</td>
    <td>${fmtPt(t.D)}</td>
    <td>${mkInput('c6'+i,90)} <span id="tc6${i}" class="tick"></span></td>
  </tr>`).join('');

    host.innerHTML=`
      <div class="row norepere"><div class="statement">
        <p><strong>Exercice C6</strong></p>
<p>1) Ecrire la fonction pente qui qui calcule le coefficient directeur de la droite \\((AB)\\) connaissant les coordonn√©es des points \\(A\\) et \\(B\\), apr√®s avoir v√©rifi√© que les points n'aient pas la m√™me abscisse.</p>
     <p>2) Ecrire la fonction paralleles qui d√©termine si deux droites non verticales sont parall√®les ou non, en connaissant les √©quations r√©duites des deux droites.</p>
            <p>3) Ecrire la fonction paralleles_points qui d√©termine si des droites \\((AB)\\) et \\((CD)\\) sont parall√®les ou non, √† partir des coordonn√©es des quatre points.<p>

	   <p>4) Tester ce dernier programme :</p>   
        <table class="tbl">
          <tr><th>A</th><th>B</th><th>C</th><th>D</th><th>(AB) et (CD) sont-elles parall√®les ? (True/False)</th></tr>
          ${rows}
        </table>
      </div><div><div id="steps" class="steps"></div></div></div>`;
    host.__state=s;
  },
check(host){
  const s=host.__state; let filled=true, allOk=true;
  s.res.forEach((R,i)=>{
    const raw=(document.getElementById('c6'+i)?.value||'').trim().toLowerCase();
    const ok = raw==='' ? null
            : ( (R && (raw==='true'||raw==='vrai'||raw==='oui'))
             || (!R && (raw==='false'||raw==='faux'||raw==='non')) );
    setTick(host, '#tc6'+i, ok);
    if(ok===null) filled=false; else if(!ok) allOk=false;
  });
  if(filled){ SCORE[1]++; if(allOk) SCORE[0]++; scoreSet(...SCORE); }
  return filled && allOk;
},

  solution(host){
    const s=host.__state, W=$('#steps',host);
    host.__solutionPython = s.code; host.dataset.hasSolution='1';
// Dans solution(host) de C6 (ou o√π tu fabriques 'lines')
const lines = s.cases.map((t,i)=>
  `paralleles_points(${t.A[0]}, ${t.A[1]}, ${t.B[0]}, ${t.B[1]}, ${t.C[0]}, ${t.C[1]}, ${t.D[0]}, ${t.D[1]}) = ${s.res[i]}`
).join('\n');
    W.innerHTML = `<pre><code>${s.code}

# Tests
${lines}</code></pre>`;
  }
});




 

  return L;
}

/* ====== UI ====== */
const REGISTRY = makeExos();
window.REGISTRY = REGISTRY;

function populateSelect(){
  const sel=$("#exo-select"); if(!sel) return;
  sel.innerHTML = '';
  for(const e of REGISTRY){
    const o=document.createElement('option'); o.value=e.id; o.textContent=e.title; sel.appendChild(o);
  }
}
function renderActive(){
  const host=$("#host"), sel=$("#exo-select");
  try{
    const def=REGISTRY.find(e=>e.id===sel.value) || REGISTRY[0];
    host.dataset.active=def.id;
    def.render(host, def.gen());
    host.querySelectorAll('input').forEach(inp=>{
      inp.addEventListener('keydown', ev=>{ if(ev.key==='Enter') $('#btn-check').click(); });
    });
    retypeMath(host);
  }catch(e){
    host.innerHTML = `<div class="steps" style="color:#b00020"><b>Erreur :</b> ${e.message}</div>`;
  }
}
function val(id){ const e=document.getElementById(id); return e?e.value:'' }

window.addEventListener('load', ()=>{
  populateSelect();
  $("#exo-select")?.addEventListener('change', ()=>{ SCORE=[0,0]; scoreSet(0,0); renderActive(); });
  $("#btn-new")?.addEventListener('click', ()=>{ SCORE=[0,0]; scoreSet(0,0); renderActive(); });
  $("#btn-reset")?.addEventListener('click', ()=>{ SCORE=[0,0]; scoreSet(0,0); renderActive(); });
  $("#btn-check")?.addEventListener('click', ()=>{
    const host=$("#host");
    const def=REGISTRY.find(e=>e.id===host.dataset.active);
    if(def?.check) def.check(host);
  });
  $("#btn-sol")?.addEventListener('click', ()=>{
    const host=$("#host");
    const def=REGISTRY.find(e=>e.id===host.dataset.active);
    if(def?.solution) def.solution(host);
  });

  renderActive(); scoreSet(0,0);

  // Init PDF (m√™me position que d‚Äôhabitude)
  (function waitForPDF(){
    if (window.ExoPDF?.init && Array.isArray(window.REGISTRY) && window.REGISTRY.length){
      ExoPDF.init({
        title: 'Premi√®re ‚Äî Suites num√©riques ‚Äî Python (Pour & Tant que)',
        max: 50,
        mountAfterSelector: '#info-saisie',
        autoPrint: false
      });
    } else { setTimeout(waitForPDF, 60); }
  })();
});
})();
</script>
<!-- === Console Python 3 panneaux : √âditeur / Console / Sortie === -->
<style>
/* === Console Python ‚Äî CSS consolid√© (remplace les doublons) === */
#py-panel{
  position: fixed;
  right: 16px;
  /* top est fix√© par placePanel() en JS */
  bottom: auto;
  width: 680px;
  max-width: 95vw;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 12px;
  box-shadow: 0 12px 22px rgba(0,0,0,.14);
  display: none;               /* affich√©/masqu√© par le bouton */
  flex-direction: column;
  z-index: 9999;
  max-height: 80vh;            /* hauteur max raisonnable */
}

#py-head{
  display: flex; align-items: center; gap: 8px;
  padding: 10px; border-bottom: 1px solid #eee;
}
#py-head .btn{ border:1px solid #ccc; background:#fff; border-radius:8px; padding:.35rem .6rem; cursor:pointer }
#py-head .btn:active{ transform: translateY(1px) }
#py-status{ margin-left: auto }

#py-sections{
  display: flex;               /* <<< PAS grid */
  flex-direction: column;
  min-height: 0;               /* indispensable pour que #py-out puisse grandir */
}

#py-editor{
  width: 100%;
  height: 230px;               /* √©ditable */
  min-height: 120px;
  resize: vertical;
  border: none; border-bottom: 1px solid #eee;
  padding: 10px;
  font-family: ui-monospace, Menlo, Consolas, monospace;
  font-size: 14px;
  outline: none;
}

#py-repl{ display:flex; gap:8px; align-items:center; padding:8px; border-bottom:1px solid #eee }
#py-input{
  flex:1; border:1px solid #ddd; border-radius:8px; padding:8px 10px;
  font-family: ui-monospace, Menlo, Consolas, monospace; font-size:14px;
}

#py-out{
  flex: 1 1 auto;              /* prend tout l'espace restant */
  min-height: 120px;
  overflow: auto;
  padding: 10px;
  background: #0e1116; color:#d6deeb;
  border-bottom-left-radius:12px; border-bottom-right-radius:12px;
  white-space: pre-wrap;
}
@media (max-width:720px){ #py-panel{ width:96vw } }

</style>

<script>
(function(){
  // === 0) Bouton barre d‚Äôoutils
  const bar = document.querySelector('.controls');
  if(bar && !document.getElementById('py-open')){
    const btn=document.createElement('button');
    btn.id='py-open'; btn.className='btn'; btn.textContent='‚ñ∂Ô∏è Console Python';
    bar.insertBefore(btn, bar.children[1]||null);
  }

  // === 1) Panneau
  const panel=document.createElement('div');
  panel.id='py-panel';
  panel.innerHTML=`
    <div id="py-head">
      <strong>√âditeur / Console / Sortie</strong>
      <button id="py-fill" class="btn">üß© Pr√©remplir depuis l‚Äôexercice</button>
      <button id="py-run"  class="btn">‚ñ∂Ô∏è Ex√©cuter le code</button>
      <button id="py-eval" class="btn">‚èé Eval (ligne console)</button>
      <button id="py-clear" class="btn">üßπ Effacer sortie</button>
      <div id="py-status">Pyodide : chargement‚Ä¶</div>
      <button id="py-close" class="btn">‚úñ</button>
    </div>
    <div id="py-sections">
      <textarea id="py-editor" spellcheck="false"
        placeholder="# √âcris ton programme ici (def suite(n): ...)."></textarea>
      <div id="py-repl">
        <span><strong>Console</strong> ‚Ä∫ </span>
        <input id="py-input" placeholder="ex: suite(5) ou print(suite(5))">
      </div>
      <pre id="py-out">[sortie]</pre>
    </div>`;
  document.body.appendChild(panel);

  const $ = sel => document.querySelector(sel);
function placePanel(){
  const controls = document.querySelector('.controls');
  if(!controls) return;
  const r = controls.getBoundingClientRect();
  const top = Math.round(r.bottom + 8 + window.scrollY);
  panel.style.top = top + 'px';

  const free = window.innerHeight - (r.bottom + 8);
  panel.style.maxHeight = Math.max(260, free - 16) + 'px'; // pas de height fixe !
}

  // === 2) Charger Pyodide (une seule fois)
  let pyodide=null;
  async function ensurePy(){
    if(pyodide) return pyodide;
    if(!window.loadPyodide){
      const s=document.createElement('script');
      s.src='https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js';
      await new Promise(r=>{ s.onload=r; document.head.appendChild(s); });
    }
    pyodide=await loadPyodide({});
    $('#py-status').textContent='Pyodide : pr√™t';
    return pyodide;
  }
  $('#py-open')?.addEventListener('click', async ()=>{
  const btn = document.getElementById('py-open');
  const isShown = panel.style.display === 'flex';
  if (isShown) {
    panel.style.display = 'none';
    btn?.setAttribute('aria-pressed','false');
    btn.textContent = '‚ñ∂Ô∏è Console Python';
  } else {
    placePanel();                 // <‚Äî positionne sous le s√©lecteur
    panel.style.display = 'flex';
    btn?.setAttribute('aria-pressed','true');
    btn.textContent = '‚èπ Fermer la console';
    await ensurePy();             // charge Pyodide √† l‚Äôouverture
  }
});

// --- ajuster au scroll / resize (d√©bours√© l√©ger)
let _placeTO=null;
function schedulePlace(){
  clearTimeout(_placeTO);
  _placeTO = setTimeout(placePanel, 20);
}
window.addEventListener('scroll', schedulePlace, {passive:true});
window.addEventListener('resize', schedulePlace);
  $('#py-close')?.addEventListener('click', ()=>{ panel.style.display='none'; });

  // === 3) Ex√©cution & capture stdout/stderr
function appendOut(txt){
  const el = document.querySelector('#py-out');
  if (el.textContent.trim() === '[sortie]') el.textContent = ''; // enl√®ve le placeholder
  el.textContent += (el.textContent ? '\n' : '') + txt;
  el.scrollTop = el.scrollHeight;
}
  async function pyExec(code){
    await ensurePy();
    let stdout='', stderr='';
    pyodide.setStdout({batched:msg=>{stdout+=msg;}});
    pyodide.setStderr({batched:msg=>{stderr+=msg;}});
	await pyodide.runPythonAsync(`
import builtins
from js import prompt

def _browser_input(msg=''):
    # affiche le message pass√© √† input(...) dans la bo√Æte de saisie
    v = prompt(str(msg))
    return '' if v is None else v  # input doit renvoyer une cha√Æne

builtins.input = _browser_input
`);

    try{
	pyodide.setStdin({
  stdin: () => {
    const v = window.prompt("Entr√©e pour input() :");
    return ((v ?? '') + '\n');
  }
});
      await pyodide.runPythonAsync(code);
      if(stdout.trim()) appendOut(stdout.trim());
      if(stderr.trim()) appendOut('[stderr]\\n'+stderr.trim());
    }catch(e){
      appendOut('[Erreur] ' + (e?.message || String(e)));
    }
  }

  // === 4) Ex√©cuter le contenu de l‚Äô√©diteur
  $('#py-run').addEventListener('click', async ()=>{
    const code=$('#py-editor').value;
    await pyExec(code);
  });

  // === 5) √âvaluer une ligne console
  // - si c‚Äôest une expression, on affiche repr(expr)
  // - sinon on ex√©cute comme une instruction (ex: x=3)
  const hist=[]; let hIdx=-1;
  $('#py-eval').addEventListener('click', async ()=>{ await runConsoleLine(); });
  $('#py-input').addEventListener('keydown', async (e)=>{
    if(e.key==='Enter'){ e.preventDefault(); await runConsoleLine(); }
    else if(e.key==='ArrowUp'){ if(hist.length){hIdx=Math.max(0,hIdx-1); $('#py-input').value=hist[hIdx]; e.preventDefault();} }
    else if(e.key==='ArrowDown'){ if(hist.length){hIdx=Math.min(hist.length, hIdx+1); $('#py-input').value=(hIdx>=hist.length?'':hist[hIdx]); e.preventDefault();} }
  });
  async function runConsoleLine(){
    const line=$('#py-input').value.trim();
    if(!line) return;
    hist.push(line); hIdx=hist.length;
    $('#py-input').value='';
    // essaie eval(...)
    const wrapper = `
import builtins
_res_ = None
try:
    _res_ = eval(${JSON.stringify(line)})
    if _res_ is not None:
        print(repr(_res_))
except SyntaxError:
    exec(${JSON.stringify(line)})
`;
    await pyExec(wrapper);
  }

  // === 6) Effacer sortie
  $('#py-clear').addEventListener('click', ()=>{ $('#py-out').textContent='[sortie]'; });

  // === 7) Pr√©remplir depuis l‚Äôexercice actif (m√™me logique que ta console pr√©c√©dente)
  function getVal(id){ return (document.getElementById(id)?.value || '').trim(); }
function codeFromExercise(){
  const host = document.querySelector('#host');

  // <<< PRIORIT√â √Ä LA SOLUTION SI ELLE EXISTE
  if (host?.__solutionPython) {
    return host.__solutionPython + '\n';
  }
}
  // ... ensuite ton code existant (ex1, ex2, ex3, etc.)

  $('#py-fill').addEventListener('click', ()=>{ $('#py-editor').value = codeFromExercise(); });

  // === 8) Petit ‚Äú√©diteur intelligent‚Äù : indentation apr√®s ":" + Tab/Shift+Tab + Ctrl/Cmd+Enter
  (function enhanceEditor(){
    const ta=$('#py-editor');
    function insert(text){
      const s=ta.selectionStart, e=ta.selectionEnd;
      ta.setRangeText(text, s, e, 'end');
    }
    function curLine(){
      const pos=ta.selectionStart, before=ta.value.slice(0,pos);
      const ls = before.lastIndexOf('\n')+1;
      const line = before.slice(ls);
      const indent = (line.match(/^\s*/)||[''])[0];
      return {line, indent};
    }
    function indentSel(add=true){
      const start=ta.selectionStart, end=ta.selectionEnd, v=ta.value;
      const from=v.lastIndexOf('\n',start-1)+1;
      const to=v.indexOf('\n',end); const endPos=(to===-1?v.length:to);
      const lines=v.slice(from,endPos).split('\n');
      const pad='    ';
      const changed=lines.map(s=> add? pad+s : (s.startsWith('    ')?s.slice(4):s.replace(/^ {1,3}/,''))).join('\n');
      ta.value = v.slice(0,from)+changed+v.slice(endPos);
      const delta=changed.length - (endPos-from);
      ta.setSelectionRange(start+(add?4:0), end+delta);
    }
    ta.addEventListener('keydown', e=>{
      if((e.ctrlKey||e.metaKey) && e.key==='Enter'){ e.preventDefault(); $('#py-run').click(); return; }
      if(e.key==='Tab'){ e.preventDefault(); if(ta.selectionStart!==ta.selectionEnd) indentSel(!e.shiftKey); else insert('    '); return; }
      if(e.key==='Enter'){ e.preventDefault(); const {line,indent}=curLine(); const more=/:\s*$/.test(line)?'    ':''; insert('\n'+indent+more); return; }
    });
  })();
})();
</script>


</body>
</html>
