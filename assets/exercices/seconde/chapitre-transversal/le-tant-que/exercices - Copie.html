<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Python ‚Äî Le TANT QUE ‚Äì Exemples</title>

<!-- m√™mes feuilles que ton mod√®le -->
<link rel="stylesheet" href="../../../../css/math-kbd.css">
<link rel="stylesheet" href="../../../../css/espace-gras.css">
<link rel="stylesheet" href="../../../../css/espace-latex.css">
<link rel="stylesheet" href="../../../../css/mobile.css">

<style>
*{box-sizing:border-box}
body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:0;background:#fafafa;color:#111;line-height:1.5}
.header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;padding:14px 18px;z-index:5}
.wrap{max-width:1200px;margin:0 auto;padding:18px;display:flex;flex-direction:column;gap:12px}
.card{background:#fff;border:1px solid #e6e6e6;border-radius:12px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
.controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
.controls .btn{border:1px solid #ccc;background:#fff;border-radius:8px;padding:.45rem .7rem;cursor:pointer}
.controls select{border:1px solid #ccc;border-radius:8px;padding:.45rem .55rem}
.controls .btn:active{transform:translateY(1px)}
.controls .score{margin-left:auto;font-weight:700}
.small{font-size:.92rem;color:#555}

.row{display:grid;grid-template-columns:1fr 1fr;gap:14px;align-items:start}
.row.norepere{grid-template-columns:1fr}
.hint{color:#444;font-style:italic;margin:.25rem 0}
.steps{margin:.45rem 0 0 .15rem;padding:.6rem .7rem;background:#f6f6f6;border:1px dashed #e3e3e3;border-radius:8px}
.step{margin:.25rem 0}

.kbd{padding:.06rem .35rem;border:1px solid #ccc;border-radius:6px;background:#fff}
.tick{display:none;margin-left:.35rem;font-weight:700}
.tick.ok{color:#11823b;display:inline}
.tick.ko{color:#b00020;display:inline}

.tbl{border-collapse:collapse}
.tbl td,.tbl th{border:1px solid #ddd;padding:6px 8px;text-align:center}

/* Lignes de r√©ponse imprimables */
.blank-wrap{ display:inline-block; vertical-align:baseline }
.blank-wrap .blank{ display:none; height:1.4em; border-bottom:2px solid #000; vertical-align:baseline; }
@media print{
  .controls,.header,.kbd-host,.hide-print{display:none!important}
  .card{box-shadow:none}
  .blank-wrap input{ display:none !important; }
  .blank-wrap .blank{ display:inline-block !important; }
}
</style>

<!-- MathJax identique -->
<script>
window.MathJax = {
  tex: { inlineMath: [['\\(','\\)'], ['$', '$']], displayMath: [['\\[','\\]'], ['$$','$$']], processEscapes: true },
  chtml: { matchFontHeight:false }, startup: { typeset: true }
};
</script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

<!-- libs partag√©es -->
<script src='../../../../js/algebra-eval-patch.multiplicatif.js' defer></script>
</head>
<body>
  <div class="header">
    <h1 style="margin:0;font-size:1.1rem">Python ‚Äî Le TANT QUE ‚Äì Exemples</h1>
  </div>

  <div class="wrap">
    <!-- Barre de contr√¥le -->
    <div class="controls card">
      <label for="exo-select"><strong>Type d‚Äôexercice :</strong></label>
      <select id="exo-select"></select>
      <button id="btn-new" class="btn">üîÑ Nouvel √©nonc√©</button>
      <button id="btn-check" class="btn">‚úÖ V√©rifier</button>
      <button id="btn-sol" class="btn">üí° Solution</button>
      <button id="btn-reset" class="btn">üßπ R√©initialiser</button>
      <div class="score" id="score">Score : 0 / 0</div>
    </div>

    <!-- H√¥te -->
    <div id="host" class="card" data-active="" data-state=""></div>

    <!-- Saisie & r√©ponses accept√©es -->

  </div>

<script>
(function(){
"use strict";

/* ====== Utilitaires ====== */
function typesetAll(root){ const run=()=>MathJax.typesetPromise(root?[root]:undefined).catch(()=>{}); if(MathJax?.startup?.promise){ MathJax.startup.promise.then(run);} else { const t=setInterval(()=>{ if(MathJax?.typesetPromise){ clearInterval(t); run(); }},60);} }

function $(s,root){return (root||document).querySelector(s)}
function $all(s,root){return Array.from((root||document).querySelectorAll(s))}
function rint(a,b){return a+Math.floor(Math.random()*(b-a+1))}
function choice(A){return A[Math.floor(Math.random()*A.length)]}
function near(a,b,eps){return Math.abs(a-b)<= (eps||1e-9)}
function parseNumber(s){
  if(s==null) return NaN;
  s = (''+s).trim().replace(',', '.');
  if(/^[-+]?(\d+(\.\d+)?|\.\d+)$/.test(s)) return +s;
  return NaN;
}
function retypeMath(scope){ if(window.MathJax?.typesetPromise) MathJax.typesetPromise([scope||document]) }
function mkInput(id,w){ return `<span class="blank-wrap"><input id="${id}" style="width:${w||110}px;font-size:15px;padding:6px;border:1px solid #ddd;border-radius:8px"> <span class="blank" style="width:${(w||110)-14}px"></span></span>` }
function tickTri(el, state){
  if(!el) return;
  el.classList.remove('ok','ko');
  if(state===true){ el.classList.add('ok'); el.textContent='‚úì'; }
  else if(state===false){ el.classList.add('ko'); el.textContent='‚úó'; }
  else el.textContent='';
}
function scoreSet(a,b){ const s=$("#score"); if(s) s.textContent=`Score : ${a} / ${b}` }
let SCORE=[0,0];
function normPy(s){
  return (''+s).toLowerCase()
    .replace(/[ \t]/g,'')
    .replace(/[‚àí‚Äì‚Äî]/g,'-')
    .replace(/\u00A0/g,'')
    .replace(/;+$/,''); // ; facultatif
}
function normRelation(str){
  if(str==null) return '';
  let s=(''+str).toLowerCase().replace(/\s+/g,'');
  s=s.replace(/[‚àí‚Äì‚Äî]/g,'-');
  s=s.replace(/u\(([^)]+)\)/g,'u_{$1}').replace(/u_\(([^)]+)\)/,'u_{$1}').replace(/u_\{([^}]+)\)/g,'u_{$1}');
  s=s.replace(/u_\{([a-z])\}/g,'u_$1').replace(/\{(\d+)\}/g,'$1');
  return s;
}
function fmtPt(P){ return `\\((${P[0]}  ;  ${P[1]})\\)`; }  // (x ; y)
function hasBothTF(arr){ return arr.some(Boolean) && arr.some(x=>!x); }

// Normalise un texte "appel de fonction" (retire espaces, minuscule, virgules homog√®nes)
function normCall(s){
  return (''+s).trim()
    .toLowerCase()
    .replace(/\s+/g,'')       // supprime espaces
    .replace(/[,;]+/g,',');   // ; ‚Üí , par s√©curit√©
}
// Tick helper concis
function setTick(host, sel, state){
  const el=$(sel,host); if(!el) return;
  el.classList.remove('ok','ko');
  if(state===true){ el.classList.add('ok'); el.textContent='‚úì'; }
  else if(state===false){ el.classList.add('ko'); el.textContent='‚úó'; }
  else el.textContent='';
}
// Nombre tol√©rant
function chkNumById(id, target, tickSel, host, eps=1e-6){
  const raw=(document.getElementById(id)?.value||'').trim();
  const ok = raw==='' ? null : near(parseNumber(raw), target, eps);
  setTick(host, tickSel, ok);
  return ok;
}

// === Transposer .tbl : colonnes -> lignes ===
function transposeTables(scope){
  (scope||document).querySelectorAll('table.tbl').forEach(tbl=>{
    const rows = Array.from(tbl.rows);
    if (!rows.length) return;
    const nCols = rows[0].cells.length, nRows = rows.length;

    // Nouveau tableau (m√™mes classes + marqueur "transposed" optionnel)
    const newT = document.createElement('table');
    newT.className = (tbl.className || '') + ' transposed';
    // Copie simple des styles inline si jamais (rare)
    if (tbl.getAttribute('style')) newT.setAttribute('style', tbl.getAttribute('style'));

    for (let c = 0; c < nCols; c++){
      const tr = document.createElement('tr');
      for (let r = 0; r < nRows; r++){
        const src = rows[r].cells[c];
        const cell = document.createElement(r===0 ? 'th' : 'td'); // l‚Äôancienne 1 ≥·µâ ligne d‚Äôen-t√™tes devient la 1 ≥·µâ colonne
        // D√©placer tout le contenu (inputs, spans tick, etc.) pour conserver les IDs/√©couteurs
        while (src.firstChild) cell.appendChild(src.firstChild);
        tr.appendChild(cell);
      }
      newT.appendChild(tr);
    }
    tbl.parentNode.replaceChild(newT, tbl);
  });
}
function fmtMX(m){
  if (m === 1)  return 'x';
  if (m === -1) return '-x';
  return `${m}*x`;          // pour Python ET lisible
}
function fmtMX_tex(m){
  if (m === 1)  return 'x';
  if (m === -1) return '-x';
  return `${m}x`;           // pour l‚Äôaffichage math (pas de *)
}
function fmtP(p){
  if (p === 0) return '';
  return (p > 0) ? ` + ${p}` : ` - ${Math.abs(p)}`;
}

// helpers "pas 0,5"
const toHalf  = x => Math.round(x * 2) / 2;
const rhalf   = (a, b) => rint(Math.ceil(a * 2), Math.floor(b * 2)) / 2;

// Tirage sur un intervalle [a,b] avec pas fixe 'step'
const rstep = (a, b, step) => a + step * rint(0, Math.floor((b - a) / step));


/* ===== BANQUE PR√âCIS√âE ‚Äî m√™mes questions/pr√©sentation que tes originaux ===== */

/* === COMPL√âMENT : ajout de la variante "original" (index 0) √† F1 et F2 === */

const BANK_FULL = {
  /* =================== F1 ‚Äî Croissance (%) jusqu‚Äô√† un seuil (ann√©e) =================== */
  F1_tantque: [
    { // 0) ‚Äî‚Äî ORIGINAL (Mme Econome) ‚Äî‚Äî copie fid√®le de ton √©nonc√©/solution
      enonce: s => `
        <p><strong>Exercice F1 :</strong><br>
        Mme Econome effectue un virement de <b>${s.C0} euros</b> sur un livret d'√©pargne en <b>${s.an0}</b>.<br>
        Chaque ann√©e, le capital est augment√© de <b>${s.p}%</b> ( par le versement d'int√©r√™ts).</p>
        <p>On souhaite d√©terminer l‚Äôann√©e √† partir de laquelle le capital disponible sur le livret sera sup√©rieur ou √©gal √† <b>${s.seuil}‚Ç¨</b>.</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√©e le capital chaque ann√©e ?`,
      q2: s => `2) Ecrire une fonction en langage Python afin qu'elle affiche l'ann√©e √† partir de laquelle le capital disponible sur le livret sera sup√©rieur ou √©gal √† <b>${s.seuil}‚Ç¨</b>.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) Augmenter de ${s.p} % revient √† multiplier par : \\( 1 + \\dfrac{${s.p}}{100} = ${s.fac} \\)</p>
<pre><code>def econome(seuil):
    a = ${s.an0}
    C = ${s.C0}
    while C &lt; seuil:
        C = C*(1 + ${s.p}/100)
        a = a + 1
    return a</code></pre>
          <p>3) Valeur :
<pre><code>econome(${s.seuil}) = ${s.an}</code></pre>
Le capital disponible sur le livret sera sup√©rieur ou √©gal √† ${s.seuil}‚Ç¨ en ${s.an}.
        </div>`
    },

    /* ‚Äî‚Äî Les 10 variantes contextualis√©es d√©j√† fournies (1..10) ‚Äî‚Äî */
    { // 1) Abonn√©s YouTube
      enonce: s => `
        <p><strong>Exercice F1 :</strong><br>
        En <b>${s.an0}</b>, une cha√Æne YouTube compte <b>${s.C0}</b> abonn√©s.<br>
        Chaque ann√©e, la communaut√© augmente de <b>${s.p}%</b> (croissance r√©guli√®re).</p>
        <p>On souhaite d√©terminer l‚Äôann√©e √† partir de laquelle le nombre d‚Äôabonn√©s sera sup√©rieur ou √©gal √† <b>${s.seuil}</b>.</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© le nombre d‚Äôabonn√©s chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction en langage Python afin qu‚Äôelle affiche l‚Äôann√©e √† partir de laquelle la cha√Æne d√©passera <b>${s.seuil}</b> abonn√©s.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) Augmenter de ${s.p}&nbsp;% revient √† multiplier par : \\( 1 + \\dfrac{${s.p}}{100} = ${s.fac} \\)</p>
<pre><code>def an_abonnes(seuil):
    a = ${s.an0}
    N = ${s.C0}
    while N &lt; seuil:
        N = N*(1 + ${s.p}/100)
        a = a + 1
    return a</code></pre>
          <p>3) Valeur en sortie :
<pre><code>an_abonnes(${s.seuil}) = ${s.an}</code></pre>
La cha√Æne d√©passera ${s.seuil} abonn√©s en <b>${s.an}</b>.
        </div>`
    },
    { // 2) Fonds associatif
      enonce: s => `
        <p><strong>Exercice F1 :</strong><br>
        En <b>${s.an0}</b>, un fonds associatif dispose de <b>${s.C0} ‚Ç¨</b> sur son compte.<br>
        Chaque ann√©e, le capital progresse de <b>${s.p}%</b> (int√©r√™ts compos√©s).</p>
        <p>On veut conna√Ætre l‚Äôann√©e √† partir de laquelle le capital sera sup√©rieur ou √©gal √† <b>${s.seuil} ‚Ç¨</b>.</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© le capital chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction en langage Python afin qu‚Äôelle affiche l‚Äôann√©e √† partir de laquelle le capital sera sup√©rieur ou √©gal √† <b>${s.seuil} ‚Ç¨</b>.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) Facteur annuel : \\( 1 + \\dfrac{${s.p}}{100} = ${s.fac} \\)</p>
<pre><code>def fonds(seuil):
    a = ${s.an0}
    C = ${s.C0}
    while C &lt; seuil:
        C = C*(1 + ${s.p}/100)
        a = a + 1
    return a</code></pre>
          <p>3) Test :
<pre><code>fonds(${s.seuil}) = ${s.an}</code></pre>
Le capital atteindra au moins ${s.seuil} ‚Ç¨ en <b>${s.an}</b>.
        </div>`
    },
    { // 3) T√©l√©chargements appli
      enonce: s => `
        <p><strong>Exercice F1 :</strong><br>
        En <b>${s.an0}</b>, une application totalise <b>${s.C0}</b> t√©l√©chargements.<br>
        Le volume augmente de <b>${s.p}%</b> chaque ann√©e.</p>
        <p>On cherche l‚Äôann√©e √† partir de laquelle le nombre de t√©l√©chargements sera sup√©rieur ou √©gal √† <b>${s.seuil}</b>.</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© le nombre de t√©l√©chargements chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction en Python qui affiche l‚Äôann√©e √† partir de laquelle on d√©passe <b>${s.seuil}</b> t√©l√©chargements.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) Facteur : \\( 1 + \\dfrac{${s.p}}{100} = ${s.fac} \\)</p>
<pre><code>def an_dl(seuil):
    an = ${s.an0}
    T = ${s.C0}
    while T &lt; seuil:
        T = T*(1 + ${s.p}/100)
        an = an + 1
    return an</code></pre>
          <p>3) Sortie :
<pre><code>an_dl(${s.seuil}) = ${s.an}</code></pre>
On d√©passera ${s.seuil} t√©l√©chargements en <b>${s.an}</b>.
        </div>`
    },
    { // 4) Photovolta√Øque
      enonce: s => `
        <p><strong>Exercice F1 :</strong><br>
        En <b>${s.an0}</b>, une commune exploite <b>${s.C0}</b> m¬≤ de panneaux solaires.<br>
        La surface cro√Æt annuellement de <b>${s.p}%</b>.</p>
        <p>D√©terminer l‚Äôann√©e √† partir de laquelle la surface sera sup√©rieure ou √©gale √† <b>${s.seuil}</b> m¬≤.</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√©e la surface chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python affichant l‚Äôann√©e d‚Äôatteinte de <b>${s.seuil}</b> m¬≤.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) Facteur : \\( ${s.fac} \\)</p>
<pre><code>def an_pv(seuil):
    an = ${s.an0}
    S  = ${s.C0}
    while S &lt; seuil:
        S = S*(1 + ${s.p}/100)
        an = an + 1
    return an</code></pre>
          <p>3) R√©sultat :
<pre><code>an_pv(${s.seuil}) = ${s.an}</code></pre>
Le parc atteindra ${s.seuil} m¬≤ en <b>${s.an}</b>.
        </div>`
    },
    { // 5) Newsletter
      enonce: s => `
        <p><strong>Exercice F1 :</strong><br>
        En <b>${s.an0}</b>, une newsletter compte <b>${s.C0}</b> lecteurs r√©guliers.<br>
        L‚Äôaudience progresse de <b>${s.p}%</b> par an.</p>
        <p>√Ä partir de quelle ann√©e atteindra-t-on au moins <b>${s.seuil}</b> lecteurs ?</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© le nombre de lecteurs chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python renvoyant l‚Äôann√©e d‚Äôatteinte de <b>${s.seuil}</b> lecteurs.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) \\( 1 + \\dfrac{${s.p}}{100} = ${s.fac} \\)</p>
<pre><code>def an_news(seuil):
    a = ${s.an0}
    L = ${s.C0}
    while L &lt; seuil:
        L = L*(1 + ${s.p}/100)
        a = a + 1
    return a</code></pre>
          <p>3) Test :
<pre><code>an_news(${s.seuil}) = ${s.an}</code></pre>
On atteindra ${s.seuil} lecteurs en <b>${s.an}</b>.
        </div>`
    },
    { // 6) IoT
      enonce: s => `
        <p><strong>Exercice F1 :</strong><br>
        En <b>${s.an0}</b>, un r√©seau IoT comprend <b>${s.C0}</b> objets actifs.<br>
        Le parc augmente de <b>${s.p}%</b> par an.</p>
        <p>D√©terminer l‚Äôann√©e √† partir de laquelle on comptera au moins <b>${s.seuil}</b> objets.</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© l‚Äôeffectif d‚Äôobjets chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python affichant l‚Äôann√©e o√π l‚Äôon atteint <b>${s.seuil}</b> objets.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) Facteur : ${s.fac}</p>
<pre><code>def an_iot(seuil):
    a = ${s.an0}
    n = ${s.C0}
    while n &lt; seuil:
        n = n*(1 + ${s.p}/100)
        a = a + 1
    return a</code></pre>
          <p>3) Sortie :
<pre><code>an_iot(${s.seuil}) = ${s.an}</code></pre>
Seuil atteint en <b>${s.an}</b>.
        </div>`
    },
    { // 7) Reboisement
      enonce: s => `
        <p><strong>Exercice F1 :</strong><br>
        Au lancement (en <b>${s.an0}</b>), le programme compte <b>${s.C0}</b> hectares replant√©s.<br>
        La surface replant√©e cro√Æt de <b>${s.p}%</b> chaque ann√©e.</p>
        <p>√Ä partir de quelle ann√©e d√©passera-t-on <b>${s.seuil}</b> hectares ?</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√©e la surface replant√©e chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python qui affiche l‚Äôann√©e √† partir de laquelle ${s.seuil} ha sont atteints.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) \\( 1 + \\dfrac{${s.p}}{100} = ${s.fac} \\)</p>
<pre><code>def an_foret(seuil):
    an = ${s.an0}
    S  = ${s.C0}
    while S &lt; seuil:
        S = S*(1 + ${s.p}/100)
        an = an + 1
    return an</code></pre>
          <p>3) Application :
<pre><code>an_foret(${s.seuil}) = ${s.an}</code></pre>
On d√©passera ${s.seuil} ha en <b>${s.an}</b>.
        </div>`
    },
    { // 8) Capture CO2
      enonce: s => `
        <p><strong>Exercice F1 :</strong><br>
        En <b>${s.an0}</b>, un site capte <b>${s.C0}</b> t de CO‚ÇÇ/an.<br>
        La capacit√© augmente de <b>${s.p}%</b> tous les ans.</p>
        <p>D√©terminer l‚Äôann√©e o√π la capacit√© sera au moins <b>${s.seuil}</b> t/an.</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√©e la capacit√© chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python afin d‚Äôafficher l‚Äôann√©e √† partir de laquelle on atteint <b>${s.seuil}</b> t/an.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) Facteur : ${s.fac}</p>
<pre><code>def an_capt(seuil):
    a = ${s.an0}
    C = ${s.C0}
    while C &lt; seuil:
        C = C*(1 + ${s.p}/100)
        a = a + 1
    return a</code></pre>
          <p>3) Valeur :
<pre><code>an_capt(${s.seuil}) = ${s.an}</code></pre>
Capacit√© ‚â• ${s.seuil} t/an en <b>${s.an}</b>.
        </div>`
    },
    { // 9) Audience m√©dia
      enonce: s => `
        <p><strong>Exercice F1 :</strong><br>
        En <b>${s.an0}</b>, l‚Äôaudience cumul√©e d‚Äôun m√©dia est <b>${s.C0}</b>.<br>
        Elle progresse de <b>${s.p}%</b> chaque ann√©e.</p>
        <p>√Ä partir de quelle ann√©e l‚Äôaudience sera-t-elle sup√©rieure ou √©gale √† <b>${s.seuil}</b> ?</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√©e l‚Äôaudience chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python affichant l‚Äôann√©e d‚Äôatteinte de <b>${s.seuil}</b>.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) \\( ${s.fac} \\)</p>
<pre><code>def an_audience(seuil):
    an = ${s.an0}
    A  = ${s.C0}
    while A &lt; seuil:
        A = A*(1 + ${s.p}/100)
        an = an + 1
    return an</code></pre>
          <p>3) R√©sultat :
<pre><code>an_audience(${s.seuil}) = ${s.an}</code></pre>
Seuil atteint en <b>${s.an}</b>.
        </div>`
    },
    { // 10) VLS v√©los
      enonce: s => `
        <p><strong>Exercice F1 :</strong><br>
        En <b>${s.an0}</b>, un service compte <b>${s.C0}</b> v√©los disponibles.<br>
        Le parc augmente de <b>${s.p}%</b> par an.</p>
        <p>D√©terminer l‚Äôann√©e √† partir de laquelle on disposera d‚Äôau moins <b>${s.seuil}</b> v√©los.</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© le parc chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python affichant l‚Äôann√©e d‚Äôatteinte de <b>${s.seuil}</b> v√©los.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) Facteur : ${s.fac}</p>
<pre><code>def an_velos(seuil):
    a = ${s.an0}
    V = ${s.C0}
    while V &lt; seuil:
        V = V*(1 + ${s.p}/100)
        a = a + 1
    return a</code></pre>
          <p>3) Test :
<pre><code>an_velos(${s.seuil}) = ${s.an}</code></pre>
On disposera d‚Äôau moins ${s.seuil} v√©los en <b>${s.an}</b>.
        </div>`
    }
  ],

  /* =================== F2 ‚Äî Hausse (%) d‚Äôun prix jusqu‚Äôau seuil (ann√©es) =================== */
  F2_tantque: [
    { // 0) ‚Äî‚Äî ORIGINAL (Loyers) ‚Äî‚Äî copie fid√®le de ton √©nonc√©/solution
      enonce: s => `
        <p><strong>Exercice F2 :</strong><br>
        Dans une petite ville, on constate depuis quelques ann√©es une hausse annuelle de <b>${s.p}%</b> du prix des loyers. <br>
        Cette ann√©e, le prix moyen de location du m√®tre carr√© est <b>${s.prix0}‚Ç¨</b>.<br>
        On souhaite d√©terminer dans combien d'ann√©es le prix moyen de location du m√®tre carr√© d√©passera <b>${s.cible}‚Ç¨</b>.</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√©e le prix du loyer chaque ann√©e ?`,
      q2: s => `2) Ecrire une fonction en langage Python afin que la variable N donne le nombre d'ann√©es cherch√©.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) Augmenter de ${s.p} % revient √† multiplier par : \\( 1 + \\dfrac{${s.p}}{100} = ${s.fac} \\)</p>
<pre><code>def loyer(seuil):
    n = 0
    loy = ${s.prix0}
    while loy &lt;= seuil:
        loy = loy*(1 + ${s.p}/100)
        n = n + 1
    return n</code></pre>
          <p>3) Test :
<pre><code>loyer(${s.cible}) = ${s.n}</code></pre>
Le loyer depassera ${s.cible}‚Ç¨ le m¬≤ la ${s.n}√®me ann√©e.
        </div>`
    },

    /* ‚Äî‚Äî Les 10 variantes contextualis√©es d√©j√† fournies (1..10) ‚Äî‚Äî */
    { // 1) Abonnement streaming
      enonce: s => `
        <p><strong>Exercice F2 :</strong><br>
        On observe une hausse annuelle de <b>${s.p}%</b> du prix d‚Äôun abonnement de streaming.<br>
        Cette ann√©e, l‚Äôabonnement co√ªte <b>${s.prix0} ‚Ç¨</b>/mois.<br>
        On souhaite d√©terminer en combien d‚Äôann√©es le prix mensuel d√©passera <b>${s.cible} ‚Ç¨</b>.</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© le prix chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction en langage Python afin que la variable <b>n</b> donne le nombre d‚Äôann√©es n√©cessaire.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) Augmenter de ${s.p}&nbsp;% ‚áí facteur : \\( 1 + \\dfrac{${s.p}}{100} = ${s.fac} \\)</p>
<pre><code>def nb_ans_stream(seuil):
    n = 0
    P = ${s.prix0}
    while P &lt;= seuil:
        P = P*(1 + ${s.p}/100)
        n = n + 1
    return n</code></pre>
          <p>3) Valeur :
<pre><code>nb_ans_stream(${s.cible}) = ${s.n}</code></pre>
Le prix d√©passera ${s.cible} ‚Ç¨ au bout de <b>${s.n}</b> an(s).
        </div>`
    },
    { // 2) Ticket de transport
      enonce: s => `
        <p><strong>Exercice F2 :</strong><br>
        Le prix d‚Äôun ticket de transport augmente chaque ann√©e de <b>${s.p}%</b>.<br>
        Cette ann√©e, il vaut <b>${s.prix0} ‚Ç¨</b>.<br>
        Au bout de combien d‚Äôann√©es d√©passera-t-il <b>${s.cible} ‚Ç¨</b> ?</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© le prix chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python qui renvoie le nombre d‚Äôann√©es n√©cessaires pour d√©passer <b>${s.cible} ‚Ç¨</b>.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) Facteur : ${s.fac}</p>
<pre><code>def nb_ans_ticket(seuil):
    n = 0
    T = ${s.prix0}
    while T &lt;= seuil:
        T = T*(1 + ${s.p}/100)
        n = n + 1
    return n</code></pre>
          <p>3) R√©sultat :
<pre><code>nb_ans_ticket(${s.cible}) = ${s.n}</code></pre>
Il faudra <b>${s.n}</b> an(s).
        </div>`
    },
    { // 3) Menu de restaurant
      enonce: s => `
        <p><strong>Exercice F2 :</strong><br>
        Le prix d‚Äôun menu de restaurant est <b>${s.prix0} ‚Ç¨</b> cette ann√©e et augmente de <b>${s.p}%</b> par an.<br>
        Dans combien d‚Äôann√©es d√©passera-t-il <b>${s.cible} ‚Ç¨</b> ?</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© le prix du menu chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python qui renvoie le nombre d‚Äôann√©es n√©cessaires pour d√©passer <b>${s.cible} ‚Ç¨</b>.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) \\( 1 + \\dfrac{${s.p}}{100} = ${s.fac} \\)</p>
<pre><code>def nb_ans_menu(seuil):
    n = 0
    M = ${s.prix0}
    while M &lt;= seuil:
        M = M*(1 + ${s.p}/100)
        n = n + 1
    return n</code></pre>
          <p>3) Sortie :
<pre><code>nb_ans_menu(${s.cible}) = ${s.n}</code></pre>
R√©ponse : <b>${s.n}</b> an(s).
        </div>`
    },
    { // 4) Place de cin√©ma
      enonce: s => `
        <p><strong>Exercice F2 :</strong><br>
        La place de cin√©ma co√ªte <b>${s.prix0} ‚Ç¨</b> cette ann√©e. On suppose une hausse de <b>${s.p}%</b> par an.<br>
        Au bout de combien d‚Äôann√©es d√©passera-t-elle <b>${s.cible} ‚Ç¨</b> ?</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© le prix chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python renvoyant le nombre d‚Äôann√©es n√©cessaires pour d√©passer <b>${s.cible} ‚Ç¨</b>.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) Facteur : ${s.fac}</p>
<pre><code>def nb_ans_cine(seuil):
    n = 0
    P = ${s.prix0}
    while P &lt;= seuil:
        P = P*(1 + ${s.p}/100)
        n = n + 1
    return n</code></pre>
          <p>3) R√©sultat :
<pre><code>nb_ans_cine(${s.cible}) = ${s.n}</code></pre>
Il faut <b>${s.n}</b> an(s).
        </div>`
    },
    { // 5) Forfait mobile
      enonce: s => `
        <p><strong>Exercice F2 :</strong><br>
        Un forfait mobile co√ªte <b>${s.prix0} ‚Ç¨</b>/mois cette ann√©e. Il augmente de <b>${s.p}%</b> chaque ann√©e.<br>
        Dans combien d‚Äôann√©es d√©passera-t-il <b>${s.cible} ‚Ç¨</b>/mois ?</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© le prix du forfait chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python qui renvoie le nombre d‚Äôann√©es n√©cessaires pour d√©passer <b>${s.cible} ‚Ç¨</b>/mois.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) \\( ${s.fac} \\)</p>
<pre><code>def nb_ans_forfait(seuil):
    n = 0
    F = ${s.prix0}
    while F &lt;= seuil:
        F = F*(1 + ${s.p}/100)
        n = n + 1
    return n</code></pre>
          <p>3) Valeur :
<pre><code>nb_ans_forfait(${s.cible}) = ${s.n}</code></pre>
Le forfait d√©passera ${s.cible} ‚Ç¨ au bout de <b>${s.n}</b> an(s).
        </div>`
    },
    { // 6) Parking
      enonce: s => `
        <p><strong>Exercice F2 :</strong><br>
        Le tarif horaire d‚Äôun parking vaut <b>${s.prix0} ‚Ç¨</b> cette ann√©e et augmente de <b>${s.p}%</b> par an.<br>
        Dans combien d‚Äôann√©es d√©passera-t-il <b>${s.cible} ‚Ç¨</b> ?</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© le tarif chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python qui renvoie le nombre d‚Äôann√©es n√©cessaires pour d√©passer <b>${s.cible} ‚Ç¨</b>.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) Facteur : ${s.fac}</p>
<pre><code>def nb_ans_parking(seuil):
    n = 0
    t = ${s.prix0}
    while t &lt;= seuil:
        t = t*(1 + ${s.p}/100)
        n = n + 1
    return n</code></pre>
          <p>3) R√©sultat :
<pre><code>nb_ans_parking(${s.cible}) = ${s.n}</code></pre>
R√©ponse : <b>${s.n}</b>.
        </div>`
    },
    { // 7) Salle de sport
      enonce: s => `
        <p><strong>Exercice F2 :</strong><br>
        L‚Äôabonnement √† une salle de sport co√ªte <b>${s.prix0} ‚Ç¨</b>/mois et augmente de <b>${s.p}%</b> par an.<br>
        Au bout de combien d‚Äôann√©es d√©passera-t-il <b>${s.cible} ‚Ç¨</b>/mois ?</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© le prix chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python renvoyant le nombre d‚Äôann√©es n√©cessaires pour d√©passer <b>${s.cible} ‚Ç¨</b>/mois.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) \\( 1 + \\dfrac{${s.p}}{100} = ${s.fac} \\)</p>
<pre><code>def nb_ans_gym(seuil):
    n = 0
    A = ${s.prix0}
    while A &lt;= seuil:
        A = A*(1 + ${s.p}/100)
        n = n + 1
    return n</code></pre>
          <p>3) Sortie :
<pre><code>nb_ans_gym(${s.cible}) = ${s.n}</code></pre>
Il faudra <b>${s.n}</b> an(s).
        </div>`
    },
    { // 8) kWh
      enonce: s => `
        <p><strong>Exercice F2 :</strong><br>
        Le prix du kWh est de <b>${s.prix0} ‚Ç¨</b> cette ann√©e et augmente de <b>${s.p}%</b>/an.<br>
        Quand d√©passera-t-il <b>${s.cible} ‚Ç¨</b> ?</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© le prix chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python qui renvoie le nombre d‚Äôann√©es n√©cessaires pour d√©passer <b>${s.cible} ‚Ç¨</b>.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) Facteur : ${s.fac}</p>
<pre><code>def nb_ans_kwh(seuil):
    n = 0
    x = ${s.prix0}
    while x &lt;= seuil:
        x = x*(1 + ${s.p}/100)
        n = n + 1
    return n</code></pre>
          <p>3) R√©sultat :
<pre><code>nb_ans_kwh(${s.cible}) = ${s.n}</code></pre>
R√©ponse : <b>${s.n}</b> an(s).
        </div>`
    },
    { // 9) Panier e-commerce
      enonce: s => `
        <p><strong>Exercice F2 :</strong><br>
        Le panier moyen est de <b>${s.prix0} ‚Ç¨</b> et cro√Æt de <b>${s.p}%</b> par an.<br>
        Dans combien d‚Äôann√©es d√©passera-t-il <b>${s.cible} ‚Ç¨</b> ?</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© le panier chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python renvoyant le nombre d‚Äôann√©es n√©cessaires pour d√©passer <b>${s.cible} ‚Ç¨</b>.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) \\( ${s.fac} \\)</p>
<pre><code>def nb_ans_panier(seuil):
    n = 0
    M = ${s.prix0}
    while M &lt;= seuil:
        M = M*(1 + ${s.p}/100)
        n = n + 1
    return n</code></pre>
          <p>3) Sortie :
<pre><code>nb_ans_panier(${s.cible}) = ${s.n}</code></pre>
Il faut <b>${s.n}</b> an(s).
        </div>`
    },
    { // 10) Bureaux ‚Ç¨/m¬≤
      enonce: s => `
        <p><strong>Exercice F2 :</strong><br>
        Le prix moyen des bureaux est aujourd‚Äôhui <b>${s.prix0} ‚Ç¨</b>/m¬≤. On constate une hausse annuelle de <b>${s.p}%</b>.<br>
        Quand d√©passera-t-il <b>${s.cible} ‚Ç¨</b>/m¬≤ ?</p>
      `,
      q1: s => `1) Par quelle valeur est multipli√© le prix chaque ann√©e ?`,
      q2: s => `2) √âcrire une fonction Python renvoyant le nombre d‚Äôann√©es n√©cessaires pour d√©passer <b>${s.cible} ‚Ç¨</b>/m¬≤.`,
      q3: s => `3) Quelle est la valeur affich√©e en sortie ?`,
      solution: s => `
        <div class="steps">
          <p>1) Facteur : ${s.fac}</p>
<pre><code>def nb_ans_bureaux(seuil):
    n = 0
    P = ${s.prix0}
    while P &lt;= seuil:
        P = P*(1 + ${s.p}/100)
        n = n + 1
    return n</code></pre>
          <p>3) R√©sultat :
<pre><code>nb_ans_bureaux(${s.cible}) = ${s.n}</code></pre>
R√©ponse : <b>${s.n}</b>.
        </div>`
    }
  ],
  
  /* =========================
   F3 ‚Äî Sommes arithm√©tiques (M0, +d chaque ann√©e) + cumul T jusqu‚Äôau seuil
   Donn√©es dispo : {an0,M0,d,seuil,M1,M2,T1,T2,A}
   ========================= */
  
   
   
F3_tantque : [
  { // 0) ‚Äî‚Äî ORIGINAL (Lucas ‚Äî √âtrennes) ‚Äî‚Äî
    enonce: s => `
      <p><strong>Exercice F3 :</strong><br>
      Le 1er janvier <b>${s.an0}</b>, Lucas re√ßut <b>${s.M0}‚Ç¨</b> d'√©trennes, puis chaque ann√©e, celles-ci augmentent de <b>${s.d}‚Ç¨</b>. <br>Il d√©cide de ne pas d√©penser cet argent avant de disposer de <b>${s.seuil}‚Ç¨</b>.</p>
    `,
    q1: s => `1) Quel montant M recevra Lucas en ${s.an0+1} ? en ${s.an0+2} ?`,
    q2: s => `2) De quelle somme totale T dispose-t-il en ${s.an0+1} ? en ${s.an0+2} ?`,
    q3: s => `3) Ecrire une fonction en langage Python afin qu'elle affiche l'ann√©e √† partir de laquelle Lucas disposera de ${s.seuil}‚Ç¨.`,
    q4: s => `4) Quelle est l'ann√©e affich√©e en sortie ?`,
    solution: s => `
      <div class="steps">
        <p>1) Montants : en ${s.an0+1}, M = ${s.M1}‚Ç¨ ; en ${s.an0+2}, M = ${s.M2}‚Ç¨.</p>
        <p>2) Cumul : en ${s.an0+1}, T = ${s.T1}‚Ç¨ ; en ${s.an0+2}, T = ${s.T2}‚Ç¨.</p>
<pre><code>def etrennes(seuil):
    a = ${s.an0}
    M  = ${s.M0}
    T  = M
    while T &lt; seuil:
        M = M + ${s.d}
        T = T + M
        a = a + 1
    return a</code></pre>
        <p>4) Valeur en sortie :
<pre><code>etrennes(${s.seuil}) = ${s.A}</code></pre>
Lucas disposera de ${s.seuil}‚Ç¨ en <b>${s.A}</b>.
      </div>`
  },

  { // 1) Prime annuelle de fid√©lit√©
    enonce: s => `
      <p><strong>Exercice F3 :</strong><br>
      Le 1er janvier <b>${s.an0}</b>, une prime de fid√©lit√© est de <b>${s.M0}‚Ç¨</b>. Chaque ann√©e, elle augmente de <b>${s.d}‚Ç¨</b>. <br>On d√©cide de cumuler ces primes jusqu‚Äô√† atteindre <b>${s.seuil}‚Ç¨</b>.</p>
    `,
    q1: s => `1) Quel montant M sera vers√© en ${s.an0+1} ? en ${s.an0+2} ?`,
    q2: s => `2) Quelle somme totale T sera cumul√©e en ${s.an0+1} ? en ${s.an0+2} ?`,
    q3: s => `3) √âcrire une fonction Python affichant l‚Äôann√©e √† partir de laquelle le cumul d√©passe ${s.seuil}‚Ç¨.`,
    q4: s => `4) Quelle est l‚Äôann√©e affich√©e en sortie ?`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.M1}‚Ç¨ puis ${s.M2}‚Ç¨.</p>
        <p>2) ${s.T1}‚Ç¨ puis ${s.T2}‚Ç¨.</p>
<pre><code>def prime_cumul(seuil):
    a = ${s.an0}
    M = ${s.M0}
    T = M
    while T &lt; seuil:
        M = M + ${s.d}
        T = T + M
        a = a + 1
    return a</code></pre>
        <p>4) Sortie :
<pre><code>prime_cumul(${s.seuil}) = ${s.A}</code></pre>
Seuil atteint en <b>${s.A}</b>.
      </div>`
  },

  { // 2) Dons annuels croissants
    enonce: s => `
      <p><strong>Exercice F3 :</strong><br>
      En <b>${s.an0}</b>, un donateur verse <b>${s.M0}‚Ç¨</b>, puis augmente son don de <b>${s.d}‚Ç¨</b> chaque ann√©e. <br>Il souhaite atteindre un cumul d‚Äôau moins <b>${s.seuil}‚Ç¨</b>.</p>
    `,
    q1: s => `1) Quel don M en ${s.an0+1} ? en ${s.an0+2} ?`,
    q2: s => `2) Quel cumul T en ${s.an0+1} ? en ${s.an0+2} ?`,
    q3: s => `3) √âcrire une fonction Python renvoyant l‚Äôann√©e d‚Äôatteinte de ${s.seuil}‚Ç¨.`,
    q4: s => `4) Quelle ann√©e est obtenue ?`,
    solution: s => `
      <div class="steps">
        <p>1) M=${s.M1}‚Ç¨ ; M=${s.M2}‚Ç¨.</p>
        <p>2) T=${s.T1}‚Ç¨ ; T=${s.T2}‚Ç¨.</p>
<pre><code>def dons(seuil):
    a = ${s.an0}
    m = ${s.M0}
    T = m
    while T &lt; seuil:
        m = m + ${s.d}
        T = T + m
        a = a + 1
    return a</code></pre>
        <p>4) R√©sultat :
<pre><code>dons(${s.seuil}) = ${s.A}</code></pre>
Atteint en <b>${s.A}</b>.
      </div>`
  },

  { // 3) Pages lues
    enonce: s => `
      <p><strong>Exercice F3 :</strong><br>
      Le 1er janvier <b>${s.an0}</b>, un √©l√®ve lit <b>${s.M0}</b> pages. Chaque ann√©e, il lit <b>${s.d}</b> pages de plus. <br>Il attend d‚Äôavoir lu au moins <b>${s.seuil}</b> pages au total.</p>
    `,
    q1: s => `1) Combien de pages M en ${s.an0+1} ? en ${s.an0+2} ?`,
    q2: s => `2) Quel total T en ${s.an0+1} ? en ${s.an0+2} ?`,
    q3: s => `3) √âcrire une fonction Python qui affiche l‚Äôann√©e o√π le total atteint ${s.seuil} pages.`,
    q4: s => `4) Quelle ann√©e est affich√©e ?`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.M1} ; ${s.M2}.</p>
        <p>2) ${s.T1} ; ${s.T2}.</p>
<pre><code>def lecture(seuil):
    a = ${s.an0}
    P = ${s.M0}
    T = P
    while T &lt; seuil:
        P = P + ${s.d}
        T = T + P
        a = a + 1
    return a</code></pre>
        <p>4) Valeur :
<pre><code>lecture(${s.seuil}) = ${s.A}</code></pre>
Seuil atteint en <b>${s.A}</b>.
      </div>`
  },

  { // 4) Kilom√®tres courus
    enonce: s => `
      <p><strong>Exercice F3 :</strong><br>
      D√©but <b>${s.an0}</b>, un coureur r√©alise <b>${s.M0}</b> km et ajoute <b>${s.d}</b> km chaque ann√©e. <br>Il attend d‚Äôavoir parcouru au moins <b>${s.seuil}</b> km au total.</p>
    `,
    q1: s => `1) Kilom√©trage M en ${s.an0+1} ? en ${s.an0+2} ?`,
    q2: s => `2) Total T en ${s.an0+1} ? en ${s.an0+2} ?`,
    q3: s => `3) √âcrire une fonction Python affichant l‚Äôann√©e o√π T atteint ${s.seuil} km.`,
    q4: s => `4) Quelle ann√©e ?`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.M1} km ; ${s.M2} km.</p>
        <p>2) ${s.T1} km ; ${s.T2} km.</p>
<pre><code>def km_cumul(seuil):
    a = ${s.an0}
    K = ${s.M0}
    T = K
    while T &lt; seuil:
        K = K + ${s.d}
        T = T + K
        a = a + 1
    return a</code></pre>
        <p>4) Sortie :
<pre><code>km_cumul(${s.seuil}) = ${s.A}</code></pre>
R√©ponse : <b>${s.A}</b>.
      </div>`
  },

  { // 5) Points fid√©lit√©
    enonce: s => `
      <p><strong>Exercice F3 :</strong><br>
      En <b>${s.an0}</b>, un client gagne <b>${s.M0}</b> points puis <b>${s.d}</b> points de plus chaque ann√©e. <br>Il vise un cumul d‚Äôau moins <b>${s.seuil}</b> points.</p>
    `,
    q1: s => `1) Combien de points M en ${s.an0+1} ? en ${s.an0+2} ?`,
    q2: s => `2) Quel cumul T en ${s.an0+1} ? en ${s.an0+2} ?`,
    q3: s => `3) √âcrire une fonction Python retournant l‚Äôann√©e d‚Äôatteinte de ${s.seuil} points.`,
    q4: s => `4) Quelle ann√©e sort ?`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.M1} ; ${s.M2}.</p>
        <p>2) ${s.T1} ; ${s.T2}.</p>
<pre><code>def points(seuil):
    a = ${s.an0}
    P = ${s.M0}
    T = P
    while T &lt; seuil:
        P = P + ${s.d}
        T = T + P
        a = a + 1
    return a</code></pre>
        <p>4) R√©sultat :
<pre><code>points(${s.seuil}) = ${s.A}</code></pre>
Ann√©e : <b>${s.A}</b>.
      </div>`
  },

  { // 6) Heures de b√©n√©volat
    enonce: s => `
      <p><strong>Exercice F3 :</strong><br>
      Le 1er janvier <b>${s.an0}</b>, un b√©n√©vole donne <b>${s.M0}</b> h, puis augmente de <b>${s.d}</b> h/an. <br>Il veut atteindre au moins <b>${s.seuil}</b> h au total.</p>
    `,
    q1: s => `1) M en ${s.an0+1} ? en ${s.an0+2} ?`,
    q2: s => `2) T en ${s.an0+1} ? en ${s.an0+2} ?`,
    q3: s => `3) √âcrire une fonction Python qui renvoie l‚Äôann√©e d‚Äôatteinte de ${s.seuil} h.`,
    q4: s => `4) Quelle ann√©e ?`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.M1} h ; ${s.M2} h.</p>
        <p>2) ${s.T1} h ; ${s.T2} h.</p>
<pre><code>def benevolat(seuil):
    a = ${s.an0}
    H = ${s.M0}
    T = H
    while T &lt; seuil:
        H = H + ${s.d}
        T = T + H
        a = a + 1
    return a</code></pre>
        <p>4) Valeur :
<pre><code>benevolat(${s.seuil}) = ${s.A}</code></pre>
Seuil atteint en <b>${s.A}</b>.
      </div>`
  },

  { // 7) Budget culture lyc√©e
    enonce: s => `
      <p><strong>Exercice F3 :</strong><br>
      En <b>${s.an0}</b>, un lyc√©e consacre <b>${s.M0}‚Ç¨</b> √† la culture, puis ajoute <b>${s.d}‚Ç¨</b> chaque ann√©e. <br>On cumule jusqu‚Äô√† atteindre <b>${s.seuil}‚Ç¨</b>.</p>
    `,
    q1: s => `1) Montant M en ${s.an0+1} ? en ${s.an0+2} ?`,
    q2: s => `2) Cumul T en ${s.an0+1} ? en ${s.an0+2} ?`,
    q3: s => `3) √âcrire une fonction Python qui affiche l‚Äôann√©e d‚Äôatteinte de ${s.seuil}‚Ç¨.`,
    q4: s => `4) Quelle ann√©e ?`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.M1}‚Ç¨ ; ${s.M2}‚Ç¨.</p>
        <p>2) ${s.T1}‚Ç¨ ; ${s.T2}‚Ç¨.</p>
<pre><code>def budget(seuil):
    a = ${s.an0}
    B = ${s.M0}
    T = B
    while T &lt; seuil:
        B = B + ${s.d}
        T = T + B
        a = a + 1
    return a</code></pre>
        <p>4) Sortie :
<pre><code>budget(${s.seuil}) = ${s.A}</code></pre>
R√©ponse : <b>${s.A}</b>.
      </div>`
  },

  { // 8) Arbres plant√©s
    enonce: s => `
      <p><strong>Exercice F3 :</strong><br>
      Une classe plante <b>${s.M0}</b> arbres au 1er janvier <b>${s.an0}</b>, puis <b>${s.d}</b> de plus chaque ann√©e. <br>On patiente jusqu‚Äôau total d‚Äôau moins <b>${s.seuil}</b> arbres.</p>
    `,
    q1: s => `1) M en ${s.an0+1} ? en ${s.an0+2} ?`,
    q2: s => `2) T en ${s.an0+1} ? en ${s.an0+2} ?`,
    q3: s => `3) √âcrire une fonction Python affichant l‚Äôann√©e o√π T ‚â• ${s.seuil}.`,
    q4: s => `4) Quelle ann√©e est affich√©e ?`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.M1} ; ${s.M2}.</p>
        <p>2) ${s.T1} ; ${s.T2}.</p>
<pre><code>def arbres(seuil):
    a = ${s.an0}
    A = ${s.M0}
    T = A
    while T &lt; seuil:
        A = A + ${s.d}
        T = T + A
        a = a + 1
    return a</code></pre>
        <p>4) R√©sultat :
<pre><code>arbres(${s.seuil}) = ${s.A}</code></pre>
Atteint en <b>${s.A}</b>.
      </div>`
  },

  { // 9) Articles publi√©s
    enonce: s => `
      <p><strong>Exercice F3 :</strong><br>
      Un blog publie <b>${s.M0}</b> articles en <b>${s.an0}</b>, puis <b>${s.d}</b> de plus chaque ann√©e. <br>√Ä partir de quand le cumul atteindra-t-il <b>${s.seuil}</b> articles ?</p>
    `,
    q1: s => `1) Articles M en ${s.an0+1} ? en ${s.an0+2} ?`,
    q2: s => `2) Total T en ${s.an0+1} ? en ${s.an0+2} ?`,
    q3: s => `3) √âcrire une fonction Python renvoyant l‚Äôann√©e d‚Äôatteinte de ${s.seuil} articles.`,
    q4: s => `4) Quelle ann√©e ?`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.M1} ; ${s.M2}.</p>
        <p>2) ${s.T1} ; ${s.T2}.</p>
<pre><code>def articles(seuil):
    a = ${s.an0}
    m = ${s.M0}
    T = m
    while T &lt; seuil:
        m = m + ${s.d}
        T = T + m
        a = a + 1
    return a</code></pre>
        <p>4) Valeur :
<pre><code>articles(${s.seuil}) = ${s.A}</code></pre>
Ann√©e : <b>${s.A}</b>.
      </div>`
  },

  { // 10) Heures de formation internes
    enonce: s => `
      <p><strong>Exercice F3 :</strong><br>
      En <b>${s.an0}</b>, une entreprise cumule <b>${s.M0}</b> h de formation, puis ajoute <b>${s.d}</b> h chaque ann√©e. <br>Objectif : au moins <b>${s.seuil}</b> h cumul√©es.</p>
    `,
    q1: s => `1) Heures M en ${s.an0+1} ? en ${s.an0+2} ?`,
    q2: s => `2) Cumul T en ${s.an0+1} ? en ${s.an0+2} ?`,
    q3: s => `3) √âcrire une fonction Python qui affiche l‚Äôann√©e d‚Äôatteinte de ${s.seuil} h.`,
    q4: s => `4) Quelle ann√©e s‚Äôaffiche ?`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.M1} h ; ${s.M2} h.</p>
        <p>2) ${s.T1} h ; ${s.T2} h.</p>
<pre><code>def formation(seuil):
    a = ${s.an0}
    H = ${s.M0}
    T = H
    while T &lt; seuil:
        H = H + ${s.d}
        T = T + H
        a = a + 1
    return a</code></pre>
        <p>4) Sortie :
<pre><code>formation(${s.seuil}) = ${s.A}</code></pre>
R√©ponse : <b>${s.A}</b>.
      </div>`
  }
],

/* =========================
   F4 ‚Äî Co√ªt lin√©aire croissant (c1, c2, +step) + budget ‚Üí profondeur max
   Donn√©es : {c1,c2,step,budget,prof}
   ========================= */
F4_tantque : [
  { // 0) ‚Äî‚Äî ORIGINAL (Puits) ‚Äî‚Äî
    enonce: s => `
      <p><strong>Exercice F4 :</strong><br>
      Une entreprise de forage creuse des puits dans le d√©sert afin d'atteindre la nappe d'eau phr√©atique. <br>Cette entreprise facture le premier m√®tre <b>${s.c1}‚Ç¨</b>, le second m√®tre <b>${s.c2}‚Ç¨</b> et ainsi de suite en augmentant le prix de chaque nouveau m√®tre creus√© de <b>${s.step}‚Ç¨</b>.<br>
      Une organisation humanitaire dispose de <b>${s.budget}‚Ç¨</b> pour faire creuser un puits.</p>
    `,
    q1: s => `1) Ecrire une fonction en langage Python qui permet de connaitre la profondeur maximale du puits que peut financer cette organisation.`,
    q2: s => `2) Tester la fonction ci-dessus pour les montants suivants :`,
    solution: s => {
      const depth = B => { let p=0, prix=s.c1, reste=B; while(reste>=prix){ reste-=prix; p++; prix+=s.step; } return p; };
      const profMinus = depth(s.budget-1000), profExact = s.prof, profPlus = depth(s.budget+1000);
      return `
      <div class="steps">
<pre><code>def profondeur(budget):
    p = 0
    prix = ${s.c1}
    reste = budget
    while reste &gt;= prix:
        reste = reste - prix
        prix = prix + ${s.step}
        p = p + 1
    return p</code></pre>
        <p>Valeur en sortie :
<pre><code>profondeur(${s.budget}) = ${profExact}</code></pre>
Avec ${s.budget}‚Ç¨, la profondeur maximale est de ${profExact} m.
<br><br>
2) Tableau :
<pre><code>profondeur(${s.budget-1000}) = ${profMinus}
profondeur(${s.budget}) = ${profExact}
profondeur(${s.budget+1000}) = ${profPlus}</code></pre>
      </div>`;
    }
  },

  { // 1) Marches d‚Äôescalier
    enonce: s => `
      <p><strong>Exercice F4 :</strong><br>
      Un artisan facture la 1 ≥·µâ marche <b>${s.c1}‚Ç¨</b>, la 2·µâ <b>${s.c2}‚Ç¨</b>, puis chaque marche co√ªte <b>${s.step}‚Ç¨</b> de plus que la pr√©c√©dente. <br>On dispose d‚Äôun budget de <b>${s.budget}‚Ç¨</b>.</p>
    `,
    q1: s => `1) √âcrire une fonction Python renvoyant le nombre maximal de marches r√©alisables avec un budget donn√©.`,
    q2: s => `2) Tester la fonction pour ${s.budget-1000}‚Ç¨, ${s.budget}‚Ç¨ et ${s.budget+1000}‚Ç¨ :`,
    solution: s => {
      const depth = B => { let p=0, prix=s.c1, reste=B; while(reste>=prix){ reste-=prix; p++; prix+=s.step; } return p; };
      const A = depth(s.budget-1000), B0 = s.prof, C = depth(s.budget+1000);
      return `
      <div class="steps">
<pre><code>def marches(budget):
    n = 0
    prix = ${s.c1}
    reste = budget
    while reste &gt;= prix:
        reste = reste - prix
        prix  = prix + ${s.step}
        n = n + 1
    return n</code></pre>
        <p>Valeur en sortie :
<pre><code>marches(${s.budget}) = ${B0}</code></pre>
Avec ${s.budget}‚Ç¨, on construit ${B0} marche(s).
<br><br>
2) Tableau :
<pre><code>marches(${s.budget-1000}) = ${A}
marches(${s.budget}) = ${B0}
marches(${s.budget+1000}) = ${C}</code></pre>
      </div>`;
    }
  },

  { // 2) Gradins de stade
    enonce: s => `
      <p><strong>Exercice F4 :</strong><br>
      Ajouter un rang de gradins co√ªte <b>${s.c1}‚Ç¨</b>, le suivant <b>${s.c2}‚Ç¨</b>, puis +<b>${s.step}‚Ç¨</b> √† chaque rang suppl√©mentaire. <br>Budget : <b>${s.budget}‚Ç¨</b>.</p>
    `,
    q1: s => `1) √âcrire une fonction Python qui renvoie le nombre maximal de rangs finan√ßables.`,
    q2: s => `2) Tester pour ${s.budget-1000}‚Ç¨, ${s.budget}‚Ç¨ et ${s.budget+1000}‚Ç¨ :`,
    solution: s => {
      const depth = B => { let p=0, prix=s.c1, reste=B; while(reste>=prix){ reste-=prix; p++; prix+=s.step; } return p; };
      const A = depth(s.budget-1000), B0 = s.prof, C = depth(s.budget+1000);
      return `
      <div class="steps">
<pre><code>def gradins(budget):
    r = 0
    prix = ${s.c1}
    reste = budget
    while reste &gt;= prix:
        reste = reste - prix
        prix  = prix + ${s.step}
        r = r + 1
    return r</code></pre>
        <p>Valeur en sortie :
<pre><code>gradins(${s.budget}) = ${B0}</code></pre>
On peut financer ${B0} rang(s).
<br><br>
2) Tableau :
<pre><code>gradins(${s.budget-1000}) = ${A}
gradins(${s.budget}) = ${B0}
gradins(${s.budget+1000}) = ${C}</code></pre>
      </div>`;
    }
  },

  { // 3) Ateliers (co√ªt croissant)
    enonce: s => `
      <p><strong>Exercice F4 :</strong><br>
      Le 1·µâ ≥ atelier co√ªte <b>${s.c1}‚Ç¨</b>, le 2·µâ <b>${s.c2}‚Ç¨</b>, puis chaque atelier ajoute <b>${s.step}‚Ç¨</b>. <br>Budget total : <b>${s.budget}‚Ç¨</b>.</p>
    `,
    q1: s => `1) √âcrire une fonction Python d√©terminant le nombre maximal d‚Äôateliers.`,
    q2: s => `2) Tester pour ${s.budget-1000}‚Ç¨, ${s.budget}‚Ç¨ et ${s.budget+1000}‚Ç¨ :`,
    solution: s => {
      const depth = B => { let p=0, prix=s.c1, reste=B; while(reste>=prix){ reste-=prix; p++; prix+=s.step; } return p; };
      const A = depth(s.budget-1000), B0 = s.prof, C = depth(s.budget+1000);
      return `
      <div class="steps">
<pre><code>def ateliers(budget):
    n = 0
    cout = ${s.c1}
    reste = budget
    while reste &gt;= cout:
        reste = reste - cout
        cout  = cout + ${s.step}
        n = n + 1
    return n</code></pre>
        <p>Valeur en sortie :
<pre><code>ateliers(${s.budget}) = ${B0}</code></pre>
On finance ${B0} atelier(s).
<br><br>
2) Tableau :
<pre><code>ateliers(${s.budget-1000}) = ${A}
ateliers(${s.budget}) = ${B0}
ateliers(${s.budget+1000}) = ${C}</code></pre>
      </div>`;
    }
  },

  { // 4) Tron√ßons de piste cyclable
    enonce: s => `
      <p><strong>Exercice F4 :</strong><br>
      Le 1·µâ ≥ tron√ßon co√ªte <b>${s.c1}‚Ç¨</b>, le 2·µâ <b>${s.c2}‚Ç¨</b>, puis +<b>${s.step}‚Ç¨</b> √† chaque nouveau tron√ßon. <br>Budget disponible : <b>${s.budget}‚Ç¨</b>.</p>
    `,
    q1: s => `1) √âcrire une fonction Python qui renvoie le nombre maximal de tron√ßons.`,
    q2: s => `2) Tester pour ${s.budget-1000}‚Ç¨, ${s.budget}‚Ç¨ et ${s.budget+1000}‚Ç¨ :`,
    solution: s => {
      const depth = B => { let p=0, prix=s.c1, reste=B; while(reste>=prix){ reste-=prix; p++; prix+=s.step; } return p; };
      const A = depth(s.budget-1000), B0 = s.prof, C = depth(s.budget+1000);
      return `
      <div class="steps">
<pre><code>def troncons(budget):
    n = 0
    prix = ${s.c1}
    reste = budget
    while reste &gt;= prix:
        reste = reste - prix
        prix  = prix + ${s.step}
        n = n + 1
    return n</code></pre>
        <p>Valeur en sortie :
<pre><code>troncons(${s.budget}) = ${B0}</code></pre>
On peut r√©aliser ${B0} tron√ßon(s).
<br><br>
2) Tableau :
<pre><code>troncons(${s.budget-1000}) = ${A}
troncons(${s.budget}) = ${B0}
troncons(${s.budget+1000}) = ${C}</code></pre>
      </div>`;
    }
  },

  { // 5) Niveaux d‚Äôun jeu
    enonce: s => `
      <p><strong>Exercice F4 :</strong><br>
      D√©velopper le niveau 1 co√ªte <b>${s.c1}‚Ç¨</b>, le niveau 2 <b>${s.c2}‚Ç¨</b>, puis chaque niveau ajoute <b>${s.step}‚Ç¨</b>. <br>Budget : <b>${s.budget}‚Ç¨</b>.</p>
    `,
    q1: s => `1) √âcrire une fonction Python renvoyant le nombre maximal de niveaux.`,
    q2: s => `2) Tester pour ${s.budget-1000}‚Ç¨, ${s.budget}‚Ç¨ et ${s.budget+1000}‚Ç¨ :`,
    solution: s => {
      const depth = B => { let p=0, prix=s.c1, reste=B; while(reste>=prix){ reste-=prix; p++; prix+=s.step; } return p; };
      const A = depth(s.budget-1000), B0 = s.prof, C = depth(s.budget+1000);
      return `
      <div class="steps">
<pre><code>def niveaux(budget):
    k = 0
    cout = ${s.c1}
    reste = budget
    while reste &gt;= cout:
        reste = reste - cout
        cout  = cout + ${s.step}
        k = k + 1
    return k</code></pre>
        <p>Valeur en sortie :
<pre><code>niveaux(${s.budget}) = ${B0}</code></pre>
On peut cr√©er ${B0} niveau(x).
<br><br>
2) Tableau :
<pre><code>niveaux(${s.budget-1000}) = ${A}
niveaux(${s.budget}) = ${B0}
niveaux(${s.budget+1000}) = ${C}</code></pre>
      </div>`;
    }
  },

  { // 6) Tourn√©es de livraison
    enonce: s => `
      <p><strong>Exercice F4 :</strong><br>
      La 1 ≥·µâ tourn√©e co√ªte <b>${s.c1}‚Ç¨</b>, la 2·µâ <b>${s.c2}‚Ç¨</b>, puis +<b>${s.step}‚Ç¨</b> par tourn√©e suivante. <br>Budget : <b>${s.budget}‚Ç¨</b>.</p>
    `,
    q1: s => `1) √âcrire une fonction Python renvoyant le nombre maximal de tourn√©es.`,
    q2: s => `2) Tester pour ${s.budget-1000}‚Ç¨, ${s.budget}‚Ç¨ et ${s.budget+1000}‚Ç¨ :`,
    solution: s => {
      const depth = B => { let p=0, prix=s.c1, reste=B; while(reste>=prix){ reste-=prix; p++; prix+=s.step; } return p; };
      const A = depth(s.budget-1000), B0 = s.prof, C = depth(s.budget+1000);
      return `
      <div class="steps">
<pre><code>def tournees(budget):
    t = 0
    prix = ${s.c1}
    reste = budget
    while reste &gt;= prix:
        reste = reste - prix
        prix  = prix + ${s.step}
        t = t + 1
    return t</code></pre>
        <p>Valeur en sortie :
<pre><code>tournees(${s.budget}) = ${B0}</code></pre>
On finance ${B0} tourn√©e(s).
<br><br>
2) Tableau :
<pre><code>tournees(${s.budget-1000}) = ${A}
tournees(${s.budget}) = ${B0}
tournees(${s.budget+1000}) = ${C}</code></pre>
      </div>`;
    }
  },

  { // 7) Sessions de formation
    enonce: s => `
      <p><strong>Exercice F4 :</strong><br>
      1 ≥·µâ session : <b>${s.c1}‚Ç¨</b>, 2·µâ : <b>${s.c2}‚Ç¨</b>, puis +<b>${s.step}‚Ç¨</b> par session. <br>Budget : <b>${s.budget}‚Ç¨</b>.</p>
    `,
    q1: s => `1) √âcrire une fonction Python renvoyant le nombre maximal de sessions.`,
    q2: s => `2) Tester pour ${s.budget-1000}‚Ç¨, ${s.budget}‚Ç¨ et ${s.budget+1000}‚Ç¨ :`,
    solution: s => {
      const depth = B => { let p=0, prix=s.c1, reste=B; while(reste>=prix){ reste-=prix; p++; prix+=s.step; } return p; };
      const A = depth(s.budget-1000), B0 = s.prof, C = depth(s.budget+1000);
      return `
      <div class="steps">
<pre><code>def sessions(budget):
    n = 0
    prix = ${s.c1}
    reste = budget
    while reste &gt;= prix:
        reste = reste - prix
        prix  = prix + ${s.step}
        n = n + 1
    return n</code></pre>
        <p>Valeur en sortie :
<pre><code>sessions(${s.budget}) = ${B0}</code></pre>
On peut organiser ${B0} session(s).
<br><br>
2) Tableau :
<pre><code>sessions(${s.budget-1000}) = ${A}
sessions(${s.budget}) = ${B0}
sessions(${s.budget+1000}) = ${C}</code></pre>
      </div>`;
    }
  },

  { // 8) Segments de route
    enonce: s => `
      <p><strong>Exercice F4 :</strong><br>
      Segment 1 : <b>${s.c1}‚Ç¨</b>, segment 2 : <b>${s.c2}‚Ç¨</b>, puis +<b>${s.step}‚Ç¨</b>/segment. <br>Budget : <b>${s.budget}‚Ç¨</b>.</p>
    `,
    q1: s => `1) √âcrire une fonction Python renvoyant le nombre maximal de segments.`,
    q2: s => `2) Tester pour ${s.budget-1000}‚Ç¨, ${s.budget}‚Ç¨ et ${s.budget+1000}‚Ç¨ :`,
    solution: s => {
      const depth = B => { let p=0, prix=s.c1, reste=B; while(reste>=prix){ reste-=prix; p++; prix+=s.step; } return p; };
      const A = depth(s.budget-1000), B0 = s.prof, C = depth(s.budget+1000);
      return `
      <div class="steps">
<pre><code>def segments(budget):
    n = 0
    prix = ${s.c1}
    reste = budget
    while reste &gt;= prix:
        reste = reste - prix
        prix  = prix + ${s.step}
        n = n + 1
    return n</code></pre>
        <p>Valeur en sortie :
<pre><code>segments(${s.budget}) = ${B0}</code></pre>
On r√©alise ${B0} segment(s).
<br><br>
2) Tableau :
<pre><code>segments(${s.budget-1000}) = ${A}
segments(${s.budget}) = ${B0}
segments(${s.budget+1000}) = ${C}</code></pre>
      </div>`;
    }
  },

  { // 9) Modules d‚Äôun MOOC
    enonce: s => `
      <p><strong>Exercice F4 :</strong><br>
      Module 1 : <b>${s.c1}‚Ç¨</b>, module 2 : <b>${s.c2}‚Ç¨</b>, puis +<b>${s.step}‚Ç¨</b>/module. <br>Budget : <b>${s.budget}‚Ç¨</b>.</p>
    `,
    q1: s => `1) √âcrire une fonction Python renvoyant le nombre maximal de modules.`,
    q2: s => `2) Tester pour ${s.budget-1000}‚Ç¨, ${s.budget}‚Ç¨ et ${s.budget+1000}‚Ç¨ :`,
    solution: s => {
      const depth = B => { let p=0, prix=s.c1, reste=B; while(reste>=prix){ reste-=prix; p++; prix+=s.step; } return p; };
      const A = depth(s.budget-1000), B0 = s.prof, C = depth(s.budget+1000);
      return `
      <div class="steps">
<pre><code>def modules(budget):
    m = 0
    prix = ${s.c1}
    reste = budget
    while reste &gt;= prix:
        reste = reste - prix
        prix  = prix + ${s.step}
        m = m + 1
    return m</code></pre>
        <p>Valeur en sortie :
<pre><code>modules(${s.budget}) = ${B0}</code></pre>
On peut financer ${B0} module(s).
<br><br>
2) Tableau :
<pre><code>modules(${s.budget-1000}) = ${A}
modules(${s.budget}) = ${B0}
modules(${s.budget+1000}) = ${C}</code></pre>
      </div>`;
    }
  },

  { // 10) Paliers de subventions
    enonce: s => `
      <p><strong>Exercice F4 :</strong><br>
      1er palier : <b>${s.c1}‚Ç¨</b>, 2e palier : <b>${s.c2}‚Ç¨</b>, puis +<b>${s.step}‚Ç¨</b>/palier. <br>Budget total : <b>${s.budget}‚Ç¨</b>.</p>
    `,
    q1: s => `1) √âcrire une fonction Python renvoyant le nombre maximal de paliers.`,
    q2: s => `2) Tester pour ${s.budget-1000}‚Ç¨, ${s.budget}‚Ç¨ et ${s.budget+1000}‚Ç¨ :`,
    solution: s => {
      const depth = B => { let p=0, prix=s.c1, reste=B; while(reste>=prix){ reste-=prix; p++; prix+=s.step; } return p; };
      const A = depth(s.budget-1000), B0 = s.prof, C = depth(s.budget+1000);
      return `
      <div class="steps">
<pre><code>def paliers(budget):
    n = 0
    prix = ${s.c1}
    reste = budget
    while reste &gt;= prix:
        reste = reste - prix
        prix  = prix + ${s.step}
        n = n + 1
    return n</code></pre>
        <p>Valeur en sortie :
<pre><code>paliers(${s.budget}) = ${B0}</code></pre>
On finance ${B0} palier(s).
<br><br>
2) Tableau :
<pre><code>paliers(${s.budget-1000}) = ${A}
paliers(${s.budget}) = ${B0}
paliers(${s.budget+1000}) = ${C}</code></pre>
      </div>`;
    }
  }
],

/* =========================
   F5 ‚Äî D√©croissance % + ajout constant, jusqu‚Äô√† d√©passer une cible
   Donn√©es : { d, add, P0, cible, fac, an }
   ========================= */
F5_tantque : [
  { // 0) ‚Äî‚Äî ORIGINAL (Truites) ‚Äî‚Äî
    enonce: s => `
      <p><strong>Exercice  F5 :</strong><br>
      Des chercheurs √©tudient l'√©volution de la population de truites dans un lac de montagne. <br>Ils constatent une diminution annuelle moyenne de <b>${s.d}%</b> de cette population.<br>
      Afin de sauvegarder l'esp√®ce, ils d√©cident d'introduire chaque ann√©e <b>${s.add}</b> nouvelles truites.<br>
      On estime la population initiale du lac √† <b>${s.P0}</b> truites.<br>
      On souhaite savoir au bout de combien d'ann√©es la population d√©passera les <b>${s.cible}</b> individus.</p>
    `,
    q1: s => `1) Ecrire une fonction en langage Python r√©pondant au probl√®me.`,
    q2: s => `2) Quelle est l'ann√©e cherch√©e ?`,
    solution: s => `
      <div class="steps">
<pre><code>def truites(cible):    
    n = 0
    P  = ${s.P0}
    while P &lt;= cible:
        P = P * (1-${s.d}/100) + ${s.add}
        n = n + 1
    return n</code></pre>
        <p>2) Valeur en sortie :
<pre><code>truites(${s.cible}) = ${s.an}</code></pre>
La population d√©passera ${s.cible} truites au bout de <b>${s.an}</b> ans.
      </div>`
  },

  { // 1) R√©servoir d‚Äôeau (√©vaporation + apport)
    enonce: s => `
      <p><strong>Exercice  F5 :</strong><br>
      Un r√©servoir contient <b>${s.P0}</b> m¬≥ d‚Äôeau. Chaque ann√©e, il perd <b>${s.d}%</b> de son volume, mais re√ßoit <b>${s.add}</b> m¬≥ d‚Äôapport. <br>Quand le volume d√©passera-t-il <b>${s.cible}</b> m¬≥ ?</p>
    `,
    q1: s => `1) √âcrire une fonction Python donnant l‚Äôann√©e o√π le seuil est d√©pass√©.`,
    q2: s => `2) Quelle est l‚Äôann√©e cherch√©e ?`,
    solution: s => `
      <div class="steps">
<pre><code>def reservoir(cible):
    n = 0
    V = ${s.P0}
    while V &lt;= cible:
        V = V*(1 - ${s.d}/100) + ${s.add}
        n = n + 1
    return n</code></pre>
        <p>2) R√©sultat :
<pre><code>reservoir(${s.cible}) = ${s.an}</code></pre>
R√©ponse : <b>${s.an}</b> an(s).
      </div>`
  },

  { // 2) Abonn√©s actifs (attrition + acquisition)
    enonce: s => `
      <p><strong>Exercice  F5 :</strong><br>
      Un service compte <b>${s.P0}</b> abonn√©s actifs. Chaque ann√©e, <b>${s.d}%</b> se d√©sabonnent, et <b>${s.add}</b> nouveaux actifs arrivent. <br>Au bout de combien d‚Äôann√©es d√©passera-t-on <b>${s.cible}</b> actifs ?</p>
    `,
    q1: s => `1) √âcrire une fonction Python pour simuler l‚Äô√©volution.`,
    q2: s => `2) Donner l‚Äôann√©e obtenue.`,
    solution: s => `
      <div class="steps">
<pre><code>def actifs(cible):
    n = 0
    A = ${s.P0}
    while A &lt;= cible:
        A = A*(1 - ${s.d}/100) + ${s.add}
        n = n + 1
    return n</code></pre>
        <p>2) Valeur :
<pre><code>actifs(${s.cible}) = ${s.an}</code></pre>
Apr√®s <b>${s.an}</b> an(s).
      </div>`
  },

  { // 3) Population d‚Äôune ville
    enonce: s => `
      <p><strong>Exercice  F5 :</strong><br>
      Une ville perd <b>${s.d}%</b> d‚Äôhabitants/an, mais accueille <b>${s.add}</b> nouveaux habitants chaque ann√©e. <br>Partant de <b>${s.P0}</b> habitants, quand d√©passera-t-on <b>${s.cible}</b> ?</p>
    `,
    q1: s => `1) √âcrire une fonction Python pour d√©terminer l‚Äôann√©e.`,
    q2: s => `2) Quelle ann√©e ?`,
    solution: s => `
      <div class="steps">
<pre><code>def population(cible):
    n = 0
    P = ${s.P0}
    while P &lt;= cible:
        P = P*(1 - ${s.d}/100) + ${s.add}
        n = n + 1
    return n</code></pre>
        <p>2) Sortie :
<pre><code>population(${s.cible}) = ${s.an}</code></pre>
R√©sultat : <b>${s.an}</b>.
      </div>`
  },

  { // 4) For√™t (maladie + plantation)
    enonce: s => `
      <p><strong>Exercice  F5 :</strong><br>
      Une for√™t perd <b>${s.d}%</b> d‚Äôarbres/an (maladie), mais on replante <b>${s.add}</b> arbres/an. <br>√Ä partir de <b>${s.P0}</b> arbres, quand d√©passera-t-on <b>${s.cible}</b> ?</p>
    `,
    q1: s => `1) √âcrire la fonction Python correspondante.`,
    q2: s => `2) Quelle est l‚Äôann√©e ?`,
    solution: s => `
      <div class="steps">
<pre><code>def foret(cible):
    n = 0
    N = ${s.P0}
    while N &lt;= cible:
        N = N*(1 - ${s.d}/100) + ${s.add}
        n = n + 1
    return n</code></pre>
        <p>2) Valeur :
<pre><code>foret(${s.cible}) = ${s.an}</code></pre>
Apr√®s <b>${s.an}</b> an(s).
      </div>`
  },

  { // 5) Niveau d‚Äôun lac
    enonce: s => `
      <p><strong>Exercice  F5 :</strong><br>
      Le niveau d‚Äôun lac baisse de <b>${s.d}%</b> par an mais re√ßoit <b>${s.add}</b> m¬≥/an d‚Äôaffluents. <br>Partant de <b>${s.P0}</b> m¬≥, quand d√©passera-t-il <b>${s.cible}</b> m¬≥ ?</p>
    `,
    q1: s => `1) √âcrire la fonction Python.`,
    q2: s => `2) Donner le nombre d‚Äôann√©es.`,
    solution: s => `
      <div class="steps">
<pre><code>def lac(cible):
    n = 0
    V = ${s.P0}
    while V &lt;= cible:
        V = V*(1 - ${s.d}/100) + ${s.add}
        n = n + 1
    return n</code></pre>
        <p>2) R√©sultat :
<pre><code>lac(${s.cible}) = ${s.an}</code></pre>
R√©ponse : <b>${s.an}</b>.
      </div>`
  },

  { // 6) Parc de bus
    enonce: s => `
      <p><strong>Exercice  F5 :</strong><br>
      Une compagnie met au rebut <b>${s.d}%</b> de ses bus/an mais ach√®te <b>${s.add}</b> v√©hicules/an. <br>Depuis <b>${s.P0}</b> bus, quand d√©passera-t-on <b>${s.cible}</b> ?</p>
    `,
    q1: s => `1) √âcrire la fonction Python.`,
    q2: s => `2) Nombre d‚Äôann√©es ?`,
    solution: s => `
      <div class="steps">
<pre><code>def bus(cible):
    n = 0
    B = ${s.P0}
    while B &lt;= cible:
        B = B*(1 - ${s.d}/100) + ${s.add}
        n = n + 1
    return n</code></pre>
        <p>2) Valeur :
<pre><code>bus(${s.cible}) = ${s.an}</code></pre>
Apr√®s <b>${s.an}</b> an(s).
      </div>`
  },

  { // 7) Biblioth√®que (d√©sherbage + achats)
    enonce: s => `
      <p><strong>Exercice  F5 :</strong><br>
      Une m√©diath√®que retire <b>${s.d}%</b> de son stock/an et ach√®te <b>${s.add}</b> ouvrages/an. <br>Partant de <b>${s.P0}</b> ouvrages, quand d√©passera-t-elle <b>${s.cible}</b> ?</p>
    `,
    q1: s => `1) √âcrire la fonction Python de simulation.`,
    q2: s => `2) Indiquer l‚Äôann√©e obtenue.`,
    solution: s => `
      <div class="steps">
<pre><code>def biblio(cible):
    n = 0
    S = ${s.P0}
    while S &lt;= cible:
        S = S*(1 - ${s.d}/100) + ${s.add}
        n = n + 1
    return n</code></pre>
        <p>2) R√©sultat :
<pre><code>biblio(${s.cible}) = ${s.an}</code></pre>
Ann√©e : <b>${s.an}</b>.
      </div>`
  },

  { // 8) Newsletter (d√©sinscriptions + inscriptions)
    enonce: s => `
      <p><strong>Exercice  F5 :</strong><br>
      Une newsletter perd <b>${s.d}%</b> d‚Äôabonn√©s/an mais gagne <b>${s.add}</b> abonn√©s/an. <br>Depuis <b>${s.P0}</b> abonn√©s, quand d√©passera-t-on <b>${s.cible}</b> ?</p>
    `,
    q1: s => `1) √âcrire la fonction Python.`,
    q2: s => `2) Combien d‚Äôann√©es ?`,
    solution: s => `
      <div class="steps">
<pre><code>def news(cible):
    n = 0
    N = ${s.P0}
    while N &lt;= cible:
        N = N*(1 - ${s.d}/100) + ${s.add}
        n = n + 1
    return n</code></pre>
        <p>2) Valeur :
<pre><code>news(${s.cible}) = ${s.an}</code></pre>
R√©ponse : <b>${s.an}</b> an(s).
      </div>`
  },

  { // 9) Esp√®ce prot√©g√©e
    enonce: s => `
      <p><strong>Exercice  F5 :</strong><br>
      Une esp√®ce prot√©g√©e perd <b>${s.d}%</b>/an ; <b>${s.add}</b> individus sont r√©introduits/an. <br>Depuis <b>${s.P0}</b> individus, quand d√©passera-t-on <b>${s.cible}</b> ?</p>
    `,
    q1: s => `1) √âcrire la fonction Python.`,
    q2: s => `2) Donner le nombre d‚Äôann√©es.`,
    solution: s => `
      <div class="steps">
<pre><code>def espece(cible):
    n = 0
    P = ${s.P0}
    while P &lt;= cible:
        P = P*(1 - ${s.d}/100) + ${s.add}
        n = n + 1
    return n</code></pre>
        <p>2) R√©sultat :
<pre><code>espece(${s.cible}) = ${s.an}</code></pre>
Apr√®s <b>${s.an}</b> an(s).
      </div>`
  },

  { // 10) Capital machine (usure + maintenance)
    enonce: s => `
      <p><strong>Exercice  F5 :</strong><br>
      La valeur d‚Äôun parc machine d√©cro√Æt de <b>${s.d}%</b>/an, mais l‚Äôentreprise investit <b>${s.add}</b> unit√©s/an. <br>Partant de <b>${s.P0}</b>, quand d√©passera-t-on <b>${s.cible}</b> ?</p>
    `,
    q1: s => `1) Programmer la fonction Python.`,
    q2: s => `2) Indiquer l‚Äôann√©e.`,
    solution: s => `
      <div class="steps">
<pre><code>def capital(cible):
    n = 0
    V = ${s.P0}
    while V &lt;= cible:
        V = V*(1 - ${s.d}/100) + ${s.add}
        n = n + 1
    return n</code></pre>
        <p>2) Valeur :
<pre><code>capital(${s.cible}) = ${s.an}</code></pre>
Ann√©e : <b>${s.an}</b>.
      </div>`
  }
],

/* =========================
   F6 ‚Äî D√©croissance % jusqu‚Äô√† passer SOUS un seuil (ann√©es)
   Donn√©es : {Q0,p,seuil,fac,n}
   ========================= */
F6_tantque : [
  { // 0) ‚Äî‚Äî ORIGINAL (Rejets polluants) ‚Äî‚Äî
    enonce: s => `
      <p><strong>Exercice  F6 :</strong><br>
      En 2016, les rejets polluants d'un groupe industriel sont √©valu√©s √† <b>${s.Q0}</b> tonnes. <br>Le groupe est contraint de r√©duire ses rejets polluants de <b>${s.p}%</b> chaque ann√©e, jusqu'√† ce que ceux-ci ne d√©passent pas <b>${s.seuil}</b> tonnes annuelles. <br>On suppose que ce groupe respecte ce plan de r√©duction.</p>
    `,
    q1: s => `1) Par quelle valeur est multipli√©e chaque ann√©e  la quantit√© de rejets polluants?`,
    q2: s => `2) Ecrire une fonction en langage Python donnant le nombre d'ann√©es n√©cessaires pour que les rejets ne d√©passent pas ${s.seuil} tonnes annuelles.`,
    q3: s => `3) Nombre d'ann√©es :`,
    solution: s => `
      <div class="steps">
        <p>1) Diminuer de ${s.p} % revient √† multiplier par : \\( 1 - \\dfrac{${s.p}}{100} = ${s.fac} \\)</p>
<pre><code>def rejets(seuil):
    n = 0
    R = ${s.Q0}
    while R &gt; seuil:
        R = R * (1-${s.p}/100)
        n = n + 1
    return n</code></pre>
        <p>3) Valeur en sortie :
<pre><code>rejets(${s.seuil}) = ${s.n}</code></pre>
Il faut <b>${s.n}</b> ans pour que les rejets ne d√©passent pas ${s.seuil} t/an.
      </div>`
  },

  { // 1) NOx
    enonce: s => `
      <p><strong>Exercice  F6 :</strong><br>
      Les rejets de NOx d‚Äôun site sont de <b>${s.Q0}</b> t en 2016. On r√©duit de <b>${s.p}%</b> par an jusqu‚Äô√† passer sous <b>${s.seuil}</b> t.</p>
    `,
    q1: s => `1) Par quelle valeur est multipli√©e la quantit√© chaque ann√©e ?`,
    q2: s => `2) √âcrire une fonction Python donnant le nombre d‚Äôann√©es n√©cessaires.`,
    q3: s => `3) Nombre d‚Äôann√©es :`,
    solution: s => `
      <div class="steps">
        <p>1) Facteur : \\( 1 - \\dfrac{${s.p}}{100} = ${s.fac} \\)</p>
<pre><code>def nox(seuil):
    n = 0
    Q = ${s.Q0}
    while Q &gt; seuil:
        Q = Q * (1 - ${s.p}/100)
        n = n + 1
    return n</code></pre>
        <p>3) Sortie :
<pre><code>nox(${s.seuil}) = ${s.n}</code></pre>
Il faut <b>${s.n}</b> an(s).
      </div>`
  },

  { // 2) CO‚ÇÇ flotte
    enonce: s => `
      <p><strong>Exercice  F6 :</strong><br>
      Les √©missions annuelles de CO‚ÇÇ d‚Äôune flotte valent <b>${s.Q0}</b> t. On vise <b>${s.seuil}</b> t, avec une r√©duction de <b>${s.p}%</b>/an.</p>
    `,
    q1: s => `1) Par quel facteur est-on multipli√© chaque ann√©e ?`,
    q2: s => `2) √âcrire la fonction Python qui renvoie le nombre d‚Äôann√©es.`,
    q3: s => `3) Donner ce nombre :`,
    solution: s => `
      <div class="steps">
        <p>1) Facteur : ${s.fac}</p>
<pre><code>def co2(seuil):
    n = 0
    E = ${s.Q0}
    while E &gt; seuil:
        E = E * (1 - ${s.p}/100)
        n = n + 1
    return n</code></pre>
        <p>3) Valeur :
<pre><code>co2(${s.seuil}) = ${s.n}</code></pre>
R√©ponse : <b>${s.n}</b>.
      </div>`
  },

  { // 3) Niveau sonore
    enonce: s => `
      <p><strong>Exercice  F6 :</strong><br>
      Un chantier affiche un niveau sonore √©quivalent √† <b>${s.Q0}</b> unit√©s. On r√©duit de <b>${s.p}%</b> par an jusqu‚Äô√† passer sous <b>${s.seuil}</b>.</p>
    `,
    q1: s => `1) Facteur de r√©duction annuel ?`,
    q2: s => `2) √âcrire la fonction Python correspondante.`,
    q3: s => `3) Nombre d‚Äôann√©es :`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.fac}</p>
<pre><code>def bruit(seuil):
    n = 0
    N = ${s.Q0}
    while N &gt; seuil:
        N = N * (1 - ${s.p}/100)
        n = n + 1
    return n</code></pre>
        <p>3) R√©sultat :
<pre><code>bruit(${s.seuil}) = ${s.n}</code></pre>
Il faut <b>${s.n}</b> an(s).
      </div>`
  },

  { // 4) Consommation d‚Äôeau
    enonce: s => `
      <p><strong>Exercice  F6 :</strong><br>
      Un site consomme <b>${s.Q0}</b> m¬≥/an. Le plan de sobri√©t√© impose ‚àí<b>${s.p}%</b>/an jusqu‚Äô√† <b>${s.seuil}</b> m¬≥/an.</p>
    `,
    q1: s => `1) Par quelle valeur est multipli√©e la consommation chaque ann√©e ?`,
    q2: s => `2) √âcrire une fonction Python renvoyant le nombre d‚Äôann√©es n√©cessaires.`,
    q3: s => `3) Nombre d‚Äôann√©es :`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.fac}</p>
<pre><code>def eau(seuil):
    n = 0
    C = ${s.Q0}
    while C &gt; seuil:
        C = C * (1 - ${s.p}/100)
        n = n + 1
    return n</code></pre>
        <p>3) Valeur :
<pre><code>eau(${s.seuil}) = ${s.n}</code></pre>
R√©duction atteinte en <b>${s.n}</b> an(s).
      </div>`
  },

  { // 5) D√©chets
    enonce: s => `
      <p><strong>Exercice  F6 :</strong><br>
      Une usine produit <b>${s.Q0}</b> t de d√©chets/an. R√©duction pr√©vue : <b>${s.p}%</b> par an jusqu‚Äô√† <b>${s.seuil}</b> t/an.</p>
    `,
    q1: s => `1) Facteur annuel ?`,
    q2: s => `2) Fonction Python donnant le nombre d‚Äôann√©es.`,
    q3: s => `3) Donner le r√©sultat :`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.fac}</p>
<pre><code>def dechets(seuil):
    n = 0
    D = ${s.Q0}
    while D &gt; seuil:
        D = D * (1 - ${s.p}/100)
        n = n + 1
    return n</code></pre>
        <p>3) Sortie :
<pre><code>dechets(${s.seuil}) = ${s.n}</code></pre>
Il faut <b>${s.n}</b> an(s).
      </div>`
  },

  { // 6) Consommation √©lectrique
    enonce: s => `
      <p><strong>Exercice  F6 :</strong><br>
      Un parc consomme <b>${s.Q0}</b> MWh/an. On baisse de <b>${s.p}%</b>/an jusqu‚Äô√† passer sous <b>${s.seuil}</b> MWh/an.</p>
    `,
    q1: s => `1) Facteur appliqu√© chaque ann√©e ?`,
    q2: s => `2) √âcrire une fonction Python pour le nombre d‚Äôann√©es.`,
    q3: s => `3) Nombre d‚Äôann√©es :`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.fac}</p>
<pre><code>def elec(seuil):
    n = 0
    E = ${s.Q0}
    while E &gt; seuil:
        E = E * (1 - ${s.p}/100)
        n = n + 1
    return n</code></pre>
        <p>3) Valeur :
<pre><code>elec(${s.seuil}) = ${s.n}</code></pre>
R√©ponse : <b>${s.n}</b>.
      </div>`
  },

  { // 7) D√©penses marketing
    enonce: s => `
      <p><strong>Exercice  F6 :</strong><br>
      Un budget marketing de <b>${s.Q0}‚Ç¨</b> est r√©duit de <b>${s.p}%</b> par an jusqu‚Äô√† passer sous <b>${s.seuil}‚Ç¨</b>.</p>
    `,
    q1: s => `1) Par quel facteur multiplie-t-on chaque ann√©e ?`,
    q2: s => `2) √âcrire la fonction Python retournant le nombre d‚Äôann√©es.`,
    q3: s => `3) Nombre d‚Äôann√©es :`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.fac}</p>
<pre><code>def mkt(seuil):
    n = 0
    B = ${s.Q0}
    while B &gt; seuil:
        B = B * (1 - ${s.p}/100)
        n = n + 1
    return n</code></pre>
        <p>3) Valeur :
<pre><code>mkt(${s.seuil}) = ${s.n}</code></pre>
Il faut <b>${s.n}</b> an(s).
      </div>`
  },

  { // 8) Temps de traitement moyen
    enonce: s => `
      <p><strong>Exercice  F6 :</strong><br>
      Le temps moyen de traitement d‚Äôun dossier est <b>${s.Q0}</b> minutes. Il baisse de <b>${s.p}%</b> par an jusqu‚Äô√† passer sous <b>${s.seuil}</b> minutes.</p>
    `,
    q1: s => `1) Quel est le facteur annuel ?`,
    q2: s => `2) √âcrire la fonction Python donnant le nombre d‚Äôann√©es.`,
    q3: s => `3) Nombre d‚Äôann√©es :`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.fac}</p>
<pre><code>def traitement(seuil):
    n = 0
    T = ${s.Q0}
    while T &gt; seuil:
        T = T * (1 - ${s.p}/100)
        n = n + 1
    return n</code></pre>
        <p>3) Sortie :
<pre><code>traitement(${s.seuil}) = ${s.n}</code></pre>
Il faut <b>${s.n}</b> an(s).
      </div>`
  },

  { // 9) Consommation de papier
    enonce: s => `
      <p><strong>Exercice  F6 :</strong><br>
      Une administration consomme <b>${s.Q0}</b> rames/an. Plan : ‚àí<b>${s.p}%</b>/an jusqu‚Äô√† <b>${s.seuil}</b> rames/an.</p>
    `,
    q1: s => `1) Facteur multiplicatif annuel ?`,
    q2: s => `2) √âcrire la fonction Python qui renvoie le nombre d‚Äôann√©es.`,
    q3: s => `3) Donner ce nombre :`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.fac}</p>
<pre><code>def papier(seuil):
    n = 0
    R = ${s.Q0}
    while R &gt; seuil:
        R = R * (1 - ${s.p}/100)
        n = n + 1
    return n</code></pre>
        <p>3) Sortie :
<pre><code>papier(${s.seuil}) = ${s.n}</code></pre>
R√©ponse : <b>${s.n}</b>.
      </div>`
  },

  { // 10) Impuret√©s dans un r√©acteur
    enonce: s => `
      <p><strong>Exercice  F6 :</strong><br>
      Un r√©acteur contient <b>${s.Q0}</b> kg d‚Äôimpuret√©s. On r√©duit cette masse de <b>${s.p}%</b> chaque ann√©e jusqu‚Äô√† √™tre sous <b>${s.seuil}</b> kg.</p>
    `,
    q1: s => `1) Par quel facteur multiplie-t-on la masse chaque ann√©e ?`,
    q2: s => `2) √âcrire la fonction Python renvoyant le nombre d‚Äôann√©es.`,
    q3: s => `3) Nombre d‚Äôann√©es :`,
    solution: s => `
      <div class="steps">
        <p>1) ${s.fac}</p>
<pre><code>def impuretes(seuil):
    n = 0
    M = ${s.Q0}
    while M &gt; seuil:
        M = M * (1 - ${s.p}/100)
        n = n + 1
    return n</code></pre>
        <p>3) Valeur :
<pre><code>impuretes(${s.seuil}) = ${s.n}</code></pre>
Besoin de <b>${s.n}</b> an(s).
      </div>`
  }
]

  
  
};

/* S√©lection : idx=0 pour l‚Äôoriginal, 1..10 pour les variantes */
function pickFull(exoId, s, idx=null){
  const bank = BANK_FULL[exoId] || [];
  if(!bank.length) return null;
  if(idx!=null) return bank[((idx%bank.length)+bank.length)%bank.length];
  // par d√©faut, on choisit pseudo-stablement (mais tu peux forcer 0 pour l‚Äôoriginal)
  const sig = Object.values(s).join('|'); let h=0;
  for(let i=0;i<sig.length;i++) h=(h*131 + sig.charCodeAt(i))>>>0;
  return bank[h % bank.length];
}




/* ====== REGISTRY ====== */
function makeExos(){
  const L=[];

/* =========================
   Exercices
   ========================= */
L.push({
  id: 'F1_tantque',
  title: 'Exercice F1 ‚Äî √âpargne (tant que)',
  gen(){
    const C0 = rstep(2000, 5000, 200);     // d√©p√¥t 2018
    const p  = rint(1, 4);                 // % annuel
    const an0 = rint(2016, 2020);          // ann√©e de d√©p√¥t
    // seuil > C0
    const seuil = rstep(C0 + 200, C0 + 3000, 100);
    const fac = +(1 + p/100).toFixed(4);
    // calcul attendu
    let an = an0, C=C0;
    while(C<=seuil){ C = +(C*fac).toFixed(2); an++; }
    return {C0,p,fac,an0,seuil,an};
  },
// F1_tantque ‚Äî dans render(host, s) :
render(host, s){
  const v = pickFull('F1_tantque', s);  // <- choisit une variante
  host.innerHTML = `
    <div class="row norepere"><div class="statement">
      ${v.enonce(s)}
      <p>${v.q1(s)} ${mkInput('f1op',160)} <span id="tf1op" class="tick"></span></p>
      <p>${v.q2(s)}</p>
      <p>${v.q3(s)} ${mkInput('f1ans',120)} <span id="tf1ans" class="tick"></span></p>
    </div></div>`;
  host.__state = s;
}

,
  check(host){
    const s=host.__state;
    const op=(document.getElementById('f1op')?.value||'').replace(',','.').trim();
    const okOp = op===''?null: (op.includes('*') ? near(parseNumber(op.split('*').pop()), s.fac, 1e-9)
                                                 : near(parseNumber(op), s.fac, 1e-9));
    const ans=(document.getElementById('f1ans')?.value||'').trim();
    const okA = ans===''?null: (+ans===s.an);
    const mark=(id,st)=>{ const el=$(id,host); el.classList.remove('ok','ko');
      if(st===true){el.classList.add('ok'); el.textContent='‚úì';}
      else if(st===false){el.classList.add('ko'); el.textContent='‚úó';} else el.textContent='';};
    mark('#tf1op',okOp); mark('#tf1ans',okA);
    const filled = [okOp,okA].every(x=>x!==null), all=[okOp,okA].every(Boolean);
    if(filled){ SCORE[1]++; if(all) SCORE[0]++; scoreSet(...SCORE); }
    return filled && all;
  },
solution(host){
  const s = host.__state;
  const v = pickFull('F1_tantque', s);
  host.dataset.hasSolution = '1';
  host.__solutionPython = ""; // (optionnel, tu peux laisser ta variable si tu t‚Äôen sers pour la console)
  let W = document.getElementById('steps');
  if(!W){ W = document.createElement('div'); W.id='steps'; W.className='steps'; host.appendChild(W); }
  W.innerHTML = v.solution(s);
  typesetAll(W);
}

});




L.push({
  id: 'F2_tantque',
  title: 'Exercice F2 ‚Äî Loyers (tant que)',
  gen(){
    const p  = rint(3,7);                            // % hausse
    const prix0 = rstep(6, 10, 0.5);                 // ‚Ç¨/m¬≤ actuel
    const cible = rstep(prix0+1.5, 15, 0.5);         // seuil > actuel
    const fac = +(1 + p/100).toFixed(4);
    let n=0, x=prix0; while(x<=cible){ x=+(x*fac).toFixed(2); n++; }
    return {p,prix0,cible,fac,n};
  },
  render(host, s){
  const v = pickFull('F2_tantque', s);  // <- choisit une variante
  host.innerHTML = `
    <div class="row norepere"><div class="statement">
      ${v.enonce(s)}
      <p>${v.q1(s)} ${mkInput('f2op',160)} <span id="tf1op" class="tick"></span></p>
      <p>${v.q2(s)}</p>
      <p>${v.q3(s)} ${mkInput('f2n',120)} <span id="tf1ans" class="tick"></span></p>
    </div></div>`;
  host.__state = s;
}
,
  check(host){
    const s=host.__state;
    const op=(document.getElementById('f2op')?.value||'').replace(',','.').trim();
    const okOp= op===''?null: near(parseNumber(op.replace('*','')), s.fac, 1e-9);
    const n=(document.getElementById('f2n')?.value||'').trim();
    const okN = n===''?null: (+n===s.n);
    const mark=(id,st)=>{ const el=$(id,host); el.classList.remove('ok','ko');
      if(st===true){el.classList.add('ok'); el.textContent='‚úì';}
      else if(st===false){el.classList.add('ko'); el.textContent='‚úó';} else el.textContent='';};
    mark('#tf2op',okOp); mark('#tf2n',okN);
    const filled=[okOp,okN].every(x=>x!==null), all=[okOp,okN].every(Boolean);
    if(filled){ SCORE[1]++; if(all) SCORE[0]++; scoreSet(...SCORE); } return filled&&all;
  },
solution(host){
  const s = host.__state;
  const v = pickFull('F2_tantque', s);
  host.dataset.hasSolution = '1';
  host.__solutionPython = ""; // (optionnel, tu peux laisser ta variable si tu t‚Äôen sers pour la console)
  let W = document.getElementById('steps');
  if(!W){ W = document.createElement('div'); W.id='steps'; W.className='steps'; host.appendChild(W); }
  W.innerHTML = v.solution(s);
  typesetAll(W);
}
});



L.push({
  id: 'F3_tantque',
  title: 'Exercice F3 ‚Äî √âtrennes (tant que)',
  gen(){
    const an0 = rint(2015, 2020);
    const M0  = rstep(60, 120, 5);      // premier montant re√ßu
    const d   = rstep(3, 10, 1);        // +d ‚Ç¨ chaque ann√©e
    const seuil = rstep(400, 1000, 50);
    // 1) montants  (an0+1 et an0+2)
    const M1 = M0 + d; const M2 = M1 + d;
    // 2) cumul T en  (an0+1) et (an0+2)
    const T1 = M0 + M1; const T2 = T1 + M2;
    // 3) ‚Äútant que‚Äù jusqu‚Äôau seuil cumul√©
    let A = an0, T=0, m=M0;
    while(T < seuil){ T += m; m += d; A++; }
    return {an0,M0,d,seuil,M1,M2,T1,T2,A};
  },
  
  
  render(host, s){
  const v = pickFull('F3_tantque', s);  // <- choisit une variante
  host.innerHTML = `
    <div class="row norepere">
      <div class="statement">
        ${v.enonce(s)}
        <p>${v.q1(s)} 
          ${mkInput('f3m1',120)} ; ${mkInput('f3m2',120)} 
          <span id="tf3m" class="tick"></span>
        </p>
        <p>${v.q2(s)} 
          ${mkInput('f3t1',120)} ; ${mkInput('f3t2',120)} 
          <span id="tf3t" class="tick"></span>
        </p>
        <p>${v.q3(s)}</p>
        <p>${v.q4(s)} 
          ${mkInput('f3ans',120)} <span id="tf3ans" class="tick"></span>
        </p>
      </div>
    </div>`;
  host.__state = s;
},

  
  check(host){
    const s=host.__state, v=id=>(document.getElementById(id)?.value||'').trim();
    const okM = (v('f3m1')===''||v('f3m2')==='')?null:(near(parseNumber(v('f3m1')), s.M1,1e-9) && near(parseNumber(v('f3m2')), s.M2,1e-9));
    const okT = (v('f3t1')===''||v('f3t2')==='')?null:(near(parseNumber(v('f3t1')), s.T1,1e-9) && near(parseNumber(v('f3t2')), s.T2,1e-9));
    const okA = v('f3ans')===''?null:(+v('f3ans')===s.A);
    const mark=(id,st)=>{ const el=$(id,host); el.classList.remove('ok','ko');
      if(st===true){el.classList.add('ok'); el.textContent='‚úì';}
      else if(st===false){el.classList.add('ko'); el.textContent='‚úó';} else el.textContent='';};
    mark('#tf3m',okM); mark('#tf3t',okT); mark('#tf3ans',okA);
    const filled=[okM,okT,okA].every(x=>x!==null), all=[okM,okT,okA].every(Boolean);
    if(filled){ SCORE[1]++; if(all) SCORE[0]++; scoreSet(...SCORE);} return filled&&all;
  },
  solution(host){
    const s=host.__state;
    const v = pickFull('F3_tantque', s);
  host.dataset.hasSolution = '1';
  let W = document.getElementById('steps');
  if(!W){ W = document.createElement('div'); W.id='steps'; W.className='steps'; host.appendChild(W); }
  W.innerHTML = v.solution(s);
  typesetAll(W);
}
});



L.push({
  id: 'F4_tantque',
  title: 'Exercice F4 ‚Äî Puits (tant que)',
  gen(){
    const c1 = rstep(80, 150, 10);  // 1er m√®tre
    const c2 = c1 + rstep(20, 60, 10); // 2e m√®tre
    const step = c2 - c1;           // incr√©ment constant
    const budget = rstep(3000, 10000, 500);
    // profondeur max avec budget
    let prof=0, reste=budget, prix=c1;
    while(reste>=prix){ reste -= prix; prof++; prix += step; }
    return {c1,c2,step,budget,prof};
  },
  render(host, s){
  const v = pickFull('F4_tantque', s);
  host.innerHTML = `
    <div class="row norepere">
      <div class="statement">
        ${v.enonce(s)}
        <p>${v.q1(s)}</p>
        <p>${v.q2(s)}</p>
        <table class="tbl">
          <tr>
            <th>Montant (en ‚Ç¨)</th>
            <th>${s.budget-1000}</th>
            <th>${s.budget}</th>
            <th>${s.budget+1000}</th>
          </tr>
          <tr>
            <th>Profondeur</th>
            <td>${mkInput('f4a',110)} <span id="tf4a" class="tick"></span></td>
            <td>${mkInput('f4b',110)} <span id="tf4b" class="tick"></span></td>
            <td>${mkInput('f4c',110)} <span id="tf4c" class="tick"></span></td>
          </tr>
        </table>
      </div>
    </div>`;
  host.__state = s;
},
  check(host){
    const s=host.__state;
    function depth(B){
      let p=0, price=s.c1;
      while(B>=price){ B-=price; p++; price+=s.step; }
      return p;
    }
    const A=depth(s.budget-1000), B=depth(s.budget), C=depth(s.budget+1000);
    const v=id=>(document.getElementById(id)?.value||'').trim();
    const mark=(id,ok)=>{ const el=$(id,host); el.classList.remove('ok','ko');
      if(ok===true){el.classList.add('ok'); el.textContent='‚úì';}
      else if(ok===false){el.classList.add('ko'); el.textContent='‚úó';} else el.textContent='';};
    const okA=v('f4a')===''?null:+v('f4a')===A;
    const okB=v('f4b')===''?null:+v('f4b')===B;
    const okC=v('f4c')===''?null:+v('f4c')===C;
    mark('#tf4a',okA); mark('#tf4b',okB); mark('#tf4c',okC);
    const filled=[okA,okB,okC].every(x=>x!==null), all=[okA,okB,okC].every(Boolean);
    if(filled){SCORE[1]++; if(all) SCORE[0]++; scoreSet(...SCORE);} return filled&&all;
  },
solution(host){
  const s = host.__state;
  const v = pickFull('F4_tantque', s);
  host.dataset.hasSolution = '1';
  let W = document.getElementById('steps');
  if(!W){ W = document.createElement('div'); W.id='steps'; W.className='steps'; host.appendChild(W); }
  W.innerHTML = v.solution(s);      // calcule et affiche profondeur(budget¬±1000)
  typesetAll(W);
}

});


L.push({
  id: 'F5_tantque',
  title: 'Exercice F5 ‚Äî Truites (tant que)',
  gen(){
  // tirages
  const d   = rint(10, 30);               // % de baisse
  const add = rstep(20, 100, 10);         // + truites / an
  let   P0  = rstep(80, 200, 10);         // population initiale (let !)
  const fac = +(1 - d/100).toFixed(4);    // 0 < fac < 1

  // niveau d'√©quilibre atteignable
  const Pinfty = add / (1 - fac);

  // si P0 est trop proche/au-dessus de la limite, on le rabat un peu
  if (P0 >= Pinfty - 1) {
    P0 = Math.max(50, Math.floor(Pinfty * 0.6));
  }

  // ann√©e vis√©e entre 5 et 15
  const nTarget = rint(5, 15);

  // √©volution SANS arrondi pour √©viter les paliers
  const step = P => P * fac + add;

  // calcule P_{n-1} et P_n
  let P = P0, Pnm1 = P0;
  for (let k = 1; k <= nTarget; k++) {
    P = step(P);
    if (k === nTarget - 1) Pnm1 = P;
  }
  const Pn = P;

  // cible enti√®re strictement entre P_{n-1} et P_n (robuste m√™me si l'√©cart < 1)
  let low  = Math.floor(Pnm1) + 1;
  let high = Math.ceil(Pn)   - 1;
  if (low > high) {
    const mid = Pnm1 + 0.6*(Pn - Pnm1);
    low  = Math.max(Math.floor(Pnm1) + 1, Math.floor(mid));
    high = Math.max(low, Math.floor(Pn - 1e-6));
  }
  const cible = rint(low, high);

  // ann√©e attendue (s√©curis√©e) : sortira en ‚â§ nTarget
  let an = 0; P = P0; let safe = 0;
  while (P <= cible && safe < 5000) { P = step(P); an++; safe++; }

  return { d, add, P0, cible, fac, an }; // an ‚àà [5,15]
}
,
  render(host, s){
  const v = pickFull('F5_tantque', s);
  host.innerHTML = `
    <div class="row norepere">
      <div class="statement">
        ${v.enonce(s)}
        <p>${v.q1(s)}</p>
        <p>${v.q2(s)} 
          ${mkInput('f5ans',120)} <span id="tf5ans" class="tick"></span>
        </p>
      </div>
    </div>`;
  host.__state = s;
},
  check(host){
    const s=host.__state, v=(document.getElementById('f5ans')?.value||'').trim();
    const ok = v===''?null:(+v===s.an);
    const el=$('#tf5ans',host); el.classList.remove('ok','ko');
    if(ok===true){el.classList.add('ok'); el.textContent='‚úì';}
    else if(ok===false){el.classList.add('ko'); el.textContent='‚úó';} else el.textContent='';
    if(ok!==null){SCORE[1]++; if(ok) SCORE[0]++; scoreSet(...SCORE);} return ok===true;
  },
  solution(host){
  const s = host.__state;
  const idx = host.__variantIdx ?? getVarIdx();
  const v = pickFull('F5_tantque', s, idx);
  host.dataset.hasSolution = '1';
  let W = document.getElementById('steps');
  if(!W){ W = document.createElement('div'); W.id='steps'; W.className='steps'; host.appendChild(W); }
  W.innerHTML = v.solution(s);
  typesetAll(W);
}
});



L.push({
  id: 'F6_tantque',
  title: 'Exercice F6 ‚Äî Rejets polluants (tant que)',
  gen(){
    const Q0 = rstep(3000, 8000, 200);
    const p  = rint(5, 15);
    const seuil = rstep(1000, 4000, 100);
    const fac = +(1 - p/100).toFixed(4);
    let n=0, Q=Q0; while(Q>seuil){ Q=+(Q*fac).toFixed(2); n++; }
    return {Q0,p,seuil,fac,n};
  },
  render(host, s){
  const v = pickFull('F6_tantque', s);
  host.innerHTML = `
    <div class="row norepere">
      <div class="statement">
        ${v.enonce(s)}
        <p>${v.q1(s)} 
          ${mkInput('f6fac',140)} <span id="tf6fac" class="tick"></span>
        </p>
        <p>${v.q2(s)}</p>
        <p>${v.q3(s)} 
          ${mkInput('f6n',110)} <span id="tf6n" class="tick"></span>
        </p>
      </div>
    </div>`;
  host.__state = s;
},
  check(host){
    const s=host.__state;
    const fac=(document.getElementById('f6fac')?.value||'').replace(',','.').trim();
    const okF = fac===''?null: near(parseNumber(fac), s.fac, 1e-9);
    const n=(document.getElementById('f6n')?.value||'').trim();
    const okN = n===''?null: (+n===s.n);
    const mark=(id,st)=>{ const el=$(id,host); el.classList.remove('ok','ko');
      if(st===true){el.classList.add('ok'); el.textContent='‚úì';}
      else if(st===false){el.classList.add('ko'); el.textContent='‚úó';} else el.textContent='';};
    mark('#tf6fac',okF); mark('#tf6n',okN);
    const filled=[okF,okN].every(x=>x!==null), all=[okF,okN].every(Boolean);
    if(filled){SCORE[1]++; if(all) SCORE[0]++; scoreSet(...SCORE);} return filled&&all;
  },
  solution(host){
  const s = host.__state;
  const v = pickFull('F6_tantque', s);
  host.dataset.hasSolution = '1';
  let W = document.getElementById('steps');
  if(!W){ W = document.createElement('div'); W.id='steps'; W.className='steps'; host.appendChild(W); }
  W.innerHTML = v.solution(s);
  typesetAll(W);
}
});






  return L;
}

/* ====== UI ====== */
const REGISTRY = makeExos();
window.REGISTRY = REGISTRY;

function populateSelect(){
  const sel=$("#exo-select"); if(!sel) return;
  sel.innerHTML = '';
  for(const e of REGISTRY){
    const o=document.createElement('option'); o.value=e.id; o.textContent=e.title; sel.appendChild(o);
  }
}
function renderActive(){
  const host=$("#host"), sel=$("#exo-select");
  try{
    const def=REGISTRY.find(e=>e.id===sel.value) || REGISTRY[0];
    host.dataset.active=def.id;
    def.render(host, def.gen());
    host.querySelectorAll('input').forEach(inp=>{
      inp.addEventListener('keydown', ev=>{ if(ev.key==='Enter') $('#btn-check').click(); });
    });
    retypeMath(host);

  }catch(e){
    host.innerHTML = `<div class="steps" style="color:#b00020"><b>Erreur :</b> ${e.message}</div>`;
  }
}
function val(id){ const e=document.getElementById(id); return e?e.value:'' }

window.addEventListener('load', ()=>{
  populateSelect();
  $("#exo-select")?.addEventListener('change', ()=>{ SCORE=[0,0]; scoreSet(0,0); renderActive(); });
  $("#btn-new")?.addEventListener('click', ()=>{ SCORE=[0,0]; scoreSet(0,0); renderActive(); });
  $("#btn-reset")?.addEventListener('click', ()=>{ SCORE=[0,0]; scoreSet(0,0); renderActive(); });
  $("#btn-check")?.addEventListener('click', ()=>{
    const host=$("#host");
    const def=REGISTRY.find(e=>e.id===host.dataset.active);
    if(def?.check) def.check(host);
  });
  $("#btn-sol")?.addEventListener('click', ()=>{
    const host=$("#host");
    const def=REGISTRY.find(e=>e.id===host.dataset.active);
    if(def?.solution) def.solution(host);
  });

  renderActive(); scoreSet(0,0);

  // Init PDF (m√™me position que d‚Äôhabitude)
  (function waitForPDF(){
    if (window.ExoPDF?.init && Array.isArray(window.REGISTRY) && window.REGISTRY.length){
      ExoPDF.init({
        title: 'Premi√®re ‚Äî Suites num√©riques ‚Äî Python (Pour & Tant que)',
        max: 50,
        mountAfterSelector: '#info-saisie',
        autoPrint: false
      });
    } else { setTimeout(waitForPDF, 60); }
  })();
});
})();
</script>
<!-- === Console Python 3 panneaux : √âditeur / Console / Sortie === -->
<style>
/* === Console Python ‚Äî CSS consolid√© (remplace les doublons) === */
#py-panel{
  position: fixed;
  right: 16px;
  /* top est fix√© par placePanel() en JS */
  bottom: auto;
  width: 680px;
  max-width: 95vw;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 12px;
  box-shadow: 0 12px 22px rgba(0,0,0,.14);
  display: none;               /* affich√©/masqu√© par le bouton */
  flex-direction: column;
  z-index: 9999;
  max-height: 80vh;            /* hauteur max raisonnable */
}

#py-head{
  display: flex; align-items: center; gap: 8px;
  padding: 10px; border-bottom: 1px solid #eee;
}
#py-head .btn{ border:1px solid #ccc; background:#fff; border-radius:8px; padding:.35rem .6rem; cursor:pointer }
#py-head .btn:active{ transform: translateY(1px) }
#py-status{ margin-left: auto }

#py-sections{
  display: flex;               /* <<< PAS grid */
  flex-direction: column;
  min-height: 0;               /* indispensable pour que #py-out puisse grandir */
}

#py-editor{
  width: 100%;
  height: 230px;               /* √©ditable */
  min-height: 120px;
  resize: vertical;
  border: none; border-bottom: 1px solid #eee;
  padding: 10px;
  font-family: ui-monospace, Menlo, Consolas, monospace;
  font-size: 14px;
  outline: none;
}

#py-repl{ display:flex; gap:8px; align-items:center; padding:8px; border-bottom:1px solid #eee }
#py-input{
  flex:1; border:1px solid #ddd; border-radius:8px; padding:8px 10px;
  font-family: ui-monospace, Menlo, Consolas, monospace; font-size:14px;
}

#py-out{
  flex: 1 1 auto;              /* prend tout l'espace restant */
  min-height: 120px;
  overflow: auto;
  padding: 10px;
  background: #0e1116; color:#d6deeb;
  border-bottom-left-radius:12px; border-bottom-right-radius:12px;
  white-space: pre-wrap;
}
@media (max-width:720px){ #py-panel{ width:96vw } }

</style>

<script>
(function(){
  // === 0) Bouton barre d‚Äôoutils
  const bar = document.querySelector('.controls');
  if(bar && !document.getElementById('py-open')){
    const btn=document.createElement('button');
    btn.id='py-open'; btn.className='btn'; btn.textContent='‚ñ∂Ô∏è Console Python';
    bar.insertBefore(btn, bar.children[1]||null);
  }

  // === 1) Panneau
  const panel=document.createElement('div');
  panel.id='py-panel';
  panel.innerHTML=`
    <div id="py-head">
      <strong>√âditeur / Console / Sortie</strong>
      <button id="py-fill" class="btn">üß© Pr√©remplir depuis l‚Äôexercice</button>
      <button id="py-run"  class="btn">‚ñ∂Ô∏è Ex√©cuter le code</button>
      <button id="py-eval" class="btn">‚èé Eval (ligne console)</button>
      <button id="py-clear" class="btn">üßπ Effacer sortie</button>
      <div id="py-status">Pyodide : chargement‚Ä¶</div>
      <button id="py-close" class="btn">‚úñ</button>
    </div>
    <div id="py-sections">
      <textarea id="py-editor" spellcheck="false"
        placeholder="# √âcris ton programme ici (def suite(n): ...)."></textarea>
      <div id="py-repl">
        <span><strong>Console</strong> ‚Ä∫ </span>
        <input id="py-input" placeholder="ex: suite(5) ou print(suite(5))">
      </div>
      <pre id="py-out">[sortie]</pre>
    </div>`;
  document.body.appendChild(panel);

  const $ = sel => document.querySelector(sel);
function placePanel(){
  const controls = document.querySelector('.controls');
  if(!controls) return;
  const r = controls.getBoundingClientRect();
  const top = Math.round(r.bottom + 8 + window.scrollY);
  panel.style.top = top + 'px';

  const free = window.innerHeight - (r.bottom + 8);
  panel.style.maxHeight = Math.max(260, free - 16) + 'px'; // pas de height fixe !
}

  // === 2) Charger Pyodide (une seule fois)
  let pyodide=null;
  async function ensurePy(){
    if(pyodide) return pyodide;
    if(!window.loadPyodide){
      const s=document.createElement('script');
      s.src='https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js';
      await new Promise(r=>{ s.onload=r; document.head.appendChild(s); });
    }
    pyodide=await loadPyodide({});
    $('#py-status').textContent='Pyodide : pr√™t';
    return pyodide;
  }
  $('#py-open')?.addEventListener('click', async ()=>{
  const btn = document.getElementById('py-open');
  const isShown = panel.style.display === 'flex';
  if (isShown) {
    panel.style.display = 'none';
    btn?.setAttribute('aria-pressed','false');
    btn.textContent = '‚ñ∂Ô∏è Console Python';
  } else {
    placePanel();                 // <‚Äî positionne sous le s√©lecteur
    panel.style.display = 'flex';
    btn?.setAttribute('aria-pressed','true');
    btn.textContent = '‚èπ Fermer la console';
    await ensurePy();             // charge Pyodide √† l‚Äôouverture
  }
});

// --- ajuster au scroll / resize (d√©bours√© l√©ger)
let _placeTO=null;
function schedulePlace(){
  clearTimeout(_placeTO);
  _placeTO = setTimeout(placePanel, 20);
}
window.addEventListener('scroll', schedulePlace, {passive:true});
window.addEventListener('resize', schedulePlace);
  $('#py-close')?.addEventListener('click', ()=>{ panel.style.display='none'; });

  // === 3) Ex√©cution & capture stdout/stderr
function appendOut(txt){
  const el = document.querySelector('#py-out');
  if (el.textContent.trim() === '[sortie]') el.textContent = ''; // enl√®ve le placeholder
  el.textContent += (el.textContent ? '\n' : '') + txt;
  el.scrollTop = el.scrollHeight;
}
  async function pyExec(code){
    await ensurePy();
    let stdout='', stderr='';
    pyodide.setStdout({batched:msg=>{stdout+=msg;}});
    pyodide.setStderr({batched:msg=>{stderr+=msg;}});
	await pyodide.runPythonAsync(`
import builtins
from js import prompt

def _browser_input(msg=''):
    # affiche le message pass√© √† input(...) dans la bo√Æte de saisie
    v = prompt(str(msg))
    return '' if v is None else v  # input doit renvoyer une cha√Æne

builtins.input = _browser_input
`);

    try{
	pyodide.setStdin({
  stdin: () => {
    const v = window.prompt("Entr√©e pour input() :");
    return ((v ?? '') + '\n');
  }
});
      await pyodide.runPythonAsync(code);
      if(stdout.trim()) appendOut(stdout.trim());
      if(stderr.trim()) appendOut('[stderr]\\n'+stderr.trim());
    }catch(e){
      appendOut('[Erreur] ' + (e?.message || String(e)));
    }
  }

  // === 4) Ex√©cuter le contenu de l‚Äô√©diteur
  $('#py-run').addEventListener('click', async ()=>{
    const code=$('#py-editor').value;
    await pyExec(code);
  });

  // === 5) √âvaluer une ligne console
  // - si c‚Äôest une expression, on affiche repr(expr)
  // - sinon on ex√©cute comme une instruction (ex: x=3)
  const hist=[]; let hIdx=-1;
  $('#py-eval').addEventListener('click', async ()=>{ await runConsoleLine(); });
  $('#py-input').addEventListener('keydown', async (e)=>{
    if(e.key==='Enter'){ e.preventDefault(); await runConsoleLine(); }
    else if(e.key==='ArrowUp'){ if(hist.length){hIdx=Math.max(0,hIdx-1); $('#py-input').value=hist[hIdx]; e.preventDefault();} }
    else if(e.key==='ArrowDown'){ if(hist.length){hIdx=Math.min(hist.length, hIdx+1); $('#py-input').value=(hIdx>=hist.length?'':hist[hIdx]); e.preventDefault();} }
  });
  async function runConsoleLine(){
    const line=$('#py-input').value.trim();
    if(!line) return;
    hist.push(line); hIdx=hist.length;
    $('#py-input').value='';
    // essaie eval(...)
    const wrapper = `
import builtins
_res_ = None
try:
    _res_ = eval(${JSON.stringify(line)})
    if _res_ is not None:
        print(repr(_res_))
except SyntaxError:
    exec(${JSON.stringify(line)})
`;
    await pyExec(wrapper);
  }

  // === 6) Effacer sortie
  $('#py-clear').addEventListener('click', ()=>{ $('#py-out').textContent='[sortie]'; });

  // === 7) Pr√©remplir depuis l‚Äôexercice actif (m√™me logique que ta console pr√©c√©dente)
  function getVal(id){ return (document.getElementById(id)?.value || '').trim(); }
function codeFromExercise(){
  const host = document.querySelector('#host');

  // <<< PRIORIT√â √Ä LA SOLUTION SI ELLE EXISTE
  if (host?.__solutionPython) {
    return host.__solutionPython + '\n';
  }
}
  // ... ensuite ton code existant (ex1, ex2, ex3, etc.)

  $('#py-fill').addEventListener('click', ()=>{ $('#py-editor').value = codeFromExercise(); });

  // === 8) Petit ‚Äú√©diteur intelligent‚Äù : indentation apr√®s ":" + Tab/Shift+Tab + Ctrl/Cmd+Enter
  (function enhanceEditor(){
    const ta=$('#py-editor');
    function insert(text){
      const s=ta.selectionStart, e=ta.selectionEnd;
      ta.setRangeText(text, s, e, 'end');
    }
    function curLine(){
      const pos=ta.selectionStart, before=ta.value.slice(0,pos);
      const ls = before.lastIndexOf('\n')+1;
      const line = before.slice(ls);
      const indent = (line.match(/^\s*/)||[''])[0];
      return {line, indent};
    }
    function indentSel(add=true){
      const start=ta.selectionStart, end=ta.selectionEnd, v=ta.value;
      const from=v.lastIndexOf('\n',start-1)+1;
      const to=v.indexOf('\n',end); const endPos=(to===-1?v.length:to);
      const lines=v.slice(from,endPos).split('\n');
      const pad='    ';
      const changed=lines.map(s=> add? pad+s : (s.startsWith('    ')?s.slice(4):s.replace(/^ {1,3}/,''))).join('\n');
      ta.value = v.slice(0,from)+changed+v.slice(endPos);
      const delta=changed.length - (endPos-from);
      ta.setSelectionRange(start+(add?4:0), end+delta);
    }
    ta.addEventListener('keydown', e=>{
      if((e.ctrlKey||e.metaKey) && e.key==='Enter'){ e.preventDefault(); $('#py-run').click(); return; }
      if(e.key==='Tab'){ e.preventDefault(); if(ta.selectionStart!==ta.selectionEnd) indentSel(!e.shiftKey); else insert('    '); return; }
      if(e.key==='Enter'){ e.preventDefault(); const {line,indent}=curLine(); const more=/:\s*$/.test(line)?'    ':''; insert('\n'+indent+more); return; }
    });
  })();
})();
</script>


</body>
</html>
