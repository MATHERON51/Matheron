<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Seconde ‚Äì Chapitre 1 ‚Äì √âquations (1er degr√©) ‚Äì Exercices</title>
<link href="../../../../css/math-kbd.css" rel="stylesheet"/>
<style>
  :root{ --card-bg:#fff; --card-bd:#e6e6e6; --muted:#6b7280; }
  *{box-sizing:border-box} html,body{margin:0;padding:0}
  body{font-family:system-ui, Segoe UI, Roboto, Arial, sans-serif; background:#fafafa; color:#111; line-height:1.55}

  .header{position:sticky; top:0; background:#fff; border-bottom:1px solid #eee}
  .header .wrap{padding:12px 16px}

  .wrap{max-width:1100px; margin:0 auto; padding:16px; display:flex; flex-direction:column; gap:12px}
  .card{background:var(--card-bg); border:1px solid var(--card-bd); border-radius:12px; padding:14px}

  .controls{display:flex; flex-wrap:wrap; gap:8px; align-items:center}
  #exo-select{min-width:320px}
  select,button,input[type=text]{font-size:15px}
  .btn{padding:8px 12px; border:1px solid #dadada; border-radius:10px; background:#f7f7f7; cursor:pointer}
  .btn:hover{background:#efefef}

  .row{display:grid; grid-template-columns:1fr; gap:12px; align-items:start}
  .statement .consigne{opacity:.85; margin-bottom:6px}
  .ans-row{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  .ans-row input[type=text]{flex:1; min-width:240px}
  .steps{background:#f6f7f8; border:1px dashed #cfd3d7; border-radius:10px; padding:.7rem .8rem; min-height:52px}
  .steps .line{white-space:pre-wrap; color:var(--muted)}

  .accept .title{font-weight:600}
  .kbd-wrap{display:flex; justify-content:center}
</style>
<style>
*{box-sizing:border-box}
body{font-family:system-ui, Segoe UI, Roboto, Arial; margin:0; background:#fafafa; color:#111; line-height:1.5}
.header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;padding:14px 18px;z-index:5}
.wrap{max-width:1200px;margin:0 auto;padding:18px;display:flex;flex-direction:column;gap:12px}
.card{background:#fff;border:1px solid #e6e6e6;border-radius:12px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
.controls{display:flex;flex-wrap:nowrap;gap:8px;align-items:center;overflow-x:auto}
select,input[type=text]{padding:8px 10px;border:1px solid #ddd;border-radius:8px;font-size:15px}
.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 10px;border:1px solid #dadada;background:#f7f7f7;border-radius:10px;cursor:pointer;white-space:nowrap}
.btn:hover{background:#efefef}
.score{font-weight:700;white-space:nowrap}
.small{font-size:.92rem;color:#666}
.row{display:grid;grid-template-columns:1fr auto 200px;gap:8px;align-items:center}
.res-ok{color:#11823b;font-weight:700}
.res-ko{color:#b00020;font-weight:700}
.code{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; background:#f7f7f7;border:1px dashed #ddd;border-radius:8px;padding:2px 6px}
.equ{font-weight:600}

/* Fractions ‚Äúpile‚Äù (sans LaTeX) */
.frac{display:inline-flex;flex-direction:column;align-items:center;vertical-align:middle;line-height:1}
.frac .num,.frac .den{padding:0 .2em; white-space:nowrap}
.frac .bar{border-top:1.6px solid currentColor;align-self:stretch;margin:.06em 0}
.frac-sign{margin-right:.15em}

/* Bloc √©tapes : lignes simples, une √©galit√© max par ligne */
.steps{margin:.35rem 0 0 .15rem;padding:.35rem .5rem;background:#fafafa;border:1px dashed #e3e3e3;border-radius:8px}
.step{margin:.2rem 0}
</style></head>
<body>
<!-- En-t√™te -->
<div class="header">
<div class="wrap">
<div class="controls">
<label for="exo-select"><strong>Type d‚Äôexercice :</strong></label>
<select id="exo-select"></select>
<button class="btn" id="btn-new">üîÑ Nouvel √©nonc√©</button>
<button class="btn" id="btn-check">‚úÖ V√©rifier</button>
<button class="btn" id="btn-solution">üí° Solution</button>
<button class="btn" id="btn-reset">üßπ R√©initialiser</button>
<span class="score">Score : <span id="score">0 / 0</span></span><span class="small" id="status"></span></div>
</div>
</div>
<!-- Corps -->
<div class="wrap">
<!-- √ânonc√© + saisie + corrig√© -->
<div class="card" id="host"></div>
<!-- Saisie & r√©ponses accept√©es (volontairement vide) -->
<div class="card accept" id="accept"><div class="title">Saisie &amp; r√©ponses accept√©es :</div></div>
<!-- L‚ÄôUI PDF se montera ici (apr√®s #accept) -->
<!-- Clavier math (auto-mount par la lib) -->
<div class="card kbd-wrap">
<div data-math-kbd=""></div>
</div>
</div>
<!-- JS (versions *.multiplicatif uniquement) -->
<script defer="" src="../../../../js/ch0-mul-clean.multiplicatif.js"></script>
<script defer="" src="../../../../js/dev-rules-clean.dedup.js"></script>
<script defer="" src="../../../../js/algebra-eval-patch.multiplicatif.js"></script>
<script defer="" src="../../../../js/exo-pdf-kit.multiplicatif.js"></script>
<script defer="" src="../../../../js/math-kbd.multiplicatif.js"></script>
<!-- Orchestration minimale (sans exercices) -->
<script>
  (function(){
    'use strict';
    const $ = (s,r=document)=>r.querySelector(s);

    /* Cadre g√©n√©rique √ânonc√©/Saisie/Corrig√© */
    function mkFrame(host, {consigneHTML='', enonceHTML='', placeholder='‚Ä¶'}={}){
      host.innerHTML = `
        <div class="row">
          <div class="statement">
            ${consigneHTML ? `<div class="consigne">${consigneHTML}</div>` : ''}
            ${enonceHTML ? `<div class="equ">${enonceHTML}</div>` : ''}
            <div class="ans-row" style="margin-top:.5rem">
              <label for="reponse"><strong>R√©ponse :</strong></label>
              <input type="text" id="reponse" placeholder="${placeholder}">
            </div>
            <div id="res" class="small" aria-live="polite"></div>
          </div>
          <div id="sol" class="steps"><div class="line">Le corrig√© s‚Äôaffichera ici.</div></div>
        </div>`;
      const ip=$("#reponse",host);
      ip && ip.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); check(); } });
    }

    /* Catalogue vide (√† remplir plus tard) */
    const REGISTRY = (window.REGISTRY = []);

    /* Actions boutons */
    function buildOne(){
      const sel=$("#exo-select"), host=$("#host");
      const def = REGISTRY.find(e=>e.id===sel.value);
      if(!def){
        mkFrame(host,{consigneHTML:'S√©lectionnez un type d‚Äôexercice.', placeholder:'‚Ä¶'});
        $("#res",host).textContent = 'Aucun exercice charg√© (squelette).';
        return;
      }
      const st = def.gen ? def.gen() : {};
      host.dataset.active = def.id;
      host.dataset.state = JSON.stringify(st);
      (def.render || mkFrame)(host, st);
    }
    function check(){
      const host=$("#host");
      const def = REGISTRY.find(e=>e.id===host.dataset.active);
      if(def && typeof def.correct==='function'){
        const st = JSON.parse(host.dataset.state||'{}');
        def.correct(host, st);
      }
    }
    function solution(){
      const host=$("#host");
      const def = REGISTRY.find(e=>e.id===host.dataset.active);
      if(def && typeof def.solution==='function'){
        const st = JSON.parse(host.dataset.state||'{}');
        def.solution(host, st);
      }
    }
    function resetAll(){
      const host=$("#host");
      const ip=$("#reponse",host); if(ip) ip.value='';
      $("#res",host).textContent='';
      $("#sol",host).innerHTML='<div class="line">Le corrig√© s‚Äôaffichera ici.</div>';
    }

    /* Init */
    document.addEventListener('DOMContentLoaded', function(){
      // s√©lecteur (reste vide si REGISTRY vide)
      $("#exo-select").innerHTML = REGISTRY.map(e=>`<option value="${e.id}">${e.title}</option>`).join('');
      $("#exo-select").addEventListener('change', buildOne);

      $("#btn-new").addEventListener('click', buildOne);
      $("#btn-check").addEventListener('click', check);
      $("#btn-solution").addEventListener('click', solution);
      $("#btn-reset").addEventListener('click', resetAll);

      // Pas d'appel √† MathKbd.autoMount() -> √©vite le double clavier

      // PDF (UI apr√®s #accept)
      if (window.ExoPDF?.init){
        ExoPDF.init({
          title: 'Seconde ‚Äî Squelette d‚Äôexercices',
          mountAfterSelector: '#accept',
          max: 50,
          lead: ''
        });
      }

      buildOne(); // cadre ‚Äúpr√™t‚Äù
    });
  })();
  </script>
<script>
(function(){'use strict';
const $=(s,r=document)=>r.querySelector(s);
const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
const rnd=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const choice=a=>a[Math.floor(Math.random()*a.length)];

/* ===== Fractions ‚Äúpile‚Äù ===== */
function fracHTML(p,q){
  const sign = (p<0) ? '‚àí' : '';
  p = Math.abs(p); q = Math.abs(q);
  if(q===1) return sign + String(p);
  return (sign ? `<span class="frac-sign">${sign}</span>` : '') +
         `<span class="frac"><span class="num">${p}</span><span class="bar"></span><span class="den">${q}</span></span>`;
}
function fracExprHTML(numerHTML, den){
  return `<span class="frac"><span class="num">${numerHTML}</span><span class="bar"></span><span class="den">${den}</span></span>`;
}
function ansHTML(p,q){ return (q===1? `x = ${p}` : `x = ${fracHTML(p,q)}`); }

/* ===== Arithm√©tique rationnelle ===== */
function gcd(a,b){ a=Math.abs(a); b=Math.abs(b); while(b){ [a,b]=[b,a%b]; } return a||1; }
function norm(p,q){
  if(q===0) throw new Error("denominator 0");
  let g=gcd(p,q); p/=g; q/=g; if(q<0){ p=-p; q=-q; }
  return {p,q};
}
function addR(A,B){ return norm(A.p*B.q + B.p*A.q, A.q*B.q); }
function subR(A,B){ return norm(A.p*B.q - B.p*A.q, A.q*B.q); }
function mulR(A,B){ return norm(A.p*B.p, A.q*B.q); }
function divR(A,B){ if(B.p===0) throw new Error("div by 0"); return norm(A.p*B.q, A.q*B.p); }
function isZero(R){ return R.p===0; }
function toNumber(R){ return R.p / R.q; }
function makeR(p,q){ return norm(p,q||1); }

function randIntNonZero(min,max){ let x=0; while(x===0){ x=rnd(min,max); } return x; }
function randRational(opts={}){
  const {allowZero=true} = opts;
  const isFrac = Math.random()<0.4;
  if(!isFrac){
    let v = allowZero ? rnd(-9,9) : randIntNonZero(-9,9);
    return makeR(v,1);
  }
  const d = choice([2,3,4,5,6]);
  const n = allowZero ? rnd(-9,9) : randIntNonZero(-9,9);
  return makeR(n,d);
}

/* ===== Utilitaires d'affichage ===== */
function isOne(R){ return R.q===1 && R.p===1; }
function isNegOne(R){ return R.q===1 && R.p===-1; }
function absR(R){ return makeR(Math.abs(R.p), R.q); }

function fmtCoeffXHTML(A){ // A*x
  if(isOne(A)) return "x";
  if(isNegOne(A)) return "‚àíx";
  return `${fracHTML(A.p,A.q)}x`;
}
function fmtConstHTML(B){
  return (B.q===1? String(B.p) : fracHTML(B.p,B.q));
}
function fmtSignedConstHTML(B){
  if(isZero(B)) return "";
  const abs = absR(B);
  const core = fmtConstHTML(abs);
  return (B.p>0? " + " : " ‚àí ") + core;
}
function sideHTML(A,B){ // A‚â†0 garanti
  return fmtCoeffXHTML(A) + fmtSignedConstHTML(B);
}

/* ===== Helpers √©tapes ===== */
function showDiffHTML(U,V){ // affiche U - V (sans calcul), simplifie si 0
  if(isZero(V)) return fmtConstHTML(U);
  if(isZero(U)) return "‚àí " + fmtConstHTML(absR(V));
  if(V.p<0) return fmtConstHTML(U) + " + " + fmtConstHTML(absR(V));
  return fmtConstHTML(U) + " ‚àí " + fmtConstHTML(V);
}
function quotientRaw(N,D){ // retourne la fraction N/D SANS passer par '√∑'
  let num = N.p * D.q;
  let den = N.q * D.p;
  if(den<0){ num = -num; den = -den; }
  return {p:num, q:den};
}
function needsSimplify(fr){
  const g = gcd(Math.abs(fr.p), Math.abs(fr.q));
  return g > 1;
}
/* ‚Äî‚Äî‚Äî Normalisation des signes dans les lignes d‚Äô√©tapes ‚Äî‚Äî‚Äî */
function normalizeSigns(html){
  return html
    // -+ ou +- ‚Üí ‚àí
    .replace(/\+\s*[‚àí-]/g, ' ‚àí ')
    .replace(/[‚àí-]\s*\+/g, ' ‚àí ')
    // -- ‚Üí +
    .replace(/[‚àí-]\s*[‚àí-]/g, ' + ')
    // ++ ‚Üí +
    .replace(/\+\s*\+/g, ' + ')
    // espaces multiples ‚Üí 1
    .replace(/\s{2,}/g, ' ');
}

/* ===== Parsing / comparaison des r√©ponses ===== */
function parseNumberOrFrac(str){
  if(!str) return null;
  let s = str.trim().replace(/\u2212/g,'-').replace(/^x\s*=\s*/i,'').trim();
  if(/^[-+]?(\d+([.,]\d+)?|\d*[.,]\d+)$/.test(s)){ s=s.replace(',','.'); return parseFloat(s); }
  const m = s.match(/^([-+]?\d+)\s*\/\s*([-+]?\d+)$/);
  if(m){ const p = parseInt(m[1],10), q = parseInt(m[2],10); if(q===0) return null; return p/q; }
  return null;
}
function sameNumber(a,b){
  const na = parseFloat(a), nb = parseFloat(b);
  if(Number.isNaN(na) || Number.isNaN(nb)) return false;
  return Math.abs(na-nb) < 1e-9;
}
function normalizeAnswer(s){
  if(!s) return "";
  const v = parseNumberOrFrac(s);
  if(v===null || Number.isNaN(v)) return s.trim();
  return String(v);
}

/* ======= Exercices ======= */
/* 1) ax + b = c (a,b,c entiers ; a ‚â† 0) */
const ex1 = {
  id: "lin_simple",
  title: "R√©soudre : ax + b = c",
  gen(){
    let a=0; while(a===0) a=rnd(-9,9);
    const b=rnd(-12,12), c=rnd(-12,12);
    const A=makeR(a,1), B=makeR(b,1), C=makeR(c,1);
    const rhsExpr = subR(C, B);           // c - b
    const S = divR(rhsExpr, A);           // (c-b)/a (r√©duit)
    const fracDirect = quotientRaw(rhsExpr, A); // brut
    return {A,B,C,rhsExpr, S, fracDirect};
  },
  text(st){ return sideHTML(st.A, st.B) + " = " + fmtConstHTML(st.C); },
  render(host, st){
    host.innerHTML="";
    const row=document.createElement("div"); row.className="row";
    const lab=document.createElement("div"); lab.className="col-label equ"; lab.innerHTML=this.text(st); row.appendChild(lab);
    const inp=document.createElement("input"); inp.type="text"; inp.id="reponse"; inp.placeholder="x = 3  ou  3  ou  7/3"; row.appendChild(inp);
    const res=document.createElement("div"); res.id="res"; row.appendChild(res);
    host.appendChild(row);
  },
  correct(host, st){
    const got = normalizeAnswer($("#reponse",host).value);
    const ok = sameNumber(got, toNumber(st.S));
    $("#res",host).innerHTML = ok ? "‚úî" : `‚úò&nbsp;&nbsp;(attendu : ${ansHTML(st.S.p, st.S.q)})`;
    $("#res",host).className = ok ? "res-ok" : "res-ko";
    return {ok,total:1};
  },
  solution(host, st){
    let steps = [
      `${sideHTML(st.A, st.B)} = ${fmtConstHTML(st.C)}`,
      `${fmtCoeffXHTML(st.A)} = ${showDiffHTML(st.C, st.B)}`,
      `${fmtCoeffXHTML(st.A)} = ${fmtConstHTML(st.rhsExpr)}`,
      `x = ${fracHTML(st.fracDirect.p, st.fracDirect.q)}`
    ];
    if(needsSimplify(st.fracDirect)) steps.push(`${ansHTML(st.S.p, st.S.q)}`);
    steps = steps.map(normalizeSigns);
    $("#reponse",host).value = (st.S.q===1? String(st.S.p) : `${st.S.p}/${st.S.q}`);
    $("#res",host).innerHTML = `<div class="steps">${steps.map(t=>`<div class="step">${t}</div>`).join("")}</div>`;
    $("#res",host).className = "small";
  },
  reset(host){ $("#reponse",host).value=""; $("#res",host).textContent=""; }
};

/* 2) ax + b = cx + d (a,c ‚â† 0 et a ‚â† c ; entiers) */
const ex2 = {
  id: "lin_two_sides",
  title: "R√©soudre : ax + b = cx + d",
  gen(){
    let a=0,c=0; while(a===0) a=rnd(-8,8); while(c===0||c===a) c=rnd(-8,8);
    const b=rnd(-12,12), d=rnd(-12,12);
    const A=makeR(a,1), B=makeR(b,1), C=makeR(c,1), D=makeR(d,1);
    const L = subR(A,C), Rr = subR(D,B);
    const S = divR(Rr, L);
    const fracDirect = quotientRaw(Rr, L);
    return {A,B,C,D,L,Rr,S, fracDirect};
  },
  text(st){ return sideHTML(st.A,st.B) + " = " + sideHTML(st.C,st.D); },
  render(host, st){
    host.innerHTML="";
    const row=document.createElement("div"); row.className="row";
    const lab=document.createElement("div"); lab.className="col-label equ"; lab.innerHTML=this.text(st); row.appendChild(lab);
    const inp=document.createElement("input"); inp.type="text"; inp.id="reponse"; inp.placeholder="x = ‚Ä¶"; row.appendChild(inp);
    const res=document.createElement("div"); res.id="res"; row.appendChild(res);
    host.appendChild(row);
  },
  correct(host, st){
    const got = normalizeAnswer($("#reponse",host).value);
    const ok = sameNumber(got, toNumber(st.S));
    $("#res",host).innerHTML = ok ? "‚úî" : `‚úò&nbsp;&nbsp;(attendu : ${ansHTML(st.S.p, st.S.q)})`;
    $("#res",host).className = ok ? "res-ok" : "res-ko";
    return {ok,total:1};
  },
  solution(host, st){
    let steps = [
      `${sideHTML(st.A,st.B)} = ${sideHTML(st.C,st.D)}`,
      `${fmtCoeffXHTML(st.A)} ‚àí ${fmtCoeffXHTML(st.C)} = ${fmtConstHTML(st.D)} ‚àí ${fmtConstHTML(st.B)}`,
      `${fmtCoeffXHTML(st.L)} = ${fmtConstHTML(st.Rr)}`,
      `x = ${fracHTML(st.fracDirect.p, st.fracDirect.q)}`
    ];
    if(needsSimplify(st.fracDirect)) steps.push(`${ansHTML(st.S.p, st.S.q)}`);
    steps = steps.map(normalizeSigns);
    $("#reponse",host).value = (st.S.q===1? String(st.S.p) : `${st.S.p}/${st.S.q}`);
    $("#res",host).innerHTML = `<div class="steps">${steps.map(t=>`<div class="step">${t}</div>`).join("")}</div>`;
    $("#res",host).className="small";
  },
  reset(host){ $("#reponse",host).value=""; $("#res",host).textContent=""; }
};

/* 3) a(x+b)=c  ou  a(x+b)=c(x+d)+e (entiers ; a,c ‚â† 0) */
const ex3 = {
  id: "lin_parentheses",
  title: "R√©soudre avec parenth√®ses",
  gen(){
    const type = choice(["one_side","two_sides"]);
    if(type==="one_side"){
      let a=0; while(a===0) a=rnd(-6,6);
      const b=rnd(-6,6), c=rnd(-18,18);
      const A=makeR(a,1), B=makeR(b,1), C=makeR(c,1);
      const ab = mulR(A, B);
      const rhs = subR(C, ab);
      const S = divR(rhs, A);
      const fracDirect = quotientRaw(rhs, A);
      return {fmt:"one", A,B,C, ab, rhs, S, fracDirect};
    } else {
      let a=0,c=0; while(a===0) a=rnd(-6,6); while(c===0||c===a) c=rnd(-6,6);
      const b=rnd(-6,6), d=rnd(-6,6), e=rnd(-10,10);
      const A=makeR(a,1), B=makeR(b,1), C=makeR(c,1), D=makeR(d,1), E=makeR(e,1);
      const cd = mulR(C,D);
      const right = addR(cd, E);
      const left  = mulR(A,B);
      const Rr = subR(right, left);
      const L  = subR(A,C);
      const S  = divR(Rr, L);
      const fracDirect = quotientRaw(Rr, L);
      return {fmt:"two", A,B,C,D,E, cd, right, left, Rr, L, S, fracDirect};
    }
  },
  text(st){
    if(st.fmt==="one"){
      return (st.B.p===0? `${st.A.p}(x)` : `${st.A.p}(x ${st.B.p>0?'+':'-'} ${Math.abs(st.B.p)})`) + " = " + fmtConstHTML(st.C);
    }
    const left = (st.B.p===0? `${st.A.p}(x)` : `${st.A.p}(x ${st.B.p>0?'+':'-'} ${Math.abs(st.B.p)})`);
    const right= (st.D.p===0? `${st.C.p}(x)` : `${st.C.p}(x ${st.D.p>0?'+':'-'} ${Math.abs(st.D.p)})`) + (st.E.p===0? "" : (st.E.p>0? " + "+st.E.p : " - "+Math.abs(st.E.p)));
    return left + " = " + right;
  },
  render(host, st){
    host.innerHTML=""; const row=document.createElement("div"); row.className="row";
    const lab=document.createElement("div"); lab.className="col-label equ"; lab.innerHTML=this.text(st); row.appendChild(lab);
    const inp=document.createElement("input"); inp.type="text"; inp.id="reponse"; inp.placeholder="x = ‚Ä¶"; row.appendChild(inp);
    const res=document.createElement("div"); res.id="res"; row.appendChild(res);
    host.appendChild(row);
  },
  correct(host, st){ const got=normalizeAnswer($("#reponse",host).value); const ok=sameNumber(got, toNumber(st.S));
    $("#res",host).innerHTML = ok ? "‚úî" : `‚úò&nbsp;&nbsp;(attendu : ${ansHTML(st.S.p, st.S.q)})`;
    $("#res",host).className = ok ? "res-ok" : "res-ko"; return {ok,total:1}; },
  solution(host, st){
    let steps;
    if(st.fmt==="one"){
      steps = [
        `${st.A.p}(x ${st.B.p>=0?'+':'-'} ${Math.abs(st.B.p)}) = ${fmtConstHTML(st.C)}`,
        `${fmtCoeffXHTML(st.A)} + ${fmtConstHTML(st.ab)} = ${fmtConstHTML(st.C)}`,
        `${fmtCoeffXHTML(st.A)} = ${fmtConstHTML(st.C)} ‚àí ${fmtConstHTML(st.ab)}`,
        `${fmtCoeffXHTML(st.A)} = ${fmtConstHTML(st.rhs)}`,
        `x = ${fracHTML(quotientRaw(st.rhs, st.A).p, quotientRaw(st.rhs, st.A).q)}`
      ];
    } else {
      steps = [
        `${st.A.p}(x ${st.B.p>=0?'+':'-'} ${Math.abs(st.B.p)}) = ${st.C.p}(x ${st.D.p>=0?'+':'-'} ${Math.abs(st.D.p)})${st.E.p===0?'':(st.E.p>0?' + '+st.E.p : ' - '+Math.abs(st.E.p))}`,
        `${fmtCoeffXHTML(st.A)} + ${fmtConstHTML(st.left)} = ${fmtCoeffXHTML(st.C)} + ${fmtConstHTML(st.cd)} ${st.E.p===0?'':(st.E.p>0?' + '+fmtConstHTML(st.E):' ‚àí '+fmtConstHTML(absR(st.E)))}`,
        `${fmtCoeffXHTML(subR(st.A,st.C))} = ${fmtConstHTML(st.cd)} ${st.E.p===0?'':(st.E.p>0?' + '+fmtConstHTML(st.E):' ‚àí '+fmtConstHTML(absR(st.E)))} ‚àí ${fmtConstHTML(st.left)}`,
        `${fmtCoeffXHTML(st.L)} = ${fmtConstHTML(st.Rr)}`,
        `x = ${fracHTML(st.fracDirect.p, st.fracDirect.q)}`
      ];
    }
    if(needsSimplify(st.fracDirect)) steps.push(`${ansHTML(st.S.p, st.S.q)}`);
    steps = steps.map(normalizeSigns);
    $("#reponse",host).value=(st.S.q===1? String(st.S.p):`${st.S.p}/${st.S.q}`);
    $("#res",host).innerHTML = `<div class="steps">${steps.map(t=>`<div class="step">${t}</div>`).join("")}</div>`;
    $("#res",host).className="small";
  },
  reset(host){ $("#reponse",host).value=""; $("#res",host).textContent=""; }
};

/* 4) (px+q)/m = (rx+s)/n ‚Äî ENONC√â en fractions ‚Äúpile‚Äù (entiers) */
const ex4 = {
  id: "lin_fractions",
  title: "R√©soudre avec fractions (formes rationnelles)",
  gen(){
    const m = choice([2,3,4,5,6]), n = choice([2,3,4,5,6]);
    let p=0,r=0; while(p===0) p=rnd(-6,6); while(r===0) r=rnd(-6,6);
    const q=rnd(-8,8), s=rnd(-8,8);
    const M=makeR(m,1), N=makeR(n,1), P=makeR(p,1), Q=makeR(q,1), R=makeR(r,1), S0=makeR(s,1);
    let A = subR( mulR(N,P), mulR(M,R) ); if(isZero(A)){ R = makeR(r+1,1); A = subR( mulR(N,P), mulR(M,R) ); }
    const B = subR( mulR(M,S0), mulR(N,Q) );
    const Sol = divR(B,A);
    const fracDirect = quotientRaw(B, A);
    return {M,N,P,Q,R,S0, A,B, Sol, fracDirect};
  },
  textHTML(st){
    const leftNum  = st.Q.p===0 ? fmtCoeffXHTML(st.P) : (fmtCoeffXHTML(st.P) + (st.Q.p>0? " + "+fmtConstHTML(st.Q) : " ‚àí "+fmtConstHTML(absR(st.Q))));
    const rightNum = st.S0.p===0? fmtCoeffXHTML(st.R) : (fmtCoeffXHTML(st.R) + (st.S0.p>0? " + "+fmtConstHTML(st.S0) : " ‚àí "+fmtConstHTML(absR(st.S0))));
    const left  = fracExprHTML(leftNum, st.M.p);
    const right = fracExprHTML(rightNum, st.N.p);
    return `${left} = ${right}`;
  },
  render(host, st){
    host.innerHTML="";
    const row=document.createElement("div"); row.className="row";
    const lab=document.createElement("div"); lab.className="col-label equ"; lab.innerHTML=this.textHTML(st); row.appendChild(lab);
    const inp=document.createElement("input"); inp.type="text"; inp.id="reponse"; inp.placeholder="x = ‚Ä¶  (nombre ou fraction)"; row.appendChild(inp);
    const res=document.createElement("div"); res.id="res"; row.appendChild(res);
    host.appendChild(row);
  },
  correct(host, st){ const got=normalizeAnswer($("#reponse",host).value); const ok=sameNumber(got,toNumber(st.Sol));
    $("#res",host).innerHTML = ok ? "‚úî" : `‚úò&nbsp;&nbsp;(attendu : ${ansHTML(st.Sol.p, st.Sol.q)})`;
    $("#res",host).className = ok ? "res-ok" : "res-ko"; return {ok,total:1}; },
  solution(host, st){
    let steps = [
      `${this.textHTML(st)}`,
      `${st.N.p}( ${fmtCoeffXHTML(st.P)} ${st.Q.p===0?'':(st.Q.p>0?' + ':' ‚àí ')+fmtConstHTML(absR(st.Q))} ) = ${st.M.p}( ${fmtCoeffXHTML(st.R)} ${st.S0.p===0?'':(st.S0.p>0?' + ':' ‚àí ')+fmtConstHTML(absR(st.S0))} )`,
      `${fmtConstHTML(mulR(st.N,st.P))}x ${fmtSignedConstHTML(mulR(st.N,st.Q))} = ${fmtConstHTML(mulR(st.M,st.R))}x ${fmtSignedConstHTML(mulR(st.M,st.S0))}`,
      `${fmtCoeffXHTML(st.A)} = ${fmtConstHTML(st.B)}`,
      `x = ${fracHTML(st.fracDirect.p, st.fracDirect.q)}`
    ];
    if(needsSimplify(st.fracDirect)) steps.push(`${ansHTML(st.Sol.p, st.Sol.q)}`);
    steps = steps.map(normalizeSigns);
    $("#reponse",host).value=(st.Sol.q===1? String(st.Sol.p):`${st.Sol.p}/${st.Sol.q}`);
    $("#res",host).innerHTML = `<div class="steps">${steps.map(t=>`<div class="step">${t}</div>`).join("")}</div>`;
    $("#res",host).className="small";
  },
  reset(host){ $("#reponse",host).value=""; $("#res",host).textContent=""; }
};

/* 5) ax + b = cx + d (coeffs rationnels : entiers OU fractions ; a‚â†c) */
const ex5 = {
  id: "lin_two_sides_rational",
  title: "ax + b = cx + d (coefficients entiers ou fractions)",
  gen(){
    let A=randRational({allowZero:false}), C=randRational({allowZero:false});
    while(A.p===C.p && A.q===C.q){ C=randRational({allowZero:false}); }
    const B=randRational({allowZero:true}), D=randRational({allowZero:true});
    const L = subR(A,C), Rr = subR(D,B);
    const S = divR(Rr, L);
    const fracDirect = quotientRaw(Rr, L);
    return {A,B,C,D,L,Rr,S, fracDirect};
  },
  text(st){ return sideHTML(st.A,st.B) + " = " + sideHTML(st.C,st.D); },
  render(host, st){
    host.innerHTML="";
    const row=document.createElement("div"); row.className="row";
    const lab=document.createElement("div"); lab.className="col-label equ"; lab.innerHTML=this.text(st); row.appendChild(lab);
    const inp=document.createElement("input"); inp.type="text"; inp.id="reponse"; inp.placeholder="x = ‚Ä¶"; row.appendChild(inp);
    const res=document.createElement("div"); res.id="res"; row.appendChild(res);
    host.appendChild(row);
  },
  correct(host, st){ const got=normalizeAnswer($("#reponse",host).value); const ok=sameNumber(got,toNumber(st.S));
    $("#res",host).innerHTML = ok ? "‚úî" : `‚úò&nbsp;&nbsp;(attendu : ${ansHTML(st.S.p, st.S.q)})`;
    $("#res",host).className = ok ? "res-ok" : "res-ko"; return {ok,total:1}; },
  solution(host, st){
    let steps = [
      `${sideHTML(st.A,st.B)} = ${sideHTML(st.C,st.D)}`,
      `${fmtCoeffXHTML(st.A)} ‚àí ${fmtCoeffXHTML(st.C)} = ${fmtConstHTML(st.D)} ‚àí ${fmtConstHTML(st.B)}`,
      `${fmtCoeffXHTML(st.L)} = ${fmtConstHTML(st.Rr)}`,
      `x = ${fracHTML(st.fracDirect.p, st.fracDirect.q)}`
    ];
    if(needsSimplify(st.fracDirect)) steps.push(`${ansHTML(st.S.p, st.S.q)}`);
    steps = steps.map(normalizeSigns);
    $("#reponse",host).value=(st.S.q===1? String(st.S.p):`${st.S.p}/${st.S.q}`);
    $("#res",host).innerHTML = `<div class="steps">${steps.map(t=>`<div class="step">${t}</div>`).join("")}</div>`;
    $("#res",host).className="small";
  },
  reset(host){ $("#reponse",host).value=""; $("#res",host).textContent=""; }
};

/* 6) ax = b (a ‚â† 0 ; a et b entiers ou fractions) */
const ex6 = {
  id: "lin_ax_eq_b",
  title: "ax = b (a entier ou fraction, a ‚â† 0)",
  gen(){
    let A=randRational({allowZero:false}); // a ‚â† 0
    const B=randRational({allowZero:true});
    const S = divR(B,A);
    const fracDirect = quotientRaw(B, A);
    return {A,B,S, fracDirect};
  },
  text(st){ return fmtCoeffXHTML(st.A) + " = " + fmtConstHTML(st.B); },
  render(host, st){
    host.innerHTML="";
    const row=document.createElement("div"); row.className="row";
    const lab=document.createElement("div"); lab.className="col-label equ"; lab.innerHTML=this.text(st); row.appendChild(lab);
    const inp=document.createElement("input"); inp.type="text"; inp.id="reponse"; inp.placeholder="x = ‚Ä¶  (nombre ou fraction)"; row.appendChild(inp);
    const res=document.createElement("div"); res.id="res"; row.appendChild(res);
    host.appendChild(row);
  },
  correct(host, st){ const got=normalizeAnswer($("#reponse",host).value); const ok=sameNumber(got,toNumber(st.S));
    $("#res",host).innerHTML = ok ? "‚úî" : `‚úò&nbsp;&nbsp;(attendu : ${ansHTML(st.S.p, st.S.q)})`;
    $("#res",host).className = ok ? "res-ok" : "res-ko"; return {ok,total:1}; },
  solution(host, st){
    let steps = [
      `${fmtCoeffXHTML(st.A)} = ${fmtConstHTML(st.B)}`,
      `x = ${fracHTML(st.fracDirect.p, st.fracDirect.q)}`
    ];
    if(needsSimplify(st.fracDirect)) steps.push(`${ansHTML(st.S.p, st.S.q)}`);
    steps = steps.map(normalizeSigns);
    $("#reponse",host).value=(st.S.q===1? String(st.S.p):`${st.S.p}/${st.S.q}`);
    $("#res",host).innerHTML = `<div class="steps">${steps.map(t=>`<div class="step">${t}</div>`).join("")}</div>`;
    $("#res",host).className="small";
  },
  reset(host){ $("#reponse",host).value=""; $("#res",host).textContent=""; }
};

const REGISTRY = [ex1, ex2, ex3, ex4, ex5, ex6];
window.REGISTRY = REGISTRY; // pour exo-pdf-kit

/* ===== Bootstrap commun ===== */
let scoreOK=0, scoreTot=0;
function updateScore(){ $("#score").textContent = scoreOK+" / "+scoreTot; }

function buildOne(){
  const sel=$("#exo-select");
  const host=$("#host");
  const def=REGISTRY.find(e=>e.id===sel.value);
  if(!def) return;
  const state=def.gen();
  host.dataset.active = def.id;
  host.dataset.state = JSON.stringify(state);
  def.render(host, state);
  const inp = $("#reponse", host) || $("input[type=text]", host);
  if(inp) inp.focus();
}
function check(){
  const host=$("#host");
  const def=REGISTRY.find(e=>e.id===host.dataset.active);
  if(!def) return;
  const state=JSON.parse(host.dataset.state||"{}");
  const r = def.correct(host, state);
  if(r){ scoreOK += r.ok?1:0; scoreTot += (r.total||1); updateScore(); }
}
function solution(){
  const host=$("#host");
  const def=REGISTRY.find(e=>e.id===host.dataset.active);
  if(!def) return;
  const state=JSON.parse(host.dataset.state||"{}");
  def.solution(host, state);
}
function resetAll(){
  scoreOK=0; scoreTot=0; updateScore();
  const host=$("#host");
  const def=REGISTRY.find(e=>e.id===host.dataset.active);
  if(def) def.reset(host);
}

document.addEventListener("DOMContentLoaded", function(){
  const sel=$("#exo-select");
  REGISTRY.forEach(e=>{
    const opt=document.createElement("option");
    opt.value=e.id; opt.textContent=e.title;
    sel.appendChild(opt);
  });
  sel.addEventListener("change", buildOne);
  $("#btn-new").addEventListener("click", buildOne);
  $("#btn-check").addEventListener("click", check);
  $("#btn-solution").addEventListener("click", solution);
  $("#btn-reset").addEventListener("click", resetAll);

  sel.value = REGISTRY[0].id;
  buildOne();
  updateScore();
});
})();
</script><script defer="" src="../../../../js/math-kbd.js"></script><script defer="" src="../../../../js/exo-pdf-kit.js"></script><script>
document.addEventListener('DOMContentLoaded', function(){
  ExoPDF.init({
    title: 'Seconde ‚Äì Chapitre 1 ‚Äì √âquations du premier degr√©',
    lead:  'R√©soudre l‚Äô√©quation :',
    max: 50
  });
});
</script><script defer="" src="../../../../js/algebra-eval-patch.js"></script></body>
</html>
